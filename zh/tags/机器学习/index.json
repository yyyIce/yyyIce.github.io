[{"content":"\r Yamlæ–‡æ¡£ï¼šhttps://yaml.org/ å¯ä»¥å…ˆå‚çœ‹ä»–äººåšå®¢ï¼Œå¤§æ¦‚äº†è§£ä»¥åçœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œä½¿ç”¨ï¼Œä¸å»ºè®®ç›´æ¥çœ‹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚  \r \r1 Yamlç®€ä»‹  YAML is a human friendly data serialization language for all programming languages.\n ã€€YAML ï¼ˆå‘éŸ³ /ËˆjÃ¦mÉ™l/ ï¼‰æ˜¯ä¸€ç§é€‚ç”¨äºæ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„äººç±»å‹å¥½çš„æ•°æ®åºåˆ—åŒ–è¯­è¨€ã€‚å®ƒä¸“é—¨ç”¨æ¥å†™é…ç½®æ–‡ä»¶ã€‚å¯ä»¥åœ¨æœ¬ç« å¿«é€Ÿäº†è§£Yamlçš„ç»„æˆå’Œè¯­æ³•ã€‚\n1.1 åŸºæœ¬è¯­æ³•è§„åˆ™ ã€€å®ƒå…·æœ‰ä»¥ä¸‹åŸºæœ¬å¥æ³•è§„åˆ™ï¼š\n å¤§å°å†™æ•æ„Ÿï¼› ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œç¼©è¿›ä¸å…è®¸ä½¿ç”¨TABé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ï¼Œç¼©è¿›æ—¶ä¸è¦æ±‚ç©ºæ ¼æ•°ï¼Œç›¸åŒå±‚çº§å…ƒç´ å·¦ä¾§å¯¹é½å³å¯ï¼› #è¡¨ç¤ºæ³¨é‡Šè¿™ä¸€æ•´è¡Œçš„å­—ç¬¦ï¼› å†’å·ï¼šå†’å·åé¢å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä»¥å†’å·ç»“å°¾é™¤å¤–ï¼› çŸ­æ¨ªçº¿ï¼šä½¿ç”¨ä¸€ä¸ªçŸ­æ¨ªçº¿åŠ ä¸€ä¸ªç©ºæ ¼è¡¨ç¤ºåˆ—è¡¨é¡¹ï¼Œå¤šä¸ªé¡¹ä½¿ç”¨åŒæ ·çš„ç¼©è¿›æœºåˆ«ä½œä¸ºåŒä¸€åˆ—è¡¨ã€‚  ã€€æ”¯æŒæ•°æ®ç»“æ„åŒ…æ‹¬ï¼š\nï¼ˆ1ï¼‰å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆå¯ä»¥ç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/å“ˆå¸Œï¼ˆhashesï¼‰/å­—å…¸ï¼ˆdictionaryï¼‰ï¼Œé”®å€¼å¯¹å³\u0026lt;key\u0026gt;: \u0026lt;value\u0026gt;ï¼Œå¦‚name: Talentæ³¨æ„å†’å·åæœ‰ç©ºæ ¼ã€‚\nï¼ˆ2ï¼‰æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰/åˆ—è¡¨ï¼ˆlistï¼‰ï¼Œä»¥çŸ­æ¨ªçº¿å¼€å¤´å¹¶ä¸”å·¦å¯¹é½ä¸€åˆ—æˆ–ç›´æ¥å†™ä¸ºæ•°ç»„ï¼Œæ³¨æ„ä¸€ä¸ªçŸ­æ¨ªçº¿ä¸ºèµ·å§‹è¡¨ç¤ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ å¯ä»¥æ˜¯å¯¹è±¡ï¼ˆåŒ…å«åœ¨{}å†…ï¼‰ã€æ•°ç»„ï¼ˆåŒ…å«åœ¨[]å†…ï¼‰å’Œçº¯é‡ï¼ˆå­—ç¬¦ä¸²ã€æ•´æ•°ç­‰ï¼‰ä¾‹å¦‚ï¼š\n1 2 3 4 5 6  food:- chocolate- sweets- ice cream# æˆ–è¡Œå†…è¡¨ç¤ºfood:[chocolate, sweets, ice cream]  ï¼ˆ3ï¼‰å­—é¢é‡/çº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚åŒ…æ‹¬å­—ç¬¦ä¸²ï¼ˆé»˜è®¤ä¸ä½¿ç”¨å¼•å·è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨'string'ï¼‰ã€å¸ƒå°”å€¼ï¼ˆå…¨å¤§å†™æˆ–å…¨å°å†™å‡å¯ï¼ŒTRUE/trueï¼‰ã€æµ®ç‚¹æ•°ã€æ•´æ•°ã€Nullã€æ—¥æœŸï¼ˆyyyy-MM-ddï¼Œå¦‚2021-10-12ï¼‰ã€æ—¶é—´ï¼ˆ\u0026lt;æ—¥æœŸ\u0026gt;T\u0026lt;hh:mm:ss\u0026gt;+\u0026lt;æ—¶åŒº\u0026gt;ï¼Œå¦‚2021-10-12T15:15:16+08:00ï¼‰ã€‚\nã€€YAMLæ–‡ä»¶å¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ç»„æˆï¼Œæ–‡æ¡£é—´ä½¿ç”¨---åœ¨æ¯æ–‡æ¡£å¼€å§‹ä½œä¸ºåˆ†éš”ç¬¦ï¼Œç”¨...ä½œä¸ºç»“æŸç¬¦ã€‚å¦‚æœçŸ¥è¯†å•ä¸ªæ–‡æ¡£ï¼Œåˆ†éš”ç¬¦---å¯ä»¥çœç•¥ï¼›æ¯ä¸ªæ–‡æ¡£ä¹Ÿä¸éœ€è¦ä½¿ç”¨ç»“æŸç¬¦...æ¥è¡¨ç¤ºç»“æŸï¼Œä½†å¯¹äºç½‘ç»œä¼ è¾“æˆ–è€…æµæ¥è¯´ï¼Œæ˜ç¡®çš„ç»“æŸç¬¦å·æœ‰åˆ©äºè½¯ä»¶å¤„ç†ã€‚\n1.2 ç®€å•Yamlç¤ºä¾‹ ã€€ä¸€ä¸ªç®€å•çš„YAMLæ–‡ä»¶01_hello_yaml.ymlå¦‚ä¸‹ï¼Œ\n1 2 3 4  ---text:Hello, Yaml!date:2021-10-13...  ã€€å„ç§è¯­è¨€å‡èƒ½å¤Ÿå¯¹YAMLè¯­è¨€è¿›è¡Œè§£æï¼Œä¾‹å¦‚ä½¿ç”¨pythonè§£æYAMLæ–‡ä»¶ï¼Œå¯ä»¥æ£€æŸ¥YAMLæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚é¦–å…ˆå®‰è£…pyyamlæ¨¡å—ã€‚\n1  $ pip install pyyaml   ã€€ç„¶åç”¨pyyamlæ¨¡å—è§£ææˆ‘ä»¬å‰é¢çš„01_hello_yaml.ymlï¼Œå°†pythonæ–‡ä»¶ä¿å­˜ä¸º01_hello_yaml.pyï¼š\n1 2 3 4 5 6 7 8 9 10 11  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml file_path = \u0026#34;./01_hello_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è¯»å–åŒ…å«ä¸€ä¸ªymlæ–‡æ¡£å¯¹è±¡çš„ymlæ–‡ä»¶ yml_content = yaml.load(file.read(), Loader=yaml.Loader) print(yml_content) print(type(yml_content))   ã€€æŸ¥çœ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ç”¨pythonè§£æyamlæ–‡ä»¶ï¼Œä¼šå°†yamlçš„å†…å®¹è½¬æ¢ä¸ºä¸€ä¸ªdictå¯¹è±¡\n1 2 3  $ python3 01_hello_yaml.py {\u0026#39;text\u0026#39;: \u0026#39;Hello, Yaml!\u0026#39;, \u0026#39;date\u0026#39;: datetime.date(2021, 10, 13)} \u0026lt;class \u0026#39;dict\u0026#39;\u0026gt;   2 Yamlè¯­æ³•è§„åˆ™  Yamlè¯­æ³•è§„åˆ™ï¼šhttps://github.com/yaml/yaml-grammar/blob/master/yaml-spec-1.2.yaml\n ã€€åŸºæœ¬è¯­æ³•è§„åˆ™åœ¨1.1èŠ‚ä¸­å¯ä»¥æ‰¾åˆ°ã€‚\n2.1 å¤šä¸ªå¯¹è±¡æ–‡æ¡£æ–‡ä»¶ ã€€ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªçš„YAMLæ–‡ä»¶02_multi_yaml.ymlå¦‚ä¸‹ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªæ–‡æ¡£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ---text:Hello, Yaml!date:2021-10-13...---name:Talentsex:femaleage:16hobby:- swim- draw- delicious foodfavorite food:[chocolate, ice cream]family:father:LiMather:Liu...  ã€€å„ç§è¯­è¨€å‡èƒ½å¤Ÿå¯¹YAMLè¯­è¨€è¿›è¡Œè§£æï¼Œä¾‹å¦‚ä½¿ç”¨pythonè§£æYAMLæ–‡ä»¶ï¼Œå¯ä»¥æ£€æŸ¥YAMLæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚é¦–å…ˆå®‰è£…pyyamlæ¨¡å—ã€‚\n1  $ pip install pyyaml   ã€€ç„¶åç”¨pyyamlæ¨¡å—è§£ææˆ‘ä»¬å‰é¢çš„02_multi_yaml.ymlï¼Œå°†pythonæ–‡ä»¶ä¿å­˜ä¸º02_multi_yaml.pyï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml file_path = \u0026#34;./02_multi_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è§£æåŒ…å«å¤šä¸ªYAMLæ–‡ä»¶çš„ymlæ–‡ä»¶ yml_content = yaml.load_all(file.read(), Loader=yaml.Loader) for yml_i in yml_content: print(yml_i) print(type(yml_i))   ã€€æŸ¥çœ‹ç»“æœï¼š\n1 2 3 4 5  $ python3 02_multi_yaml.py {\u0026#39;text\u0026#39;: \u0026#39;Hello, Yaml!\u0026#39;, \u0026#39;date\u0026#39;: datetime.date(2021, 10, 13)} \u0026lt;class \u0026#39;dict\u0026#39;\u0026gt; {\u0026#39;name\u0026#39;: \u0026#39;Talent\u0026#39;, \u0026#39;sex\u0026#39;: \u0026#39;female\u0026#39;, \u0026#39;age\u0026#39;: 16, \u0026#39;hobby\u0026#39;: [\u0026#39;swim\u0026#39;, \u0026#39;draw\u0026#39;, \u0026#39;delicious food\u0026#39;], \u0026#39;favorite food\u0026#39;: [\u0026#39;chocolate\u0026#39;, \u0026#39;ice cream\u0026#39;], \u0026#39;family\u0026#39;: {\u0026#39;father\u0026#39;: \u0026#39;Li\u0026#39;, \u0026#39;Mather\u0026#39;: \u0026#39;Liu\u0026#39;}} \u0026lt;class \u0026#39;dict\u0026#39;\u0026gt;   2.2 å¤åˆç»“æ„  ç¨‹åºæ¥æºï¼šhttps://cloud.tencent.com/developer/article/1718377\n ã€€ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«å¤åˆç»“æ„çš„yamlæ–‡ä»¶03_compose_yaml.ymlï¼Œåœ¨åªæœ‰ä¸€ä¸ªyamlæ–‡æ¡£æ—¶å¯ä»¥çœç•¥---å’Œ...ã€‚æ³¨æ„çŸ­æ¨ªçº¿çš„è¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  shop:GoodShoppingaddress:BJgoods:Food:- sell_time:\u0026#34;AM 08:30\u0026#34;food01:potatofood02:porkFruits:- sell_time:\u0026#34;AM 09:00\u0026#34;- fruit01:orangeprice:3.50- fruit02:bananaprice:3.00Clothes:- sell_time:\u0026#34;AM 09:30\u0026#34;- clothe01- clothe02  ã€€æˆ‘ä»¬ç”¨pythonç¨‹åºè¾“å‡ºè§£æå‡ºæ¥çš„yamlæ–‡ä»¶ï¼Œè§‚å¯Ÿè¾“å‡ºæ ¼å¼ï¼Œä½“ä¼šçŸ­æ¨ªçº¿ä¹¦å†™æ ¼å¼çš„ç”¨æ³•åŒºåˆ«ï¼Œå°†pythonç¨‹åºå¦å­˜ä¸º03_compose_yaml.pyã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml import json file_path = \u0026#34;./03_compose_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è¯»å–åŒ…å«ä¸€ä¸ªymlæ–‡æ¡£å¯¹è±¡çš„ymlæ–‡ä»¶ yml_content = yaml.load(file.read(), Loader=yaml.Loader) print(yml_content) # print(json.dumps(yml_content, indent=2))   ã€€è¿è¡Œpythonç¨‹åºï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n1  {\u0026#39;shop\u0026#39;: \u0026#39;GoodShopping\u0026#39;, \u0026#39;goods\u0026#39;: {\u0026#39;Food\u0026#39;: [{\u0026#39;food02\u0026#39;: \u0026#39;pork\u0026#39;, \u0026#39;sell_time\u0026#39;: \u0026#39;AM 08:30\u0026#39;, \u0026#39;food01\u0026#39;: \u0026#39;rice\u0026#39;}], \u0026#39;Fruits\u0026#39;: [{\u0026#39;sell_time\u0026#39;: \u0026#39;AM 09:00\u0026#39;}, {\u0026#39;fruit01\u0026#39;: \u0026#39;orange\u0026#39;, \u0026#39;price\u0026#39;: 3.5}, {\u0026#39;price\u0026#39;: 3.0, \u0026#39;fruit02\u0026#39;: \u0026#39;banana\u0026#39;}], \u0026#39;clothes\u0026#39;: [{\u0026#39;sell_time\u0026#39;: \u0026#39;AM 09:30\u0026#39;}, \u0026#39;clothe01\u0026#39;, \u0026#39;clothe02\u0026#39;]}, \u0026#39;address\u0026#39;: \u0026#39;BJ\u0026#39;}   ã€€è¿™æ ·çœ‹éå¸¸ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠå®ƒè½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œå¹¶å¢åŠ ç¼©è¿›ï¼š\n1  print(json.dumps(yml_content, indent=2))   ã€€è¿è¡Œpythonç¨‹åºï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n å†’å·:åæ˜¯é”®å€¼ä¸­çš„å€¼ï¼Œå€¼å¯ä»¥æ˜¯å¯¹è±¡ï¼ˆç”¨{}åŒ…å«ï¼‰ã€æ•°ç»„æˆ–çº¯é‡ï¼› ä¸€åˆ—çŸ­æ¨ªçº¿-è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œç”¨[]åŒ…å«ï¼Œä¸€ä¸ª-åé¢æ˜¯æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ï¼› ä¸€ä¸ªçŸ­æ¨ªçº¿-åçš„å€¼è¡¨ç¤ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ•°ç»„å…ƒç´ å¯ä»¥æ˜¯å¯¹è±¡ï¼ˆç”¨{}åŒ…å«ï¼‰ã€æ•°ç»„ã€çº¯é‡ã€‚  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  { \u0026#34;shop\u0026#34;: \u0026#34;GoodShopping\u0026#34;, \u0026#34;address\u0026#34;: \u0026#34;BJ\u0026#34;, \u0026#34;goods\u0026#34;: { \u0026#34;Food\u0026#34;: [ { \u0026#34;sell_time\u0026#34;: \u0026#34;AM 08:30\u0026#34;, \u0026#34;food01\u0026#34;: \u0026#34;potato\u0026#34;, \u0026#34;food02\u0026#34;: \u0026#34;pork\u0026#34; } ], \u0026#34;Fruits\u0026#34;: [ { \u0026#34;sell_time\u0026#34;: \u0026#34;AM 09:00\u0026#34; }, { \u0026#34;fruit01\u0026#34;: \u0026#34;orange\u0026#34;, \u0026#34;price\u0026#34;: 3.5 }, { \u0026#34;fruit02\u0026#34;: \u0026#34;banana\u0026#34;, \u0026#34;price\u0026#34;: 3.0 } ], \u0026#34;Clothes\u0026#34;: [ { \u0026#34;sell_time\u0026#34;: \u0026#34;AM 09:30\u0026#34; }, \u0026#34;clothe01\u0026#34;, \u0026#34;clothe02\u0026#34; ] } }   2.3 å¼•ç”¨  å‚è€ƒï¼šhttps://www.runoob.com/w3cnote/yaml-intro.html\n ã€€YAMLè¯­è¨€å¯ä»¥é€šè¿‡å»ºç«‹é”šç‚¹æ¥å¿«é€Ÿæ·»åŠ é‡å¤å†…å®¹ï¼Œå¯¹åº”çš„ç¬¦å·ä¸è¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š\n \u0026amp;ï¼šå»ºç«‹é”šç‚¹ï¼ˆdefaultsï¼‰ï¼Œ\u0026amp;åè·Ÿé”šç‚¹åç§°ï¼› \u0026lt;\u0026lt;ï¼šåˆå¹¶åˆ°å½“å‰æ•°æ®ï¼Œåè·Ÿå†’å·:ï¼› *ï¼šå¼•ç”¨é”šç‚¹ï¼Œ*åè·Ÿé”šç‚¹åç§°ã€‚  ã€€æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæ–‡ä»¶04_ref_yaml.ymlæ¥ä½“ä¼šå¼•ç”¨çš„ç”¨æ³•ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œé¦–å…ˆä¸ºæƒ³è¦å¼•ç”¨çš„å†…å®¹å»ºç«‹é”šç‚¹ï¼Œé”šç‚¹åç§°ä¸ºdefaults_contentï¼Œç„¶ååœ¨developmentå’Œtestä¸­ç”¨*å¼•ç”¨é”šç‚¹ï¼Œæœ€åç”¨\u0026lt;\u0026lt;å°†é”šç‚¹å†…å®¹åˆå¹¶åˆ°æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11  defaults:\u0026amp;defaults_contentadapter:postgreshost:localhostdevelopment:database:myapp_development\u0026lt;\u0026lt;:*defaults_contenttest:database:myapp_test\u0026lt;\u0026lt;:*defaults_content  ã€€æˆ‘ä»¬å»ºç«‹pythonæ–‡ä»¶04_ref_yaml.pyè§£æyamlæ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml import json file_path = \u0026#34;./04_ref_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è¯»å–åŒ…å«ä¸€ä¸ªymlæ–‡æ¡£å¯¹è±¡çš„ymlæ–‡ä»¶ yml_content = yaml.load(file.read(), Loader=yaml.Loader) print(yml_content) print(json.dumps(yml_content, indent=2))   ã€€è¾“å‡ºJsonæ ¼å¼çš„ç»“æœå¦‚ä¸‹ï¼Œæˆ‘ä»¬ç¼–å†™è¾“å‡ºç»“æœè¿™æ ·å†…å®¹çš„yamlæ–‡ä»¶å’Œ04_ref_yaml.ymlçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  { \u0026#34;defaults\u0026#34;: { \u0026#34;adapter\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;localhost\u0026#34; }, \u0026#34;development\u0026#34;: { \u0026#34;adapter\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;localhost\u0026#34;, \u0026#34;database\u0026#34;: \u0026#34;myapp_development\u0026#34; }, \u0026#34;test\u0026#34;: { \u0026#34;adapter\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;localhost\u0026#34;, \u0026#34;database\u0026#34;: \u0026#34;myapp_test\u0026#34; } }   2.4 å­—ç¬¦ä¸² ã€€yamlå­—ç¬¦ä¸²é»˜è®¤ä¸ä½¿ç”¨å¼•å·è¡¨ç¤ºï¼›\n1  str:hello  ã€€å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦æ”¾åœ¨å¼•å·ï¼ˆå•å¼•å·åŒå¼•å·çš†å¯ï¼‰ä¸­ï¼›\n1  quotation_str:\u0026#34;Hello, world!\u0026#34;  ã€€åŒå¼•å·ä¸ä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œå¦‚æœå•å¼•å·å†…è¿˜æœ‰å•å¼•å·ï¼Œå¿…é¡»è¿ç»­ä½¿ç”¨ä¸¤ä¸ªå•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼›\n1 2 3  quotation_str:\u0026#39;hi,\\nyaml\u0026#39;double_quotation_str:\u0026#34;hi,\\nyaml\u0026#34;escape_character_str:\u0026#39;user\u0026#39;\u0026#39;s QoE\u0026#39;  ã€€å­—ç¬¦ä¸²å¯ä»¥å†™æˆå¤šè¡Œï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œå¿…é¡»æœ‰ç©ºæ ¼ç¼©è¿›ï¼Œæ¢è¡Œç¬¦ä¼šè¢«è½¬æ¢ä¸ºç©ºæ ¼ï¼›\n1 2 3  multi_line: str:firstlinesecondlinethirdline  ã€€å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨|ä¿ç•™æ¢è¡Œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨\u0026gt;å»æ‰æ¢è¡Œç¬¦ï¼Œ+è¡¨ç¤ºä¿ç•™å­—ç¬¦ä¸²æœ«å°¾çš„æ¢è¡Œç¬¦ï¼Œ-è¡¨ç¤ºåˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„æ¢è¡Œç¬¦ï¼›\n1 2 3 4 5 6 7 8 9 10 11 12  remain_line_break:|Foo barfold_line_break:\u0026gt;Foo barremain_end_line_break:|+Foo barfold_end_line_break:|-Foo bar  ã€€å­—ç¬¦ä¸²ä¸­å¯ä»¥æ’å…¥HTMLæ ‡è®°ã€‚\n1 2 3 4  html_content:|\u0026lt;p\u0026gt; This is a paragraph. \u0026lt;/p\u0026gt;  ã€€æˆ‘ä»¬ä½¿ç”¨ç¼–å†™æœ‰ä¸€ä¸ªç¤ºä¾‹05_str_yaml.ymlæ¥ä½“ä¼šyamlå­—ç¬¦ä¸²çš„ç”¨æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  str:helloquotation_str:\u0026#34;Hello, world!\u0026#34;quotation_str:\u0026#39;hi,\\nyaml\u0026#39;double_quotation_str:\u0026#34;hi,\\nyaml\u0026#34;escape_character_str:\u0026#39;user\u0026#39;\u0026#39;s QoE\u0026#39;multi_line_str:firstlinesecondlinethirdlineremain_line_break:|Foo bar testfold_line_break:\u0026gt;Foo bar testremain_end_line_break:|+Foo bar testfold_end_line_break:|-Foo bar testhtml_content:| \u0026lt;p\u0026gt; This is a paragraph. \u0026lt;/p\u0026gt;  ã€€ç”¨05_str_yaml.pyå¯¹yamlæ–‡ä»¶è¿›è¡Œè§£æï¼ŒæŸ¥çœ‹è¾“å‡ºï¼Œä½“ä¼šyamlçš„æ–¹ä¾¿ä¹‹å¤„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml import json file_path = \u0026#34;./05_str_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è¯»å–åŒ…å«ä¸€ä¸ªymlæ–‡æ¡£å¯¹è±¡çš„ymlæ–‡ä»¶ yml_content = yaml.load(file.read(), Loader=yaml.Loader) print(yml_content) print(json.dumps(yml_content, indent=2))   ã€€æŸ¥çœ‹Jsonæ ¼å¼çš„è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°åŒå¼•å·ä¸è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ¢è¡Œç¬¦è¢«è½¬æ¢æˆç©ºæ ¼ç­‰ä¸Šé¢æè¿°è¿‡çš„ç»“æœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  { \u0026#34;str\u0026#34;: \u0026#34;hello\u0026#34;, \u0026#34;quotation_str\u0026#34;: \u0026#34;hi,\\\\nyaml\u0026#34;, \u0026#34;double_quotation_str\u0026#34;: \u0026#34;hi,\\nyaml\u0026#34;, \u0026#34;escape_character_str\u0026#34;: \u0026#34;user\u0026#39;s QoE\u0026#34;, \u0026#34;multi_line_str\u0026#34;: \u0026#34;firstline secondline thirdline\u0026#34;, \u0026#34;remain_line_break\u0026#34;: \u0026#34;Foo\\nbar\\ntest\\n\u0026#34;, \u0026#34;fold_line_break\u0026#34;: \u0026#34;Foo bar test\\n\u0026#34;, \u0026#34;remain_end_line_break\u0026#34;: \u0026#34;Foo\\nbar\\ntest\\n\u0026#34;, \u0026#34;fold_end_line_break\u0026#34;: \u0026#34;Foo\\nbar\\ntest\u0026#34;, \u0026#34;html_content\u0026#34;: \u0026#34;\u0026lt;p\u0026gt; \\u00a0 \\n This is a paragraph. \\n\u0026lt;/p\u0026gt;\\n\u0026#34; }   2.5 å¼ºåˆ¶ç±»å‹è½¬æ¢ ã€€yamlå¯ç”¨åŒå¹å·!!çº¯é‡è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ ¼å¼ä¸º!!\u0026lt;å¼ºåˆ¶è½¬æ¢ç±»å‹\u0026gt; åŸå€¼ï¼Œä¾‹å¦‚06_type_cast_yaml.ymlï¼š\n1 2  float_to_str:!!str6.66str_to_int:!!int\u0026#34;888\u0026#34;  ã€€ç”¨06_type_cast_yaml.pyè§£æã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  #!/usr/bin/env python # -*- coding: utf-8 -*- import yaml import json file_path = \u0026#34;./06_type_cast_yaml.yml\u0026#34; file = open(file_path, \u0026#39;r\u0026#39;) # è¯»å–åŒ…å«ä¸€ä¸ªymlæ–‡æ¡£å¯¹è±¡çš„ymlæ–‡ä»¶ yml_content = yaml.load(file.read(), Loader=yaml.Loader) print(yml_content) print(json.dumps(yml_content, indent=2))   ã€€æŸ¥çœ‹jsonæ ¼å¼çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°åŸæ¥çš„æµ®ç‚¹æ•°å˜æˆäº†å­—ç¬¦ä¸²ï¼ŒåŸæ¥çš„å­—ç¬¦ä¸²å˜æˆäº†æ•´æ•°ï¼š\n1 2 3 4  { \u0026#34;float_to_str\u0026#34;: \u0026#34;6.66\u0026#34;, \u0026#34;str_to_int\u0026#34;: 888 }   3 ç¤ºä¾‹ä»£ç åœ°å€ ã€€é€šè¿‡ä¸‹åˆ—ä»£ç è·å–æœ¬æ–‡å…¨éƒ¨ç¤ºä¾‹ï¼š\n1  $ git clone https://github.com/yyyIce/yaml_exercise.git   å‚è€ƒèµ„æ–™ YAML è¯­è¨€æ•™ç¨‹ä¸ä½¿ç”¨æ¡ˆä¾‹ï¼šhttps://cloud.tencent.com/developer/article/1718377\nYAML å…¥é—¨æ•™ç¨‹ï¼šhttps://www.runoob.com/w3cnote/yaml-intro.html\n","description":"yamlçš„åŸºæœ¬è¯­æ³•ã€ä½¿ç”¨æ–¹æ³•å’Œä½¿ç”¨ç¤ºä¾‹","id":3,"section":"posts","tags":["yaml"],"title":"YAMLï¼šyamlåŸºæœ¬ä½¿ç”¨","uri":"https://yyyIce.github.io/zh/posts/yamlyaml%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"},{"content":"ã€€æ³¨ï¼šæœ¬èŠ‚é€‚åˆå¯¹å¸¸ç”¨æ•°æ®é›†æ“ä½œä¸€çŸ¥åŠè§£ä½†æ··æ·†ä¸æ¸…çš„äººç¾¤é˜…è¯»ï¼Œä¸é€‚åˆä¸€æ¡å¸¸ç”¨å‘½ä»¤éƒ½ä¸æ¸…æ¥šçš„äººç¾¤é˜…è¯»ã€‚å‚æ•°ã€è¿”å›å€¼ã€ä½¿ç”¨ç¤ºä¾‹è¿˜æ˜¯å®˜æ–¹æ–‡æ¡£å†™å¾—æ¸…æ¥šï¼Œåœ¨æœ‰æ‰€äº†è§£ã€æ€ç»´æ¸…æ™°åæ¨èä½¿ç”¨å®˜æ–¹æ–‡æ¡£ã€‚\n pandasæ–‡æ¡£ï¼šhttps://pandas.pydata.org/docs/reference/api/\nnumpyæ–‡æ¡£ï¼šhttps://numpy.org/doc/stable/reference/index.html\n 1 è¯»å…¥æ•°æ® ã€€æˆ‘ä»¬ä»¥ä¸€ç»„çç¼–çš„æ•°æ®ä¸ºä¾‹ï¼Œè¿™ç»„æ•°æ®ä¿å­˜åœ¨train.csvä¸­ï¼Œæˆ‘ä»¬é€šè¿‡train.csvè¿›è¡Œæ“ä½œï¼Œä½“ä¼šä»–ä»¬ä¹‹é—´çš„å·®å¼‚å’Œå…±é€šä¹‹å¤„ï¼Œæ™®é€šçš„æ•°æ®é›†csvæ–‡ä»¶å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å½¢å¼ï¼š\nã€€å½¢å¼Aâ€”â€”æ ‡å‡†è¡¨æ ¼å‹ï¼šä¸€ä¸ªå•å…ƒæ ¼ä¸€æ¡æ•°æ®ã€‚\nid\tfeature1\tfeature2 ... feature10 label\r1001\t1 5 ... 3\t1\r1002\t2 8 ... 7\t1\r1003\t5 6 ... 3\t1\r1004\t9 5 ... 4\t2\r1005\t2 2 ... 4 2\r1006\t6 4 ... 2\t0\r1007\t2 5 ... 7 0\r1008\t2 5 ... 1\t0\r1009\t3 1 ... 2 1\r1010\t7 9 ... 8\t2\r1011\t5 8 ... 8\t1\r1012\t4 1 ... 5 0\rã€€å½¢å¼Bâ€”â€”ç‰¹å¾ä¸€åˆ—å‹ï¼šç‰¹å¾ç”¨,è¿æ¥ï¼Œç‰¹å¾ç”¨ä¸€åˆ—æ¥è¡¨ç¤ºã€‚\nid\tfeature\tlabel\r1001\t1,5,2,3,8,9,2,1,1,3\t1\r1002\t2,8,9,4,4,4,6,1,0,7\t1\r1003\t5,6,9,7,4,1,2,5,1,3\t1\r1004\t9,5,4,1,5,6,3,2,1,4\t2\r1005\t2,2,2,2,2,1,4,4,4,4\t2\r1006\t6,4,5,8,1,1,4,3,7,2\t0\r1007\t2,5,8,9,1,6,1,5,6,7\t0\r1008\t2,5,6,7,8,9,2,1,1,1\t0\r1009\t3,1,2,4,1,5,6,7,1,2\t1\r1010\t7,9,5,1,2,3,4,4,1,8\t2\r1011\t5,8,7,7,5,6,1,2,2,8\t1\r1012\t4,1,6,8,3,2,7,1,6,5\t0\rã€€å½¢å¼Câ€”â€”ä¸€åˆ—å‹ï¼šä¸€å…±å°±ä¸€åˆ—ï¼Œç”¨åˆ†éš”ç¬¦éš”å¼€äº†ä¸åŒå«ä¹‰çš„æ•°æ®åˆ—ã€‚\nid|feature1|feature2|...|feature10|label\r1001|1|5|2|3|8|9|2|1|1|3|1\r1002|2|8|9|4|4|4|6|1|0|7|1\r1003|5|6|9|7|4|1|2|5|1|3|1\r1004|9|5|4|1|5|6|3|2|1|4|2\r1005|2|2|2|2|2|1|4|4|4|4|2\r1006|6|4|5|8|1|1|4|3|7|2|0\r1007|2|5|8|9|1|6|1|5|6|7|0\r1008|2|5|6|7|8|9|2|1|1|1|0\r1009|3|1|2|4|1|5|6|7|1|2|1\r1010|7|9|5|1|2|3|4|4|1|8|2\r1011|5|8|7|7|5|6|1|2|2|8|1\r1012|4|1|6|8|3|2|7|1|6|5|0\rã€€æ³¨æ„ä¸è¦æŠŠæ•°æ®å¤„ç†æˆä¸‹é¢çš„å½¢å¼ï¼Œè¿™æ ·çš„æ•°æ®å¦‚æœç”¨pd.read_csv('xxx.csv', sep='|')è¯»å…¥ï¼Œç”±äº,å’Œ|åŒæ—¶å­˜åœ¨ï¼Œå¯¼è‡´æ— æ³•æŠŠ1001|1,5,2,3,8,9,2,1,1,3|1åˆ†æˆ12åˆ—ï¼Œè€Œæ˜¯åˆ†æˆä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—çš„å€¼æ˜¯1001|1,5,2,3,8,9,2,1,1,3|1ï¼Œç¬¬äºŒä¸‰åˆ—éƒ½æ˜¯nanã€‚\nid|feature|label\r1001|1,5,2,3,8,9,2,1,1,3|1\r1002|2,8,9,4,4,4,6,1,0,7|1\r1003|5,6,9,7,4,1,2,5,1,3|1\r1004|9,5,4,1,5,6,3,2,1,4|2\r1005|2,2,2,2,2,1,4,4,4,4|2\r1006|6,4,5,8,1,1,4,3,7,2|0\r1007|2,5,8,9,1,6,1,5,6,7|0\r1008|2,5,6,7,8,9,2,1,1,1|0\r1009|3,1,2,4,1,5,6,7,1,2|1\r1010|7,9,5,1,2,3,4,4,1,8|2\r1011|5,8,7,7,5,6,1,2,2,8|1\r1012|4,1,6,8,3,2,7,1,6,5|0\rã€€å¯¹äºå½¢å¼Bå’ŒCï¼Œæˆ‘ä»¬é€šå¸¸éƒ½è¦å¤„ç†æˆå½¢å¼Açš„æ ¼å¼ï¼Œæ–¹ä¾¿å¤„ç†ã€‚ä»¥ä¸Šæ ¼å¼éƒ½æ˜¯å¤„ç†æ•°æ®é›†è¿‡ç¨‹ä¸­é‡åˆ°çš„å½¢å¼ï¼Œå¦‚æœé‡åˆ°æ–°çš„å†æ›´æ–°ã€‚\n1.1 Pandasè¯»å–å¹¶å¤„ç†CSVæ–‡ä»¶ ã€€åœ¨æ•°æ®é›†è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨pandasè¯»å…¥æ•°æ®ï¼Œå®ƒæä¾›çš„æ•°æ®å±‚æ¬¡åŒ–ç»“æ„éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿæ“ä½œæ•°æ®é›†ã€‚æˆ‘ä»¬å­˜å‚¨äº†ä¸‰ç§å½¢å¼çš„csvæ–‡ä»¶ï¼Œä»–ä»¬çš„æ•°æ®å†…å®¹å®Œå…¨ç›¸åŒï¼Œåªæœ‰å½¢å¼ä¸åŒï¼Œåˆ†åˆ«å‘½åä¸ºtrainA.csvã€trainB.csvå’ŒtrainC.csvã€‚\nã€€å½“æ•°æ®é›†æ–‡ä»¶æ˜¯Açš„å½¢å¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨pd.read_csv(\u0026lt;æ–‡ä»¶è·¯å¾„\u0026gt;)æ¥è¯»å–æ•°æ®é›†ï¼Œæˆ‘ä»¬å…ˆç›´æ¥è¯»å–ä¸‰ä¸ªæ–‡ä»¶ï¼ŒæŸ¥çœ‹ä»–ä»¬çš„å½¢çŠ¶ï¼ˆshapeï¼Œå³å‡ è¡Œå‡ åˆ—ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  import pandas as pd train_dataA = pd.read_csv(\u0026#39;trainA.csv\u0026#39;) train_dataB = pd.read_csv(\u0026#39;trainB.csv\u0026#39;) train_dataC = pd.read_csv(\u0026#39;trainC.csv\u0026#39;) print(train_dataA.shape) print(train_dataB.shape) print(train_dataC.shape) # è¾“å‡ºï¼š (12, 12) # Aæ˜¯12è¡Œï¼Œ12åˆ— (12, 3) # Bæ˜¯12è¡Œï¼Œ3åˆ— (12, 1) # Cæ˜¯12è¡Œï¼Œ1åˆ—   ã€€ä¸ºäº†ä¾¿äºå¤„ç†ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å½¢å¼Bå’Œå½¢å¼Céƒ½è½¬æ¢æˆå½¢å¼Açš„å½¢å¼ï¼Œå½¢å¼Cè½¬æ¢æˆå½¢å¼Açš„æ ¼å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨read_csvä¸­å¢åŠ ä¸€ä¸ªsepå‚æ•°ï¼Œä»–è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œå°†Cè¯»æˆ12è¡Œ12åˆ—çš„æ ¼å¼çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3  import pandas as pd train_dataC = pd.read_csv(\u0026#39;trainC.csv\u0026#39;,sep=\u0026#34;|\u0026#34;) print(train_dataC.shape)   ã€€å°†å½¢å¼Bè½¬æ¢ä¸ºå½¢å¼Cçš„æ“ä½œç¨å¾®å¤æ‚ï¼Œéœ€è¦å…ˆæå–å‡ºfeatureåˆ—ï¼Œç„¶åç”¨featureåˆ—strå±æ€§çš„splitæ–¹æ³•ï¼Œå°†featureåˆ—è½¬æ¢æˆ10åˆ—ï¼Œç„¶åå†å°†idå’Œlabelåˆ—åŠ å›å»å³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œstræ˜¯pandas.core.strings.accessor.StringMethodsç±»ï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™ç§ç”¨æ³•å’Œpythonä¸­çš„s1 = a.__str__()åŸç†ç±»ä¼¼ï¼Œs1æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œs2 = str(\u0026lt;string\u0026gt;)æ˜¯è°ƒç”¨äº†str()æ–¹æ³•ï¼Œs2æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  import pandas as pd # æå‡ºfeatureåˆ— train_dataB = pd.read_csv(\u0026#39;trainB.csv\u0026#39;) train_B_feature = train_dataB[\u0026#39;feature\u0026#39;] # \u0026lt;class \u0026#39;pandas.core.series.Series\u0026#39;\u0026gt; print(type(train_B_feature)) # å°†featureåˆ—çš„æ¯ä¸€è¡Œéƒ½è½¬æ¢ä¸ºstrå¯¹è±¡ï¼Œå†ç”¨\u0026#39;,\u0026#39;ï¼Œä½œä¸ºåˆ†éš”ç¬¦åˆ†å¼€ï¼Œè®¾ç½®expandå‚æ•°ä¸ºTrueï¼Œå°†åˆ†éš”ç»“æœå±•å¼€ã€‚ train_B_feature_expand = train_B_feature.str.split(\u0026#39;,\u0026#39;,expand = True) print(train_B_feature_expand) # \u0026lt;class \u0026#39;pandas.core.strings.accessor.StringMethods\u0026#39;\u0026gt; print(type(train_B_feature_expand.str)) # \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt; print(type(train_B_feature_expand)) # åŠ å…¥idå’Œlabelåˆ—ï¼Œtrain_B_feature_expandå°±æ˜¯å±•å¼€çš„train_dataB train_B_feature_expand[\u0026#39;id\u0026#39;] = train_dataB[\u0026#39;id\u0026#39;] train_B_feature_expand[\u0026#39;label\u0026#39;] = train_dataB[\u0026#39;label\u0026#39;] print(train_B_feature_expand) \u0026gt;\u0026gt;\u0026gt; 0 1 2 3 4 5 6 7 8 9 id label 0 1 5 2 3 8 9 2 1 1 3 1001 1 1 2 8 9 4 4 4 6 1 0 7 1002 1 2 5 6 9 7 4 1 2 5 1 3 1003 1 3 9 5 4 1 5 6 3 2 1 4 1004 2 4 2 2 2 2 2 1 4 4 4 4 1005 2 5 6 4 5 8 1 1 4 3 7 2 1006 0 6 2 5 8 9 1 6 1 5 6 7 1007 0 7 2 5 6 7 8 9 2 1 1 1 1008 0 8 3 1 2 4 1 5 6 7 1 2 1009 1 9 7 9 5 1 2 3 4 4 1 8 1010 2 10 5 8 7 7 5 6 1 2 2 8 1011 1 11 4 1 6 8 3 2 7 1 6 5 1012 0   ã€€æ³¨æ„expandå‚æ•°å¿…é¡»è®¾ç½®ä¸ºTrueæ‰ä¼šå±•å¼€ï¼Œå³ä¸€ä¸ªåˆ†éš”ç¬¦ä¸ºä¸€åˆ—ï¼Œå¦åˆ™å°†ä¼šå¾—åˆ°ä¸‹é¢è¿™æ ·çš„ä¸€åˆ—ç»“æœï¼Œå®ƒçš„ç±»å‹ä¸æ˜¯DataFrameè€Œæ˜¯Series\n0 [1, 5, 2, 3, 8, 9, 2, 1, 1, 3]\r1 [2, 8, 9, 4, 4, 4, 6, 1, 0, 7]\r2 [5, 6, 9, 7, 4, 1, 2, 5, 1, 3]\r3 [9, 5, 4, 1, 5, 6, 3, 2, 1, 4]\r4 [2, 2, 2, 2, 2, 1, 4, 4, 4, 4]\r5 [6, 4, 5, 8, 1, 1, 4, 3, 7, 2]\r6 [2, 5, 8, 9, 1, 6, 1, 5, 6, 7]\r7 [2, 5, 6, 7, 8, 9, 2, 1, 1, 1]\r8 [3, 1, 2, 4, 1, 5, 6, 7, 1, 2]\r9 [7, 9, 5, 1, 2, 3, 4, 4, 1, 8]\r10 [5, 8, 7, 7, 5, 6, 1, 2, 2, 8]\r11 [4, 1, 6, 8, 3, 2, 7, 1, 6, 5]\rName: feature, dtype: object\r\u0026lt;class 'pandas.core.series.Series'\u0026gt;\rè¿˜æœ‰æ—¶æˆ‘ä»¬ä¼šè¯»å–åˆ°æ²¡æœ‰åˆ—è¯´æ˜çš„csvæ–‡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·train_no_col_index.csvï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12  1001\t1,5,2,3,8,9,2,1,1,3\t1 1002\t2,8,9,4,4,4,6,1,0,7\t1 1003\t5,6,9,7,4,1,2,5,1,3\t1 1004\t9,5,4,1,5,6,3,2,1,4\t2 1005\t2,2,2,2,2,1,4,4,4,4\t2 1006\t6,4,5,8,1,1,4,3,7,2\t0 1007\t2,5,8,9,1,6,1,5,6,7\t0 1008\t2,5,6,7,8,9,2,1,1,1\t0 1009\t3,1,2,4,1,5,6,7,1,2\t1 1010\t7,9,5,1,2,3,4,4,1,8\t2 1011\t5,8,7,7,5,6,1,2,2,8\t1 1012\t4,1,6,8,3,2,7,1,6,5\t0   è¿™æ—¶æˆ‘ä»¬åªéœ€è¦è®¾ç½®header=Noneï¼Œå°±å¯ä»¥æ­£å¸¸è¯»å…¥ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œread_csvä¼šé»˜è®¤å°†ç¬¬ä¸€è¡Œè®¾ç½®ä¸ºåˆ—ç´¢å¼•ã€‚\n1    1.2 æŒ‰è¡Œè¯»å…¥CSV/txtæ–‡ä»¶ ã€€æœ‰æ—¶è¿˜ä¼šé‡‡ç”¨é€è¡Œè¯»å–çš„æ–¹å¼ï¼Œé€‚ç”¨äºä¸åŒcsvæ–‡ä»¶ä¹‹é—´å­˜åœ¨å…³è”çš„æƒ…å†µï¼Œæ¯”å¦‚A.csvçš„keyæ˜¯B.csvçš„ä¸€ä¸ªå±æ€§ã€‚æ–‡ä»¶é€è¡Œè¯»å–æ—¶å°†æ¯è¡Œä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ä¾æ¬¡è¯»å…¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªè¯»å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œä»»æ„åˆ†å‰²ã€æ‹†åˆ†ã€é‡ç»„ï¼Œé‡æ–°å†™å…¥åˆ°æ–°çš„csvæ–‡ä»¶ä¸­ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  with open(source_file, \u0026#34;r\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as fp, open(target_file, \u0026#34;w\u0026#34;) as gp: # é€è¡Œè¯»å– for line in fp: # è¯»å–æ¯ä¸€åˆ—çš„å€¼ï¼Œstrip()æ˜¯ç§»é™¤å­—ç¬¦ä¸²å¤´å°¾æŒ‡å®šçš„å­—ç¬¦ï¼ˆé»˜è®¤ä¸ºç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰æˆ–å­—ç¬¦åºåˆ—ã€‚ # line.strip().split(\u0026#34;|\u0026#34;)æ˜¯ä¸€ä¸ªlistï¼Œå½¢å¦‚[1,4,5,...], # line.strip().split(\u0026#34;|\u0026#34;)[0]å°±æ˜¯å–è¿™ä¸ªlistç´¢å¼•ä¸º0çš„å…ƒç´ ï¼Œå°±æ˜¯1ã€‚ col_0 = line.strip().split(\u0026#34;|\u0026#34;)[0] col_1 = line.strip().split(\u0026#34;|\u0026#34;)[1] ... col_n = line.strip().split(\u0026#34;|\u0026#34;)[n] # å°†æƒ³è¦æå–çš„åˆ—å†™å…¥ç›®æ ‡æ–‡ä»¶ gp.write(\u0026#34;{}|{}|...|{}\\n\u0026#34;.format(col_0, col_1, ..., col_n))    tqdmè¯¦ç»†ä½¿ç”¨ï¼šhttps://github.com/tqdm/tqdm\n ã€€æœ‰æ—¶æ–‡ä»¶è¿‡å¤§ï¼Œä¸çŸ¥é“æ–‡ä»¶è¯»å–åˆ°ä»€ä¹ˆä½ç½®ï¼Œä¹Ÿä¸æƒ³è¾“å‡ºåˆ°å±å¹•æˆ–æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥ç”¨tqdmåŒ…ä¸ºæ–‡ä»¶è¯»å–å¢åŠ è¿›åº¦æ¡ï¼Œå°†å¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™tqdm()å³å¯ã€‚ç®€å•ç”¨æ³•å¦‚ä¸‹ï¼ˆé«˜çº§ç”¨æ³•å¯æŸ¥çœ‹githubé¡µé¢ï¼Œè¿™é‡Œä»…éœ€è¦ç®€å•ç”¨æ³•å°±è¶³å¤Ÿï¼‰ï¼š\n1 2 3 4  from tqdm import tqdm with open(source_file, \u0026#34;r\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as fp, open(target_file, \u0026#34;w\u0026#34;) as gp: for line in tqdm(fp, \u0026#34;[INFO] loading from {} line-by-line...\u0026#34;.format(source_file_name)): ...   ã€€è¾“å‡ºåœ¨å±å¹•ä¸Šçš„è¿›åº¦æ ·å¼å¦‚ä¸‹:\n1 2 3 4 5  # è¯»æ–‡ä»¶ [INFO] loading from source_file line-by-line...: 2000000it [00:11, 177291.19it/s] # å†™æ–‡ä»¶ [INFO] write id and index to file...: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 351/351 [00:00\u0026lt;00:00, 846092.36it/s]   ã€€åç»­é‡åˆ°æ•°æ®é›†éå¸¸éå¸¸å¤§éœ€è¦é‡‡æ ·è¯»å–ä¼šæ›´æ–°é‡‡æ ·è¯»å–ï¼Œç›®å‰è¿˜æ²¡æ¥è§¦è¿‡ï¼Œæš‚æ—¶ä¸æã€‚\n1.3 è¯»å–npyæ–‡ä»¶ ã€€è¯»å–npyæ–‡ä»¶å¯ä»¥ä½¿ç”¨numpyè¯»å…¥ã€‚\n1  np_file = np.load(\u0026#39;data.npy\u0026#39;)   2 æ•°æ®æ¨¡å‹  å‚è€ƒå’Œå¼•ç”¨ï¼š\npython pandas stackå’Œunstackå‡½æ•°ï¼šhttps://www.cnblogs.com/bambipai/p/7658311.html\n ã€€åœ¨pandaså¤„ç†æ•°æ®æ—¶ï¼Œä¼šç”¨åˆ°stack()å’Œunstack()æ–¹æ³•ï¼Œå€Ÿç”¨ç¬¬ä¸€ä¸ªå‚è€ƒé“¾æ¥çš„è¯´æ³•ï¼Œstack()å‡½æ•°å°†æ•°æ®ä»è¡¨æ ¼ç»“æ„è½¬æ¢ä¸ºèŠ±æ‹¬å·ç»“æ„ï¼Œå³ä»å›¾1è½¬æ¢åˆ°å›¾2ï¼›è€Œunstack()å‡½æ•°å°†èŠ±æ‹¬å·ç»“æ„è½¬æ¢æˆè¡¨æ ¼ç»“æ„ï¼Œå³ä»å›¾2è½¬æ¢åˆ°å›¾1ã€‚\nå›¾1 è¡¨æ ¼ç»“æ„:\r\r å›¾2 èŠ±æ‹¬å·ç»“æ„:\r\r  å‚è€ƒå’Œå¼•ç”¨ï¼š\nä¸‰ç§æ•°æ®æ¨¡å‹\u0026mdash;å±‚æ¬¡æ¨¡å‹ã€ç½‘çŠ¶æ¨¡å‹ä»¥åŠå…³ç³»æ¨¡å‹ï¼šhttps://www.cnblogs.com/daniumeng/p/8717438.html\næ•°æ®æ¨¡å‹åŒ…æ‹¬ï¼šå±‚æ¬¡æ¨¡å‹ï¼ˆæ ‘çŠ¶å›¾ï¼‰ã€ç½‘çŠ¶æ¨¡å‹ï¼ˆæœ‰å‘å›¾ï¼‰ã€å…³ç³»æ¨¡å‹ï¼ˆè¡¨æ ¼ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è¯¦ç»†è¯´æ˜ï¼Œæƒ³è¦å…·ä½“äº†è§£å¯ä»¥è¿›å…¥å‚è€ƒè¿æ¥é˜…è¯»ã€‚\n ã€€è¿™ä¸¤ç§ç»“æ„å®é™…ä¸Šæ˜¯æ•°æ®æ¨¡å‹ä¸­çš„å±‚æ¬¡æ¨¡å‹ï¼ˆèŠ±æ‹¬å·ï¼Œå›¾2ï¼‰å’Œå…³ç³»æ¨¡å‹ï¼ˆè¡¨æ ¼ï¼Œå›¾1ï¼‰ã€‚å±‚æ¬¡æ¨¡å‹æ˜¯ä¸€ä¸ªæ ‘çŠ¶å›¾ï¼Œå®ƒåªæœ‰åˆ—æ–¹å‘ä¸Šçš„ç´¢å¼•ï¼Œç»“æ„ä¸Šåå‘å †å ï¼Œå°†åŸæ¥mè¡Œnåˆ—çš„å…ƒç´ æŒ‰ç…§[0][0]ã€[0][1]ã€[0][2]ã€\u0026hellip;ã€[0][n]ã€[1][0]ã€[1][1]ã€[1][2]ã€\u0026hellip;ã€[1][n]ã€\u0026hellip;ã€[m][n]çš„é¡ºåºå †æˆä¸€åˆ—ï¼Œæ‰€ä»¥å°†å…³ç³»æ¨¡å‹ï¼ˆå›¾1ï¼‰è½¬æ¢æˆå±‚æ¬¡æ¨¡å‹æ—¶ï¼Œè°ƒç”¨çš„æ˜¯stack()å‡½æ•°ï¼›å°†å±‚æ¬¡æ¨¡å‹è½¬æ¢æˆå…³ç³»æ¨¡å‹æ—¶ï¼Œä½¿ç”¨unstack()å‡½æ•°ï¼Œç”¨stack()å’Œunstack()å‡½æ•°è¿›è¡Œå›¾1å’Œå›¾2çš„è½¬åŒ–ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  import numpy as np import pandas as pd # np.arange(1,7) = [1,2,3,4,5,6] # reshapeæ–¹æ³•å°†æ•°ç»„è½¬æ¢ä¸º2è¡Œ3åˆ—çš„å½¢çŠ¶ # np.arange(1,7).reshape((2,3)) = [ [1, 2, 3], [4, 5, 6] ] data = pd.DataFrame(np.arange(1,7).reshape((2,3)), index=pd.Index([\u0026#39;street1\u0026#39;,\u0026#39;street2\u0026#39;]), columns=pd.Index([\u0026#39;one\u0026#39;,\u0026#39;two\u0026#39;,\u0026#39;three\u0026#39;])) print(data) print(\u0026#39;-----------------------------------------\\n\u0026#39;) data_tree = data.stack() print(data_tree) print(type(data_tree)) print(data_tree.shape) print(\u0026#39;-----------------------------------------\\n\u0026#39;) data_table = data_tree.unstack() print(data_table) print(type(data_table)) print(data_table.shape)   ã€€è¾“å‡ºå¦‚ä¸‹ï¼Œå…¶ä¸­(6,)è¡¨ç¤ºæœ‰6ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„ï¼Œ(2,3)è¡¨ç¤º2è¡Œ3åˆ—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  one two three street1 1 2 3 street2 4 5 6 ----------------------------------------- street1 one 1 two 2 three 3 street2 one 4 two 5 three 6 dtype: int32 \u0026lt;class \u0026#39;pandas.core.series.Series\u0026#39;\u0026gt; (6,) ----------------------------------------- one two three street1 1 2 3 street2 4 5 6 \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt; (2, 3)   ã€€å¸¸ç”¨stack()å°†æ•°æ®è½¬åˆ—å¤„ç†ï¼Œå°†å„ç»´ç‰¹å¾ç”¨ä½œæ—¶é—´åºåˆ—ä¸­çš„æ—¶é—´ä¿¡å·ã€‚\n3 ç­›é€‰æ•°æ® ã€€å¾ˆå¤šç½‘ä¸Šçš„å®è·µç¤ºä¾‹ä»£ç å¯¹æ•°æ®è¿›è¡Œäº†ä¸€äº›å‡†å¤‡å·¥ä½œï¼Œä½†åŸºæœ¬æ²¡æœ‰æ³¨é‡Šï¼Œå¾ˆéš¾çœ‹æ‡‚ï¼Œæ¯”å¦‚å–è¡Œå…ƒç´ ã€åˆ—å…ƒç´ ï¼Œé‡ç½®ç´¢å¼•ï¼Œå°†æŸåˆ—åˆ—ä¸ºç´¢å¼•ç­‰ç­‰ï¼Œæƒ³ä¸å‡ºè¦è¿™æ ·åšçš„åŸå› ã€‚å„ç§æ–¹æ³•äº¤ç»‡åœ¨ä¸€èµ·ï¼Œäº”ï¼ˆluanï¼‰èŠ±ï¼ˆqiï¼‰å…«ï¼ˆbaï¼‰é—¨ï¼ˆzaoï¼‰ï¼Œæ°´å¹³å„ä¸ç›¸åŒçš„ç¤ºä¾‹è®©äººçœ¼èŠ±ç¼­ä¹±ï¼Œç„¶åå¤´æ™•ç¨‹åº¦åŠ å€ğŸ˜±ï¼Œåˆ°æœ€åä¹Ÿæ²¡çœ‹æ‡‚ã€‚æœ¬èŠ‚å¯¹å–æŒ‡å®šè¡Œåˆ—å…ƒç´ å’Œç´¢å¼•ä¿®æ”¹æ–¹æ³•è¿›è¡Œå½’çº³æ€»ç»“ã€‚\nã€€åŒæ ·åœ°ï¼Œæˆ‘ä»¬å…ˆå¯¼å…¥pandaså’Œnumpyã€‚\n1 2  import numpy as np import pandas as pd   3.1 DataFrameå®šåˆ¶ç´¢å¼•  å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/110819220?from_voters_page=true\n ã€€å¯¹ç´¢å¼•çš„æ“ä½œä¹Ÿæ˜¯æ•°æ®æ ¼å¼å¤„ç†æ—¶çš„å¸¸ç”¨æ“ä½œã€‚æˆ‘ä»¬å…ˆè¯»å…¥æ•°æ®é›†trainB.csvï¼Œç„¶åå¯¹ç‰¹å¾è¿›è¡Œè½¬åˆ—å¤„ç†ã€‚å¯ä»¥çœ‹åˆ°è¾“å‡ºå˜æˆäº†ç¬¬2èŠ‚æåˆ°çš„å±‚æ¬¡æ¨¡å‹ï¼Œè¿™é‡Œå‰ä¸¤åˆ—æ˜¯å®ƒçš„ç´¢å¼•ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°å®ƒçš„å½¢çŠ¶æ˜¯ä¸€ä¸ªæœ‰120ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  train_dataB = pd.read_csv(\u0026#39;trainB.csv\u0026#39;) train_dataB_feature = train_dataB[\u0026#39;feature\u0026#39;].str.split(\u0026#34;,\u0026#34;, expand=True).stack() print(train_dataB_feature) print(train_dataB_feature.shape) # è¾“å‡º 0 0 1 1 5 2 2 3 3 4 8 .. 11 5 2 6 7 7 1 8 6 9 5 Length: 120, dtype: object (120,)   ã€€ï¼ˆ1ï¼‰é‡ç½®è¡Œç´¢å¼•ï¼šDataFrame.reset_index()\nã€€reset_index()é‡ç½®DataFrameæ•°æ®çš„è¡Œç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™æ·»åŠ ä¸€åˆ—ä»0å¼€å§‹çš„è¿ç»­è‡ªç„¶æ•°ä½œä¸ºè¡Œç´¢å¼•ï¼Œå¹¶å°†åŸæ¥çš„ç´¢å¼•åˆ—æ·»åŠ ä¸ºæ•°æ®åˆ—ã€‚\n1  DataFrame.reset_index(level=None, drop=False, inplace=False, col_level=0, col_fill=\u0026#39;\u0026#39;)    levelï¼šç±»å‹å¯ä»¥æ˜¯intã€strã€tupleæˆ–listã€‚è¡¨ç¤ºåˆ é™¤çš„ç´¢å¼•çº§åˆ«ï¼Œä»…ä»ç´¢å¼•ä¸­åˆ é™¤ç»™å®šçº§åˆ«ã€‚é»˜è®¤å€¼ä¸ºNoneï¼Œè¡¨ç¤ºç§»é™¤æ‰€æœ‰çº§åˆ«çš„ç´¢å¼•ã€‚ **dropï¼š**å¸ƒå°”ç±»å‹ï¼Œå½“å€¼ä¸ºFalseæ—¶ï¼ŒåŸæœ‰ç´¢å¼•åˆ—ä¼šå˜æˆæ•°æ®åˆ—ï¼Œå¦åˆ™åŸç´¢å¼•åˆ—ä¼šè¢«åˆ é™¤ã€‚é»˜è®¤å€¼ä¸ºFalseã€‚ inplaceï¼šå¸ƒå°”ç±»å‹ï¼Œè¡¨ç¤ºæ˜¯å¦åœ¨åŸæ•°æ®ä¸Šæ“ä½œï¼Œé»˜è®¤ä¸ºFalseã€‚ col_levelï¼šç±»å‹ä¸ºintæˆ–strï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå¦‚æœåˆ—æœ‰å¤šä¸ªçº§åˆ«ï¼Œåˆ™ç¡®å®šå°†åˆ—æ ‡ç­¾æ’å…¥åˆ°å“ªä¸ªçº§åˆ«ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†æ’å…¥åˆ°ç¬¬ä¸€çº§ã€‚ **col_fillï¼š**å¯¹è±¡ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²''ï¼Œå¦‚æœåˆ—æœ‰å¤šä¸ªçº§åˆ«ï¼Œåˆ™ç¡®å®šå…¶ä»–çº§åˆ«çš„å‘½åæ–¹å¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™é‡å¤ç´¢å¼•åã€‚  ã€€å¸¸ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\n æ•°æ®æ¸…æ´—åï¼Œä¼šå°†å¸¦ç©ºå€¼çš„è¡Œåˆ é™¤ï¼Œæ­¤æ—¶DataFrameæˆ–Seriesç±»å‹çš„æ•°æ®ä¸å†æ˜¯è¿ç»­çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨reset_index()é‡ç½®ç´¢å¼•ã€‚ å°†æ•°æ®è½¬åˆ—å¤„ç†åï¼Œå¸Œæœ›å°†åŸæœ‰ç´¢å¼•è½¬æ¢ä¸ºæ•°æ®åˆ—ã€‚  ã€€è¿™é‡Œæˆ‘ä»¬ä»¥å°†åŸæœ‰ç´¢å¼•è½¬æ¢ä¸ºæ•°æ®åˆ—ä¸ºä¾‹ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†™train_dataB_feature.reset_index(inplace=True)ï¼Œå› ä¸ºtrain_dataB_featureæ˜¯Seriesç±»å‹ï¼Œè€Œreset_indexä¸èƒ½å°†åŸæœ‰çš„Seriesç±»å‹è½¬æ¢ä¸ºDataFrameç±»å‹ï¼Œä½†æ˜¯å¯ä»¥æ ¹æ®åŸæœ‰çš„Seriesç±»å‹åˆ›å»ºä¸€ä¸ªæ–°çš„DataFrameç±»å‹çš„å˜é‡ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥çš„ä¸¤çº§ç´¢å¼•åˆ†åˆ«å¯¹åº”äºlevel_0ï¼Œlevel_1ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  train_dataB_feature = train_dataB_feature.reset_index() print(train_dataB_feature) print(type(train_dataB_feature)) print(train_dataB_feature.shape) # è¾“å‡º level_0 level_1 0 0 0 0 1 1 0 1 5 2 0 2 2 3 0 3 3 4 0 4 8 .. ... ... .. 115 11 5 2 116 11 6 7 117 11 7 1 118 11 8 6 119 11 9 5 [120 rows x 3 columns] \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt; (120, 3)   ã€€ï¼ˆ2ï¼‰è®¾ç½®æŸä¸€åˆ—ä½œä¸ºè¡Œç´¢å¼•ï¼šDataFrame.set_index()\n1  DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False)    keysï¼šåˆ—æ ‡ç­¾ï¼ˆå¦‚ä¸Šé¢çš„level_0ï¼‰/åˆ—æ ‡ç­¾åˆ—è¡¨ï¼Œè¿™ä¸€/å‡ åˆ—å°†è¢«è®¾ç½®ä¸ºè¡Œç´¢å¼•ã€‚ dropï¼šå¸ƒå°”ç±»å‹ï¼Œå€¼ä¸ºTrueè¡¨ç¤ºè®¾ç½®ä¸ºç´¢å¼•çš„è¿™ä¸€åˆ—ä¸å†æ˜¯æ•°æ®ï¼Œé»˜è®¤å€¼ä¸ºTrueã€‚ appendï¼šå¸ƒå°”ç±»å‹ï¼Œè¡¨ç¤ºæ˜¯å¦å°†åˆ—é™„åŠ åˆ°ç°æœ‰ç´¢å¼•ï¼Œå³æ–°å¢ä¸€çº§ç´¢å¼•åˆ—ï¼Œé»˜è®¤å€¼ä¸ºFalseã€‚ inplaceï¼šå¸ƒå°”ç±»å‹ï¼Œè¡¨ç¤ºæ˜¯å¦ç›´æ¥åœ¨å½“å‰æ•°æ®ä¸Šæ“ä½œï¼Œé»˜è®¤å€¼Falseã€‚ verify_integrityï¼šå¸ƒå°”ç±»å‹ï¼Œæ²¡çœ‹æ‡‚ï¼Œå°†å…¶è®¾ç½®ä¸ºfalseå°†æé«˜è¯¥æ–¹æ³•çš„æ€§èƒ½ï¼Œé»˜è®¤å€¼ä¸ºFalseã€‚  ã€€æˆ‘ä»¬å°†ä¸Šé¢çš„level_0è®¾ç½®ä¸ºæ–°ç´¢å¼•ï¼Œè¿™æ¬¡æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨train_dataB_featureä¸Šä¿®æ”¹ï¼Œå› ä¸ºå®ƒå·²ç»è¢«ä¿®æ”¹ä¸ºDataFrameç±»å‹ã€‚å¯ä»¥çœ‹åˆ°åŸæœ‰ç´¢å¼•åˆ—è¢«æ›¿æ¢ï¼Œå¹¶ä¸”level_0ä¸å†æ˜¯æ•°æ®åˆ—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  train_dataB_feature.set_index(\u0026#39;level_0\u0026#39;,inplace=True) print(train_dataB_feature) print(train_dataB_feature.shape) # è¾“å‡º level_1 0 level_0 0 0 1 0 1 5 0 2 2 0 3 3 0 4 8 ... ... .. 11 5 2 11 6 7 11 7 1 11 8 6 11 9 5 [120 rows x 2 columns] (120, 2)   ã€€ï¼ˆ3ï¼‰ç´¢å¼•åç§°é‡å‘½åï¼šDataFrame.rename()\nã€€DataFrameçš„ç´¢å¼•åç§°å®šä¹‰åœ¨DataFrame.index.nameå’ŒDataFrame.columns.nameä¸­ã€‚è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•éƒ½å¯ä»¥é‡å‘½åï¼Œé€šå¸¸è¡Œç´¢å¼•ç”¨indexæˆ–axis=0è¡¨ç¤ºï¼Œåˆ—ç´¢å¼•ç”¨columnsæˆ–axis=1è¡¨ç¤ºã€‚ç´¢å¼•çº§åˆ«ä¹Ÿå¯ä»¥é‡å‘½åï¼Œæš‚æ—¶ç”¨ä¸åˆ°ï¼Œä¸åšä»‹ç»ã€‚å¯ä»¥ç”¨DataFrame.rename()æ–¹æ³•é‡å‘½åç´¢å¼•åç§°ã€‚\n1  DataFrame.rename(mapper=None, index=None, columns=None, axis=None, copy=True, inplace=False, level=None, errors=\u0026#39;ignore\u0026#39;)   ã€€ä½¿ç”¨æ—¶ä¼ å…¥å­—å…¸å½¢çŠ¶çš„å‚æ•°ç»™indexå°±å¯ä»¥ä¿®æ”¹è¡Œç´¢å¼•ï¼Œä¼ é€’ç»™columnså°±å¯ä»¥ä¿®æ”¹åˆ—ç´¢å¼•åç§°ï¼Œå…¶ä½™å‚æ•°æ²¡æœ‰å¼„æ¸…æ¥šæ–‡æ¡£è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæš‚æ—¶ä¸å†™ã€‚\nã€€æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„ç¤ºä¾‹ï¼Œå°†åˆ—ç´¢å¼•é‡æ–°å‘½åï¼Œæˆ‘ä»¬å°†10ç»´ç‰¹å¾è¡¨ç¤ºä¸ºä¸€ä¸ªæœ‰10ä¸ªä¿¡å·çš„æ—¶é—´åºåˆ—ç‰¹å¾ï¼Œå…±12ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬å…±10ä¸ªä¿¡å·ï¼Œlevel_1é‡å‘½åä¸ºtimeï¼Œè¡¨ç¤ºæ—¶é—´æ­¥ï¼Œå³å…·æœ‰ç›¸åŒæ—¶é—´é—´éš”çš„æ—¶åˆ»ï¼Œå°†0åˆ—é‡å‘½åä¸ºsignalï¼Œè¡¨ç¤ºè¯¥æ—¶åˆ»çš„æ—¶é—´ä¿¡å·ï¼›åŒæ—¶å–æ¶ˆè¡Œç´¢å¼•çš„åç§°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  # å–æ¶ˆè¡Œç´¢å¼• train_dataB_feature.index.name = None # ä¿®æ”¹åˆ—ç´¢å¼•åç§° train_dataB_feature.rename(columns={\u0026#34;level_1\u0026#34;:\u0026#34;time\u0026#34;, 0:\u0026#34;signals\u0026#34;}, inplace=True) print(train_dataB_feature) # è¾“å‡º time signals 0 0 1 0 1 5 0 2 2 0 3 3 0 4 8 .. ... .. 11 5 2 11 6 7 11 7 1 11 8 6 11 9 5 [120 rows x 2 columns]   3.2 æ•°æ®ç±»å‹è½¬æ¢ ã€€ï¼ˆ1ï¼‰DataFrameæ•°æ®ç±»å‹è½¬æ¢ï¼šDataFrame.astype()\nã€€åœ¨DataFrameä¸­æ•°æ®ç±»å‹ä¸èƒ½ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œéœ€è¦ä½¿ç”¨.astype(\u0026lt;ç±»å‹\u0026gt;)æ–¹æ³•ï¼Œå¯ä»¥è½¬æ¢ä¸€åˆ—çš„æ•°æ®ç±»å‹ï¼Œæ¥ä¸Šé¢3.1çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°†signalsä»æ•´å‹è½¬æ¢æˆfloatç±»å‹ã€‚\nã€€å¯ä»¥ä»è¾“å‡ºä¸­çœ‹åˆ°ï¼Œsignalsçš„æ•°æ®æ·»åŠ äº†å°æ•°ç‚¹ï¼Œè€Œtimeçš„æ•°æ®ç±»å‹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬ç”¨infoè¾“å‡ºæ•°æ®åŸºæœ¬ä¿¡æ¯æ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®ç±»å‹æ˜¯ä»¥åˆ—ä¸ºå•ä½çš„ï¼ŒåŒä¸€åˆ—çš„æ•°æ®ç±»å‹æ˜¯ç»Ÿä¸€çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æ›´æ”¹æŸä¸€ä¸ªå…ƒç´ çš„ç±»å‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  train_dataB_feature[\u0026#39;signals\u0026#39;] = train_dataB_feature[\u0026#39;signals\u0026#39;].astype(float) print(train_dataB_feature) print(train_dataB_feature.info()) # è¾“å‡º time signals 0 0 1.0 0 1 5.0 0 2 2.0 0 3 3.0 0 4 8.0 .. ... ... 11 5 2.0 11 6 7.0 11 7 1.0 11 8 6.0 11 9 5.0 [120 rows x 2 columns] \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt; Int64Index: 120 entries, 0 to 11 Data columns (total 2 columns): # Column Non-Null Count Dtype  --- ------ -------------- ----- 0 time 120 non-null int64 1 signals 120 non-null float64 dtypes: float64(1), int64(1) memory usage: 2.8 KB   3.3 DataFrameæ“ä½œæŒ‡å®šè¡Œåˆ—æ•°æ®  å‚è€ƒï¼š\npandasè·å¾—æŒ‡å®šè¡Œ_pandaså–dataframeç‰¹å®šè¡Œ/åˆ—ï¼šhttps://blog.csdn.net/weixin_39586825/article/details/111758506\n ã€€æˆ‘ä»¬ä»¥trainA.csvçš„æ•°æ®ä¸ºä¾‹è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆå¯¼å…¥pandasåŒ…å¹¶è¯»å…¥trainA.csvã€‚\n1 2 3 4 5 6  # DataFrameè¡Œåˆ—æ“ä½œ import pandas as pd # è¯»å…¥æ•°æ® train_dataA = pd.read_csv(\u0026#39;/kaggle/input/d/xianyuice/basic-opt/trainA.csv\u0026#39;) train_dataA.head()   3.3.1 å–è¡Œ/åˆ— ã€€DataFrameå–è¡Œåˆ—æ•°æ®æ¯”æ•°ç»„ç¨å¾®å¤æ‚ï¼Œå…·ä½“å¯è¿›å…¥å‚è€ƒé“¾æ¥æŸ¥è¯¢ï¼Œè¿™é‡Œåªä»‹ç»æœ€å¸¸ç”¨çš„å‡ ç§æ“ä½œã€‚\nã€€ï¼ˆ1ï¼‰ç›´æ¥å–åˆ—æ•°æ®\n å–1åˆ—ï¼šdataframe['\u0026lt;col_name\u0026gt;']ï¼› å–2åˆ—ï¼šdataframe[[\u0026lt;col_name1\u0026gt;', \u0026lt;col_name\u0026gt;2']]ã€‚  ã€€æ³¨æ„å–1åˆ—æ—¶å¾—åˆ°çš„æ•°æ®ç±»å‹æ˜¯Seriesã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  # å–1åˆ—ï¼Œå–feature2åˆ— feature2 = train_dataA[\u0026#39;feature2\u0026#39;] print(feature2) print(type(feature2)) # å–2åˆ—ï¼Œ dataframe[[\u0026lt;col_name1\u0026gt;\u0026#39;, \u0026lt;col_name\u0026gt;2\u0026#39;]] feature23 = train_dataA[[\u0026#39;feature2\u0026#39;,\u0026#39;feature3\u0026#39;]] print(feature23) print(type(feature23)) # è¾“å‡º 0 5 1 8 2 6 ... ... 11 1 Name: feature2, dtype: int64 \u0026lt;class \u0026#39;pandas.core.series.Series\u0026#39;\u0026gt; feature2 feature3 0 5 2 1 8 9 2 6 9 ... ... ... 11 1 6 \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt;   ã€€ï¼ˆ2ï¼‰é€šè¿‡DataFrame.locå–è¡Œåˆ—\nã€€ç”¨loc[]å–è¡Œåˆ—æ—¶åªèƒ½é€šè¿‡indexå’Œcolumnså®šä¹‰çš„ç´¢å¼•åç§°è·å–è¡Œå’Œåˆ—ï¼Œç´¢å¼•åç§°å¦‚åˆ—åç§°feature1ã€feature2â€¦â€¦ï¼Œæ³¨æ„æ­¤æ—¶æˆ‘ä»¬çš„trainA_dataçš„è¡Œç´¢å¼•æ˜¯æ²¡æœ‰åç§°çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹éªŒè¯ä¸€ä¸‹ï¼š\n1 2 3 4  print(train_dataA.index.name) # è¾“å‡º None   ã€€å¦‚æœè¿™æ—¶å€™ä½¿ç”¨locå–è¡Œå…ƒç´ ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒåªèƒ½é€šè¿‡ç´¢å¼•åç§°æ¥è·å–è¡Œå’Œåˆ—ï¼Œè€Œè¡Œç´¢å¼•æ²¡æœ‰åç§°ï¼Œæˆ‘ä»¬ä¸ºè¡Œç´¢å¼•æ·»åŠ åç§°row_\u0026lt;index\u0026gt;ï¼Œå¹¶å†æ¬¡è¾“å‡ºè¡Œç´¢å¼•ã€‚ï¼ˆä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆrenameå¹¶ä¸ä¼šæ›´æ”¹.nameçš„å€¼ï¼Œ.nameä»ç„¶ä¸ºnoneï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12  row_idx_name_dict = {} for i in range(12): row_idx_name_dict[i] = \u0026#34;row_\u0026#34; + str(i) train_dataA.rename(index=row_idx_name_dict, inplace=True) print(train_dataA.index.name) # è¾“å‡º id feature1 feature2 feature3 feature4 feature5 feature6 ... row_0 1001 1 5 2 3 8 ... row_1 1002 2 8 9 4 4 ... None   ã€€è¿™æ—¶æˆ‘ä»¬å†ç”¨locè·å–æŒ‡å®šè¡Œå’Œåˆ—ï¼š\n å–1è¡Œï¼štrain_dataA.loc['row_0'] å–è¿ç»­è¡Œï¼štrain_dataA.loc['row_0':'row_2'] å–å¤šä¸ªä¸è¿ç»­è¡Œï¼štrain_dataA.loc[['row_0','row_3']] å–1åˆ—ï¼štrain_dataA.loc[:,'feature2'] å–è¿ç»­åˆ—ï¼štrain_dataA.loc[:,'feature1':'feature3'] å–å¤šä¸ªä¸è¿ç»­åˆ—ï¼štrain_dataA.loc[:,['feature2','feature4']]  1 2 3 4 5 6  print(train_dataA.loc[\u0026#39;row_0\u0026#39;]) print(train_dataA.loc[\u0026#39;row_0\u0026#39;:\u0026#39;row_2\u0026#39;]) print(train_dataA.loc[[\u0026#39;row_0\u0026#39;,\u0026#39;row_3\u0026#39;]]) print(train_dataA.loc[:,\u0026#39;feature2\u0026#39;]) print(train_dataA.loc[:,\u0026#39;feature1\u0026#39;:\u0026#39;feature3\u0026#39;]) print(train_dataA.loc[:,[\u0026#39;feature2\u0026#39;,\u0026#39;feature4\u0026#39;]])   ã€€ï¼ˆ3ï¼‰é€šè¿‡DataFrame.ilocè·å–è¡Œå’Œåˆ—\nã€€ç”¨loc[]å–è¡Œåˆ—æ—¶åªèƒ½é€šè¿‡æ•°å­—æ ‡å·è·å–è¡Œå’Œåˆ—ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š\n å–1è¡Œï¼štrain_dataA.iloc[0] å–è¿ç»­è¡Œï¼štrain_dataA.iloc[0:2] å–å¤šä¸ªä¸è¿ç»­è¡Œï¼štrain_dataA.iloc[[0,3]] å–1åˆ—ï¼štrain_dataA.iloc[:,1] å–è¿ç»­åˆ—ï¼štrain_dataA.iloc[:,1:3] å–å¤šä¸ªä¸è¿ç»­åˆ—ï¼štrain_dataA.iloc[:,[2,4]]  1 2 3 4 5 6  print(train_dataA.iloc[0]) print(train_dataA.iloc[0:2]) print(train_dataA.iloc[[0,3]]) print(train_dataA.iloc[:,1]) print(train_dataA.iloc[:,1:3]) print(train_dataA.iloc[:,[2,4]])   ã€€ï¼ˆ4ï¼‰æŒ‰æ¡ä»¶å–è¡Œ\n1 2 3 4 5 6 7 8 9 10 11  # é€‰å–æŸäº›åˆ—ç­‰äºæŸäº›å€¼çš„è¡Œè®°å½•,ä¸ç­‰äºç”¨!= # df.loc[df[\u0026#39;column_name\u0026#39;] == some_value] some_rows = train_dataA[train_dataA[\u0026#39;feature1\u0026#39;]==2] print(some_rows) # å¤šç§æ¡ä»¶çš„é€‰å– ç”¨\u0026amp;è¿æ¥ï¼Œæ³¨æ„è¦åŠ æ‹¬å· # df.loc[(df[\u0026#39;column\u0026#39;] == some_value) \u0026amp; df[\u0026#39;other_column\u0026#39;].isin(some_values)] some_rows = train_dataA[(train_dataA[\u0026#39;feature1\u0026#39;]==2) \u0026amp; (train_dataA[\u0026#39;feature2\u0026#39;]==5)] print(some_rows)   3.3.2 æ·»åŠ è¡Œ/åˆ— ã€€æ·»åŠ åˆ—ç›´æ¥Dataframe['\u0026lt;æ–°åˆ—å\u0026gt;']=æ–°åˆ—å³å¯ã€‚å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ä»£ç ä¸­æˆåŠŸæ·»åŠ new_colåˆ—ã€‚\n1 2 3 4 5 6 7 8 9  new_cow = [8,8,8,8,8,8,8,8,8,8,8,8] train_dataA[\u0026#39;new_col\u0026#39;] = new_cow train_dataA.head() # è¾“å‡º id\tfeature1\tfeature2\tfeature3\t...\tlabel new_col row_0\t1001\t1\t5\t2\t... 1 8 row_1\t1002\t2\t8\t9\t... 1 8 ...   3.3.3 åˆ é™¤è¡Œ/åˆ— ã€€åˆ é™¤è¡Œæˆ–åˆ—ä½¿ç”¨Dataframe.drop()æ–¹æ³•ï¼Œåˆ é™¤è¡Œè®¾ç½®å‚æ•°axis=0ï¼Œåˆ é™¤åˆ—è®¾ç½®å‚æ•°axis=1ã€‚æˆ‘ä»¬å°†åˆšåˆšæ·»åŠ çš„new_colåˆ—åˆ é™¤ã€‚\n1 2 3 4 5 6 7 8  train_dataA.drop(\u0026#34;new_col\u0026#34;, axis=1, inplace=True) train_dataA.head() # è¾“å‡º id\tfeature1\tfeature2\tfeature3\t...\tlabel row_0\t1001\t1\t5\t2\t... 1 row_1\t1002\t2\t8\t9\t... 1 ...   3.4 ndarrayæ“ä½œæŒ‡å®šè¡Œåˆ—æ•°æ® ã€€ndarrayå–å…ƒç´ çš„æ“ä½œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œé€šè¿‡è¡Œåˆ—ç´¢å¼•è·å–ï¼Œç´¢å¼•ä»0å¼€å§‹ï¼Œä¾‹å¦‚arr[0][2]ã€‚\nã€€ndarrayå–è¡Œåˆ—å’Œdataframe.iloc[]æ–¹æ³•ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå–å¤šä¸ªä¸è¿ç»­è¡Œåˆ—æ—¶çš„æ“ä½œã€‚\nã€€ndarrayå®šä¹‰äº†ç‰¹åˆ«çš„å–æ•´è¡Œæ•°æ®å’Œæ•´åˆ—æ•°æ®çš„æ“ä½œï¼Œè¿™äº›æ“ä½œlistæ˜¯ä¸æ”¯æŒçš„ï¼Œå¯ä»¥å°†listè½¬ä¸ºndarrayç±»å‹å†åšæ“ä½œï¼Œæ“ä½œæ–¹æ³•å¦‚ä¸‹ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„æ“ä½œå¯èƒ½å¾—åˆ°çš„æ•°æ®å†…å®¹ç›¸åŒï¼Œä½†å¾—åˆ°çš„æ•°æ®å½¢çŠ¶ä¸åŒï¼Œåœ¨ä½œä¸ºæ¨¡å‹è¾“å…¥æ—¶å¯èƒ½ä¼šç”±äºå½¢çŠ¶ä¸åŒè€ŒæŠ¥é”™ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¯ç§æ“ä½œå¾—åˆ°çš„æ•°æ®å½¢çŠ¶æœ‰æ‰€äº†è§£ã€‚\n ndarray[i,:]å–ç¬¬iè¡Œæ•°æ®ï¼Œndarray[i:j, :] å–ç¬¬iè¡Œåˆ°ç¬¬j-1è¡Œçš„æ•°æ®ï¼› ndarray[:,j]å–ç¬¬jåˆ—æ•°æ®ï¼ˆä»¥è¡Œå½¢å¼è¿”å›ï¼‰ï¼Œndarray[:, i:j]å–ç¬¬iåˆ—åˆ°ç¬¬j-1åˆ—çš„æ•°æ®ã€‚  ã€€æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª3è¡Œ4åˆ—çš„ndarrayæ•°ç»„æ¥è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œå¹¶è¾“å‡ºå¾—åˆ°çš„å½¢çŠ¶ã€‚\n1 2 3 4 5 6 7  a_ndarr = np.arange(12).reshape((3, 4)) print(a_ndarr) # è¾“å‡º [[ 0 1 2 3] [ 4 5 6 7] [ 8 9 10 11]]   ã€€ï¼ˆ1ï¼‰å–ä¸€ä¸ªæŒ‡å®šè¡Œåˆ—çš„æ•°æ®ã€‚\n1 2 3 4  print(a_ndarr[0][2]) # è¾“å‡º 2   ã€€ï¼ˆ2ï¼‰å–ç¬¬iè¡Œã€‚æ³¨æ„è¿™é‡Œä¸¤ç§å–æ³•å¾—åˆ°çš„å½¢çŠ¶ä¸åŒã€‚å–æ³•1å¾—åˆ°çš„æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå®ƒæœ‰4ä¸ªå…ƒç´ ï¼›è€Œå–æ³•2å¾—åˆ°çš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå®ƒæœ‰4è¡Œ4åˆ—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  # å–ç¬¬1è¡Œï¼Œå–æ³•1 a_row_1 = a_ndarr[1,:] print(a_row_1) print(a_row_1.shape) # å–ç¬¬1è¡Œï¼Œå–æ³•2 a_row_1_new = a_ndarr[1:2,:] print(a_row_1_new) print(a_row_1_new.shape) # è¾“å‡º [4 5 6 7] (4,) [[4 5 6 7]] (1, 4)   ã€€ï¼ˆ3ï¼‰å–ç¬¬jåˆ—ã€‚å’Œå–æ•´è¡Œå…ƒç´ ç›¸ä¼¼ï¼Œå¦‚æœæƒ³å¾—åˆ°ä¸€ç»´æ•°ç»„åˆ™ä½¿ç”¨æ ‡å·ï¼Œå¦‚æœæƒ³å¾—åˆ°äºŒç»´æ•°ç»„åˆ™ä½¿ç”¨å†’å·æ ‡å·ã€‚è¿™é‡Œå–æ³•1å¾—åˆ°äº†ä¸€ä¸ªå…·æœ‰3ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„ï¼›è€Œå–æ³•2å¾—åˆ°äº†ä¸€ä¸ªæœ‰ä¸‰è¡Œ1åˆ—çš„äºŒç»´æ•°ç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  # å–ç¬¬2åˆ—ï¼Œå–æ³•1 a_col_2 = a_ndarr[:,2] print(a_col_2) print(a_col_2.shape) # å–ç¬¬2åˆ—ï¼Œå–æ³•2 a_col_2_new = a_ndarr[:,2:3] print(a_col_2_new) print(a_col_2_new.shape) # è¾“å‡º [ 2 6 10] (3,) [[ 2] [ 6] [10]] (3, 1)   ã€€ï¼ˆ4ï¼‰å–iåˆ°j-1è¡Œï¼Œå¦‚æœæ˜¯ä»ç¬¬0è¡Œ/åˆ—å¼€å§‹ï¼Œ0å¯ä»¥çœç•¥ã€‚å–ç¬¬i-jè¡Œï¼Œä¸å–åˆ—å…ƒç´ ï¼Œè¿˜å¯ä»¥çœå»,å’Œ:ï¼Œä¸‹é¢ä¸¤ç§å†™æ³•ç­‰ä»·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  # å–1-2è¡Œ a_row_1to2 = a_ndarr[1:3,:] print(a_row_1to2) print(a_row_1to2.shape) # å–1-2è¡Œ a_row_1to2 = a_ndarr[1:3] print(a_row_1to2) print(a_row_1to2.shape) # è¾“å‡º [[ 4 5 6 7] [ 8 9 10 11]] (2, 4) [[ 4 5 6 7] [ 8 9 10 11]] (2, 4)   ã€€ï¼ˆ5ï¼‰å–iåˆ°j-1åˆ—ï¼Œå¦‚æœæ˜¯ä»ç¬¬0è¡Œ/åˆ—å¼€å§‹ï¼Œ0å¯ä»¥çœç•¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # å–0-3åˆ— a_cow_0to2 = a_ndarr[:,0:3] print(a_cow_0to2) print(a_cow_0to2.shape) # å–0-3åˆ—ï¼Œçœç•¥0 a_cow_0to2 = a_ndarr[:,:3] print(a_cow_0to2) print(a_cow_0to2.shape) # è¾“å‡º [[ 0 1 2] [ 4 5 6] [ 8 9 10]] (3, 3) [[ 0 1 2] [ 4 5 6] [ 8 9 10]] (3, 3)   ã€€æ³¨æ„3å‰é¢çš„:ä¸èƒ½çœç•¥ï¼Œä¸è¦å†™æˆa_ndarr[:,3]ï¼Œè¿™æ ·æ˜¯å–ç¬¬3åˆ—çš„æ„æ€ï¼Œå¹¶ä¸”å®ƒçš„å½¢çŠ¶æ˜¯ä¸€ç»´æ•°ç»„ã€‚\nå–è¿ç»­åœ°è¡Œå’Œåˆ—å°†ï¼ˆ4ï¼‰ï¼ˆ5ï¼‰åˆå¹¶èµ·æ¥å†™å³å¯ï¼Œå½¢å¦‚a_ndarr[0:2,1:3]ã€‚\nã€€ï¼ˆ7ï¼‰å–å¤šä¸ªä¸è¿ç»­çš„æŒ‡å®šè¡Œ\n1 2 3 4 5 6 7 8 9  # å–ç¬¬0è¡Œå’Œç¬¬2è¡Œ a_row02 = a_ndarr[[0,2]] print(a_row02) print(a_row02.shape) # è¾“å‡º [[ 0 1 2 3] [ 8 9 10 11]] (2, 4)   ã€€ï¼ˆ8ï¼‰å–å¤šä¸ªä¸è¿ç»­çš„æŒ‡å®šåˆ—\n1 2 3 4 5 6 7 8 9 10  # å–ç¬¬1åˆ—å’Œç¬¬3åˆ— a_col13 = a_ndarr[:,[1,3]] print(a_col13) print(a_col13.shape) # è¾“å‡º [[ 1 3] [ 5 7] [ 9 11]] (3, 2)   ã€€ï¼ˆ9ï¼‰å–æŒ‡å®šçš„ä¸è¿ç»­è¡Œå’Œåˆ—ï¼Œæ³¨æ„è¿™é‡Œå’ŒDataFrameçš„ilocæ–¹æ³•ä¸åŒï¼Œæ¯”å¦‚è¦å–0è¡Œå’Œ2è¡Œç¬¬0ã€1ã€3åˆ—çš„æ•°æ®ï¼Œä¸å¯ä»¥å†™æˆa_ndarr[[0,2], [0,1,3]]ï¼Œä¼šæŠ¥é”™ã€‚æ­£ç¡®å†™æ³•åº”è¯¥å…ˆå–å‡ºæƒ³è¦çš„è¡Œæ•°æ®ï¼Œå†ä»è¡Œæ•°æ®ä¸­å–å‡ºæƒ³è¦çš„åˆ—æ•°æ®ï¼Œå†™æ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9  a_row02_col013 = a_ndarr[[0,2]] a_row02_col013 = a_row02_col013[:, [0,1,3]] print(a_row02_col013) print(a_row02_col013 .shape) # è¾“å‡º [[ 0 1 3] [ 8 9 11]] (2, 3)   ã€€ï¼ˆ10ï¼‰å–å¤šä¸ªæŒ‡å®šå…ƒç´ ã€‚åœ¨ï¼ˆ6ï¼‰ç§æˆ‘ä»¬æåˆ°çš„é”™è¯¯å†™æ³•å®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œä½†å‰ææ˜¯a_ndarr[[list1],[list2]]ä¸­list1å’Œlist2çš„å½¢çŠ¶ç›¸åŒï¼Œæˆ‘ä»¬å–åˆ°çš„å…ƒç´ æ˜¯a_ndarr[list_1_0][list_2_0]ã€a_ndarr[list_1_1][list_2_1]â€¦â€¦ã€‚ç”¨æ³•ç¤ºä¾‹å¦‚ä¸‹ï¼Œå¯ä»¥åœ¨è¾“å‡ºç»“æœä¸­çœ‹åˆ°ï¼Œè¿™æ ·å†™æˆ‘ä»¬å–åˆ°çš„å…ƒç´ å®é™…ä¸Šæ˜¯[0][0]å’Œ[2][3]ä¸¤ä¸ªå…ƒç´ ã€‚\n1 2 3 4 5 6 7  a_row02_col03 = a_ndarr[[0,2], [0,3]] print(a_row02_col03) print(a_row02_col03.shape) # è¾“å‡º [ 0 11] (2,)   4 DataFrameã€ndarrayã€listä¹‹é—´çš„è½¬æ¢ ã€€æˆ‘ä»¬ç»å¸¸èƒ½çœ‹è§æœºå™¨å­¦ä¹ æ•°æ®å¤„ç†å½“ä¸­æ··ç”¨pandasçš„DataFrameã€numpyçš„ndarrayã€Pythonçš„listï¼Œè¯»å…¥æ•°æ®æ—¶ç”¨pandsï¼Œå¤„ç†å¤„ç†å°±å˜æˆäº†numpyï¼Œè°ƒç”¨æ–¹æ³•äº”ï¼ˆluanï¼‰èŠ±ï¼ˆqiï¼‰å…«ï¼ˆbaï¼‰é—¨ï¼ˆzaoï¼‰ã€‚å®ƒä»¬çš„ç»“æ„ç›¸ä¼¼ï¼Œä¸€èˆ¬è¢«ç»Ÿä¸€æè¿°ä¸ºarray likeã€‚è¿™äº›array likeåœ¨å½¢å¼ä¸Šæ˜¯nç»´å‘é‡ï¼Œè¾“å‡ºç»“æœçœ‹èµ·æ¥å½¢çŠ¶ç›¸ä¼¼ï¼Œéš¾ä»¥åŒºåˆ†ã€‚ä½†å®é™…ä¸Šç”±äºä»–ä»¬å±äºä¸åŒçš„åŒ…ï¼Œå…·æœ‰ä¸åŒçš„ç±»å‹ï¼Œæœ‰äº›æƒ…å†µè¾“å…¥ç±»å‹æ˜¯array likeå½¢å¼æ—¶å¯ä»¥æ··ç”¨ï¼Œä»–ä»¬æœ€å¤§çš„åŒºåˆ«åœ¨äºå¯ä»¥è°ƒç”¨ä»–ä»¬æ‰€å±ç±»ç‹¬ç‰¹çš„æ–¹æ³•å’Œå±æ€§ã€‚\nã€€æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹ä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œé¦–å…ˆå¯¼å…¥pandasåŒ…å’ŒnumpyåŒ…ï¼Œç”¨pd.read_csvè¯»å…¥ç¬¬1èŠ‚ä¸­æä¾›çš„æ•°æ®é›†ã€‚\n1 2 3 4  import numpy as np import pandas as pd train_dataA = pd.read_csv(\u0026#39;trainA.csv\u0026#39;)   4.1 DataFrame \u0026lt;-\u0026gt; ndarray DataFrame -\u0026gt; ndarray ï¼ˆ1ï¼‰DataFrame.values\nã€€DataFrameæ˜¯æ•°æ®å±‚æ¬¡åŒ–ç»“æ„ï¼ŒåŒ…å«è¡Œæ ‡å·ã€åˆ—æ ‡å·ã€æ•°æ®ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç†è§£å’ŒæŸ¥çœ‹ï¼Œè€Œndarrayæ˜¯ä¸€ä¸ªnç»´æ•°ç»„ï¼Œæ²¡æœ‰è¡Œå·å’Œåˆ—å·ï¼Œåªæœ‰æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥æ¨æµ‹ï¼ŒDataFrameçš„valueæ˜¯ä¸€ä¸ªndarrayç±»å‹ã€‚ç„¶åæˆ‘ä»¬ç”¨.valueså±æ€§è¿›è¡ŒéªŒè¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # DataFrame -\u0026gt; ndarray train_dataA_value = train_dataA.values print(train_dataA_value) print(type(train_dataA_value)) # è¾“å‡º [[1001 1 5 2 3 8 9 2 1 1 3 1] [1002 2 8 9 4 4 4 6 1 0 7 1] [1003 5 6 9 7 4 1 2 5 1 3 1] [1004 9 5 4 1 5 6 3 2 1 4 2] [1005 2 2 2 2 2 1 4 4 4 4 2] [1006 6 4 5 8 1 1 4 3 7 2 0] [1007 2 5 8 9 1 6 1 5 6 7 0] [1008 2 5 6 7 8 9 2 1 1 1 0] [1009 3 1 2 4 1 5 6 7 1 2 1] [1010 7 9 5 1 2 3 4 4 1 8 2] [1011 5 8 7 7 5 6 1 2 2 8 1] [1012 4 1 6 8 3 2 7 1 6 5 0]] \u0026lt;class \u0026#39;numpy.ndarray\u0026#39;\u0026gt;   ï¼ˆ2ï¼‰numpy.array\nã€€é™¤äº†é€šè¿‡DataFrameçš„.valueså°†DataFrameè½¬æ¢ä¸ºndarrayæ ¼å¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡numpy.array(DataFrame)å°†DataFrameè½¬æ¢æˆndarrayæ ¼å¼ï¼Œå¾—åˆ°çš„è¾“å‡ºç»“æœå’ŒDataFrame.valuesç›¸åŒã€‚\n1 2 3 4 5 6  # DataFrame -\u0026gt; ndarray train_data_ndarray = np.array(train_dataA) print(train_data_ndarray) print(type(train_data_ndarray)) #è¾“å‡ºå’Œï¼ˆ1ï¼‰ä¸­çš„æ–¹æ³•ç›¸åŒ   ndarray-\u0026gt;DataFrame ã€€ndarrayè½¬æ¢ä¸ºDataFrameæ ¼å¼ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€å°†ndarrayç±»å‹çš„æ•°æ®ä¼ å…¥pd.DataFrame()æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  # ndarray-\u0026gt;DataFrame train_data_df = pd.DataFrame(train_data_ndarray) print(train_data_df) print(type(train_data_df)) # è¾“å‡º 0 1 2 3 4 5 6 7 8 9 10 11 0 1001 1 5 2 3 8 9 2 1 1 3 1 1 1002 2 8 9 4 4 4 6 1 0 7 1 2 1003 5 6 9 7 4 1 2 5 1 3 1 3 1004 9 5 4 1 5 6 3 2 1 4 2 4 1005 2 2 2 2 2 1 4 4 4 4 2 5 1006 6 4 5 8 1 1 4 3 7 2 0 6 1007 2 5 8 9 1 6 1 5 6 7 0 7 1008 2 5 6 7 8 9 2 1 1 1 0 8 1009 3 1 2 4 1 5 6 7 1 2 1 9 1010 7 9 5 1 2 3 4 4 1 8 2 10 1011 5 8 7 7 5 6 1 2 2 8 1 11 1012 4 1 6 8 3 2 7 1 6 5 0 \u0026lt;class \u0026#39;pandas.core.frame.DataFrame\u0026#39;\u0026gt;   ã€€éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæ˜¯DataFrame-\u0026gt;ndarray-\u0026gt;DataFrameï¼Œä¼šæŸå¤±åŸæœ‰çš„è¡Œæ ‡å·å’Œåˆ—æ ‡å·åç§°ï¼Œåªæœ‰ä»0å¼€å§‹çš„ç´¢å¼•ã€‚\n4.2 ndarray \u0026lt;-\u0026gt; list ã€€ï¼ˆ1ï¼‰ndarray-\u0026gt;list\nã€€ndarrayå’Œlistçš„ç›¸äº’è½¬æ¢éå¸¸å®¹æ˜“ï¼Œç”±ndarrayè½¬åˆ°liståªéœ€è¦è°ƒç”¨.tolist()æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8  # ndarray -\u0026gt; list train_data_list = train_data_ndarray.tolist() print(train_data_list) print(type(train_data_list)) # è¾“å‡º [[1001, 1, 5, 2, 3, 8, 9, 2, 1, 1, 3, 1], [1002, 2, 8, 9, 4, 4, 4, 6, 1, 0, 7, 1], [1003, 5, 6, 9, 7, 4, 1, 2, 5, 1, 3, 1], [1004, 9, 5, 4, 1, 5, 6, 3, 2, 1, 4, 2], [1005, 2, 2, 2, 2, 2, 1, 4, 4, 4, 4, 2], [1006, 6, 4, 5, 8, 1, 1, 4, 3, 7, 2, 0], [1007, 2, 5, 8, 9, 1, 6, 1, 5, 6, 7, 0], [1008, 2, 5, 6, 7, 8, 9, 2, 1, 1, 1, 0], [1009, 3, 1, 2, 4, 1, 5, 6, 7, 1, 2, 1], [1010, 7, 9, 5, 1, 2, 3, 4, 4, 1, 8, 2], [1011, 5, 8, 7, 7, 5, 6, 1, 2, 2, 8, 1], [1012, 4, 1, 6, 8, 3, 2, 7, 1, 6, 5, 0]] \u0026lt;class \u0026#39;list\u0026#39;\u0026gt;   ã€€ï¼ˆ2ï¼‰list-\u0026gt;ndarray\nã€€listè½¬åˆ°ndarrayä¹Ÿåªéœ€è°ƒç”¨numpy.array(list)ï¼Œå°±èƒ½å°†listç±»å‹è½¬æ¢ä¸ºndarrayç±»å‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # list -\u0026gt; ndarray train_data_ndarray = np.array(train_data_list) print(train_data_ndarray) print(type(train_data_ndarray)) # è¾“å‡º [[1001 1 5 2 3 8 9 2 1 1 3 1] [1002 2 8 9 4 4 4 6 1 0 7 1] [1003 5 6 9 7 4 1 2 5 1 3 1] [1004 9 5 4 1 5 6 3 2 1 4 2] [1005 2 2 2 2 2 1 4 4 4 4 2] [1006 6 4 5 8 1 1 4 3 7 2 0] [1007 2 5 8 9 1 6 1 5 6 7 0] [1008 2 5 6 7 8 9 2 1 1 1 0] [1009 3 1 2 4 1 5 6 7 1 2 1] [1010 7 9 5 1 2 3 4 4 1 8 2] [1011 5 8 7 7 5 6 1 2 2 8 1] [1012 4 1 6 8 3 2 7 1 6 5 0]] \u0026lt;class \u0026#39;numpy.ndarray\u0026#39;\u0026gt;   ã€€ä»ä¸Šé¢çš„è½¬æ¢ä¸­å¯ä»¥çœ‹å‡ºndarrayå’Œliståœ¨è¾“å‡ºæ—¶ï¼Œlistçš„å…ƒç´ ä¹‹é—´ç”¨,éš”å¼€ï¼Œç»“æ„ç´§å‡‘ï¼›è€Œndarrayçš„å…ƒç´ ç”¨ç©ºæ ¼éš”å¼€ï¼Œæ•´é½ç¾è§‚ã€‚\n4.3 DataFrame -\u0026gt; list ã€€å¯ä»¥å…ˆå°†DataFrameè½¬æ¢æˆndarrayç±»å‹ï¼Œå†å°†ndarrayç±»å‹è½¬æ¢ä¸ºlistç±»å‹ï¼Œè½¬æ¢æ–¹æ³•å‚è€ƒ4.1å’Œ4.2èŠ‚ã€‚\n5 å¤„ç†å¤šä¸ªæ•°æ®æ–‡ä»¶  å‚è€ƒ1ï¼šhttps://zhuanlan.zhihu.com/p/45442554\nå‚è€ƒ2ï¼šhttps://blog.csdn.net/weixin_38168620/article/details/80663892\n ã€€æ•°æ®é›†é€šå¸¸å¯èƒ½ç”±å¤šä¸ªcsvæ–‡ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ªcsvæ–‡ä»¶çš„keyå„ä¸ç›¸åŒï¼Œå…¶ä¸­ä¸€ä¸ªçš„keyæ˜¯å¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸€åˆ—ã€‚pandasæœ‰ç±»ä¼¼äºSQLä¸­è¿æ¥è¡¨çš„æ“ä½œï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è½¬æ¢ã€‚Pandas.DataFrameæ“ä½œè¡¨è¿æ¥æœ‰ä¸‰ç§æ–¹å¼ï¼šmergeã€joinã€concatã€‚ğŸ·å¾ˆå¤šéœ€è¦çš„æ“ä½œåœ¨è¿™äº›åŒ…é‡Œéƒ½å®ç°äº†ï¼Œå»ºè®®æ‰‹åŠ¨å®ç°å‰çœ‹çœ‹æ–‡æ¡£ã€‚\nå…·ä½“å¯å‚è€ƒï¼šhttps://blog.csdn.net/weixin_38168620/article/details/80663892\n5.1 merge ã€€ç›¸å½“äºSQLä¸­çš„joinï¼Œä¸¤å¼ è¡¨æœ‰ç›¸åŒå†…å®¹çš„åˆ—ï¼Œå°†ä¸¤å¼ è¡¨åˆå¹¶åˆ°ä¸€å¼ è¡¨ï¼›åˆå¹¶å¾—åˆ°çš„ç»“æœé›†è¡Œæ•°ä¸ä¼šå¢åŠ ï¼Œåˆ—æ•°ä¸ºä¸¤ä¸ªå…ƒæ•°æ®çš„åˆ—æ•°å‡å»è¿æ¥é”®çš„æ•°é‡ã€‚\npd.merge(left, right, how=â€™innerâ€™, on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=False, suffixes=(â€˜_xâ€™, â€˜_yâ€™), copy=True, indicator=False, validate=None)\r5.2 join 5.3 concat ã€€DataFrame.join()ï¼šå°†è¡Œç´¢å¼•ç›¸åŒçš„ä¸åŒçš„åˆ—è¿æ¥ï¼Œ\n1 2 3 4  data_train_label = data_train[\u0026#34;label\u0026#34;] data_train = data_train.drop(\u0026#34;label\u0026#34;, axis=1) data_train = data_train.drop(\u0026#34;heartbeat_signals\u0026#34;, axis=1) data_train = data_train.join(train_heartbeat_df)   pandasæœ‰ç±»ä¼¼äºSQLä¸­è¿æ¥è¡¨çš„æ“ä½œï¼Œä¸è¦è‡ªå·±è½¬æ¢ï¼šhttps://zhuanlan.zhihu.com/p/45442554\nhttps://pandas.pydata.org/docs/reference/api/pandas.DataFrame.join.html\n","description":"ç”¨Pandaså’ŒNumpyæ“ä½œæ•°æ®é›†","id":4,"section":"posts","tags":["æœºå™¨å­¦ä¹ "],"title":"Pythonï¼šPandaså’ŒNumpyå¯¹æ•°æ®é›†çš„åŸºæœ¬æ“ä½œ","uri":"https://yyyIce.github.io/zh/posts/pythonpandas%E5%92%8Cnumpy%E5%AF%B9%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"},{"content":"ã€€å‰è¨€ï¼šæœ¬æ–‡ç»å¤§éƒ¨åˆ†å†…å®¹æ‘˜å½•è‡ªã€ŠDockerâ€”â€”ä»å…¥é—¨åˆ°å®è·µã€‹ï¼Œä¸ºåŠ æ·±æˆ‘çš„å°è±¡æ•´ç†è€Œæˆï¼ˆæˆ‘çš„ç¬”è®°å‡çº§äº†ï¼Œç”µå­ç¬”è®°ï¼‰ï¼Œåœ¨æœ€åè®¾ç½®äº†ä¸¤ä¸ªdocker demoä½œä¸ºå®éªŒç»“æœã€‚å®šåˆ¶Dockeré•œåƒï¼Œä¸€é”®è¿ç§»å¼€å‘ç¯é•œè¯·ç›´æ¥è·³è½¬è‡³ç¬¬4èŠ‚ã€‚å®é™…ä¸Šæˆ‘2018å¹´å°±å­¦ä¹ è¿‡Dockerï¼Œçœ‹çš„è¿˜æ˜¯è¯­è¨€è¡¨è¾¾èƒ½åŠ›åˆšåŠæ ¼çš„è€ç‰ˆæœ¬ã€ŠDockerâ€”â€”ä»å…¥é—¨åˆ°å®è·µã€‹ï¼ŒåŸç†æ˜¯çœ‹æ‡‚äº†ï¼Œä½†å®Œå…¨æ²¡å­¦ä¼šæ€ä¹ˆä½¿ç”¨ï¼Œçœ‹ç€å‘½ä»¤è¡Œçœ¼æ™•ï¼Œæ¯æ¬¡éƒ½å¡åœ¨å®‰è£…Dockerï¼Œå±¡è£…å±¡è´¥ï¼Œä½†è¿™æ¬¡å­¦èµ·æ¥è§‰å¾—So easyï¼Œçœ‹æ¥æˆ‘çš„æ™ºå•†å’Œç†è§£åŠ›æå‡äº†ğŸ¤“ã€‚\n1 Dockerç®€ä»‹  æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/introduction/what\n 1.1 æ¦‚è¿° ã€€Dockeræ˜¯å¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»çš„æ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒéš”ç¦»è¿›ç¨‹ï¼Œä¹Ÿè¢«ç§°ä¸ºå®¹å™¨ã€‚Dockerä½¿ç”¨Goè¯­è¨€å¼€å‘å®ç°ã€‚ç”¨æˆ·æ— éœ€å…³å¿ƒå®¹å™¨ç®¡ç†ï¼Œæ“ä½œDockerå®¹å™¨å°±åƒæ“ä½œå¿«é€Ÿè½»é‡çº§çš„è™šæ‹Ÿæœºä¸€æ ·ç®€å•ã€‚\nã€€å›¾1å’Œå›¾2å½¢è±¡åœ°å±•ç¤ºäº†Dockerè™šæ‹ŸåŒ–æŠ€æœ¯å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯çš„åŒºåˆ«ã€‚ä¼ ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯å…ˆå¯¹ç‰©ç†ç¡¬ä»¶è¿›è¡Œè™šæ‹ŸåŒ–ï¼Œè™šæ‹Ÿå‡ºç¡¬ä»¶ä¹‹åï¼Œåœ¨è™šæ‹ŸåŒ–çš„ç¡¬ä»¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œæ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°è™šæ‹ŸåŒ–ï¼›è€Œå®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ä»è¿è¡Œåœ¨åŸæœ‰çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œå³å®¿ä¸»å†…æ ¸ä¸Šï¼Œå®¹å™¨æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚\nå›¾1 ä¼ ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯:\r\r å›¾2 Dockerè™šæ‹ŸåŒ–æŠ€æœ¯:\r\r 1.2 ä¸ºä»€ä¹ˆè¦ç”¨Docker  å‚è€ƒï¼šhttps://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html\n ã€€å¯¹äºæˆ‘ä»¬è¿™äº›æ™®é€šä½¿ç”¨äººå‘˜æ¥è¯´ï¼Œä½¿ç”¨Dockerèƒ½å¤ŸèŠ‚çœå¤§é‡é‡æ–°é…ç½®å¼€å‘ç¯å¢ƒçš„æ—¶é—´ï¼Œè½»æ¾å¤‡ä»½ï¼ˆğŸ˜“è™½ç„¶ä½†æ˜¯ï¼Œä¼šè€—è´¹å¤§é‡æ—¶é—´åœ¨é…ç½®å¼€å‘ç¯å¢ƒçš„æˆ‘ä»¬å¯èƒ½ä¹Ÿå¹¶ä¸èƒ½è¿…é€ŸæŒæ¡Dockerï¼Œä½†æŒæ¡äº†å°±å¾ˆæ–¹ä¾¿å•¦ï¼‰ã€‚\nã€€å…·ä½“æ¥è¯´ï¼Œéšç€å„ç§æŠ€æœ¯çš„è“¬å‹ƒå‘å±•ï¼Œéœ€è¦çš„å¼€å‘è¶Šæ¥è¶Šå¤æ‚ï¼Œæ¯å°†ç¨‹åºå®‰è£…åˆ°ä¸€å°æ–°è®¾å¤‡éƒ½éœ€è¦é‡æ–°é…ç½®å¼€å‘ç¯å¢ƒã€‚é…ç½®å¼€å‘ç¯å¢ƒæ—¶éå¸¸å®¹æ˜“å‡ºé”™ï¼Œæ¨¡å—ã€åº“çš„å®‰è£…ã€ä¾èµ–å…³ç³»ã€ç‰ˆæœ¬è¦æ±‚ã€å…¼å®¹æ€§ï¼Œä¸€æ—¦å‡ºé”™ï¼Œå°±è¦é‡æ¥ï¼Œæµªè´¹å¤§é‡çš„æ—¶é—´ï¼Œå¦‚æœéœ€è¦ç¨‹åºåœ¨å…¶å®ƒè®¾å¤‡ä¸Šè¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿå°†ç¨‹åºéœ€è¦çš„å¼€å‘ç¯å¢ƒä¸€èµ·ç§»åˆ°å…¶ä»–è®¾å¤‡ä¸Šï¼Œå°±èƒ½å¤ŸèŠ‚çœå¤§é‡æ—¶é—´ã€‚\n æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/introduction/why\n ã€€ç”±äºDockerç›´æ¥è¿è¡Œåœ¨ç‰©ç†æœºçš„æ“ä½œç³»ç»Ÿä¸Šï¼ŒèŠ‚çœäº†è®¸å¤šå¼€é”€ï¼Œæ‰€ä»¥Dockerä¸ä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼ç›¸æ¯”æœ‰å·¨å¤§ä¼˜åŠ¿ï¼š\n æ›´é«˜æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼šå®¹å™¨ä¸éœ€è¦è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿå’Œè¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿç­‰é¢å¤–å¼€é”€ï¼Œæ‰€ä»¥å¯¹ç‰©ç†æœºç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ã€‚ç”±äºDockerè¿è¡Œåœ¨åŸæœ‰æ“ä½œç³»ç»Ÿä¸Šï¼Œå…¶åº”ç”¨æ‰§è¡Œé€Ÿåº¦ã€æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ã€å†…å­˜æŸè€—éƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯é«˜æ•ˆï¼Œæ‰€ä»¥ç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œç›¸åŒé…ç½®çš„ä¸»æœºï¼Œå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚ æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ï¼šä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€ŒDockerå®¹å™¨åº”ç”¨æ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä»è€Œä½œåˆ°ç§’çº§ã€ç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ã€‚å¤§å¤§èŠ‚çº¦äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„æ—¶é—´ã€‚ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼šå¼€å‘è¿‡ç¨‹ä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº› bug å¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¢«å‘ç°ã€‚è€Œ Docker çš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿äº†åº”ç”¨è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šå†å‡ºç° ã€Œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜å•Šã€ è¿™ç±»é—®é¢˜ã€‚ æŒç»­äº¤ä»˜å’Œéƒ¨ç½²ï¼šå¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›çš„å°±æ˜¯ä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œã€‚ç”¨ Docker å¯ä»¥é€šè¿‡å®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ Dockerfile æ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆ æŒç»­é›†æˆ(Continuous Integration) ç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆ æŒç»­éƒ¨ç½²(Continuous Delivery/Deployment) ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚ä½¿ç”¨ Dockerfile ä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚ æ›´è½»æ¾åœ°è¿ç§»ï¼šç”±äºDockerç¡®ä¿äº†ç¯å¢ƒä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥è½»æ˜“å°†ä¸€ä¸ªå¹³å°ä¸Šçš„åº”ç”¨è¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šã€‚Docker å¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œå¦‚ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œç¬”è®°æœ¬ï¼ŒDockeråº”ç”¨ç¨‹åºåœ¨è¿™äº›å¹³å°ä¸Šçš„è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚ æ›´è½»æ¾åœ°ç»´æŠ¤å’Œæ‰©å±•ï¼šåˆ†å±‚å­˜å‚¨å’Œé•œåƒæŠ€æœ¯ï¼Œè®©åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿè®©åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ã€‚  ã€€è¡¨1å°†Dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºè¿›è¡Œå¯¹æ¯”æ€»ç»“ã€‚\nè¡¨1 Docker VS è™šæ‹Ÿæœº:\r\r 1.3 åŸºæœ¬æ¦‚å¿µ ã€€Dockeræœ‰3ä¸ªé‡è¦çš„åŸºæœ¬æ¦‚å¿µï¼šé•œåƒï¼ˆImageï¼‰ã€å®¹å™¨ï¼ˆContainerï¼‰ã€ä»“åº“ï¼ˆRepositoryï¼‰ã€‚\n1.3.1 é•œåƒï¼ˆImageï¼‰  æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/basic_concept/image\n ã€€Dockeré•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚ä»¥Linuxç³»ç»Ÿä¸ºä¾‹ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½rootæ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒï¼Œè€ŒDockeré•œåƒå°±ç›¸å½“äºä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ubuntu 18.0.4ç³»ç»Ÿé•œåƒï¼Œå°±åŒ…å«äº†å®Œæ•´çš„ubuntu 18.0.4çš„rootæ–‡ä»¶ç³»ç»Ÿã€‚\n å‚è€ƒï¼šhttp://pwn4.fun/2020/07/01/UnionFS%E6%8A%80%E6%9C%AF/\nUnion FSï¼šè”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰ï¼Œå¯ä»¥æŠŠæ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤šä¸ªç›®å½•è”åˆæŒ‚è½½åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œè€Œç›®å½•çš„ç‰©ç†ä½ç½®æ˜¯åˆ†å¼€çš„ã€‚\nå¯ä»¥ç†è§£æˆæŠŠä¸åŒç›®å½•çœ‹ä½œåœ¨åŒä¸€ç›®å½•ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨åŒä¸€ç›®å½•å¯¹ä»–ä»¬è¿›è¡Œæ“ä½œï¼Œä½†å®é™…ä¸Šä»–ä»¬å¹¶æ²¡æœ‰å­˜å‚¨åœ¨åŒä¸€ç›®å½•ã€‚\n ã€€ç”±äºé•œåƒåŒ…å«æ“ä½œç³»ç»Ÿå®Œæ•´çš„rootæ–‡ä»¶ç³»ç»Ÿï¼Œä½“ç§¯åºå¤§ï¼Œæ‰€ä»¥Dockerè¿ç”¨Union FSæŠ€æœ¯ï¼Œè®¾è®¡ä¸ºåˆ†å±‚å­˜å‚¨æ¶æ„ï¼›é•œåƒå®é™…ä¸Šä¸æ˜¯åƒ.isoä¸€æ ·çš„ä¸€æ•´ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼Œè€Œæ˜¯å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚\nã€€é•œåƒé€å±‚æ„å»ºï¼Œå‰ä¸€å±‚æ˜¯åä¸€å±‚çš„åŸºç¡€ï¼Œæ¯ä¸€å±‚æ„å»ºå®Œå°±ä¸ä¼šå†æ”¹å˜ï¼Œåä¸€å±‚ä¸Šçš„ä»»ä½•æ”¹å˜åªå‘ç”Ÿåœ¨è‡ªå·±çš„è¿™ä¸€å±‚ã€‚æ¯”å¦‚ï¼Œåˆ é™¤å‰ä¸€å±‚æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯å°†å‰ä¸€å±‚çš„æ–‡ä»¶åˆ é™¤ï¼Œè€Œæ˜¯åœ¨å½“å‰å±‚æ ‡è®°è¯¥æ–‡ä»¶å·²åˆ é™¤ï¼Œåœ¨æœ€ç»ˆè¿è¡Œå®¹å™¨æ—¶ï¼Œè™½ç„¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†å®é™…ä¸Šè¯¥æ–‡ä»¶ä¸€ç›´å­˜åœ¨äºé•œåƒé‡Œã€‚\nã€€æ„å»ºé•œåƒæ—¶ï¼Œéœ€è¦é¢å¤–å°å¿ƒï¼Œæ¯ä¸€å±‚åªå°½é‡åŒ…å«è¯¥å±‚éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œé¢å¤–çš„ä¸œè¥¿åº”è¯¥åœ¨è¯¥å±‚æ„å»ºç»“æŸå‰æ¸…ç†æ‰ã€‚\nã€€åˆ†å±‚å­˜å‚¨çš„ç‰¹å¾ä½¿é•œåƒçš„å¤ç”¨ã€å®šåˆ¶æ›´å®¹æ˜“ï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰æ„å»ºå¥½çš„é•œåƒä½œä¸ºåŸºç¡€å±‚ï¼Œè¿›ä¸€æ­¥æ·»åŠ æ–°çš„å±‚ä»¥å®šåˆ¶è‡ªå·±æ‰€éœ€çš„å†…å®¹ã€‚Dockeræä¾›äº†éå¸¸ç®€å•çš„æœºåˆ¶æ¥åˆ›å»ºæˆ–æ›´æ–°ç°æœ‰é•œåƒï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä»ä»–äººå¤„ä¸‹è½½ä¸€ä¸ªå·²ç»åšå¥½çš„é•œåƒæ¥ä½¿ç”¨ã€‚\n1.3.2 å®¹å™¨ï¼ˆContainerï¼‰  æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/basic_concept/container\n å®¹å™¨æ˜¯ä»é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ï¼Œå®¹å™¨å’Œé•œåƒçš„å…³ç³»å°±åƒé¢å‘å¯¹è±¡ç¨‹åºä¸­ç±»å’Œå®ä¾‹çš„å…³ç³»ä¸€æ ·ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚\n å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Linux_namespaces\nå‘½åç©ºé—´ï¼ˆNamespacesï¼‰æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå¯¹å†…æ ¸èµ„æºè¿›è¡Œåˆ†åŒºï¼Œä½¿å¾—ä¸€ç»„è¿›ç¨‹çœ‹åˆ°ä¸€ç»„èµ„æºï¼Œè€Œå¦ä¸€ç»„è¿›ç¨‹çœ‹åˆ°ä¸€ç»„ä¸åŒçš„èµ„æºã€‚è¯¥åŠŸèƒ½çš„å·¥ä½œåŸç†æ˜¯ä¸ºä¸€ç»„èµ„æºå’Œè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„å‘½åç©ºé—´ï¼Œä½†è¿™äº›å‘½åç©ºé—´å¼•ç”¨ä¸åŒçš„èµ„æºã€‚èµ„æºå¯èƒ½å­˜åœ¨äºå¤šä¸ªç©ºé—´ä¸­ã€‚æ­¤ç±»èµ„æºçš„ç¤ºä¾‹åŒ…æ‹¬è¿›ç¨‹ IDã€ä¸»æœºåã€ç”¨æˆ· IDã€æ–‡ä»¶åä»¥åŠä¸€äº›ä¸ç½‘ç»œè®¿é—®å’Œè¿›ç¨‹é—´é€šä¿¡ç›¸å…³çš„åç§°ã€‚\n ã€€å®¹å™¨çš„å®è´¨æ˜¯è¿›ç¨‹ï¼Œä½†å®¹å™¨è¿›ç¨‹è¿è¡Œè‡ªå·±çš„ç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œå³å®¹å™¨è¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œé…ç½®ã€è¿›ç¨‹ç©ºé—´ç­‰ç­‰ã€‚å®¹å™¨è¿›ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨èµ·æ¥å¥½åƒåœ¨ç‹¬ç«‹äºå®¿ä¸»ï¼ˆç‰©ç†æœºï¼‰çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ï¼Œè¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚\nã€€å®¹å™¨ä¹Ÿé‡‡ç”¨åˆ†å±‚å­˜å‚¨ï¼Œæ¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œä»¥é•œåƒä¸ºåŸºç¡€å±‚ï¼Œåœ¨å…¶ä¸Šåˆ›å»ºä¸€ä¸ªå½“å‰å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œè¿™ä¸ªä¸ºå®¹å™¨è¿è¡Œæ—¶è¯»å†™è€Œå‡†å¤‡çš„å­˜å‚¨å±‚ç§°ä¸ºå®¹å™¨å­˜å‚¨å±‚ã€‚\nã€€å®¹å™¨å­˜å‚¨å±‚çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¹å™¨ç›¸åŒï¼Œå®¹å™¨æ¶ˆäº¡æ—¶ï¼Œå®¹å™¨å­˜å‚¨å±‚ä¹Ÿæ¶ˆå¤±ã€‚æ‰€ä»¥ï¼Œä»»ä½•ä¿å­˜åœ¨å®¹å™¨å­˜å‚¨å±‚çš„ä¿¡æ¯éƒ½ä¼šç”±äºåˆ é™¤å®¹å™¨è€Œæ¶ˆå¤±ã€‚\nã€€å®¹å™¨ä¸åº”è¯¥å‘å­˜å‚¨å±‚å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–ã€‚æ‰€æœ‰æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨æ•°æ®å·æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œè¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»å‘ç”Ÿè¯»å†™ï¼Œæ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚æ•°æ®å·çš„ç”Ÿå­˜å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œå®¹å™¨æ¶ˆäº¡ï¼Œæ•°æ®å·ä¸ä¼šæ¶ˆäº¡ã€‚\n1.3.3 ä»“åº“ï¼ˆRepositoryï¼‰  æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/basic_concept/repository\n ã€€ä»“åº“æ˜¯é›†ä¸­å­˜å‚¨ã€åˆ†å‘é•œåƒçš„åœºæ‰€ï¼ŒDocker Registryæ˜¯ä¸€ç§ä»“åº“æœåŠ¡ã€‚ä¸€ä¸ªDocker Registryå¯ä»¥åŒ…å«å¤šä¸ªä»“åº“ï¼ˆRepositoryï¼‰ï¼Œæ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªæ ‡ç­¾ï¼ˆTagï¼‰ï¼Œæ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒã€‚\nã€€æ ‡ç­¾å¸¸ä¸å¯¹åº”äºåº”ç”¨çš„å„ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡\u0026lt;ä»“åº“å\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt;çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªåº”ç”¨å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœæ²¡æœ‰ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥latestä½œä¸ºé»˜è®¤æ ‡ç­¾ã€‚ä¾‹å¦‚ä»“åº“åä¸ºubuntuï¼Œæœ‰16.04å’Œ18.04ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¯é€šè¿‡ubuntu:16.04æ¥æŒ‡å®š16.04ç‰ˆæœ¬ï¼Œå¦‚æœå¿½ç•¥æ ‡ç­¾ï¼Œä½¿ç”¨ubuntuï¼Œåˆ™çœ‹ä½œubuntu:latestã€‚\nã€€ä»“åº“åé€šå¸¸ä»¥äºŒçº§è·¯å¾„å½¢å¼å‡ºç°ï¼Œå¦‚jwilder/nginx-proxyï¼Œjwilderé€šå¸¸æ ‡è¯†ä»“åº“æœåŠ¡å¤šç”¨æˆ·ç¯å¢ƒä¸‹çš„ç”¨æˆ·åï¼Œnginx-proxyé€šå¸¸æ ‡è¯†åº”ç”¨åï¼›å…·ä½“å«ä¹‰å–å†³äºä»“åº“æœåŠ¡ã€‚\nã€€ä»“åº“æœåŠ¡åŒ…æ‹¬å…¬å¼€æœåŠ¡å’Œç§æœ‰æœåŠ¡ã€‚\n å…¬å¼€æœåŠ¡ï¼š å¼€æ”¾ç»™ç”¨æˆ·ä½¿ç”¨ã€å…è®¸ç”¨æˆ·ç®¡ç†é•œåƒçš„ä»“åº“æœåŠ¡ï¼Œä¸€èˆ¬å…è®¸ç”¨æˆ·å…è´¹ä¸Šä¼ ã€ä¸‹è½½å…¬å¼€çš„é•œåƒã€‚æœ€å¸¸ä½¿ç”¨çš„å…¬å¼€æœåŠ¡æ˜¯å®˜æ–¹çš„Docker Hubï¼Œæ­¤å¤–è¿˜æœ‰ Red Hat çš„ Quay.ioã€Google çš„ Googluutse Container Registryï¼ˆKubernetes çš„é•œåƒä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæœåŠ¡ï¼‰ã€ GitHub çš„ ghcr.ioã€é˜¿é‡Œäº‘é•œåƒæœåº“ç­‰ã€‚å›½å†…ä¸€äº›äº‘æœåŠ¡å•†æä¾›äº†å¯¹Docker Hubçš„åŠ é€Ÿå™¨ï¼Œå¦‚é˜¿é‡Œäº‘åŠ é€Ÿå™¨ã€‚ ç§æœ‰æœåŠ¡ï¼šç”¨æˆ·å¯ä»¥åœ¨æœ¬åœ°æ­å»ºç§æœ‰Docker Registryï¼ŒDockerå®˜æ–¹æä¾›äº†Docker Registryé•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä½œä¸ºç§æœ‰ä»“åº“ç®¡ç†æœåŠ¡ï¼Œä½†ä¸åŒ…å«å›¾å½¢ç•Œé¢ã€é•œåƒç»´æŠ¤ã€ç”¨æˆ·ç®¡ç†ã€è®¿é—®æ§åˆ¶ç­‰é«˜çº§åŠŸèƒ½ã€‚  1.3.4 å­˜å‚¨é©±åŠ¨ï¼ˆStorage Driverï¼‰  å‚è€ƒï¼šhttps://zhangchenchen.github.io/2018/03/09/record-for-docker-storage-driver/\n ã€€å®¹å™¨å’Œé•œåƒçš„å±‚çº§å…³ç³»å¦‚å›¾3ï¼Œå®¹å™¨å­˜å‚¨å±‚å¯ä»¥è¯»å†™ï¼Œè€Œé•œåƒå±‚æ˜¯åªè¯»çš„ã€‚\nå›¾3 å®¹å™¨å’Œé•œåƒçš„å±‚çº§å…³ç³»:\r\r ã€€å­˜å‚¨é©±åŠ¨æ˜¯å¤„ç†Dockerå„ä¸ªåˆ†å±‚çš„é©±åŠ¨ï¼Œè´Ÿè´£å¤„ç†å®¹å™¨çš„å­˜å‚¨ã€‚å­˜å‚¨é©±åŠ¨å…·ä½“å®ç°å¦‚å›¾4æ‰€ç¤ºçš„åˆ†å±‚è¯»å†™æµç¨‹ã€‚\nã€€æœ€åº•å±‚çš„åŸºç¡€é•œåƒæ˜¯ubuntuçš„ç³»ç»Ÿé•œåƒï¼Œå†å¾€ä¸Šæ˜¯åˆ†å±‚çš„é•œåƒå±‚ï¼ˆæ¯”å¦‚dockerfileä¸­çš„è½¯ä»¶å®‰è£…ç­‰ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯åªè¯»çš„é•œåƒå±‚ã€‚æœ€ä¸Šé¢æ‰æ˜¯å¯ä»¥è¯»å†™çš„å®¹å™¨å­˜å‚¨å±‚ï¼Œä¸åŒçš„å®¹å™¨æœ‰ä¸åŒçš„å®¹å™¨å­˜å‚¨å±‚ï¼Œå…±ç”¨ç›¸åŒçš„é•œåƒå±‚ã€‚å½“æŸä¸ªå®¹å™¨éœ€è¦å†™æ“ä½œæ—¶ï¼Œä¼šå…ˆå°†å†™çš„å†…å®¹ä»é•œåƒå±‚å¤åˆ¶åˆ°å®¹å™¨å­˜å‚¨å±‚ï¼Œç„¶åå†å†™å…¥ï¼ˆä¹Ÿå°±æ˜¯å†™æ—¶å¤åˆ¶ï¼‰ï¼Œè¯»çš„æ—¶å€™ä¼šä»å®¹å™¨å±‚å¼€å§‹ï¼Œå¦‚æœå‘½ä¸­åˆ™è¯»å–ï¼Œæ²¡æœ‰å‘½ä¸­åˆ™ä¾æ¬¡å¾€ä¸‹å±‚è¯»å–ã€‚\nå›¾4 å®¹å™¨è¯»å†™æµç¨‹:\r\r ã€€ä¸åŒçš„ç³»ç»Ÿæ”¯æŒä¸åŒçš„å­˜å‚¨é©±åŠ¨ï¼Œå¯ä»¥åœ¨Dockerçš„é…ç½®é¡¹ä¸­åœ¨è¯¥ç³»ç»Ÿæ”¯æŒçš„å­˜å‚¨é©±åŠ¨ä¸­è¿›è¡Œé€‰æ‹©ã€‚å¦‚Ubuntuç³»ç»Ÿæ”¯æŒoverlay2ã€aufsã€btrfsã€‚\n2 å®‰è£… ã€€å®‰è£…é•œåƒçš„æ–¹æ³•å‚è€ƒDockerå®˜æ–¹æ–‡æ¡£ï¼š\n Ubuntuå®‰è£…æ–¹æ³•ï¼šhttps://docs.docker.com/engine/install/ubuntu/ CentOSå®‰è£…æ–¹æ³•ï¼šhttps://docs.docker.com/engine/install/centos/  ã€€æ¨èä½¿ç”¨ä»“åº“æ¥è£…Dockerã€‚\nã€€ï¼ˆ0ï¼‰ç§»é™¤æ—§ç‰ˆæœ¬çš„dockerï¼Œå¦‚æœä»¥å‰æ²¡æœ‰å®‰è£…è¿‡è¿è¡Œæ­¤å‘½ä»¤æ— å½±å“ã€‚\n sudo apt-get remove docker docker-engine docker.io containerd runc\rã€€ï¼ˆ1ï¼‰è®¾ç½®ä»“åº“\nã€€æ›´æ–°aptçš„åŒ…ç´¢å¼•ï¼Œå¹¶å…è®¸aptç”¨HTTPSä½¿ç”¨ä»“åº“æ¥å®‰è£…åŒ…ã€‚\n1 2 3 4 5 6 7  $ sudo apt-get update $ sudo apt-get install \\  apt-transport-https \\  ca-certificates \\  curl \\  gnupg \\  lsb-release   ã€€æ·»åŠ Dockerå®˜æ–¹çš„GPG keyã€‚\n1  $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg   ã€€è®¾ç½®ç¨³å®šçš„ä»“åº“ç‰ˆæœ¬ã€‚å®˜ç½‘çš„å®‰è£…é€Ÿåº¦å®åœ¨å¤ªæ…¢ï¼ˆä½†æ˜¯ä¹Ÿèƒ½æˆåŠŸï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒå®‰è£…ï¼ˆæˆ‘æ²¡æœ‰éªŒè¯ï¼Œæˆ‘ç”¨çš„å®˜ç½‘ç»™çš„é•œåƒè·¯å¾„ï¼‰ã€‚\n å‚è€ƒï¼šhttps://blog.csdn.net/qq_28612967/article/details/105912351\n 1 2 3 4  $ sudo add-apt-repository \\  \u0026#34;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \\ $(lsb_release -cs)\\ stable\u0026#34;   ã€€ï¼ˆ2ï¼‰å®‰è£…Dockerå¼•æ“\nã€€æ›´æ–°aptåŒ…ç´¢å¼•ï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Dockerå¼•æ“å’Œå®¹å™¨ï¼Œæˆ–åˆ°ä¸‹ä¸€æ­¥å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼ˆå¯åˆ°å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ï¼Œè¿™é‡Œä¸å†é‡å¤ï¼‰ï¼Œå®‰è£…çš„éå¸¸æ…¢ã€‚\n1 2  $ sudo apt-get update $ sudo apt-get install docker-ce docker-ce-cli containerd.io   ã€€ï¼ˆ3ï¼‰è¿è¡Œhello-worldé•œåƒï¼ŒéªŒè¯Dockerå¼•æ“æ˜¯å¦å®‰è£…æˆåŠŸã€‚\n1  $ sudo docker run hello-world   ã€€æ­¤å‘½ä»¤ä¸‹è½½æµ‹è¯•æ˜ åƒå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œå®ƒã€‚å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œå®ƒæ‰“å°ä¸€æ¡æ¶ˆæ¯å¹¶é€€å‡ºã€‚è¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  Unable to find image \u0026#39;hello-world:latest\u0026#39; locally latest: Pulling from library/hello-world b8dfde127a29: Pull complete Digest: sha256:7d91b69e04a9029b99f3585aaaccae2baa80bcf318f4a5d2165a9898cd2dc0a1 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the \u0026#34;hello-world\u0026#34; image from the Docker Hub. (amd64) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://hub.docker.com/ For more examples and ideas, visit: https://docs.docker.com/get-started/   ã€€æ­å–œï¼å®‰è£…æˆåŠŸğŸ‘ï¼\n3 ç®€å•ä½¿ç”¨ ã€€docker \u0026lt;åŠ¨ä½œ\u0026gt; --helpå‘½ä»¤å¯ä»¥æŸ¥çœ‹å„ä¸ªé€‰é¡¹çš„å«ä¹‰ã€‚\n3.1 åŸºæœ¬æ“ä½œ ã€€ï¼ˆ1ï¼‰æ‹‰å–é•œåƒï¼šdocker pull\nã€€é€‰é¡¹å¯ä»¥é€šè¿‡docker pull --helpå‘½ä»¤æŸ¥çœ‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  # ä»æŒ‡å®šåœ°å€è·å–é•œåƒï¼Œ[Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾]ï¼Œä¾‹baidu.com:8888/nignx:0.21 $ docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾] # ä»Docker Hubè·å–é•œåƒ $ docker pull [é€‰é¡¹] \u0026lt;ä»“åº“åï¼šæ ‡ç­¾\u0026gt; # ä¾‹å¦‚ $ sudo docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu e4ca327ec0e7: Pull complete Digest: sha256:9bc830af2bef73276515a29aa896eedfa7bdf4bdbc5c1063b4c457a4bbb8cd79 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04   ã€€æ‹‰å–é•œåƒæ—¶å¯èƒ½å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œè§£å†³æ–¹æ¡ˆä»»é€‰ä¸‹é¢ä¹‹ä¸€ï¼š\n åœ¨dockerå‘½ä»¤å‰åŠ sudoï¼› å°†å½“å‰ç”¨æˆ·åŠ å…¥åˆ°dockerç»„ï¼Œåœ¨å°†å½“å‰ç”¨æˆ·åˆ‡æ¢åˆ°dockerç»„ã€‚ï¼ˆå…·ä½“å‚è€ƒï¼šhttps://docs.docker.com/engine/install/linux-postinstall/ï¼‰  1 2  # é”™è¯¯ dial unix /var/run/docker.sock: connect: permission denied    æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/image/pull\n ã€€é•œåƒæ˜¯ç”±å¤šå±‚å­˜å‚¨æ„æˆï¼Œæ‹‰å–é•œåƒæ—¶ä¹Ÿæ˜¯ä¸€å±‚ä¸€å±‚ä¸‹è½½ï¼Œä¸Šé¢çš„ä¾‹å­å¯èƒ½çœ‹ä¸å‡ºæ¥åˆ†å±‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹å¯ä»¥çœ‹å‡ºé•œåƒæ‹‰å–æ—¶åˆ†å±‚è·å–ï¼Œå¹¶ä¼šåœ¨ä¸‹è½½ç»“æŸåç»™å‡ºé•œåƒå®Œæ•´çš„sha256æ‘˜è¦ï¼Œä»¥ç¡®ä¿ä¸‹è½½çš„ä¸€è‡´æ€§ã€‚\n1 2 3 4 5 6 7 8 9  $ docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 92dc2a97ff99: Pull complete be13a9d27eb8: Pull complete c8299583700a: Pull complete Digest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04   ã€€ï¼ˆ2ï¼‰è¿è¡Œå®¹å™¨ï¼šdocker run\nã€€ä¸‹é¢æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œçš„ç®€å•ç¤ºä¾‹ï¼Œè¿è¡Œubuntu:18.04é•œåƒï¼Œå¯åŠ¨äº¤äº’å¼shellï¼Œè¿è¡Œä¸¤æ¡å‘½ä»¤åç”¨exité€€å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  # -i:äº¤äº’å¼æ“ä½œï¼Œ-t:ç»ˆç«¯ï¼Œ--rm:å®¹å™¨é€€å‡ºååˆ é™¤å®¹å™¨ï¼Œ # ubuntu:18.04:é•œåƒï¼Œbash:æ”¾åœ¨é•œåƒåï¼Œæ˜¯å¸Œæœ›åœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚ $ docker run -it --rm ubuntu:18.04 bash # è¿è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œå‡ æ¡å‘½ä»¤ï¼Œç»“æœå¦‚ä¸‹ $ sudo docker run -it --rm ubuntu:18.04 bash root@ae6350fe7dda:/# ls bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var root@ae6350fe7dda:/# cat /etc/os-release NAME=\u0026#34;Ubuntu\u0026#34; VERSION=\u0026#34;18.04.5 LTS (Bionic Beaver)\u0026#34; ID=ubuntu ID_LIKE=debian PRETTY_NAME=\u0026#34;Ubuntu 18.04.5 LTS\u0026#34; VERSION_ID=\u0026#34;18.04\u0026#34; HOME_URL=\u0026#34;https://www.ubuntu.com/\u0026#34; SUPPORT_URL=\u0026#34;https://help.ubuntu.com/\u0026#34; BUG_REPORT_URL=\u0026#34;https://bugs.launchpad.net/ubuntu/\u0026#34; PRIVACY_POLICY_URL=\u0026#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\u0026#34; VERSION_CODENAME=bionic UBUNTU_CODENAME=bionic root@ae6350fe7dda:/# exit exit ubuntu@VM-0-12-ubuntu:~/docker_test$   ã€€ï¼ˆ3ï¼‰åˆ—å‡ºå·²ä¸‹è½½çš„é•œåƒï¼šdocker image ls\nã€€é•œåƒIDæ˜¯é•œåƒçš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœä¸¤ä¸ªé•œåƒçš„ä»“åº“åç§°ä¸åŒï¼Œä½†Image idç›¸åŒï¼Œè¯´æ˜å®ƒä»¬æ˜¯åŒä¸€é•œåƒã€‚è¿™ä¸ªå‘½ä»¤ä¸‹åˆ—å‡ºçš„SIZEæ€»å’Œå¹¶ä¸æ˜¯å®é™…æ‰€æœ‰é•œåƒå®é™…å ç”¨çš„ç©ºé—´å¤§å°ï¼Œå› ä¸ºDockerä½¿ç”¨Union FSï¼Œç›¸åŒçš„å±‚ä»…ä¿å­˜ä¸€ä»½ï¼Œå®é™…é•œåƒç¡¬ç›˜å ç”¨ç©ºé—´å¯èƒ½æ¯”è¿™ä¸ªåˆ—è¡¨é•œåƒå¤§å°çš„æ€»å’Œè¦å°å¾—å¤šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  $ sudo docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 18.04 54919e10a95d 9 days ago 63.1MB hello-world latest d1165f221234 6 months ago 13.3kB # æŸ¥çœ‹é•œåƒæ‘˜è¦ $ sudo docker image ls --digests REPOSITORY TAG DIGEST ... ubuntu 18.04 sha256:9bc830af2bef73276515a29aa896eedfa7bdf4bdbc5c1063b4c457a4bbb8cd79 ...   ã€€å¦‚æœä»“åº“åå’Œæ ‡ç­¾å‡ä¸º\u0026lt;none\u0026gt;ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå’Œæ–°é•œåƒé‡åçš„æ—§é•œåƒï¼Œç§°ä¸ºè™šæ‚¬é•œåƒï¼ˆdangling imageï¼‰å¯ä»¥éšæ„åˆ é™¤ã€‚å¦‚æœåªæœ‰æ ‡ç­¾å‡ºç°noneï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªiä¸­é—´å±‚é•œåƒï¼Œå¯ä»¥é€šè¿‡docker image ls -aæŸ¥çœ‹ã€‚\nã€€è¿˜æ”¯æŒè¿‡æ»¤å™¨å‚æ•°--filterï¼Œå…·ä½“ä½¿ç”¨è¯´æ˜å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–Dockerâ€”â€”ä»å…¥é—¨åˆ°å®è·µç­‰ã€‚\nã€€ï¼ˆï¼”ï¼‰æŸ¥çœ‹é•œåƒã€å®¹å™¨ã€æ•°æ®å·æ‰€å ç”¨çš„ç©ºé—´ï¼šdocker system df\n1 2 3 4 5 6 7  $ sudo docker system df TYPE TOTAL ACTIVE SIZE RECLAIMABLE Images 2 1 63.15MB 63.14MB (99%) Containers 1 0 0B 0B Local Volumes 0 0 0B 0B Build Cache 0 0 0B 0B   ã€€ï¼ˆ5ï¼‰åˆ é™¤æœ¬åœ°é•œåƒï¼šdocker image rm\nã€€å…¶ä¸­\u0026lt;é•œåƒ\u0026gt;å¯ä»¥æ˜¯é•œåƒåï¼ˆ\u0026lt;ä»“åº“å\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt;ï¼‰ã€é•œåƒçš„å®Œæ•´IMAGE IDï¼Œé•œåƒIDçš„å‰å‡ ä½ï¼ˆè¶³ä»¥å’Œåˆ«çš„é•œåƒåŒºåˆ†ï¼‰ï¼Œé•œåƒæ‘˜è¦ã€‚\n1 2 3 4 5 6  $ sudo docker image rm ubuntu:18.04 Untagged: ubuntu:18.04 Untagged: ubuntu@sha256:9bc830af2bef73276515a29aa896eedfa7bdf4bdbc5c1063b4c457a4bbb8cd79 Deleted: sha256:54919e10a95d6f756f7286dc0fa6b3e25b637a7f90e361504b0b14ab6762a547 Deleted: sha256:6babb56be2593d69d561cae7ad16b670a1ee7c0a32b4fa715007fba7febd5ddb   ã€€é•œåƒåˆ é™¤æ—¶ä¹Ÿæ˜¯ä»ä¸Šå±‚å‘ä¸‹å±‚ä¾æ¬¡åˆ é™¤ï¼Œå¦‚æœå…¶å®ƒé•œåƒä¾èµ–å½“å‰è¦åˆ é™¤çš„è¿™ä¸€å±‚ï¼Œé‚£ä¹ˆè¿™ä¸€å±‚ä¸ä¼šè¢«çœŸå®åˆ é™¤ï¼Œåªæœ‰è¿™ä¸€å±‚å’Œæ‰€æœ‰é•œåƒéƒ½æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»æ—¶ï¼Œæ‰ä¼šè¢«çœŸå®çš„åˆ é™¤ã€‚\nã€€å¯ä»¥é…åˆdocker image ls -qé…åˆä½¿ç”¨docker image rmï¼Œä¾‹å¦‚ï¼Œè¦åˆ é™¤æ‰€æœ‰ä»“åº“åä¸ºredisçš„é•œåƒï¼š\n1  $ docker image rm $(docker image ls -q redis)   ã€€ï¼ˆ6ï¼‰docker commitå‘½ä»¤å¯ä»¥å°†å®¹å™¨å­˜å‚¨å±‚ä¿å­˜ä¸ºé•œåƒï¼Œä»è€Œå’ŒåŸºç¡€é•œåƒåˆ†å±‚ç»„æˆæ–°çš„é•œåƒï¼Œä½†ä¸€èˆ¬ä¸ä½¿ç”¨æ­¤å‘½ä»¤å®šåˆ¶é•œåƒï¼Œé™¤äº†åˆ¶ä½œé•œåƒçš„äººæ²¡æœ‰äººçŸ¥é“æ‰§è¡Œè¿‡ä»€ä¹ˆå‘½ä»¤ï¼Œæ€ä¹ˆç”Ÿæˆçš„é•œåƒï¼Œè¢«ç§°ä¸ºé»‘ç®±é•œåƒã€‚è¯¥å‘½ä»¤ç”¨äºç‰¹æ®Šåœºåˆï¼Œå¦‚å…¥ä¾µåä¿å­˜ç°åœºã€‚\nã€€ï¼ˆ7ï¼‰é‡å‘½åé•œåƒ\nã€€æˆ‘ä»¬åœ¨ä¸‹è½½é•œåƒæ—¶ï¼ŒæŒ‰ç…§é•œåƒåœ°å€ä¸‹è½½ä¸‹æ¥çš„é•œåƒå¯èƒ½æ˜¯è¿™æ ·ï¼Œé•œåƒåç§°éå¸¸é•¿ï¼Œä¸ä¾¿äºä½¿ç”¨\nREPOSITORY TAG IMAGE ...\rregistry.cn-shanghai.aliyuncs.com/tcc-public/tianchi_antispam v1 2b8b72f601da ...\rã€€è¿™æ—¶æˆ‘ä»¬å¯ä»¥é‡å‘½åé•œåƒï¼š\n1  $ docker tag 2b8b72f601da tianchi_antispam:v1   ã€€æ­¤æ—¶ä¼šå‡ºç°ä¸¤ä¸ªImage IDç›¸åŒçš„é•œåƒï¼Œæˆ‘ä»¬å°†åŸæ¥çš„åå­—å¾ˆé•¿çš„é•œåƒåˆ é™¤ï¼š\n1  $ docker image rm registry.cn-shanghai.aliyuncs.com/tcc-public/tianchi_antispam   3.2 å®¹å™¨æ“ä½œ ã€€ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªå®¹å™¨å¹¶å¯åŠ¨\n1 2 3  $ sudo docker run ubuntu /bin/echo \u0026#39;Hello world\u0026#39; Hello world   ã€€å½“åˆ©ç”¨ docker run æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œæ—¶é¦–å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨åˆ™ä»Registryä¸‹è½½ï¼Œç„¶ååˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚å¯åŠ¨å®¹å™¨æ—¶ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½å®¹å™¨å­˜å‚¨å±‚ï¼Œä¸ºå®¹å™¨ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶ä»åœ°å€æ± ä¸ºå®¹å™¨é…ç½®ä¸€ä¸ªIPåœ°å€ã€‚é…ç½®å®Œæ¯•åæ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºæ‰§è¡Œå®Œæ¯•åå®¹å™¨ç»ˆæ­¢ã€‚\nã€€ï¼ˆ2ï¼‰ä»¥å®ˆæŠ¤æ€ï¼ˆåå°ï¼‰è¿è¡Œå®¹å™¨\n1 2 3 4 5  $ sudo docker run -d \u0026lt;image\u0026gt; \u0026lt;cmd\u0026gt; $ sudo docker run -d ubuntu /bin/sh -c \u0026#34;while true; do echo hello world; sleep 1; done\u0026#34; 88d0d78c3de5115c9ba18cda24110b241246534c0c03a71a2b15d8da65665860   ã€€å¯ä»¥é€šè¿‡docker container logså‘½ä»¤ï¼Œè·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ã€‚\n1 2 3 4 5 6  $ docker container logs [container ID or NAMES] hello world hello world hello world . . .   ã€€ï¼ˆ3ï¼‰æŸ¥çœ‹å®¹å™¨åˆ—è¡¨\n1 2 3 4 5  # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ $ sudo docker container ls $ sudo docker ps # æŸ¥çœ‹å·²åœæ­¢çš„å®¹å™¨ $ sudo docker container ls -a   ã€€ï¼ˆ4ï¼‰åœæ­¢è¿è¡Œå®¹å™¨ã€‚NAMESæ˜¯å®¹å™¨å¯åŠ¨æ—¶è®¾ç½®çš„--nameé€‰é¡¹ï¼Œå¯åœ¨å®¹å™¨æŸ¥çœ‹å‘½ä»¤çš„NAMESä¸€åˆ—æŸ¥çœ‹ï¼Œcontainerå¯çœç•¥ã€‚Dockerå®¹å™¨ä¸­æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¹Ÿè‡ªåŠ¨åœæ­¢è¿è¡Œã€‚\n1  $ sudo docker container stop [container ID or NAMES]   ã€€ï¼ˆ5ï¼‰é‡æ–°å¯åŠ¨ç»ˆæ­¢çš„å®¹å™¨ï¼Œä¸‹é¢é‡å¯Hello worldå®¹å™¨ã€‚\n1  $ sudo docker container start [container ID or NAMES]   ã€€ï¼ˆ6ï¼‰åˆ é™¤\nã€€åˆ é™¤å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚\n1  $ sudo docker container rm [container ID or NAMES]   ã€€æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚\n1  $ sudo docker container prune   ã€€ï¼ˆ7ï¼‰å¯¼å…¥å’Œå¯¼å‡º\nã€€å¯¼å‡ºæœ¬åœ°æŸä¸ªå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°æ–‡ä»¶ã€‚\n1  $ sudo docker export [container ID] \u0026gt; [å¿«ç…§å].tar   ã€€docker importä»å®¹å™¨å¿«ç…§æ–‡ä»¶ä¸­å¯¼å…¥ä¸ºé•œåƒï¼Œå’Œå¯¼å…¥é•œåƒå­˜å‚¨æ–‡ä»¶ï¼ˆdocker loadï¼‰çš„åŒºåˆ«åœ¨äºå®¹å™¨å¿«ç…§æ–‡ä»¶æ˜¯â€œé»‘ç›’â€ï¼Œä¼šä¸¢å¤±æ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼Œè€Œé•œåƒå­˜å‚¨æ–‡ä»¶ä¿å­˜å®Œæ•´è®°å½•ã€‚\n1 2 3  $ sudo cat [å¿«ç…§æ–‡ä»¶] | docker import - \u0026lt;ç”¨æˆ·å\u0026gt;/\u0026lt;ä»“åº“å:æ ‡ç­¾\u0026gt; # ä»URLæˆ–ç›®å½•å¯¼å…¥ $ sudo docker import http://example.com/exampleimage.tgz example/imagerepo   ã€€ï¼ˆ8ï¼‰è¿›å…¥å®¹å™¨ï¼šdocker exec [é€‰é¡¹] å®¹å™¨å†…æ‰§è¡Œçš„å‘½ä»¤ [å‘½ä»¤å‚æ•°]\n1 2 3 4  # å¼€å¯ä¸€ä¸ªbashå¯¹è¯ $ sudo docker exec -it \u0026lt;IMAGE_ID\u0026gt; bash # ä¾‹ $ docker exec -it 0d588c4d3cb7 bash   ï¼ˆ9ï¼‰æ–‡ä»¶æ‹·è´\nä»å®¹å™¨æ‹·è´æ–‡ä»¶åˆ°å®¿ä¸»æœº\ndocker cp tianchi_executor.py 0d588c4d3cb7:/root/tianchi_aiflow/workflows/tianchi_main/\ndocker cp mycontainer:/opt/testnew/file.txt /opt/test/\rdocker cp 0d588c4d3cb7:/root/tianchi_entry/result.csv .\nä»å®¿ä¸»æœºæ‹·è´æ–‡ä»¶åˆ°å®¹å™¨\ndocker cp /opt/test/file.txt mycontainer:/opt/testnew/\rdocker cp /root/aaigcup/tianchi_executor.py 0d588c4d3cb7:/root/tianchi_aiflow/workflows/tianchi_main/\ndocker cp /root/aaigcup/tf_main.py 0d588c4d3cb7:/root/tianchi_aiflow/workflows/tianchi_main/\n3.3 Dockerfileå®šåˆ¶é•œåƒ  æ¥æºï¼šhttps://yeasy.gitbook.io/docker_practice/image/build\n ã€€Dockerfileå°±æ˜¯è®°å½•é•œåƒæ¯å±‚ä¿®æ”¹ã€å®‰è£…ã€æ„å»ºã€æ“ä½œå‘½ä»¤çš„è„šæœ¬ï¼Œä¸docker commitæ„å»ºçš„é»‘ç›’é•œåƒä¸åŒï¼Œå®ƒèƒ½æ„å»ºä½“ç§¯é€‚å½“ã€æ“ä½œè®°å½•æ¸…æ™°çš„é•œåƒã€‚\nã€€Dockerfileæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒç”±è®¸å¤šæŒ‡ä»¤ç»„æˆï¼Œæ¯æ¡æŒ‡ä»¤æ„å»ºé•œåƒçš„ä¸€å±‚ï¼Œæè¿°è¯¥å±‚åº”è¯¥æ€æ ·æ„å»ºã€‚\nã€€å®šåˆ¶é•œåƒæ—¶å…ˆç”¨æŒ‡ä»¤ç¼–å†™Dockerfileæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨docker buildå‘½ä»¤æ„å»ºé•œåƒã€‚\n3.3.1 å®šåˆ¶é•œåƒç®€å•ç¤ºä¾‹ ã€€ä¸‹é¢æ˜¯ç”¨Dockerfileæ„å»ºä¸€ä¸ªç®€å•çš„å®šåˆ¶nginxé•œåƒï¼š\nã€€ï¼ˆ1ï¼‰åœ¨ç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå‘½åä¸ºDockerfileï¼Œå…¶ä¸­touchå‘½ä»¤æ˜¯å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚\n1 2 3 4  $ mkdir mynginx $ cd mynginx $ touch Dockerfile $ vim Dockerfile   ã€€Dockerfileçš„å†…å®¹ä¸ºï¼š\n1 2  FROMnginxRUN echo \u0026#39;\u0026lt;h1\u0026gt;Hello, Docker!\u0026lt;/h1\u0026gt;\u0026#39; \u0026gt; /usr/share/nginx/html/index.html  ã€€ï¼ˆ2ï¼‰æ„å»ºé•œåƒï¼Œåœ¨Dockerfileæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæœ¬ä¾‹ä¸­ä¸ºmynginxã€‚æ³¨æ„nginx:v2åçš„.ä¸è¦æ¼æ‰ï¼Œå®ƒè¡¨ç¤ºå½“å‰ç›®å½•ã€‚\n1 2 3 4 5 6 7 8 9 10 11  ~/mynginx$ sudo docker build -t nginx:v2 . Sending build context to Docker daemon 2.048kB Step 1/2 : FROM nginx ---\u0026gt; 822b7ec2aaf2 Step 2/2 : RUN echo \u0026#39;\u0026lt;h1\u0026gt;Hello, Docker!\u0026lt;/h1\u0026gt;\u0026#39; \u0026gt; /usr/share/nginx/html/index.html ---\u0026gt; Running in c07f4978691f Removing intermediate container c07f4978691f ---\u0026gt; 0abd2a2a7c16 Successfully built 0abd2a2a7c16 Successfully tagged nginx:v2   ã€€å¯ä»¥çœ‹åˆ°RunæŒ‡ä»¤å…ˆå¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨c07f4978691fç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œç„¶åæäº¤è¿™ä¸€å±‚0abd2a2a7c16ï¼Œéšååˆ é™¤äº†å®¹å™¨c07f4978691fã€‚\nã€€ï¼ˆ3ï¼‰æŸ¥çœ‹æ„å»ºçš„nginx:v2é•œåƒã€‚\n1 2 3 4 5  $ sudo docker image ls nginx REPOSITORY TAG IMAGE ID CREATED SIZE nginx v2 0abd2a2a7c16 7 minutes ago 133MB nginx latest 822b7ec2aaf2 6 days ago 133MB   3.3.2 å¸¸ç”¨æŒ‡ä»¤ ã€€Dockerfileä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œå±‚æ•°è¿‡å¤šä¼šå¢åŠ æ„å»ºéƒ¨ç½²æ—¶é—´ï¼Œé•œåƒè‡ƒè‚¿æ··ä¹±ï¼Œå¹¶ä¸”Union FSæœ‰æœ€å¤§å±‚æ•°é™åˆ¶ï¼ˆå¦‚AUFSä¸èƒ½è¶…è¿‡127å±‚ï¼‰ï¼Œåº”å½“åˆç†ç»„ç»‡æŒ‡ä»¤ï¼Œæ„å»ºç®€æ´å¹²å‡€çš„é•œåƒã€‚æœ‰çš„æŒ‡ä»¤å…·æœ‰ä¸¤ç§æ ¼å¼ï¼Œshellå’Œexecæ ¼å¼ï¼Œæ³¨æ„åœ¨ç”¨execæ ¼å¼æ—¶ä¸€å®šè¦ä½¿ç”¨åŒå¼•å·\u0026quot;\u0026quot;ï¼Œä¸è¦ä½¿ç”¨å•å¼•å·''ã€‚\nï¼ˆ1ï¼‰FROM\nã€€å®šåˆ¶é•œåƒä¸€èˆ¬ä»¥ä¸€ä¸ªé•œåƒä¸ºåŸºç¡€ï¼Œåœ¨ä¸Šé¢è¿›è¡Œæ“ä½œä»¥æ„å»ºæ–°çš„é•œåƒã€‚FROMå‘½ä»¤ç”¨æ¥æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒï¼Œæ¯”å¦‚3.3.1ç¤ºä¾‹ä¸­çš„nginxã€‚\nã€€åœ¨Dockerfileä¸­ï¼Œå¿…é¡»æŒ‡å®šåŸºç¡€é•œåƒã€‚Docker Hubæä¾›äº†éå¸¸å¤šçš„å®˜æ–¹é•œåƒï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿé•œåƒï¼ˆubuntuã€centosï¼‰ã€æœåŠ¡ç±»é•œåƒï¼ˆnginxã€redisã€httpdã€mongoï¼‰ã€è¯­è¨€ç¯å¢ƒé•œåƒï¼ˆnodeã€pythonã€golangï¼‰ç­‰ã€‚å¦‚æœä¸æƒ³é€‰æ‹©ç°æœ‰çš„åŸºç¡€é•œåƒï¼Œå¯ä»¥è®¾ç½®åŸºç¡€é•œåƒä¸ºscratchï¼Œè¡¨ç¤ºé•œåƒä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€ï¼Œä¹‹åçš„æŒ‡ä»¤ä¼šä½œä¸ºé•œåƒçš„ç¬¬ä¸€å±‚ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n1  $ FROM scratch   ã€€å¯¹äºé™æ€ç¼–è¯‘çš„ç¨‹åºæ¥è¯´ï¼Œå…¶ä¾èµ–åº“å·²ç»åŒ…å«åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç›´æ¥å°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶è¿›é•œåƒä¼šè®©é•œåƒä½“ç§¯æ›´åŠ å°å·§ï¼Œä½¿ç”¨Goè¯­è¨€å¼€å‘çš„åº”ç”¨å¾ˆå¤šä¼šä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ¶ä½œé•œåƒã€‚\nï¼ˆ2ï¼‰RUN\nã€€RUNç”¨æ¥æ‰§è¡Œç»ˆç«¯å‘½ä»¤ï¼Œæœ‰shellå’Œexecä¸¤ç§ã€‚\n shellæ ¼å¼ï¼šå°±åƒç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ä¸€æ ·ï¼Œæ¯”å¦‚åœ¨3.3.1ç¤ºä¾‹ä¸­çš„RUNæŒ‡ä»¤ã€‚ execæ ¼å¼ï¼šæ›´åƒå‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ï¼ŒRUN [\u0026quot;å¯æ‰§è¡Œæ–‡ä»¶\u0026quot;,\u0026quot;å‚æ•°1\u0026quot;,\u0026quot;å‚æ•°2\u0026quot;]ã€‚  ã€€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ¡RUNæŒ‡ä»¤å°±ä¼šå»ºç«‹ä¸€å±‚é•œåƒï¼Œä»¥ä¸‹é¢ç¼–è¯‘ã€å®‰è£…rediså¯æ‰§è¡Œæ–‡ä»¶çš„é”™è¯¯ç¤ºä¾‹ä¸ºä¾‹ï¼Œä¸‹é¢çš„Dockerfileä¼šå¯¼è‡´è¿è¡Œæ—¶ä¸éœ€è¦çš„å†…å®¹ä¹Ÿè¢«è£…è¿›é•œåƒï¼Œå¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ï¼Œå¯¼è‡´é•œåƒè‡ƒè‚¿ï¼š\n1 2 3 4 5 6 7 8 9  FROMdebian:stretchRUN apt-get updateRUN apt-get install -y gcc libc6-dev make wgetRUN wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34;RUN mkdir -p /usr/src/redisRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1RUN make -C /usr/src/redisRUN make -C /usr/src/redis install  ã€€ä¸Šé¢çš„é”™è¯¯ç¤ºä¾‹åœ¨åŸºç¡€é•œåƒä¹‹ä¸Šåˆ›å»ºäº†7å±‚é•œåƒï¼Œéå¸¸è‡ƒè‚¿ï¼Œè€Œä»£ç çš„ç›®æ ‡åªæ˜¯ç¼–è¯‘ã€å®‰è£…rediså¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªéœ€è¦ä¸€å±‚å°±å¯ä»¥äº†ã€‚æ‰€ä»¥åº”è¯¥åªä½¿ç”¨ä¸€æ¬¡RUNæŒ‡ä»¤ï¼Œå°†æ‰€æœ‰å‘½ä»¤ç”¨\u0026amp;\u0026amp;ä¸²è”èµ·æ¥ã€‚\nã€€ä¸ºäº†æ–¹ä¾¿æ–‡ä»¶é˜…è¯»ï¼ŒDockerfileæ”¯æŒ\\çš„è¡Œå°¾å‘½ä»¤æ¢è¡Œå’Œè¡Œé¦–#æ³¨é‡Šçš„æ ¼å¼ã€‚\nã€€æ„å»ºæ¯ä¸€å±‚æ—¶è¿˜éœ€è¦æ³¨æ„ï¼Œä¸ç¼–å†™shellè„šæœ¬ä¸åŒçš„æ˜¯ï¼Œæ„å»ºé•œåƒæ—¶ï¼Œè¦æ¸…ç†æ‰æ— å…³å†…å®¹ï¼Œæ¯”å¦‚ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ã€ä¸‹è½½çš„æ–‡ä»¶ã€aptç¼“å­˜æ–‡ä»¶ç­‰ã€‚æˆ‘ä»¬æœ€åç¼–å†™çš„Dockerfileå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  FROMdebian:stretchRUN set -x; buildDeps=\u0026#39;gcc libc6-dev make wget\u0026#39; \\  \u0026amp;\u0026amp; apt-get update \\  \u0026amp;\u0026amp; apt-get install -y $buildDeps \\  \u0026amp;\u0026amp; wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34; \\  \u0026amp;\u0026amp; mkdir -p /usr/src/redis \\  \u0026amp;\u0026amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\  \u0026amp;\u0026amp; make -C /usr/src/redis \\  \u0026amp;\u0026amp; make -C /usr/src/redis install \\  \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* \\  \u0026amp;\u0026amp; rm redis.tar.gz \\  \u0026amp;\u0026amp; rm -r /usr/src/redis \\  \u0026amp;\u0026amp; apt-get purge -y --auto-remove $buildDeps  ã€buildDepsã€‘æ˜¯ä»€ä¹ˆï¼Ÿbuild-depå‚æ•°æ˜¯æŒ‡å»ºç«‹æŸä¸ªè¦ç¼–è¯‘è½¯ä»¶çš„ç¯å¢ƒï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦æ‰‹å·¥ç¼–è¯‘apacheï¼Œé‚£å¦‚æœæƒ³è®©ç¼–è¯‘æ­£å¸¸é€šè¿‡ï¼Œä½ å¯ä»¥äº‹å…ˆæŠŠç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„è½¯ä»¶åŒ…å…ˆé…ç½®å¥½ã€‚\nï¼ˆ3ï¼‰COPYå’ŒADD\nã€€COPYæŒ‡ä»¤ä»ä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œå°†\u0026lt;æºè·¯å¾„\u0026gt;çš„æ–‡ä»¶å¤åˆ¶åˆ°æ–°ä¸€å±‚çš„é•œåƒå†…çš„\u0026lt;ç›®æ ‡è·¯å¾„\u0026gt;ä½ç½®ã€‚COPYä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼š\n COPY [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] \u0026lt;æºè·¯å¾„\u0026gt;... \u0026lt;ç›®æ ‡è·¯å¾„\u0026gt; COPY [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] [\u0026quot;\u0026lt;æºè·¯å¾„1\u0026gt;\u0026quot;,... \u0026quot;\u0026lt;ç›®æ ‡è·¯å¾„\u0026gt;\u0026quot;]  ã€€å…¶ä¸­\u0026lt;æºè·¯å¾„\u0026gt;å¯ä»¥æ˜¯å¤šä¸ªï¼Œé€šé…ç¬¦éœ€è¦æ»¡è¶³Goçš„filepath.Matchè§„åˆ™ï¼›\u0026lt;ç›®æ ‡è·¯å¾„\u0026gt;å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœç›®æ ‡è·¯å¾„ä¸å­˜åœ¨ï¼Œä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰åˆ›å»ºç¡®å®ç›®å½•ã€‚æ¯”å¦‚ï¼š\n1 2 3  COPY package.json /usr/src/app/COPY hom* /mydir/COPY hom?.txt /mydir/  ã€€COPYæŒ‡ä»¤ä¼šä¿ç•™æºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®ï¼Œæ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ç­‰ã€‚\nã€€ADDå’ŒCOPYåŠŸèƒ½ç›¸ä¼¼ï¼Œä½†åº”å°½å¯èƒ½åœ°ä½¿ç”¨COPYï¼Œè¿™é‡Œä¸å¯¹ADDåšè¯¦ç»†ä»‹ç»ã€‚ä½†ADDå…·æœ‰è‡ªåŠ¨è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œé€‚åˆç”¨äºå°†ä¸€ä¸ªå‹ç¼©æ–‡ä»¶è‡ªåŠ¨è§£å‹åˆ°\u0026lt;ç›®æ ‡è·¯å¾„\u0026gt;ä¸­ã€‚\nï¼ˆ4ï¼‰CMD\nã€€Dockerå®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œéœ€è¦æŒ‡å®šæ‰€è¿è¡Œçš„ç¨‹åºåŠå‚æ•°ã€‚CMDç”¨æ¥æŒ‡å®šé»˜è®¤çš„å®¹å™¨ä¸»è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤ï¼Œå¦‚/bin/bashï¼Œubuntué•œåƒçš„CMDæ˜¯/bin/bashï¼Œå½“æˆ‘ä»¬ç›´æ¥è¿è¡Œdocker run -it ubuntuæ—¶ï¼Œå°±ä¼šç›´æ¥è¿›å…¥bashï¼Œæƒ³è¦åœ¨è¿è¡Œæ—¶è¿è¡Œåˆ«çš„å‘½ä»¤ï¼Œéœ€è¦åœ¨è¿è¡Œå‘½ä»¤ä¸­æŒ‡å‡ºï¼Œå¦‚docker run -it ubuntu cat /etc/os-releaseï¼Œæ­¤æ—¶å°±ä¸ä¼šè¿›å…¥bashï¼Œè€Œæ˜¯è¾“å‡ºç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€‚\nã€€CMDå‘½ä»¤ä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œ\n shell æ ¼å¼ï¼šCMD \u0026lt;å‘½ä»¤\u0026gt; exec æ ¼å¼ï¼šCMD [\u0026quot;å¯æ‰§è¡Œæ–‡ä»¶\u0026quot;, \u0026quot;å‚æ•°1\u0026quot;, \u0026quot;å‚æ•°2\u0026quot;...]  ã€€ä¸€èˆ¬æ¨èä½¿ç”¨execæ ¼å¼ï¼Œä½¿ç”¨shellå½¢å¼åœ¨å®é™…æ‰§è¡Œä¸­ä¹Ÿä¼šå˜æˆsh -cçš„å‚æ•°å½¢å¼è¿›è¡Œæ‰§è¡Œã€‚\n1 2 3 4  # ä½¿ç”¨shellå½¢å¼CMD echo $HOME# å®é™…æ‰§è¡ŒCMD [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;echo $HOME\u0026#34;]  ã€€æ³¨æ„å®¹å™¨æ˜¯è¿›ç¨‹ï¼Œä¸æ˜¯æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰åå°æœåŠ¡ï¼Œå…¶ä¸»è¿›ç¨‹è¿è¡Œçš„å‘½ä»¤ç»“æŸåå®¹å™¨å°±ä¼šé€€å‡ºï¼Œå¦‚æœæˆ‘ä»¬å°†å¯åŠ¨nginxæœåŠ¡çš„å‘½ä»¤å†™æˆä¸‹é¢è¿™æ ·ï¼Œä¼šå‘ç°å®¹å™¨æ‰§è¡Œå®Œæ¯•åç«‹åˆ»é€€å‡ºäº†ã€‚\n1  CMD service nginx start  ã€€ä¸Šé¢çš„å‘½ä»¤å®é™…æ‰§è¡Œæ˜¯å®é™…æ˜¯ä¸‹é¢è¿™æ ·ï¼Œä¸»è¿›ç¨‹ä¸æ˜¯serviceè€Œæ˜¯shï¼Œè€Œshæ‰§è¡Œå®Œservice nginx startä¹‹åå°±ç»“æŸé€€å‡ºäº†ï¼Œå®¹å™¨ä¹Ÿå°±é€€å‡ºäº†ã€‚\n1  CMD [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;service nginx start\u0026#34;]  ã€€æ‰€ä»¥èƒ½å¤Ÿè¾¾åˆ°ç›®çš„çš„åšæ³•æ˜¯æ‰§è¡Œnginxå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦ä»¥å‰å°å½¢å¼è¿è¡Œï¼Œå¦åˆ™è¯¥å‘½ä»¤æ‰§è¡Œå®Œæ¯•å®¹å™¨åˆé€€å‡ºäº†ã€‚\n1  CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;]  ï¼ˆ5ï¼‰WORKDIR\nã€€WORKDIRç”¨æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆå½“å‰ç›®å½•ï¼‰ï¼Œä¹‹åå„å±‚çš„å½“å‰ç›®å½•å°±ä¿®æ”¹ä¸ºæŒ‡å®šçš„å·¥ä½œç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œä¼šå»ºç«‹è¯¥ç›®å½•ï¼Œæ ¼å¼ä¸ºï¼šWORKDIR \u0026lt;å·¥ä½œç›®å½•è·¯å¾„\u0026gt;ã€‚\nã€€æ³¨æ„å’ŒRUN cdå‘½ä»¤çš„åŒºåˆ«ï¼šRUNæŒ‡ä»¤æ‰§è¡Œä¸€æ¬¡ï¼Œåˆ›å»ºä¸€å±‚æ–°çš„é•œåƒï¼Œæ‰€ä»¥RUN cdåªèƒ½æ”¹å˜å½“å‰å±‚çš„æ‰§è¡Œç¯å¢ƒï¼Œè€ŒWORKDIRå¯ä»¥æ”¹å˜ä¹‹åæ‰€æœ‰å±‚çš„å·¥ä½œç›®å½•ã€‚shellä¸­cdå¯ä»¥æ”¹å˜åç»­çš„æ‰§è¡Œç¯å¢ƒæ˜¯å› ä¸ºshellæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ä»–å‘½ä»¤éƒ½æ˜¯shellçš„å­è¿›ç¨‹ï¼Œcd æ”¹å˜çš„æ˜¯shellè¿›ç¨‹çš„è¿è¡Œç¯å¢ƒï¼Œæ‰€ä»¥åœ¨shellä¸­æ‰§è¡Œcdå‘½ä»¤ï¼Œä¼šç›´æ¥å½±å“åˆ°åç»­å‘½ä»¤ã€‚\nå¦‚æœæƒ³è¦æ”¹å˜ä¹‹åå„å±‚çš„å·¥ä½œç›®å½•çš„ä½ç½®ï¼Œåº”è¯¥ä½¿ç”¨WORKDIRæŒ‡ä»¤ã€‚å¦‚æœWORKDIRæŒ‡ä»¤ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ‰€åˆ‡æ¢çš„è·¯å¾„ä¸ä¹‹å‰çš„WORKDIRæœ‰å…³ã€‚\n1 2 3 4 5  WORKDIR/aWORKDIRbWORKDIRcRUN pwd  ã€€RUN pwdçš„å·¥ä½œç›®å½•ä¸º/a/b/cã€‚\nï¼ˆ6ï¼‰EXPOSE\nã€€EXPOSEç”¨äºå£°æ˜å®¹å™¨è¿è¡Œæ—¶æä¾›æœåŠ¡çš„ç«¯å£ï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨å®¹å™¨è¿è¡Œæ—¶æ‰“å¼€è¿™ä¸ªç«¯å£çš„æœåŠ¡éœ€è¦ç”¨-På‘½ä»¤å¯ç”¨æ˜ å°„ã€‚è¿™ä¸ªå£°æ˜å¯ä»¥å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£é•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œå¹¶åœ¨docker run -Pæ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„EXPOSEçš„ç«¯å£ã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n1  EXPOSE\u0026lt;ç«¯å£1\u0026gt; [\u0026lt;ç«¯å£2\u0026gt; ...]  ã€€æ³¨æ„EXPOSEå’Œè¿è¡Œæ—¶ä½¿ç”¨çš„-p \u0026lt;å®¿ä¸»ç«¯å£\u0026gt;:\u0026lt;å®¹å™¨ç«¯å£\u0026gt;åŒºåˆ†ï¼Œ-pæ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œæ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æ˜ å°„ç»™ä¸»æœºï¼Œå¤–ç•Œå¯ä»¥è®¿é—®å®¿ä¸»ç«¯å£ä»è€Œè®¿é—®åˆ°å®¹å™¨ä¸Šçš„æœåŠ¡ï¼Œè€ŒEXPOSEä»…ä»…å£°æ˜å®¹å™¨è®¡åˆ’ä½¿ç”¨ä»€ä¹ˆç«¯å£ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚\nï¼ˆ7ï¼‰ENV\nã€€ENVç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè®©è¿™ä¸ªæŒ‡ä»¤åé¢çš„å…¶ä»–æŒ‡ä»¤æˆ–è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ENVå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n1 2  ENV \u0026lt;key\u0026gt; \u0026lt;value\u0026gt;ENV \u0026lt;key1\u0026gt;=\u0026lt;value1\u0026gt; \u0026lt;key2\u0026gt;=\u0026lt;value2\u0026gt; ...  ã€€å®šä¹‰ç¯å¢ƒå˜é‡åï¼Œç”¨$\u0026lt;EVN_NAME\u0026gt;è¿›è¡Œä½¿ç”¨å³å¯ã€‚ä¾‹å¦‚å®˜æ–¹nodeé•œåƒçš„Dockerfileï¼š\n1 2 3 4 5 6 7 8 9  ENV NODE_VERSION 7.2.0RUN curl -SLO \u0026#34;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz\u0026#34; \\  \u0026amp;\u0026amp; curl -SLO \u0026#34;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\u0026#34; \\  \u0026amp;\u0026amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\  \u0026amp;\u0026amp; grep \u0026#34; node-v$NODE_VERSION-linux-x64.tar.xz\\$\u0026#34; SHASUMS256.txt | sha256sum -c - \\  \u0026amp;\u0026amp; tar -xJf \u0026#34;node-v$NODE_VERSION-linux-x64.tar.xz\u0026#34; -C /usr/local --strip-components=1 \\  \u0026amp;\u0026amp; rm \u0026#34;node-v$NODE_VERSION-linux-x64.tar.xz\u0026#34; SHASUMS256.txt.asc SHASUMS256.txt \\  \u0026amp;\u0026amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs  ã€€å®˜æ–¹nodeé•œåƒåœ¨Dockerfileä¸­å®šä¹‰äº†ç¯å¢ƒå˜é‡NODE_VERSIONï¼Œä½¿ç”¨$NODE_VERSIONè¿›è¡Œæ“ä½œï¼Œè¿™æ ·åœ¨å‡çº§é•œåƒæ„å»ºç‰ˆæœ¬æ—¶ï¼Œåªéœ€æ›´æ–°ENVæŒ‡ä»¤ä¸­çš„7.2.0å³å¯ï¼Œä½¿Dockerfileçš„æ„å»ºç»´æŠ¤å˜å¾—è½»æ¾äº†ã€‚\nã€€æ”¯æŒç¯å¢ƒå˜é‡çš„æŒ‡ä»¤æœ‰ADDã€COPYã€ENVã€EXPOSEã€FROMã€LABELã€USERã€WORKDIRã€VOLUMEã€STOPSIGNALã€ONBUILDã€RUNã€‚\nã€€æœ‰äº†ç¯å¢ƒå˜é‡æŒ‡ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä»½Dockerfileåˆ¶ä½œç¯å¢ƒå˜é‡ä¸åŒçš„é•œåƒã€‚\nï¼ˆ8ï¼‰ENTRYPOINT\nã€€ENTRYPOINTæŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºå’Œå‚æ•°ï¼Œå’ŒCMDæŒ‡ä»¤ç›¸åŒï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºå’Œå‚æ•°ï¼Œä½†éœ€è¦é€šè¿‡docker runçš„--entrypointå‚æ•°æŒ‡å®šã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n shellæ ¼å¼ï¼šå°±åƒç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ä¸€æ ·ï¼Œæ¯”å¦‚åœ¨3.3.1ç¤ºä¾‹ä¸­çš„RUNæŒ‡ä»¤ã€‚ execæ ¼å¼ï¼šæ›´åƒå‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ï¼ŒENTRYPOINT [\u0026quot;å¯æ‰§è¡Œæ–‡ä»¶\u0026quot;,\u0026quot;å‚æ•°1\u0026quot;,\u0026quot;å‚æ•°2\u0026quot;]ã€‚  ã€€å½“æŒ‡å®šENTRYPOINTåï¼ŒCMDæŒ‡ä»¤ä¸è¿è¡Œå®ƒçš„å‘½ä»¤ï¼Œè€Œæ˜¯å°†å®ƒçš„å‘½ä»¤å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ENTRYPOINTæŒ‡ä»¤ã€‚å³å®é™…æ‰§è¡Œæ—¶å˜ä¸ºï¼š\n1  ENTRYPOINT \u0026#34;CMD\u0026#34;  ã€€ENTRYPOINTæŒ‡ä»¤å¯ä»¥åœ¨é•œåƒæ„å»ºæ—¶è¡¥å……å‘½ä»¤å‚æ•°ï¼Œè¿˜å¯ä»¥å®Œæˆåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œã€‚\nã€€CMDæŒ‡ä»¤æ˜¯æ‰§è¡Œå®ƒåé¢çš„å‘½ä»¤ï¼Œè€ŒENTRYPOINTæŒ‡ä»¤æ˜¯æ¥æ”¶CMDçš„å‘½ä»¤ä¸ºå‚æ•°ï¼Œå®ƒå¯ä»¥åœ¨Dockerfileä¸­å®šä¹‰äº†å‘½ä»¤åæ¥æ”¶docker runæ—¶å¢åŠ çš„CMDæŒ‡ä»¤ã€‚\nã€€è¡¥å……è¾“å…¥å‘½ä»¤å‚æ•°ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œè¯¥ç¤ºä¾‹è·å–å½“å‰çš„å…¬ç½‘IPï¼š\nã€€ç”¨CMDå‘½ä»¤çš„ç»“æœå¦‚ä¸‹ï¼š\n1 2 3 4 5  FROMubuntuRUN apt-get update \\  \u0026amp;\u0026amp; apt-get install -y curl \\  \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/*CMD [ \u0026#34;curl\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;http://myip.ipip.net\u0026#34; ]  ã€€æ„å»ºé•œåƒï¼Œå¯åŠ¨å®¹å™¨ï¼š\n1 2 3 4  $ sudo docker build -t myip . $ sudo docker run myip å½“å‰ IPï¼š49.232.101.152 æ¥è‡ªäºï¼šä¸­å›½ åŒ—äº¬ åŒ—äº¬ ç”µä¿¡/è”é€š/ç§»åŠ¨   ã€€å¦‚æœåœ¨é•œåƒæ„å»ºç»“æŸåå¸Œæœ›æ˜¾ç¤ºHTTPå¤´éƒ¨ä¿¡æ¯ï¼Œéœ€è¦å¢åŠ -iå‚æ•°ï¼Œä½†æ­¤æ—¶å¦‚æœç›´æ¥æ·»åŠ -iå‚æ•°ï¼Œä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºCMDå‘½ä»¤æŒ‡å®šçš„æ˜¯é»˜è®¤å®¹å™¨å¯åŠ¨ç¨‹åºå’Œå‚æ•°ï¼Œåœ¨é•œåƒåç§°myipåé¢å°±æ˜¯CMDå‘½ä»¤ï¼Œæ­¤æ—¶CMDå‘½ä»¤æ˜¯-iï¼Œæ˜¾ç„¶ä¼šæŠ¥é”™ã€‚å¦‚æœæƒ³è¦åŠ å…¥-iå‚æ•°ï¼Œå°±å¿…é¡»é‡æ–°è¾“å…¥å‘½ä»¤ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # ç›´æ¥æ·»åŠ -iæŠ¥é”™ $ sudo docker run myip -i docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: \u0026#34;-i\u0026#34;: executable file not found in $PATH: unknown. ERRO[0000] error waiting for container: context canceled # é‡æ–°è¾“å…¥å‘½ä»¤ $ sudo docker run myip curl -s http://myip.ipip.net -i HTTP/1.1 200 OK Date: Mon, 13 Sep 2021 06:39:57 GMT Content-Type: text/plain; charset=utf-8 Content-Length: 83 Connection: keep-alive X-Via-JSL: 1d9bd9a,- Set-Cookie: __jsluid_h=02f5c112cbd961d203f35fa0189db8b1; max-age=31536000; path=/; HttpOnly X-Cache: bypass å½“å‰ IPï¼š49.232.101.152 æ¥è‡ªäºï¼šä¸­å›½ åŒ—äº¬ åŒ—äº¬ ç”µä¿¡/è”é€š/ç§»åŠ¨   ã€€å¦‚æœä½¿ç”¨ENTRYPOINTï¼Œå°±ä¸å¿…é‡æ–°è¾“å…¥å‘½ä»¤ï¼Œä½¿ç”¨ENTRYPOINTçš„Dockerfileå¦‚ä¸‹ï¼š\n1 2 3 4 5  FROMubuntuRUN apt-get update \\  \u0026amp;\u0026amp; apt-get install -y curl \\  \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/*ENTRYPOINT [ \u0026#34;curl\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;http://myip.ipip.net\u0026#34; ]  ã€€æ­¤æ—¶ç›´æ¥åœ¨å¯åŠ¨å®¹å™¨æ—¶æ·»åŠ -iï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  $ sudo docker build -t myip . $ sudo docker run myip å½“å‰ IPï¼š49.232.101.152 æ¥è‡ªäºï¼šä¸­å›½ åŒ—äº¬ åŒ—äº¬ ç”µä¿¡/è”é€š/ç§»åŠ¨ $ sudo docker run myip -i HTTP/1.1 200 OK Date: Mon, 13 Sep 2021 06:58:00 GMT Content-Type: text/plain; charset=utf-8 Content-Length: 83 Connection: keep-alive X-Shadow-Status: 200 X-Via-JSL: 1d9bd9a,c06d31e,- Set-Cookie: __jsluid_h=f7e3f4eeb9b96aa3d5d0e903d3fa5dbe; max-age=31536000; path=/; HttpOnly X-Cache: bypass å½“å‰ IPï¼š49.232.101.152 æ¥è‡ªäºï¼šä¸­å›½ åŒ—äº¬ åŒ—äº¬ ç”µä¿¡/è”é€š/ç§»åŠ¨   ã€€æ·»åŠ ENTRYPOINTåï¼Œ-iä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ENTRYPOINTï¼Œæˆä¸ºcurlå‘½ä»¤çš„å‚æ•°ã€‚\nã€€**åº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œã€‚**å¯åŠ¨å®¹å™¨å°±æ˜¯å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œä½†æœ‰æ—¶å¯åŠ¨ä¸»è¿›ç¨‹å‰éœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œã€‚æ¯”å¦‚æ•°æ®åº“æœåŠ¡åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰è¿›è¡Œé…ç½®ã€åˆå§‹åŒ–ï¼›å¯èƒ½åœ¨å¯åŠ¨æœåŠ¡å‰ä»¥rootèº«ä»½æ‰§è¡Œä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œç„¶ååˆ‡æ¢åˆ°æœåŠ¡ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡ã€‚è¿™äº›å‡†å¤‡å·¥ä½œä¸CMDæŒ‡ä»¤æ— å…³ï¼ŒCMDæŒ‡ä»¤æ˜¯å®¹å™¨å¯åŠ¨ååœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„ï¼Œè€Œå‡†å¤‡å·¥ä½œéœ€è¦åœ¨å¯åŠ¨å®¹å™¨å‰å®Œæˆã€‚\nã€€ä¸ºäº†å®Œæˆè¿™ç§å·¥ä½œï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œæ”¾åˆ°ENTRYPOINTä¸­æ‰§è¡Œï¼Œè¿™æ ·åšä¼šå…ˆå°†è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œä¼ å…¥çš„CMDæŒ‡ä»¤å‚æ•°ã€‚å¦‚å®˜æ–¹é•œåƒrediså°±æ˜¯è¿™ä¹ˆåšçš„ã€‚\n1 2 3 4 5 6 7 8  FROMalpine:3.4...RUN addgroup -S redis \u0026amp;\u0026amp; adduser -S -G redis redis...ENTRYPOINT [\u0026#34;docker-entrypoint.sh\u0026#34;]EXPOSE6379CMD [ \u0026#34;redis-server\u0026#34; ]  ã€€ä¸Šé¢çš„Dockerfileå¯¹redisæœåŠ¡åˆ›å»ºäº†redisç”¨æˆ·ï¼Œå¹¶åœ¨æœ€ååˆ¶å®šäº†ENTRYPOINTä¸ºdocker-entrypoint.shè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9  #!/bin/sh ... # allow the container to be started with `--user` if [ \u0026#34;$1\u0026#34; = \u0026#39;redis-server\u0026#39; -a \u0026#34;$(id -u)\u0026#34; = \u0026#39;0\u0026#39; ]; then find . \\! -user redis -exec chown redis \u0026#39;{}\u0026#39; + exec gosu redis \u0026#34;$0\u0026#34; \u0026#34;$@\u0026#34; fi exec \u0026#34;$@\u0026#34;   ã€€è„šæœ¬çš„å†…å®¹æ˜¯æ ¹æ®å¯åŠ¨å®¹å™¨æ—¶è¾“å…¥çš„CMDå‘½ä»¤æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯redis-serverï¼Œåˆ™åˆ‡æ¢åˆ°redisç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦åˆ™ä»ç„¶ä½¿ç”¨rootèº«ä»½ã€‚\n1 2 3  $ sudo docker run -it redis id uid=0(root) gid=0(root) groups=0(root)   ï¼ˆ9ï¼‰HEALTHCHECK\nã€€HEALTHCHECKæŒ‡ä»¤æ£€æŸ¥Dockerå®¹å™¨çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œè¿™æ˜¯Docker 1.12å¼•å…¥çš„æ–°æŒ‡ä»¤ï¼Œä¹‹å‰çš„ç‰ˆæœ¬åªèƒ½é€šè¿‡å®¹å™¨å†…ä¸»è¿›ç¨‹æ˜¯å¦é€€å‡ºæ¥åˆ¤æ–­å®¹å™¨æ˜¯å¦çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•åº”å¯¹åº”è¿›ç¨‹æœªé€€å‡ºï¼Œä½†å·²ç»æ— æ³•æ­£å¸¸æä¾›æœåŠ¡çš„çŠ¶æ€ï¼Œå¦‚æ­»é”ã€æ­»å¾ªç¯ã€‚å®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š\n HEALTHCHECK [é€‰é¡¹] CMD \u0026lt;å‘½ä»¤\u0026gt;ï¼šè®¾ç½®æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µçš„å‘½ä»¤ã€‚ HEALTHCHECK NONEï¼šå¯ä»¥å±è”½åŸºç¡€é•œåƒçš„å¥åº·æ£€æŸ¥æŒ‡ä»¤ã€‚  ã€€CMDåé¢çš„\u0026lt;å‘½ä»¤\u0026gt;æ ¼å¼å’ŒENTRYPOINTç›¸åŒï¼Œå‘½ä»¤çš„è¿”å›å€¼è¡¨ç¤ºæ­¤æ¬¡å¥åº·æ£€æŸ¥çš„ç»“æœï¼š\n 0ï¼šæˆåŠŸï¼› 1ï¼šå¤±è´¥ï¼› 2ï¼šä¿ç•™ï¼Œä¸è¦ä½¿ç”¨è¿™ä¸ªå€¼ã€‚  ã€€å½“ä¸€ä¸ªé•œåƒæŒ‡å®šäº†HEALTHCHECKæŒ‡ä»¤åï¼Œç”¨å…¶å¯ç”¨å®¹å™¨ï¼Œåˆå§‹çŠ¶æ€ä¸ºstartingï¼Œåœ¨HEALTHCHECKæŒ‡ä»¤æ£€æŸ¥æˆåŠŸåå˜ä¸ºhealthyï¼Œå¦‚æœè¿ç»­ä¸€å®šæ¬¡æ•°ï¼ˆé»˜è®¤ä¸º3æ¬¡ï¼‰å¤±è´¥ï¼Œåˆ™çŠ¶æ€å˜æ›´ä¸ºunhealthyã€‚\nã€€HEALTHCHECKæ”¯æŒä»¥ä¸‹é€‰é¡¹ï¼š\n --interval=\u0026lt;é—´éš”\u0026gt;ï¼šä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º30ç§’ã€‚ --timeout=\u0026lt;æ—¶é•¿\u0026gt;ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤è¿è¡Œè¶…æ—¶æ—¶é—´é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªé—´éš”ï¼Œæœ¬æ¬¡å¥åº·æ£€æŸ¥å°±è§†ä¸ºå¤±è´¥ï¼Œé»˜è®¤ä¸º30ç§’ã€‚ --retries=\u0026lt;æ¬¡æ•°\u0026gt;ï¼šå½“è¿ç»­å¤±è´¥ä¸€å®šæ¬¡æ•°æ—¶ï¼Œå®¹å™¨çŠ¶æ€å˜æ›´ä¸ºunhealthyï¼Œé»˜è®¤3æ¬¡ã€‚  ã€€HEALTHCHECKåœ¨Dockerfileä¸­åªå¯ä»¥å‡ºç°ä¸€æ¬¡ï¼Œå¦‚æœå‡ºç°å¤šæ¬¡ï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚\nã€€æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„WebæœåŠ¡ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ å¥åº·æ£€æŸ¥æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥ç”¨curlå‘½ä»¤åˆ¤æ–­ã€‚curlå‘½ä»¤æ˜¯ä¸€ä¸ªåˆ©ç”¨URLè§„åˆ™åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚ç¼–å†™çš„Dockerfileå¦‚ä¸‹ï¼š\n1 2 3 4  FROMnginxRUN apt-get update \u0026amp;\u0026amp; apt-get install -y curl \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/*HEALTHCHECK --interval=5s --timeout=3s \\ CMD curl -fs http://localhost/ || exit 1  ã€€è¿™ä¸ªDockerfileä»¥niginxä¸ºåŸºç¡€é•œåƒï¼Œä¸‹è½½å¹¶å®‰è£…curlï¼Œåˆ é™¤ç¼“å­˜æ–‡ä»¶å¹¶ä½¿ç”¨curl -fs http://localhost/ || exit 1å‘½ä»¤è¿›è¡Œæ£€æŸ¥ï¼Œæ¯éš”5ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œè¶…è¿‡3ç§’æ²¡æœ‰å“åº”å°±å¤±è´¥ã€‚-fä¸ºè¿æ¥å¤±è´¥æ—¶ä¸æ˜¾ç¤ºhttpé”™è¯¯ï¼Œ-sæ˜¯é™é»˜æ¨¡å¼ï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ã€‚\næ„å»ºé•œåƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  # -tè¡¨ç¤ºè®¾ç½®åç§°æ ‡ç­¾ä¸ºmyweb:v1 $ sudo docker build -t myweb:v1 Sending build context to Docker daemon 2.048kB Step 1/3 : FROM nginx ---\u0026gt; 822b7ec2aaf2 Step 2/3 : RUN apt-get update \u0026amp;\u0026amp; apt-get install -y curl \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* ---\u0026gt; Running in 62e9e7facf8b Get:1 http://security.debian.org/debian-security buster/updates InRelease [65.4 kB] Get:2 http://deb.debian.org/debian buster InRelease [122 kB] Get:3 http://security.debian.org/debian-security buster/updates/main amd64 Packages [303 kB] Get:4 http://deb.debian.org/debian buster-updates InRelease [51.9 kB] Get:5 http://deb.debian.org/debian buster/main amd64 Packages [7907 kB] Get:6 http://deb.debian.org/debian buster-updates/main amd64 Packages [15.2 kB] Fetched 8465 kB in 6min 43s (21.0 kB/s) Reading package lists... Reading package lists... Building dependency tree... Reading state information... curl is already the newest version (7.64.0-4+deb10u2). 0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded. Removing intermediate container 62e9e7facf8b ---\u0026gt; c77f3d0c0cac Step 3/3 : HEALTHCHECK --interval=5s --timeout=3s CMD curl -fs http://localhost/ || exit 1 ---\u0026gt; Running in 7c5f96d17bc1 Removing intermediate container 7c5f96d17bc1 ---\u0026gt; 45b487bf77da Successfully built 45b487bf77da Successfully tagged myweb:v1   ã€€å¯åŠ¨å®¹å™¨ï¼š\n1 2  $ sudo docker run -d --name mywebservice -p 8080:80 myweb:v1 ebe33796114e22e0b9f97d6afd682d87c7371e10910b6a3f343284a4b9f4ef8c   ã€€è¿è¡Œé•œåƒï¼Œç«‹åˆ»æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š\n1 2 3 4  $ sudo docker container ls CONTAINER ID ... STATUS ebe33796114e ... Up 2 seconds (health: starting)   ã€€è¿‡å‡ ç§’å†æ¬¡æŸ¥çœ‹å‘å®¹å™¨çŠ¶æ€ï¼š\n1 2 3 4  $ sudo docker container ls CONTAINER ID ... STATUS ebe33796114e ... About a minute (healthy)   ã€€æŸ¥çœ‹å¥åº·æ£€æŸ¥å‘½ä»¤çš„è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  $ docker inspect --format \u0026#39;{{json .State.Health}}\u0026#39; web | python -m json.tool { \u0026#34;FailingStreak\u0026#34;: 0, \u0026#34;Log\u0026#34;: [ { \u0026#34;End\u0026#34;: \u0026#34;2021-09-13T11:00:59.49479706+08:00\u0026#34;, \u0026#34;ExitCode\u0026#34;: 0, \u0026#34;Output\u0026#34;: \u0026#34;\u0026lt;!DOCTYPE html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;title\u0026gt;Welcome to nginx!\u0026lt;/title\u0026gt;\\n\u0026lt;style\u0026gt;\\n body {\\n width: 35em;\\n margin: 0 auto;\\n font-family: Tahoma, Verdana, Arial, sans-serif;\\n }\\n\u0026lt;/style\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;h1\u0026gt;Welcome to nginx!\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;If you see this page, the nginx web server is successfully installed and\\nworking. Further configuration is required.\u0026lt;/p\u0026gt;\\n\\n\u0026lt;p\u0026gt;For online documentation and support please refer to\\n\u0026lt;a href=\\\u0026#34;http://nginx.org/\\\u0026#34;\u0026gt;nginx.org\u0026lt;/a\u0026gt;.\u0026lt;br/\u0026gt;\\nCommercial support is available at\\n\u0026lt;a href=\\\u0026#34;http://nginx.com/\\\u0026#34;\u0026gt;nginx.com\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\\n\\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Thank you for using nginx.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;, \u0026#34;Start\u0026#34;: \u0026#34;2021-09-13T11:00:59.412497775+08:00\u0026#34; }, ...... { \u0026#34;End\u0026#34;: \u0026#34;2021-09-13T11:01:19.842117465+08:00\u0026#34;, \u0026#34;ExitCode\u0026#34;: 0, \u0026#34;Output\u0026#34;: \u0026#34;\u0026lt;!DOCTYPE html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;title\u0026gt;Welcome to nginx!\u0026lt;/title\u0026gt;\\n\u0026lt;style\u0026gt;\\n body {\\n width: 35em;\\n margin: 0 auto;\\n font-family: Tahoma, Verdana, Arial, sans-serif;\\n }\\n\u0026lt;/style\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;h1\u0026gt;Welcome to nginx!\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;If you see this page, the nginx web server is successfully installed and\\nworking. Further configuration is required.\u0026lt;/p\u0026gt;\\n\\n\u0026lt;p\u0026gt;For online documentation and support please refer to\\n\u0026lt;a href=\\\u0026#34;http://nginx.org/\\\u0026#34;\u0026gt;nginx.org\u0026lt;/a\u0026gt;.\u0026lt;br/\u0026gt;\\nCommercial support is available at\\n\u0026lt;a href=\\\u0026#34;http://nginx.com/\\\u0026#34;\u0026gt;nginx.com\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\\n\\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Thank you for using nginx.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;, \u0026#34;Start\u0026#34;: \u0026#34;2021-09-13T11:01:19.765572173+08:00\u0026#34; } ], \u0026#34;Status\u0026#34;: \u0026#34;healthy\u0026#34; }   3.3.3 é•œåƒæ„å»º ã€€ä½¿ç”¨docker buildå‘½ä»¤æ„å»ºé•œåƒã€‚\n1  $ sudo docker build [é€‰é¡¹] \u0026lt;ä¸Šä¸‹æ–‡è·¯å¾„/URL/-\u0026gt;   ä¸Šä¸‹æ–‡è·¯å¾„\nã€€Dockeråœ¨è¿è¡Œæ—¶åˆ†ä¸ºæœåŠ¡ç«¯ï¼ˆDockerå¼•æ“ï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆdockeræŒ‡ä»¤ï¼‰ã€‚å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡ç«¯æä¾›çš„è¿œç¨‹è°ƒç”¨æ¥å£ï¼ˆREST APIï¼‰å’ŒæœåŠ¡ç«¯äº¤äº’ï¼Œå®Œæˆå„ç§åŠŸèƒ½ã€‚è™½ç„¶è¡¨é¢ä¸Šå¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡ŒdockeræŒ‡ä»¤ï¼Œä½†å®é™…ä¸Šæ˜¯ä»¥è¿œç¨‹è°ƒç”¨çš„å½¢å¼åœ¨æœåŠ¡ç«¯å®Œæˆã€‚\nã€€æ„å»ºé•œåƒæ—¶ï¼Œè®¸å¤šæŒ‡ä»¤æ¶‰åŠåˆ°æœ¬åœ°æ–‡ä»¶ï¼Œå¦‚COPYã€ADDæŒ‡ä»¤ï¼Œä½†docker buildå‘½ä»¤å¹¶éåœ¨æœ¬åœ°æ„å»ºé•œåƒï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯æ„å»ºé•œåƒï¼ŒæœåŠ¡ç«¯å¹¶ä¸å­˜åœ¨å®¢æˆ·ç«¯çš„æœ¬åœ°æ–‡ä»¶ï¼Œè¿™å°±éœ€è¦ç”¨æˆ·åœ¨è¯¥æŒ‡ä»¤å¤„æŒ‡å®šæ„å»ºé•œåƒçš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚docker buildåœ¨è§£æåˆ°è¯¥æŒ‡ä»¤çš„ä¸Šä¸‹æ–‡è·¯å¾„åï¼Œä¼šå°†è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œä¸Šä¼ ç»™æœåŠ¡ç«¯ï¼Œè¿™æ ·æœåŠ¡ç«¯æ”¶åˆ°ä¸Šä¸‹æ–‡åŒ…åï¼Œå°±èƒ½è·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„æ–‡ä»¶ã€‚\nã€€ä¸Šä¸‹æ–‡è·¯å¾„çš„æºæ–‡ä»¶è·¯å¾„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå³./xxx/xxxx/xxï¼Œè€Œä¸èƒ½æ˜¯ç»å¯¹è·¯å¾„/var/xx/xx/å’Œ../xx/xxè¿™æ ·çš„è·¯å¾„ï¼Œå®ƒä»¬éƒ½è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒæœåŠ¡ç«¯ä¸èƒ½è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ï¼Œå¦‚æœå®åœ¨éœ€è¦è¿™äº›æ–‡ä»¶ï¼Œéœ€è¦å°†è¿™äº›æ–‡ä»¶å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚\nã€€åœ¨3.3.1çš„å®ä¾‹ä¸­çš„.å°±æ˜¯ä¸Šä¸‹æ–‡ç›®å½•ï¼Œdocker build å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…å‘ç»™Dockerå¼•æ“ï¼ˆæœåŠ¡ç«¯ï¼‰ï¼Œè¿™ä¸ªå‘é€è¿‡ç¨‹ä¹Ÿè¾“å‡ºåœ¨äº†å±å¹•ä¸Šï¼š\n1  Sending build context to Docker daemon 2.048kB   ã€€ä¸€èˆ¬ä¼šå°†Dockerfileç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹æˆ–è€…é¡¹ç›®æ ¹ç›®å½•æ–‡ä»¶ä¸‹ï¼Œå¦‚æœç›®å½•ä¸‹æœ‰äº›å†…å®¹ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™Dockerå¼•æ“ï¼Œå¯ä»¥ç”¨.gitignoreçš„è¯­æ³•ç¼–å†™ä¸€ä¸ª.dockerignoreï¼Œå»æ‰ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™Dockerå¼•æ“çš„æ–‡ä»¶ã€‚\nã€€è¿˜æ”¯æŒå…¶å®ƒå¤šç§æ„å»ºæ–¹å¼ï¼š\n1 2 3 4 5 6 7 8 9  # ä»urlæ„å»º $ docker build -t hello-world https://github.com/docker-library/hello-world.git#master:amd64/hello-world # ä»tarå‹ç¼©åŒ…æ„å»º $ docker build http://server/context.tar.gz # ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–Dockerfileè¿›è¡Œæ„å»º $ docker build - \u0026lt; Dockerfile $ cat Dockerfile | docker build - # ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¸Šä¸‹æ–‡å‹ç¼©åŒ…è¿›è¡Œæ„å»º $ docker build - \u0026lt; context.tar.gz   å¤šé˜¶æ®µæ„å»º\nã€€Docker 17.05å¼€å§‹æ”¯æŒDockerfileå¤šé˜¶æ®µæ„å»ºé•œåƒï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªDockerfileè§£å†³é•œåƒå±‚æ¬¡å¤šã€ä½“ç§¯å¤§ã€éƒ¨ç½²æ—¶é—´é•¿çš„é—®é¢˜ï¼Œå¹¶ä¸”æ— éœ€å¤šä¸ªDockerfileæ–‡ä»¶ã€‚ä¸‹é¢çš„ç¤ºä¾‹å…ˆå°†app.goæ–‡ä»¶çš„ä¾èµ–åº“ç¼–è¯‘æµ‹è¯•æ‰“åŒ…åï¼Œå°†å®ƒæ‹·è´åˆ°è¿è¡Œç¯å¢ƒä¸­è¿è¡Œï¼š\nã€€app.goæ–‡ä»¶ï¼Œç¨‹åºè¾“å‡ºHello World!ï¼š\n1 2 3 4 5 6 7  package main import \u0026#34;fmt\u0026#34; func main(){ fmt.Printf(\u0026#34;Hello World!\u0026#34;); }   ã€€Dockerfileæ–‡ä»¶ï¼Œasåé¢æ˜¯è¿™ä¸€é˜¶æ®µçš„åç§°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  FROMgolang:alpine as builderRUN apk --no-cache add gitWORKDIR/go/src/github.com/go/helloworld/RUN go get -d -v github.com/go-sql-driver/mysqlCOPY app.go .RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .FROMalpine:latest as prodRUN apk --no-cache add ca-certificatesWORKDIR/root/COPY --from=0 /go/src/github.com/go/helloworld/app .CMD [\u0026#34;./app\u0026#34;]  ã€€æ„å»ºé•œåƒï¼š\n1  $ sudo docker build -t go/helloworld .   ã€€å¦‚æœåªæƒ³æ„å»ºå¤šé˜¶æ®µçš„Dockerfileä¸­çš„ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥åœ¨docker buildå‘½ä»¤åå¢åŠ --target \u0026lt;é˜¶æ®µå\u0026gt;å‚æ•°ï¼Œä¾‹å¦‚ï¼š\n1  $ sudo docker build --target builder -t username/imagename:tag .   4 ç»ƒä¹  4.1 ä½¿ç”¨å®¹å™¨ ã€€ï¼ˆ1ï¼‰æ‹‰å–2ç§ngnixé•œåƒï¼Œå¯ä»¥çœ‹åˆ°åˆ†å±‚æ‹‰å–ã€‚\n1 2 3 4 5 6 7 8 9 10 11  $ sudo docker pull nginx:1.21.1 1.21.1: Pulling from library/nginx a330b6cecb98: Pull complete 5ef80e6f29b5: Pull complete f699b0db74e3: Pull complete 0f701a34c55e: Pull complete 3229dce7b89c: Pull complete ddb78cb2d047: Pull complete Digest: sha256:a05b0cdd4fc1be3b224ba9662ebdf98fe44c09c0c9215b45f84344c12867002e Status: Downloaded newer image for nginx:1.21.1 docker.io/library/nginx:1.21.1   1 2 3 4 5 6  $ sudo docker pull nginx Using default tag: latest latest: Pulling from library/nginx Digest: sha256:a05b0cdd4fc1be3b224ba9662ebdf98fe44c09c0c9215b45f84344c12867002e Status: Image is up to date for nginx:latest docker.io/library/nginx:latest   ã€€æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼Œå‘ç°TAGä¸ºlatestå’Œ1.21.1çš„nginxçš„IMAGE IDå®Œå…¨ç›¸åŒï¼Œè¯´æ˜å®ƒä»¬æ˜¯åŒä¸€ä¸ªé•œåƒã€‚\n1 2 3 4 5  $ sudo docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE nginx 1.21.1 822b7ec2aaf2 5 days ago 133MB nginx latest 822b7ec2aaf2 5 days ago 133MB hello-world latest d1165f221234 6 months ago 13.3kB   ã€€åˆ é™¤æ‰TAGä¸º1.21.1çš„é‡å¤é•œåƒã€‚\n1  $ sudo docker image rm nginx:1.21.1   ã€€ï¼ˆ2ï¼‰å¯åŠ¨ä¸€ä¸ªngnixå®¹å™¨ï¼Œå‘½åä¸ºwebserverï¼Œ-pï¼šè®¾ç½®ç«¯å£æ˜ å°„ï¼Œå°†æœ¬åœ°çš„8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨çš„80ç«¯å£ã€‚-dï¼šè®¾ç½®å®¹å™¨åœ¨åå°è¿è¡Œã€‚--nameè®¾ç½®å®¹å™¨åç§°ä¸ºwebserverã€‚\n1 2  $ sudo docker run --name webserver -d -p 8080:80 nginx cd9e3dd3e7bde80c21a0bcfd766c405a1cd34143b51c8f326ba2d8047ffde8fe   ã€€è®¿é—®http://åŸŸå:8080å¯ä»¥çœ‹åˆ°å›¾Xæ‰€ç¤ºçš„é¡µé¢ã€‚\nå›¾X å®¹å™¨è¯»å†™æµç¨‹:\r\r ã€€ï¼ˆ3ï¼‰æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ã€‚\n1 2 3  $ sudo docker ps CONTAINER ID IMAGE COMMAND ... cd9e3dd3e7bd nginx \u0026#34;/docker-entrypoint.â€¦\u0026#34; ...   ã€€ï¼ˆ4ï¼‰åœæ­¢å®¹å™¨è¿è¡Œã€‚\n1 2  $ sudo docker container stop webserver webserver   æ³¨ï¼šdocker pså’Œdocker container lsä¸èƒ½æŸ¥çœ‹åˆ°åœæ­¢è¿è¡Œçš„å®¹å™¨ã€‚\nã€€ï¼ˆ5ï¼‰æŸ¥çœ‹åœæ­¢è¿è¡Œçš„å®¹å™¨ï¼Œè¿™ä¸ªcontainerä¸èƒ½çœç•¥ã€‚\n1 2 3  $ sudo docker container ls -a CONTAINER ID IMAGE COMMAND ... cd9e3dd3e7bd nginx \u0026#34;/docker-entrypoint.â€¦\u0026#34; ...   ã€€ï¼ˆ6ï¼‰åˆ é™¤å®¹å™¨ã€‚\n1  $ sudo docker container rm webservers   4.2 æ„å»ºé•œåƒ æœ¬ç»ƒä¹ ç¼–å†™ä¸€ä¸ªæ”¯æŒLæœºå™¨å­¦ä¹ é¡¹ç›®çš„é•œåƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  # Use an official PyTorch runtime as a parent imageFROMpytorch/pytorch# Set the working directoryWORKDIR/docker_sample# Copy the current directory contents into the containerCOPY . /docker_sample# Install any needed packages specified in requirements.txtRUN pip install -r requirements.txt# Run when the container launchesCMD [\u0026#34;python\u0026#34;, \u0026#34;deploy_models.py\u0026#34;]  5 å¯èƒ½å‡ºç°çš„é”™è¯¯åŠè§£å†³åŠæ³• ã€€ï¼ˆ1ï¼‰Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?\n è§£å†³ï¼š\nhttps://stackoverflow.com/questions/44678725/cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker\n 1  systemctl start docker   1 2 3  gpasswd -a $USER docker # æˆ–è€…åœ¨å‘½ä»¤å‰åŠ sudo sudo   ","description":"Dockerçš„å­¦ä¹ ä¸ä½¿ç”¨ï¼Œå°†é…ç½®å¥½çš„ç¯å¢ƒæ‰“åŒ…æˆDockerã€‚","id":5,"section":"posts","tags":["è™šæ‹ŸåŒ–"],"title":"å·¥å…·ä½¿ç”¨ï¼šDocker","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8docker/"},{"content":"Scapyçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³• 1 æ¦‚è¿°  æ–‡æ¡£ï¼šhttps://scapy.readthedocs.io/en/latest/introduction.html\n ã€€Scapyæ˜¯èƒ½è®©ç”¨æˆ·å‘é€ã€ç›‘å¬ã€åˆ†æã€æ„é€ ç½‘ç»œæ•°æ®åŒ…çš„Pythonç¨‹åºã€‚Scapyæ˜¯äº¤äº’å¼æ•°æ®åŒ…æ“çºµç¨‹åºï¼Œèƒ½å¤Ÿè½»æ¾å¤„ç†å¤šç§å…¸å‹ä»»åŠ¡ï¼Œå¦‚æ‰«æã€è·Ÿè¸ªè·¯ç”±ã€æ¢æµ‹ã€å•å…ƒæµ‹è¯•ã€æ”»å‡»æˆ–ç½‘ç»œå‘ç°ï¼Œèƒ½å¤Ÿä»£æ›¿hpingã€arpspoofã€arpskã€arpingã€p0fä»¥åŠNmapã€tcpdumpã€tsharkçš„éƒ¨åˆ†åŠŸèƒ½ã€‚\n2 å®‰è£… ï¼ˆ1ï¼‰æ™®é€šå®‰è£…\n1  pip install scapy   ï¼ˆ2ï¼‰æœ€æ–°ç‰ˆæœ¬\nã€€é€šå¸¸ä½¿ç”¨æ™®é€šå®‰è£…çš„åŠŸèƒ½å·²ç»è¶³å¤Ÿä½¿ç”¨ï¼Œæœ€æ–°ç‰ˆæœ¬å…·ä½“å®‰è£…æ–¹æ³•å¯å‚è€ƒï¼šhttps://scapy.readthedocs.io/en/latest/installation.htmlã€‚\nï¼ˆ3ï¼‰åŸºæœ¬ä½¿ç”¨\nã€€Scapyäº¤äº’å¼ç¨‹åºå°±å’Œæ‰“å¼€Pythonå‘½ä»¤è¡Œå¯¼å…¥scapyæ¨¡å—çš„æ“ä½œæ˜¯ä¸€æ ·çš„ã€‚\nã€€æ‰“å¼€äº¤äº’å¼Scapyç¨‹åºï¼Œåˆ›å»ºä¸€ä¸ªåŒ…aï¼ŒæŸ¥çœ‹å­—æ®µå¹¶å‘é€å®ƒçš„æ“ä½œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  $ sudo scapy Welcome to Scapy (2.2.0-dev) \u0026gt;\u0026gt;\u0026gt; a = Ether()/IP()/UDP() \u0026gt;\u0026gt;\u0026gt; a.show() ###[ Ethernet ]### dst= ff:ff:ff:ff:ff:ff src= 00:00:00:00:00:00 type= 0x800 ###[ IP ]### version= 4 ihl= None tos= 0x0 len= None id= 1 flags= frag= 0 ttl= 64 proto= udp chksum= None src= 127.0.0.1 dst= 127.0.0.1 \\options\\ ###[ UDP ]### sport= domain dport= domain len= None chksum= None \u0026gt;\u0026gt;\u0026gt; sendp(a) . Sent 1 packets.   ã€€ç”¨Pythonæ–‡ä»¶ä¸­è°ƒç”¨Scapyæ¨¡å—è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼š\n1 2 3 4  # test.py from scapy.all import * a = Ether()/IP()/UDP() sendp(a)   ã€€è¾“å‡ºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  $ sudo python test.py ###[ Ethernet ]### dst = ff:ff:ff:ff:ff:ff src = 00:00:00:00:00:00 type = 0x800 ###[ IP ]### version = 4 ihl = None tos = 0x0 len = None id = 1 flags = frag = 0 ttl = 64 proto = udp chksum = None src = 127.0.0.1 dst = 127.0.0.1 \\options \\ ###[ UDP ]### sport = domain dport = domain len = None chksum = None . Sent 1 packets.   ï¼ˆ4ï¼‰å¸¸ç”¨å‘½ä»¤å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£Usageé¡µé¢ï¼ŒAPIæŸ¥è¯¢å‚è€ƒScapy API referenceé¡µé¢ã€‚\n3 åŸºæœ¬ä½¿ç”¨ 3.1 ç»„è£…ä¸€ä¸ªæ•°æ®åŒ… ã€€ç»„è£…åˆæ³•æ•°æ®åŒ…éœ€è¦æŒ‰ç…§æ®åŒ…çš„å±‚çº§ç”±ä½å±‚åˆ°é«˜å±‚ç»„è£…ï¼Œä¾‹å¦‚UDPæ•°æ®åŒ…ï¼Œåˆ™éœ€è¦ä»¥å¤ªå¸§-IPå¤´-UDPå¤´-æ•°æ®çš„æ ¼å¼ç»„è£…ï¼Œå¦‚æœåªè®¾ç½®ä¸€ä¸ªUDPæ•°æ®åŒ…å¤´éƒ¨ï¼Œåˆ™ä¼šç”±äºæ²¡æœ‰IPå¤´éƒ¨å¯¼è‡´UDPå¤´éƒ¨æ²¡æœ‰æ ¡éªŒå’Œã€‚\n1 2  # ä¸åŒå±‚ç”¨\u0026#34;/\u0026#34;ç›¸è¿æ¥ \u0026gt;\u0026gt;\u0026gt; a = Ether()/IP()/UDP()   ã€€å„å±‚åˆ†ç¦»åœ°æŸ¥çœ‹æ•°æ®åŒ…açš„å„ä¸ªå­—æ®µï¼Œå³æ¯ä¸ªå±‚çš„å¤´éƒ¨ç›¸äº’ä¹‹é—´æ²¡æœ‰å…³è”ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  \u0026gt;\u0026gt;\u0026gt; a.show() ###[ Ethernet ]### dst= ff:ff:ff:ff:ff:ff src= 00:00:00:00:00:00 type= 0x800 ###[ IP ]### version= 4 ihl= None tos= 0x0 len= None id= 1 flags= frag= 0 ttl= 64 proto= udp chksum= None src= 127.0.0.1 dst= 127.0.0.1 \\options\\ ###[ UDP ]### sport= domain dport= domain len= None chksum= None   ã€€å¦‚æœæƒ³è¦ä¿®æ”¹å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨\u0026lt;æ•°æ®åŒ…å®ä¾‹\u0026gt;[æ•°æ®åŒ…å¤´éƒ¨].\u0026lt;å±æ€§å\u0026gt;æ¥ä¿®æ”¹å„ä¸ªå­—æ®µï¼Œåœ¨å„å±æ€§ä¸é‡åæ—¶å¯ä»¥çœç•¥æ•°æ®åŒ…å±‚çº§ï¼Œä¾‹\n1 2 3  \u0026gt;\u0026gt;\u0026gt; a[Ether].dst = \u0026#34;11:22:33:44:55:66\u0026#34; \u0026gt;\u0026gt;\u0026gt; a[UDP].sport = 1222 \u0026gt;\u0026gt;\u0026gt; a[UDP].dport = 222   ã€€å¦‚æœä½¿ç”¨a.dstï¼Œåªèƒ½ä¿®æ”¹Ether()å±‚ï¼Œå¦‚æœä¿®æ”¹a.dst = '192.168.1.8'ï¼Œåˆ™ä¼šå°†Ether()ä¸­çš„dstä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´é”™è¯¯ã€‚\nã€€è§‚å¯Ÿç”¨show()æ–¹æ³•å¾—åˆ°çš„ç»“æœï¼Œå¯ä»¥å‘ç°chksumæ˜¯0ï¼Œè¿™æ˜¯å› ä¸ºshow()æ–¹æ³•æ˜¯å„å±‚ç‹¬ç«‹åœ°æŸ¥çœ‹å­—æ®µå€¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨show2()æ–¹æ³•æŸ¥çœ‹æ ¡éªŒå’Œç­‰å°†å„å±‚è”ç³»èµ·æ¥çš„å€¼ï¼Œå®ƒä»¥ä¸€ä¸ªæ•´ä½“çš„å½¢å¼çœ‹å¾…ç»„è£…çš„æ•°æ®åŒ…ï¼Œæ‰€ä»¥èƒ½å¤Ÿçœ‹åˆ°è®¡ç®—çš„æ ¡éªŒå’Œï¼Œä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  \u0026gt;\u0026gt;\u0026gt; a.show2() ###[ Ethernet ]### dst= 11:22:33:44:55:66 src= 00:00:00:00:00:00 type= 0x800 ###[ IP ]### version= 4L ihl= 5L tos= 0x0 len= 28 id= 1 flags= frag= 0L ttl= 64 proto= udp chksum= 0x7cce src= 127.0.0.1 dst= 127.0.0.1 \\options\\ ###[ UDP ]### sport= 1222 dport= 222 len= 8 chksum= 0xfc37   ã€€å¯ä»¥çœ‹åˆ°IPå¤´éƒ¨çš„chksumå’ŒUDPå¤´éƒ¨çš„chksuméƒ½æœ‰å€¼ã€‚è¿™ä¸ªUDPæ•°æ®åŒ…æ²¡æœ‰è½½è·ï¼Œæˆ‘ä»¬ä¸ºå®ƒä¿®æ”¹æºIPå’Œç›®çš„IPï¼Œå†åŠ ä¸Šæ•°æ®ä½œä¸ºè½½è·ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥aï¼Œæ¥æŸ¥çœ‹æ•°æ®åŒ…açš„ç»„æˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  \u0026gt;\u0026gt;\u0026gt; a[Ether].src=\u0026#34;11:11:11:00:55:11\u0026#34; # ç­‰åŒäºa.src=\u0026#34;11:11:11:00:55:11\u0026#34; \u0026gt;\u0026gt;\u0026gt; a[IP].dst = \u0026#34;192.168.1.8\u0026#34; # ä¸èƒ½ä½¿ç”¨a.dst = \u0026#34;...\u0026#34; \u0026gt;\u0026gt;\u0026gt; a[IP].src = \u0026#34;192.168.1.6\u0026#34; \u0026gt;\u0026gt;\u0026gt; a = a/\u0026#34;AAAA\u0026#34; \u0026gt;\u0026gt;\u0026gt; a.show2() a.show2() ###[ Ethernet ]### dst= 11:22:33:44:55:66 src= 11:11:11:00:55:11 type= 0x800 ###[ IP ]### version= 4L ihl= 5L tos= 0x0 len= 32 id= 1 flags= frag= 0L ttl= 64 proto= udp chksum= 0xf76d src= 192.168.1.6 dst= 192.168.1.8 \\options\\ ###[ UDP ]### sport= 1222 dport= 222 len= 12 chksum= 0xf450 ###[ Raw ]### load= \u0026#39;AAAA\u0026#39; \u0026gt;\u0026gt;\u0026gt; a \u0026lt;Ether dst=11:22:33:44:55:66 src=11:11:11:00:55:11 type=0x800 |\u0026lt;IP frag=0 proto=udp src=192.168.1.6 dst=192.168.1.8 |\u0026lt;UDP sport=1222 dport=222 |\u0026lt;Raw load=\u0026#39;AAAA\u0026#39; |\u0026gt;\u0026gt;\u0026gt;\u0026gt;   ã€€å¯ä»¥åœ¨ç»„è£…æ•°æ®åŒ…çš„æ—¶å€™ç›´æ¥æŒ‡å®šå„å­—æ®µçš„å€¼ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­bæ˜¯å’Œaå®Œå…¨ç›¸åŒçš„æ•°æ®åŒ…ï¼š\n1 2 3  b = Ether(dst=\u0026#34;11:22:33:44:55:66\u0026#34;,src=\u0026#34;11:11:11:00:55:11\u0026#34;)/IP(src=\u0026#34;192.168.1.6\u0026#34;,dst=\u0026#34;192.168.1.8\u0026#34;)/UDP(sport=1222,dport=222)/\u0026#34;AAAA\u0026#34; \u0026gt;\u0026gt;\u0026gt; b \u0026lt;Ether dst=11:22:33:44:55:66 src=11:11:11:00:55:11 type=0x800 |\u0026lt;IP frag=0 proto=udp src=192.168.1.6 dst=192.168.1.8 |\u0026lt;UDP sport=1222 dport=222 |\u0026lt;Raw load=\u0026#39;AAAA\u0026#39; |\u0026gt;\u0026gt;\u0026gt;\u0026gt;   ã€€æ³¨ï¼šScapyæ”¯æŒå¤šç§åè®®ï¼Œå…·ä½“æ”¯æŒçš„å†…å®¹ï¼ˆæ¯ç§åè®®/æŠ¥æ–‡çš„ç±»åç§°ï¼‰å¯ä»¥å°†åè®®/åè®®å­—æ®µä½œä¸ºå…³é”®è¯ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£çš„APIï¼ˆScapy API Referenceï¼‰ä¸­è¿›è¡Œæœç´¢ï¼Œä¾‹ï¼šç»„è£…ä¸€ä¸ªTCPæ•°æ®åŒ…ï¼ša=Ether()/IP()/TCP()ã€‚ï¼ˆNSè¯·æ±‚æŠ¥æ–‡ï¼šICMPv6ND_NSã€NAåº”ç­”æŠ¥æ–‡ï¼šICMPv6ND_NAï¼‰ã€‚\nã€€ls(\u0026lt;æ•°æ®åŒ…å®ä¾‹\u0026gt;)å¯ä»¥æŸ¥çœ‹è¯¥æ•°æ®åŒ…å¯¹åº”å­—æ®µçš„ç±»å‹ã€å½“å‰å€¼ã€é»˜è®¤å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  \u0026gt;\u0026gt;\u0026gt; ls(a) dst : DestMACField = \u0026#39;11:22:33:44:55:66\u0026#39; (None) src : SourceMACField = \u0026#39;11:11:11:00:55:11\u0026#39; (None) type : XShortEnumField = 2048 (0) -- version : BitField = 4 (4) ihl : BitField = None (None) tos : XByteField = 0 (0) len : ShortField = None (None) id : ShortField = 1 (1) flags : FlagsField = 0 (0) frag : BitField = 0 (0) ttl : ByteField = 64 (64) proto : ByteEnumField = 17 (0) chksum : XShortField = None (None) src : Emph = \u0026#39;192.168.1.6\u0026#39; (None) dst : Emph = \u0026#39;192.168.1.8\u0026#39; (\u0026#39;127.0.0.1\u0026#39;) options : PacketListField = [] ([]) -- sport : ShortEnumField = 1222 (53) dport : ShortEnumField = 222 (53) len : ShortField = None (None) chksum : XShortField = None (None) -- load : StrField = \u0026#39;AAAA\u0026#39; (\u0026#39;\u0026#39;)   3.2 å‘é€æ•°æ®åŒ… ã€€å‘é€æ•°æ®åŒ…æœ‰ä¸¤ç§åŸºæœ¬æ–¹æ³•ï¼šsend()å’Œsendp()ï¼Œä½¿ç”¨send()æ—¶ä»IPå±‚å¼€å§‹æ„é€ ï¼Œä½¿ç”¨sendp()æ—¶ä»Etherå±‚å¼€å§‹æ„é€ ã€‚\n send(x, iface=None, **kargs)ï¼šxï¼špacket(s)ï¼Œifaceï¼šå‘é€æ•°æ®åŒ…çš„ç½‘ç»œæ¥å£ï¼ˆç½‘å¡åï¼‰ï¼Œåœ¨3å±‚å‘åŒ…ï¼Œç¨‹åºè‡ªåŠ¨å¤„ç†é“¾è·¯å±‚ä¸Šé¢çš„ mac åœ°å€ï¼Œifaceè¡¨ç¤ºèƒ½å¤Ÿè¿æ¥åˆ°å¤–éƒ¨ç½‘ç»œè®¾å¤‡çš„ä¸‰å±‚ç½‘ç»œæ¥å£ï¼Œå¦‚ens33ã€‚  ã€€192.168.100.5å‘192.168.100.7å‘é€ä¸‹é¢çš„IPåŒ…ï¼Œå¯ä»¥åœ¨192.168.100.5çš„ ens33æ¥å£ç›‘å¬åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå¯ä»¥åœ¨192.168.100.7çš„ens160æ¥å£ä¸Šç›‘å¬åˆ°è¿™ä¸ªæ•°æ®åŒ…ã€‚\na = IP(dst='192.168.100.5')\rsend(a, iface=\u0026quot;ens33\u0026quot;)\rã€€æ³¨ï¼šç½‘ç»œæ¥å£åç§°å¯ä»¥é€šè¿‡ifconfigå‘½ä»¤åœ¨Linuxç³»ç»Ÿä¸ŠæŸ¥çœ‹ã€‚\nã€€æ„é€ ä¸€ä¸ªUDPæ•°æ®åŒ…ï¼Œæ¯”è¾ƒåŠ ä¸Šä»¥å¤ªå¤´å’Œä¸åŠ ä»¥å¤ªå¤´ç»“æœçš„åŒºåˆ«ã€‚\na = IP(dst='192.168.100.5')/UDP(sport=666,dport=222)/\u0026quot;test\u0026quot;\rsend(a, iface=\u0026quot;ens33\u0026quot;)\rb = Ether()/IP(dst='192.168.100.5')/UDP(sport=666,dport=222)/\u0026quot;test\u0026quot;\rsend(b, iface=\u0026quot;ens33\u0026quot;)\rã€€ç»“æœæ˜¯æ•°æ®åŒ…aå¯ä»¥æˆåŠŸåœ¨192.168.100.5æ¥æ”¶ï¼Œæ•°æ®åŒ…bä¸å¯ä»¥ã€‚\nã€€æ•°æ®åŒ…bå¯èƒ½ç”±äºé”™è¯¯çš„MACåœ°å€æ— æ³•æˆåŠŸå‘é€ï¼Œæ ¹æ®ifconfigå‘½ä»¤ä¿®æ”¹æ•°æ®åŒ…bä¸­ç½‘å¡æ¥å£çš„MACåœ°å€ï¼Œå†è¿›è¡Œå‘é€ï¼Œä¹Ÿæ— æ³•é€è¾¾ã€‚\nã€€æ‰€ä»¥åº”æ³¨æ„ä½¿ç”¨send()æ—¶ï¼Œä¸è¦åŠ Ether()å¤´ã€‚\n  sendp(x, iface=None, iface_hint=None, socket=None, **kargs)ï¼šxï¼špacket(s)ï¼Œifaceï¼šå‘é€æ•°æ®åŒ…çš„æ¥å£ï¼Œä¸º2å±‚ç½‘ç»œæ¥å£ï¼Œå¦‚äº¤æ¢æœºè™šæ‹Ÿå‡ºæ¥çš„2å±‚æ¥å£veth2ï¼Œåœ¨2å±‚å‘åŒ…ã€‚\næ„é€ ä¸€ä¸ªUDPæ•°æ®åŒ…ï¼Œå’Œsend()æµ‹è¯•ç»“æœç›¸ååœ°ï¼Œç”¨sendp()å‘é€æ•°æ®åŒ…æ—¶å¿…é¡»åŠ ä¸ŠEther()ï¼Œå¦åˆ™æ•°æ®åŒ…æ— æ³•å‘é€åˆ°ç›®çš„åœ°ã€‚192.168.100.5èƒ½å¤Ÿæ”¶åˆ°æ•°æ®åŒ…bï¼Œè€Œæ— æ³•æ”¶åˆ°æ•°æ®åŒ…aã€‚\n  3.3 ä»æ–‡ä»¶è¯»åŒ…å¹¶å‘é€ ã€€ä»pcapæ–‡ä»¶ä¸­è¯»å–æ•°æ®åŒ…åˆ°å˜é‡ä¸­ï¼Œä¾æ¬¡å‘é€ã€‚\n1 2 3  a = rdpcap(\u0026#34;icmpv6_small.pcap\u0026#34;) iface = \u0026#34;veth0\u0026#34; sendp(a, iface)   3.4 è‡ªå®šä¹‰åè®®çš„æ•°æ®åŒ… ã€€åˆ›å»ºPacketçš„å­ç±»ï¼Œç„¶åè®¾ç½®å®ƒçš„å±‚å…³ç³»ï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªè®¡ç®—åè®®ï¼Œå½“ä»¥å¤ªç±»å‹ä¸º0x1234æ—¶ï¼Œä¸Šå±‚åè®®æ˜¯p4calcã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  from scapy.all import * class P4calc(Packet): name=\u0026#34;P4 Calculator\u0026#34; fields_desc=[ StrFixedLenField(\u0026#39;P\u0026#39;,\u0026#39;P\u0026#39;,1), StrFixedLenField(\u0026#39;Four\u0026#39;, \u0026#39;4\u0026#39;, 1), ByteField(\u0026#39;Version\u0026#39;, 1), StrFixedLenField(\u0026#39;Op\u0026#39;, \u0026#39;\\x00\u0026#39;, 1), ByteField(\u0026#39;Opcode\u0026#39;, \u0026#39;\\x00\u0026#39;, 2), IntField(\u0026#39;OperA\u0026#39;, 0), IntField(\u0026#39;OperB\u0026#39;, 0), IntField(\u0026#39;Result\u0026#39;, 0)] bind_layers(Ether, p4calc, type=0x1234) p = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:ee\u0026#34;)/ P4calc(Opcode=\u0026#34;\\x01\u0026#34;, Op=\u0026#34;+\u0026#34;, OperA=10, OperB=20)   3.5 ä»¥æŒ‡å®šé€Ÿåº¦å‘åŒ…  æ–‡æ¡£ï¼šhttps://scapy.readthedocs.io/en/latest/api/scapy.sendrecv.html\n ï¼ˆ1ï¼‰ä½é€Ÿå‘åŒ…\nã€€åœ¨3.2ä¸­æˆ‘ä»¬ä»…è®¾ç½®äº†sendå’Œsendpæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ï¼Œå³å‘é€çš„æ•°æ®åŒ…åˆ—è¡¨ï¼ˆlistï¼‰xå’Œå‘é€çš„ç½‘ç»œæ¥å£ifaceï¼Œä½†å®é™…ä¸Šsendå’Œsendpæ–¹æ³•è¿˜æœ‰ä¸‹é¢å‡ ä¸ªå¸¸ç”¨å‚æ•°ï¼š\n x â€“ å¾…å‘é€çš„æ•°æ®åŒ…/æ•°æ®åŒ…åˆ—è¡¨ã€‚ inter â€“ å‘é€ä¸¤ä¸ªæ•°æ®åŒ…çš„é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤å€¼ä¸º0ã€‚ loop â€“ é»˜è®¤å€¼ä¸º0ï¼Œä¸ä¸º0åˆ™å¾ªç¯å‘é€xï¼ŒæŒ‰Ctrl+cåœæ­¢ã€‚ count â€“ è®¡åˆ’å‘é€xçš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸ºå‘é€1æ¬¡ã€‚ iface â€“ å‘é€æ•°æ®åŒ…çš„ç½‘ç»œæ¥å£ã€‚  ã€€åœ¨é¢„æœŸæ•°æ®åŒ…é€Ÿåº¦è¾ƒä½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨interå‚æ•°ï¼Œè®¾ç½®ä¸¤ä¸ªä¸¤ä¸ªæ•°æ®åŒ…çš„å‘é€é—´éš”ã€‚\nã€€ä¸‹é¢çš„ç¨‹åºæ„é€ äº†ä¸€ä¸ªåŒ…å«2ä¸ªICMPv6 Echo Requestæ•°æ®åŒ…çš„æ•°æ®åŒ…åˆ—è¡¨ï¼Œä»ens33ç½‘å£å¾ªç¯å‘é€è¿™ä¸ªæ•°æ®åŒ…åˆ—è¡¨ï¼Œæ€»å…±å‘é€5æ¬¡ï¼Œå‘é€é—´éš”ä¸º0.1sã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  from scapy.all import * print(\u0026#34;Sending ICMPv6 Echo Request packets...\u0026#34;) p1 = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:e1\u0026#34;)/ IPv6(nh=58,src=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C004\u0026#34;,dst=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C001\u0026#34;)/ ICMPv6EchoRequest()) p2 = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:f1\u0026#34;)/ IPv6(nh=58,src=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C003\u0026#34;,dst=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C001\u0026#34;)/ ICMPv6EchoRequest()) p = [p1,p2] sendp(p, iface=\u0026#34;ens33\u0026#34;, loop=1, inter=0.001, count=5)   ã€€æˆ‘ä»¬è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¹¶å¼€å¯wiresharkç›‘å¬ens33æ”¶åˆ°çš„icmpv6æ•°æ®åŒ…ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹å›¾ï¼š\nå›¾1 ç”¨sendå‘é€æ•°æ®åŒ…ï¼Œå‘é€é—´éš”ä¸º0.1s:\r\r ã€€å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ”¶åˆ°äº†10ä¸ªæ•°æ®åŒ…ï¼Œå…¶æ•°æ®åŒ…çš„å‘é€é—´éš”çº¦ä¸º0.1sã€‚æˆ‘ä»¬å°†interå‚æ•°ä¿®æ”¹ä¸º0.001ï¼Œcountå‚æ•°ä¿®æ”¹ä¸º250ï¼Œå†ç”¨wiresharkç›‘å¬ens33ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹å›¾ï¼š\nå›¾2 ç”¨sendå‘é€æ•°æ®åŒ…ï¼Œå‘é€é—´éš”ä¸º0.001s:\r\r ã€€ç†è®ºä¸Šåº”è¯¥ç”¨0.5så‘å®Œï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬ç”¨äº†2.42sï¼Œç”¨sendpä¸­çš„interæ§åˆ¶å‘åŒ…é€Ÿåº¦å’Œæˆ‘ä»¬çš„é¢„æœŸå¹¶ä¸ç›¸ç¬¦ã€‚å¦‚æœç›´æ¥æ„é€ ä¸€ä¸ªåŒ…å«1000ä¸ªæ•°æ®åŒ…çš„åˆ—è¡¨ç”¨sendpå‘é€ï¼Œä¹Ÿä¸èƒ½ç”¨0.5så‘å®Œã€‚\nï¼ˆ2ï¼‰é«˜é€Ÿå‘åŒ…\nã€€é«˜é€Ÿå‘åŒ…ç”¨sendpfastï¼Œéœ€è¦å®‰è£…tcpreplayï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ã€‚\nã€€ubuntuå®‰è£…tcpreplayï¼š\n1  apt-get install tcpreplay   ã€€sendpfastçš„å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š\n x â€“ å¾…å‘é€çš„æ•°æ®åŒ…/æ•°æ®åŒ…åˆ—è¡¨ã€‚ pps â€“ æ¯ç§’å‘é€çš„æ•°æ®åŒ…æ•°ã€‚ mpbs â€“ æ¯ç§’å‘é€çš„MBitsã€‚ loop â€“ å‘é€æ•°æ®åŒ…åˆ—è¡¨çš„è¿›ç¨‹æ•°ï¼Œå®ƒçš„å€¼ç›¸å½“äºsendä¸­çš„countï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºå®ƒå‘é€ä¸€æ¬¡ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªå‘åŒ…è¿›ç¨‹ï¼Œè¿›ç¨‹çš„å¯åŠ¨é€Ÿåº¦å¾ˆæ…¢ï¼Œé«˜é€Ÿå‘åŒ…æ—¶åº”å°†loopè®¾ç½®ä¸º1ã€‚å¦å¤–å®ƒçš„é»˜è®¤å€¼ä¸º0ï¼Œå¦‚æœä¸è®¾ç½®æ­¤å‚æ•°ä¼šå‘é€0æ¬¡xã€‚ iface â€“ å‘é€æ•°æ®åŒ…çš„ç½‘ç»œæ¥å£ã€‚  ä¸‹é¢çš„ç¨‹åºå…ˆæ„é€ äº†ä¸€ä¸ªåŒ…å«1000ä¸ªæ•°æ®åŒ…çš„åˆ—è¡¨ï¼Œç„¶åå°†æ¯ç§’å‘é€çš„æ•°æ®åŒ…è®¾ç½®ä¸º1000ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  from scapy.all import * print(\u0026#34;Sending ICMPv6 Echo Request packets...\u0026#34;) p1 = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:e1\u0026#34;)/ IPv6(nh=58,src=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C004\u0026#34;,dst=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C001\u0026#34;)/ ICMPv6EchoRequest()) p2 = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:f1\u0026#34;)/ IPv6(nh=58,src=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C003\u0026#34;,dst=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C001\u0026#34;)/ ICMPv6EchoRequest()) p = [] for i in range(1000): p.append(p1) sendpfast(p, pps=1000, iface=\u0026#39;ens33\u0026#39;, loop = 1)   ã€€æˆ‘ä»¬è¿è¡Œè¿™ä¸ªç¨‹åºå¹¶ç”¨wiresharkç›‘å¬ens33ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹å›¾ã€‚\nå›¾1 ç”¨sendpfastå‘é€æ•°æ®åŒ…ï¼Œæ¯ç§’å‘é€1000ä¸ª:\r\r ã€€ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€1000ä¸ªæ•°æ®åŒ…å¤§çº¦ç”¨äº†1sï¼Œå’Œæˆ‘ä»¬çš„é¢„æœŸç›¸ç¬¦ã€‚\n3.6 ç›‘å¬æ•°æ®åŒ…  æ–‡æ¡£ï¼šhttps://scapy.readthedocs.io/en/latest/api/scapy.sendrecv.html\n ã€€åœ¨Scapyä¸­ï¼Œå¯ä»¥ä½¿ç”¨sniffå‡½æ•°è°ƒç”¨æŠ“åŒ…åˆ†æï¼Œå¹¶å¯¹æŠ“åˆ°çš„åŒ…è¿›è¡Œå›è°ƒæ“ä½œã€‚sniffçš„è¯¦ç»†å‚æ•°å¯ä»¥æŸ¥è¯¢æ–‡æ¡£ï¼Œè¿™é‡Œä»…ä»‹ç»å‡ ä¸ªåŸºæœ¬å‚æ•°ï¼š\n count â€“ æ•è·çš„æ•°æ®åŒ…æ•°é‡ï¼Œ0è¡¨ç¤ºä¸€ç›´æ•è·ã€‚ prn â€“ å¯¹æ¯ä¸ªæ•è·çš„æ•°æ®åŒ…è¿›è¡Œçš„æ“ä½œå‡½æ•°ï¼Œå‡½æ•°çš„è¾“å…¥æ˜¯æ•è·çš„æ•°æ®åŒ…ã€‚ filter â€“ è¿‡æ»¤è§„åˆ™ï¼Œè¯­æ³•åŒwiresharkã€‚ iface â€“ æŒ‡å®šæŠ“åŒ…çš„ç½‘å¡/ç½‘å¡åˆ—è¡¨ï¼Œä¸æŒ‡å®šåˆ™ç›‘å¬æ‰€æœ‰ç½‘å¡ã€‚  ã€€ä¸‹é¢çš„ç¨‹åºç›‘å¬8ä¸ªæ”¶åˆ°çš„ipv6æ•°æ®åŒ…ï¼Œå¹¶è¾“å‡ºå®ƒä»¬çš„ç›®çš„IPv6åœ°å€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  # sniff.py from scapy.all import * def pack_callback(packet): ipv6_addr = packet[\u0026#39;IPv6\u0026#39;].dst print(ipv6_addr) def start_sniff(): print(\u0026#34;Start Listen ...\u0026#34;) filterstr=\u0026#34;ip6\u0026#34; sniff(filter=filterstr,prn=pack_callback, iface=\u0026#39;ens33\u0026#39;, count=8) if __name__ == \u0026#39;__main__\u0026#39;: start_sniff()   ã€€æˆ‘ä»¬å…ˆè¿è¡Œsniff.pyç›‘å¬ç½‘å¡ï¼Œç„¶åç”¨ä¸‹é¢çš„ç¨‹åºå‘é€10ä¸ªIPv6æ•°æ®åŒ…ï¼ŒæŸ¥çœ‹è¿è¡Œç»“æœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  # sniff_test.py from scapy.all import * print(\u0026#34;Sending ICMPv6 Echo Request packets...\u0026#34;) p = [] for i in range(10): pkt = (Ether(dst=\u0026#34;00:11:22:33:44:55\u0026#34;, src=\u0026#34;00:aa:bb:cc:dd:e1\u0026#34;)/ IPv6(nh=58,src=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C004\u0026#34;,dst=\u0026#34;FD00:A880:0001:0020:0000:0000:0048:C00\u0026#34;+str(i))/ ICMPv6EchoRequest()) p.append(pkt) sendpfast(p, pps=1000, iface=\u0026#39;ens33\u0026#39;, loop = 1)   ã€€è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°sniff.pyç›‘å¬äº†8ä¸ªæ•°æ®åŒ…ã€‚\nStart Listen ...\rfd00:a880:1:20::48:c000\rfd00:a880:1:20::48:c001\rfd00:a880:1:20::48:c002\rfd00:a880:1:20::48:c003\rfd00:a880:1:20::48:c004\rfd00:a880:1:20::48:c005\rfd00:a880:1:20::48:c006\rfd00:a880:1:20::48:c007\rå‚è€ƒèµ„æ–™ 1.Scapyæ–‡æ¡£ï¼šhttps://scapy.readthedocs.io/en/latest/introduction.html\n2.Scapy Gitï¼šhttps://github.com/secdev/scapy\n3.åè®®å¤´scapy.layers.inet6ï¼šhttps://scapy.readthedocs.io/en/latest/api/scapy.layers.inet6.html?highlight=ICMPv6EchoRequest\n4.Python3ä¸‹åŸºäºScapyåº“å®Œæˆç½‘å¡æŠ“åŒ…è§£æï¼šhttps://cloud.tencent.com/developer/article/1694737\n","description":"Scapyç»„è£…æ•°æ®åŒ…ã€æ„é€ æ•°æ®åŒ…ã€å‘é€æ•°æ®åŒ…ã€ç›‘å¬æ•°æ®åŒ…çš„åŸºæœ¬æ–¹æ³•ã€‚","id":6,"section":"posts","tags":["basic"],"title":"å·¥å…·ä½¿ç”¨ï¼šScapy","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8scapy/"},{"content":"Google Colabï¼šhttps://colab.research.google.com/\n1.ç®€ä»‹ GoogleTestéµå¾ªAbseilç”Ÿæ€å“²å­¦ï¼ŒAbseilæ˜¯Googleå¼€æºçš„ä»Googleå†…éƒ¨ä»£ç å—ä¸­æŠ½å–å‡ºæ¥çš„ä¸€ç³»åˆ—æœ€åŸºç¡€çš„è½¯ä»¶åº“ã€‚GoogleTestç”¨äºC++ç¨‹åºæµ‹è¯•ï¼Œå®ƒåŸºäºxUnitæ¶æ„ï¼Œä¸JUnitå’ŒPyUnitç›¸ä¼¼ï¼Œä¸ä»…æ”¯æŒå•å…ƒæµ‹è¯•ï¼Œè¿˜æ”¯æŒå…¶å®ƒä»»æ„çš„æµ‹è¯•ã€‚\nGoogleTestä¸ä½¿ç”¨ISTQBæœ¯è¯­ä¸­çš„Test Caseï¼Œè€Œæ˜¯ä½¿ç”¨Test Suiteè¡¨è¾¾ç›¸åŒçš„å«ä¹‰ã€‚\n TEST() åœ¨ Google Testä¸­æ„ä¸ºï¼š\nExercise a particular program path with specific input values and verify the resultsã€‚ä½¿ç”¨ç‰¹å®šè¾“å…¥å€¼æ‰§è¡Œç‰¹å®šç¨‹åºè·¯å¾„å¹¶éªŒè¯ç»“æœã€‚\n GoogleTestä½¿ç”¨å¯å‚è€ƒç”¨æˆ·ä½¿ç”¨æ‰‹å†Œï¼Œå»ºè®®ä»Google Test Primerå¼€å§‹ã€‚\nï¼ˆ1ï¼‰Githubåœ°å€ï¼šhttps://github.com/google/googletest\nï¼ˆ2ï¼‰ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œï¼šhttps://google.github.io/googletest/\nï¼ˆ3ï¼‰Abseilåœ°å€ï¼šhttps://github.com/abseil/abseil-cpp\n2.å®‰è£…å’Œç®€å•ä½¿ç”¨ 2.1 å®‰è£… ï¼ˆ1ï¼‰è®¿é—®realeaseé¡µé¢ï¼šhttps://github.com/google/googletest/releasesï¼Œä¸‹è½½Source codeã€‚\nï¼ˆ2ï¼‰æ„å»ºå·¥å…·æ”¯æŒBazelå’ŒCMakeï¼Œç”±äºå¹³æ—¶çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œæˆ‘ä»¬é€‰ç”¨CMakeã€‚\n ä½¿ç”¨CmakeæŸ¥é˜…ï¼šhttps://google.github.io/googletest/quickstart-cmake.html ä½¿ç”¨BazelæŸ¥é˜…ï¼šhttps://google.github.io/googletest/quickstart-bazel.html  ï¼ˆ3ï¼‰å®‰è£…cmake.\n1  $ sudo snap install cmake   2.2 ç®€å•ä½¿ç”¨ ï¼ˆ1ï¼‰ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚\n1  $ mkdir my_project \u0026amp;\u0026amp; cd my_project   ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªCMakeLists.txtæ–‡ä»¶å¹¶å£°æ˜GoogleTestçš„ä¾èµ–ã€‚\n1  $ vim CMakeLists.txt   1 2 3 4 5 6 7 8 9 10 11 12 13 14  cmake_minimum_required(VERSION 3.14)project(my_project)# GoogleTest requires at least C++11 set(CMAKE_CXX_STANDARD 11)include(FetchContent)FetchContent_Declare( googletest URL https://github.com/google/googletest/archive/609281088cfefc76f9d0ce82e1ff6c30cc3591e5.zip )# For Windows: Prevent overriding the parent project\u0026#39;s compiler/linker settings set(gtest_force_shared_crt ON CACHE BOOL \u0026#34;\u0026#34; FORCE)FetchContent_MakeAvailable(googletest)  ä¸Šé¢çš„æ–‡ä»¶å£°æ˜äº†ä¸€ä¸ªä»Githubä¸‹è½½çš„GoogleTestä¾èµ–ï¼Œ609281088cfefc76f9d0ce82e1ff6c30cc3591e5æ˜¯ç”¨äºGoogleTestç‰ˆæœ¬çš„git commit hashå€¼ï¼Œæˆ‘ä»¬å»ºè®®æ›´æ–°è¿™ä¸ªhashä»¥è·å¾—æœ€æ–°çš„ç‰ˆæœ¬ã€‚\næ³¨ï¼šgit commit hashæ˜¯æ¯æ¬¡æäº¤ä¼šç”Ÿæˆçš„hashå€¼ï¼Œè·å–æ–¹æ³•è§é™„å½•4.1èŠ‚ã€‚\nï¼ˆ3ï¼‰åˆ›å»ºå¹¶è¿è¡Œ\nå°†GoogleTestå£°æ˜æˆä¸€ä¸ªä¾èµ–æ—¶ï¼Œå°±å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨GoogleTestä»£ç ã€‚\nåœ¨my_projectç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºhello_test.ccçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆå£°æ˜äº†ä¸€äº›åŸºç¡€æ–­è¨€ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9  #include \u0026lt;gtest/gtest.h\u0026gt; // Demonstrate some basic assertions. TEST(HelloTest, BasicAssertions) { // Expect two strings not to be equal.  EXPECT_STRNE(\u0026#34;hello\u0026#34;, \u0026#34;world\u0026#34;); // Expect equality.  EXPECT_EQ(7 * 6, 42); }   ä¸ºæ„å»ºä»£ç ï¼Œéœ€è¦åœ¨CMakeLists.txtæ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13  enable_testing()add_executable( hello_test hello_test.cc )target_link_libraries( hello_test gtest_main )include(GoogleTest)gtest_discover_tests(hello_test)  åœ¨Cmakeä¸­å¯ç”¨äº†æµ‹è¯•ï¼Œå¹¶ä¸”å£°æ˜äº†æƒ³è¦æ„å»ºçš„äºŒè¿›åˆ¶C++æµ‹è¯•ï¼ˆhello_testï¼‰ï¼Œå¹¶ä¸”å°†å®ƒé“¾æ¥åˆ°GoogleTestï¼ˆgtest_mainï¼‰ã€‚æœ€åä¸¤è¡Œä½¿ç”¨Google Test CMake moduleå¯ç”¨CMakeçš„æµ‹è¯•è¿è¡Œå™¨ï¼Œå¹¶å‘ç°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æµ‹è¯•ã€‚\nåœ¨my_projectç›®å½•ä¸‹æ„å»ºå¹¶è¿è¡Œæµ‹è¯•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  $ cmake -S . -B build -- The C compiler identification is GNU 9.3.0 -- The CXX compiler identification is GNU 9.3.0 -- Detecting C compiler ABI info -- Detecting C compiler ABI info - done -- Check for working C compiler: /usr/bin/cc - skipped -- Detecting C compile features -- Detecting C compile features - done -- Detecting CXX compiler ABI info -- Detecting CXX compiler ABI info - done -- Check for working CXX compiler: /usr/bin/c++ - skipped -- Detecting CXX compile features -- Detecting CXX compile features - done -- Found Python: /usr/local/bin/python3.9 (found version \u0026#34;3.9.5\u0026#34;) found components: Interpreter -- Looking for pthread.h -- Looking for pthread.h - found -- Performing Test CMAKE_HAVE_LIBC_PTHREAD -- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Failed -- Looking for pthread_create in pthreads -- Looking for pthread_create in pthreads - not found -- Looking for pthread_create in pthread -- Looking for pthread_create in pthread - found -- Found Threads: TRUE -- Configuring done -- Generating done -- Build files have been written to: /home/xianyubing/C/my_project/build   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  $ cmake --build build [ 10%] Building CXX object _deps/googletest-build/googletest/CMakeFiles/gtest.dir/src/gtest-all.cc.o [ 20%] Linking CXX static library ../../../lib/libgtest.a [ 20%] Built target gtest [ 30%] Building CXX object _deps/googletest-build/googletest/CMakeFiles/gtest_main.dir/src/gtest_main.cc.o [ 40%] Linking CXX static library ../../../lib/libgtest_main.a [ 40%] Built target gtest_main [ 50%] Building CXX object CMakeFiles/hello_test.dir/hello_test.cc.o [ 60%] Linking CXX executable hello_test [ 60%] Built target hello_test [ 70%] Building CXX object _deps/googletest-build/googlemock/CMakeFiles/gmock.dir/src/gmock-all.cc.o [ 80%] Linking CXX static library ../../../lib/libgmock.a [ 80%] Built target gmock [ 90%] Building CXX object _deps/googletest-build/googlemock/CMakeFiles/gmock_main.dir/src/gmock_main.cc.o [100%] Linking CXX static library ../../../lib/libgmock_main.a [100%] Built target gmock_main   1 2 3 4 5 6 7 8 9  $ cd build \u0026amp;\u0026amp; ctest Test project /home/xianyubing/C/my_project/build Start 1: HelloTest.BasicAssertions 1/1 Test #1: HelloTest.BasicAssertions ........ Passed 0.00 sec 100% tests passed, 0 tests failed out of 1 Total Test time (real) = 0.02 sec   è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨GoogleTestæˆåŠŸæ„å»ºäº†ä¸€ä¸ªäºŒè¿›åˆ¶æµ‹è¯•ã€‚\näº†è§£æ›´å¤šå¯ä»¥é˜…è¯»GoogleTest Guideçš„GoogleTest Primerå’ŒGoogleTest Samplesã€‚\n3.ä½¿ç”¨æ–¹æ³• 3.1 ç¨‹åºæ¶æ„ ä½¿ç”¨GoogleTeståº”ä»å†™assertionå¼€å§‹ï¼Œ\nassertionï¼šåˆ¤æ–­è¯­å¥æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œç»“æœä¸ºsuccessã€nonfatalã€failureæˆ–fatal failureï¼›å½“ç»“æœä¸ºfatal failureæ—¶ï¼Œå®ƒå°†å½“å‰çš„å‡½æ•°ç»ˆæ­¢ï¼Œå…¶å®ƒç»“æœç¨‹åºä¼šç»§ç»­æ­£å¸¸æ‰§è¡Œã€‚\ntest suiteï¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæµ‹è¯•ï¼Œæµ‹è¯•å¥—ä»¶åº”è¯¥ååº”æµ‹è¯•ä»£ç çš„ç»“æ„ã€‚\ntest fixtureï¼šåŒä¸€test suiteä¸­çš„å¤šä¸ªæµ‹è¯•éœ€è¦å…±äº«ç›¸åŒçš„å¯¹è±¡å’Œå­ä¾‹ç¨‹æ—¶ï¼Œå¯ä»¥å°†å®ƒä»¬æ”¾åˆ°test fixtureç±»ä¸­ã€‚\ntest programï¼šåŒ…å«å¤šä¸ªtest suiteã€‚\n3.2 æ–­è¨€ï¼ˆAssertionï¼‰ googletestæ˜¯å’Œå‡½æ•°è°ƒç”¨ç›¸ä¼¼çš„å®ï¼Œæˆ‘ä»¬é€šè¿‡ç¼–å†™ç«¯æ¥æµ‹è¯•ç±»æˆ–å‡½æ•°çš„è¡Œä¸ºã€‚å½“æ–­è¨€å¤±è´¥æ—¶ï¼Œgoogletestæ‰“å°å¸¦æœ‰æ•…éšœä¿¡æ¯çš„æ–­è¨€æºæ–‡ä»¶å’Œæ‰€åœ¨è¡Œçš„åºå·ï¼Œè¿˜å¯ä»¥æä¾›è‡ªå®šä¹‰å¤±è´¥æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å°†é™„åŠ åˆ° googletest çš„æ¶ˆæ¯ä¸­ã€‚\næ–­è¨€æˆå¯¹å‡ºç°ï¼Œç”¨æ¥æµ‹è¯•ç›¸åŒçš„äº‹ç‰©ä½†é€ æˆä¸åŒçš„å½±å“ã€‚\n ASSERT_ *ï¼šå½“æ­¤ç±»æ–­è¨€å¤±è´¥æ—¶ï¼Œç”Ÿæˆfatal failureså¹¶ç»ˆæ­¢å½“å‰å‡½æ•°ï¼Œé€‚ç”¨äºå‘ç”Ÿæ­¤æ•…éšœåç¨‹åºæ²¡å¿…è¦ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚ EXPECT_ *ï¼šé€šå¸¸æ›´å€¾å‘äºä½¿ç”¨æ­¤ç±»æ–­è¨€ï¼Œä»¥ä¾¿äºåœ¨ä¸€ä¸ªæµ‹è¯•ä¸­æŠ¥å‘Šæ›´å¤šæ•…éšœã€‚  ç”±äºASSERT_ *å¤±è´¥æ—¶ä¼šç«‹åˆ»ä»å½“å‰å‡½æ•°è¿”å›ï¼Œå¯èƒ½ä¼šè·³è¿‡å®ƒä¹‹åçš„clean-upä»£ç ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ï¼Œå®ƒä¸ä¸€å®šéœ€è¦ä¿®å¤ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´æˆ‘ä»¬è·å¾—é™¤æ–­è¨€é”™è¯¯ä¹‹å¤–çš„ä¸€ä¸ªå †æ£€æŸ¥é”™è¯¯ã€‚\nå¦‚æœæƒ³è¦è‡ªå®šä¹‰æ–­è¨€æ•…éšœæ¶ˆæ¯ï¼Œä»…éœ€è¦å°†å®ƒç”¨\u0026lt;\u0026lt;æ“ä½œç¬¦æˆ–ä¸€ç³»åˆ—è¿™ç§æ“ä½œç¬¦ä»¥æµçš„æ–¹å¼å†™å…¥å®ã€‚ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨äº†ASSERT_EQå’ŒEXPECT_EQå®æ¥éªŒè¯å€¼çš„ç›¸ç­‰ã€‚\n1 2 3 4 5  ASSERT_EQ(x.size(), y.size()) \u0026lt;\u0026lt; \u0026#34;Vectors x and y are of unequal length\u0026#34;; for (int i = 0; i \u0026lt; x.size(); ++i) { EXPECT_EQ(x[i], y[i]) \u0026lt;\u0026lt; \u0026#34;Vectors x and y differ at index \u0026#34; \u0026lt;\u0026lt; i; }   ä»»ä½•å¯ä»¥æµå…¥ostreamçš„å†…å®¹éƒ½å¯ä»¥æµå…¥æ–­è¨€å®ï¼ŒåŒ…æ‹¬C stringå’Œstringå¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªå®½å­—ç¬¦ï¼ˆå¦‚wchar_t *ï¼Œstd::wstringï¼‰ä¸²æµå…¥æ–­è¨€ï¼Œåˆ™åœ¨æ‰“å°æ—¶å°†å®ƒè½¬æ¢ä¸ºUTF-8ç±»å‹ã€‚\nGoogleTestæä¾›äº†ä¸€ç»„æ–­è¨€ä»¥ä¸åŒæ–¹å¼æ¥éªŒè¯ä»£ç è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å¸ƒå°”æ¡ä»¶ï¼ŒåŸºäºå…³ç³»æ“ä½œç¬¦æ¯”è¾ƒå€¼çš„å¤§å°ï¼ŒéªŒè¯å­—ç¬¦ä¸²å€¼ï¼Œæµ®ç‚¹å€¼ç­‰ç­‰ï¼›è¿˜å¯ä»¥è‡ªå®šä¹‰è°“è¯å®ç°æ›´å¤æ‚çš„çŠ¶æ€éªŒè¯ã€‚ç”±GoogleTestæä¾›çš„æ–­è¨€å¯ä»¥æŸ¥çœ‹ Assertions Referenceã€‚\n3.3 ç®€å•ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªæµ‹è¯•ï¼š\nï¼ˆ1ï¼‰ä½¿ç”¨TEST()å®å¯¹æµ‹è¯•å‡½æ•°å®šä¹‰å¹¶å‘½åï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰è¿”å›å€¼çš„C++å‡½æ•°ã€‚\nï¼ˆ2ï¼‰åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•åˆæ³•çš„C++è¯­å¥ï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„googletestæ–­è¨€å¯¹å€¼è¿›è¡Œæ£€æŸ¥ã€‚\nï¼ˆ3ï¼‰æµ‹è¯•ç»“æœç”±æ–­è¨€å†³å®šï¼Œå¦‚æœæµ‹è¯•ä¸­çš„ä»»ä½•ä¸€ä¸ªæ–­è¨€å¤±è´¥ï¼ˆè‡´å‘½æˆ–éè‡´å‘½ï¼‰ï¼Œæˆ–æµ‹è¯•å´©æºƒï¼Œ åˆ™æ•´ä¸ªæµ‹è¯•å¤±è´¥ï¼Œå¦åˆ™ï¼Œæµ‹è¯•æˆåŠŸã€‚\n1 2 3  TEST(TestSuiteName, TestName) { ... test body ... }   TEST()å‚æ•°ä»ä¸€èˆ¬åˆ°å…·ä½“ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•å¥—ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åœ¨è¿™ä¸ªæµ‹è¯•å¥—ä»¶å†…éƒ¨çš„æµ‹è¯•çš„åç§°ã€‚å®ƒä»¬éƒ½å¿…é¡»æ˜¯åˆæ³•çš„C++æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€‚æµ‹è¯•çš„å…¨ååŒ…æ‹¬å®ƒæ‰€åœ¨çš„æµ‹è¯•å¥—ä»¶åå’Œå®ƒè‡ªå·±çš„åç§°ã€‚ä¸åŒæµ‹è¯•å¥—ä»¶çš„æµ‹è¯•å¯ä»¥å…·æœ‰ç›¸åŒçš„åç§°ã€‚\nä¾‹å¦‚ä¸‹é¢çš„æ•´å‹å‡½æ•°ï¼Œè¿”å›nçš„é˜¶ä¹˜ï¼š\n1  int Factorial(int n); // Returns the factorial of n   è¿™ä¸ªå‡½æ•°çš„æµ‹è¯•å¥—ä»¶å¯èƒ½åƒä¸‹é¢è¿™æ ·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  // Tests factorial of 0. TEST(FactorialTest, HandlesZeroInput) { EXPECT_EQ(Factorial(0), 1); } // Tests factorial of positive numbers. TEST(FactorialTest, HandlesPositiveInput) { EXPECT_EQ(Factorial(1), 1); EXPECT_EQ(Factorial(2), 2); EXPECT_EQ(Factorial(3), 6); EXPECT_EQ(Factorial(8), 40320); }   googletestæ ¹æ®æµ‹è¯•å¥—ä»¶å°†æµ‹è¯•ç»“æœåˆ†ç»„ï¼Œæ‰€ä»¥é€»è¾‘ç›¸å…³çš„æµ‹è¯•åº”è¯¥åœ¨åŒä¸€æµ‹è¯•å¥—ä»¶ä¸­ï¼›æ¢å¥è¯è¯´ï¼Œå®ƒä»¬TEST()çš„ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥ç›¸åŒã€‚ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ä¸¤ä¸ªæµ‹è¯•ï¼ŒHandlesZeroInputå’ŒHandlesPositiveInputï¼Œå®ƒä»¬åŒå±äºæµ‹è¯•å¥—ä»¶FactorialTestã€‚\nå½“å‘½åæµ‹è¯•å¥—ä»¶å’Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬åº”å½“éµå¾ªç›¸åŒçš„å‡½æ•°å’Œç±»å‘½åçš„æƒ¯ä¾‹ï¼šhttps://google.github.io/styleguide/cppguide.html#Function_Namesã€‚\nåœ¨Linuxï¼ŒWindowsï¼ŒMacä¸Šå¯ç”¨ã€‚\n3.4 Test Fixtures å½“æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„æµ‹è¯•æ“ä½œåœ¨ç›¸åŒçš„æ•°æ®ä¸Šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨test fixtureï¼Œä»è€Œå¯¹å‡ ä¸ªä¸åŒçš„æµ‹è¯•ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡é…ç½®ã€‚\nåˆ›å»ºä¸€ä¸ªfixtureï¼š\nï¼ˆ1ï¼‰ä»::testing::Testæ´¾ç”Ÿä¸€ä¸ªç±»ï¼Œä»¥protected:ä½œä¸ºå®ƒä¸»ä½“çš„èµ·å§‹ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä»å­ç±»è®¿é—®fixtureæˆå‘˜ã€‚\nï¼ˆ2ï¼‰åœ¨ç±»çš„å†…éƒ¨ï¼Œå£°æ˜æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„å¯¹è±¡ã€‚\nï¼ˆ3ï¼‰å¦‚æœæœ‰å¿…è¦ï¼Œä¸ºæ¯ä¸ªæµ‹è¯•ç¼–å†™ä¸€ä¸ªé»˜è®¤çš„æ„é€ å™¨æˆ–SetUp()å‡½æ•°æ¥å‡†å¤‡å¯¹è±¡ã€‚æ³¨æ„ä¸è¦å°†SetUp()é”™å†™æˆSetup()ï¼Œå¯ä»¥åœ¨C++ 11ä¸­ä½¿ç”¨overrideæ¥ä¿è¯æ‹¼å†™æ­£ç¡®ã€‚\nï¼ˆ4ï¼‰å¦‚æœæœ‰å¿…è¦ï¼Œç¼–å†™ä¸€ä¸ªææ„å™¨æˆ–TearDown()å‡½æ•°æ¥é‡Šæ”¾åœ¨SetUp()ä¸­ç”³è¯·çš„èµ„æºï¼Œå¯ä»¥é˜…è¯»FAQæ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨æ„é€ å™¨/ææ„å™¨ä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨SetUp()/TearDown()ã€‚\nï¼ˆ5ï¼‰å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥ä¸ºæµ‹è¯•å®šä¹‰å‡ ä¸ªç”¨æ¥å…±äº«çš„å­ä¾‹ç¨‹ã€‚\nå½“ä½¿ç”¨fixtureæ—¶ï¼Œä½¿ç”¨TEST_F()è€Œä¸æ˜¯TEST()ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬è®¿é—®text fitureä¸­çš„å¯¹è±¡å’Œå­ä¾‹ç¨‹ã€‚\n1 2 3  TEST_F(TestFixtureName, TestName) { ... test body ... }   å’ŒTEST()ç›¸ä¼¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•å¥—ä»¶åç§°ï¼Œä½†å¯¹äºTEST_F()æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯test fixtureçš„ç±»åç§°ã€‚\nC++çš„å®ç³»ç»Ÿä¸å…è®¸åˆ›å»ºä¸€ä¸ªå•ç‹¬å®åŒæ—¶å¤„ç†è¿™ä¸¤ç§ç±»å‹çš„æµ‹è¯•ï¼Œä½¿ç”¨é”™è¯¯çš„å®ä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ã€‚\nåœ¨TEST_F()ä¸­ä½¿ç”¨test fixtureä¹‹å‰ï¼Œå¿…é¡»å®šä¹‰å¥½test fixtureç±»ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼švirtual outside class declarationã€‚\nå¯¹äºTEST_F()ä¸­å®šä¹‰çš„æ¯ä¸€ä¸ªæµ‹è¯•ï¼Œgoogletestä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„test fixtureï¼Œå¹¶ç«‹åˆ»ç”¨SetUp()å¯¹å®ƒåˆå§‹åŒ–ï¼Œè¿è¡Œè¯¥æµ‹è¯•ï¼Œå¹¶é€šè¿‡è°ƒç”¨TearDown()è¿›è¡Œæ¸…ç†ï¼Œç„¶ååˆ é™¤è¯¥test fixtureã€‚åœ¨åŒä¸€æµ‹è¯•å¥—ä»¶ä¸­çš„ä¸åŒæµ‹è¯•å…·æœ‰ä¸åŒçš„test fixtureå¯¹è±¡ï¼Œgoogleteståœ¨å®ƒåˆ›å»ºä¸‹ä¸€ä¸ªtest fixtureå¯¹è±¡ä¹‹å‰ä¼šåˆ é™¤ä¸€ä¸ªtest fixtureã€‚googletestä¸ä¼šå¯¹å¤šä¸ªæµ‹è¯•é‡ç”¨ç›¸åŒçš„test fixtureã€‚å•ä¸ªæµ‹è¯•å¯¹fixtureçš„ä»»ä½•æ”¹å˜éƒ½ä¸ä¼šå½±å“åˆ°å…¶å®ƒæµ‹è¯•ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªç±»Queueï¼ˆFIFOé˜Ÿåˆ—ï¼‰çš„æµ‹è¯•ï¼Œå…·æœ‰å¦‚ä¸‹æ¥å£ï¼š\n1 2 3 4 5 6 7 8 9  template \u0026lt;typename E\u0026gt; // E is the element type. class Queue { public: Queue(); void Enqueue(const E\u0026amp; element); E* Dequeue(); // Returns NULL if the queue is empty.  size_t size() const; ... };   é¦–å…ˆå®šä¹‰ä¸€ä¸ªfixture classã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬åº”å½“å°†å…¶å‘½åä¸ºFooTestï¼Œå…¶ä¸­Fooæ˜¯è¢«æµ‹è¯•çš„ç±»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  class QueueTest : public ::testing::Test { protected: void SetUp() override { q1_.Enqueue(1); q2_.Enqueue(2); q2_.Enqueue(3); } // void TearDown() override {}  Queue\u0026lt;int\u0026gt; q0_; Queue\u0026lt;int\u0026gt; q1_; Queue\u0026lt;int\u0026gt; q2_; };   åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸ªæµ‹è¯•åæ¸…ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦TearDown()ï¼Œé™¤äº†ææ„å‡½æ•°å·²ç»å®Œæˆçš„æ“ä½œã€‚\nç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨TEST_F()å’Œè¿™ä¸ªfixtureå†™æµ‹è¯•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  TEST_F(QueueTest, IsEmptyInitially) { EXPECT_EQ(q0_.size(), 0); } TEST_F(QueueTest, DequeueWorks) { int* n = q0_.Dequeue(); EXPECT_EQ(n, nullptr); n = q1_.Dequeue(); ASSERT_NE(n, nullptr); EXPECT_EQ(*n, 1); EXPECT_EQ(q1_.size(), 0); delete n; n = q2_.Dequeue(); ASSERT_NE(n, nullptr); EXPECT_EQ(*n, 2); EXPECT_EQ(q2_.size(), 1); delete n; }   ä¸Šé¢çš„æµ‹è¯•ä½¿ç”¨äº†ASSERT_ *æ–­è¨€å’ŒEXPECT_ *æ–­è¨€ã€‚ç»éªŒæ³•åˆ™æ˜¯å½“æˆ‘ä»¬å¸Œæœ›æµ‹è¯•åœ¨æ–­è¨€å¤±è´¥åç»§ç»­æ˜¾ç¤ºæ›´å¤šé”™è¯¯æ—¶ä½¿ç”¨EXPECT_*ï¼Œåœ¨æ–­è¨€å¤±è´¥åç»§ç»­è¿è¡Œæµ‹è¯•æ¯«æ— æ„ä¹‰æ—¶ä½¿ç”¨ASSERT_ *ã€‚ä¾‹å¦‚ï¼Œåœ¨Dequeueæµ‹è¯•çš„ç¬¬äºŒæ¡æ–­è¨€æ˜¯ASSERT_NE(n,nullptr)ï¼Œå› ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å–næŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå½“nä¸ºNULLæ—¶ä¼šå¯¼è‡´æ®µé”™è¯¯ã€‚\nå½“è¿™äº›æµ‹è¯•è¿è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä¸‹é¢çš„äº‹ï¼š\nï¼ˆ1ï¼‰googletestæ„é€ ä¸€ä¸ªQueueTestå¯¹è±¡ï¼Œç§°ä¸ºt1ã€‚\nï¼ˆ2ï¼‰t1.SetUp()åˆå§‹åŒ–t1ã€‚\nï¼ˆ3ï¼‰ç¬¬ä¸€ä¸ªæµ‹è¯•IsEmptyInitiallyåœ¨t1ä¸Šè¿è¡Œã€‚\nï¼ˆ4ï¼‰t1.TearDown()åœ¨æµ‹è¯•ç»“æŸåè¿›è¡Œæ¸…ç†ã€‚\nï¼ˆ5ï¼‰t1è¢«è§£æ„ã€‚\nï¼ˆ6ï¼‰åœ¨å¦ä¸€ä¸ªQueueTestå¯¹è±¡ä¸Šé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œè¿™æ¬¡é¢è¿è¡ŒDequeueWorksæµ‹è¯•ã€‚\nåœ¨Linuxï¼ŒWindowsï¼ŒMacä¸Šå¯ç”¨ã€‚\n3.5 è°ƒç”¨æµ‹è¯• TEST()å’ŒTEST_F()ç”¨googletestéšå¼æ³¨å†Œå®ƒä»¬çš„æµ‹è¯•ã€‚æ‰€ä»¥ä¸å¿…åƒå…¶å®ƒC++æµ‹è¯•æ¡†æ¶é‚£æ ·ä¸ºäº†è¿è¡Œæˆ‘ä»¬å®šä¹‰çš„æµ‹è¯•è€Œé‡æ–°åˆ—å‡ºè¿™äº›æµ‹è¯•çš„åˆ—è¡¨ã€‚\nåœ¨å®šä¹‰æˆ‘ä»¬çš„æµ‹è¯•ä»¥åï¼Œå¯ä»¥ç”¨RUN_ALL_TESTS()è¿è¡Œå®ƒä»¬ï¼Œå¦‚æœæ‰€æœ‰æµ‹è¯•å‡æˆåŠŸï¼Œåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›1ã€‚æ³¨æ„RUN_ALL_TESTS()è¿è¡Œè¿æ¥å•å…ƒä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼Œå®ƒä»¬å¯ä»¥æ¥è‡ªä¸åŒçš„æµ‹è¯•å¥—ä»¶ç”šè‡³æ˜¯ä¸åŒçš„æºæ–‡ä»¶ã€‚\nå½“RUN_ALL_TESTS()å®è¢«è°ƒç”¨æ—¶ï¼š\n å­˜å‚¨æ‰€æœ‰googletest flagsçš„çŠ¶æ€ã€‚ ä¸ºç¬¬ä¸€ä¸ªæµ‹è¯•åˆ›å»ºä¸€ä¸ªtest fixtureå¯¹è±¡ã€‚ é€šè¿‡SetUp()å¯¹å®ƒåˆå§‹åŒ–ã€‚ åœ¨fixtureå¯¹è±¡ä¸Šè¿è¡Œæµ‹è¯•ã€‚ é€šè¿‡TearDown()æ¸…ç†fixtureã€‚ åˆ é™¤fixtureã€‚ æ¢å¤æ‰€æœ‰googletest flagsçš„çŠ¶æ€ã€‚ å¯¹ä¸‹ä¸€ä¸ªæµ‹è¯•é‡å¤ä¸Šè¿°æ‰€æœ‰æ­¥éª¤ï¼Œç›´è‡³æµ‹è¯•è¿è¡Œå®Œæ¯•ã€‚  å¦‚æœå‡ºç°äº†fatal failureï¼Œé‚£ä¹ˆåç»­æ­¥éª¤éƒ½ä¼šè¢«ç»ˆæ­¢ã€‚\nä¸èƒ½å¿½è§†RUN_ALL_TESTS()çš„è¿”å›å€¼ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚è¿™ç§è®¾è®¡çš„åŸºæœ¬åŸç†æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•æœåŠ¡æ ¹æ®å…¶é€€å‡ºä»£ç ï¼ˆè€Œä¸æ˜¯å…¶ stdout/stderr è¾“å‡ºï¼‰æ¥ç¡®å®šæµ‹è¯•æ˜¯å¦é€šè¿‡ï¼Œå› æ­¤main()å‡½æ•°å¿…é¡»è¿”å›RUN_ALL_TESTS()çš„è¿”å›å€¼ã€‚å¹¶ä¸”åªèƒ½è°ƒç”¨RUN_ALL_TESTS() ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨å®ƒä¼šä¸ä¸€äº›é«˜çº§ googletest åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œçº¿ç¨‹å®‰å…¨çš„æ­»äº¡æµ‹è¯•ï¼‰å‘ç”Ÿå†²çªï¼Œå› æ­¤ä¸å—æ”¯æŒã€‚\nåœ¨Linuxï¼ŒWindowsï¼ŒMacä¸Šå¯ç”¨ã€‚\n3.6 ç¼–å†™main()å‡½æ•° å¤§å¤šç”¨æˆ·ä¸åº”è¯¥è‡ªå·±ç¼–å†™mainå‡½æ•°ï¼Œè€Œåº”è¯¥ç”¨gtest_mainï¼ˆä¸gtestç›¸åï¼‰è¿æ¥ï¼Œå®ƒå®šä¹‰äº†åˆé€‚çš„å…¥å£ç‚¹ã€‚æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†ä»…åœ¨ä¸€äº›éœ€è¦åœ¨æµ‹è¯•è¿è¡Œä¹‹å‰è¿›è¡Œçš„ã€æ— æ³•åœ¨fixtureå’Œæµ‹è¯•å¥—ä»¶æ¡†æ¶å†…è¡¨è¾¾çš„è‡ªå®šä¹‰æ“ä½œæ—¶æ‰ä½¿ç”¨ã€‚\nå¦‚æœè‡ªå·±ç¼–å†™mainå‡½æ•°ï¼Œå®ƒåº”è¯¥è¿”å›RUN_ALL_TESTS()çš„å€¼ã€‚\nä¸‹é¢æ˜¯è‡ªå®šä¹‰mainå‡½æ•°çš„æ ·æ¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60  #include \u0026#34;this/package/foo.h\u0026#34; #include \u0026#34;gtest/gtest.h\u0026#34; namespace my { namespace project { namespace { // The fixture for testing class Foo. class FooTest : public ::testing::Test { protected: // You can remove any or all of the following functions if their bodies would  // be empty.  FooTest() { // You can do set-up work for each test here.  } ~FooTest() override { // You can do clean-up work that doesn\u0026#39;t throw exceptions here.  } // If the constructor and destructor are not enough for setting up  // and cleaning up each test, you can define the following methods:  void SetUp() override { // Code here will be called immediately after the constructor (right  // before each test).  } void TearDown() override { // Code here will be called immediately after each test (right  // before the destructor).  } // Class members declared here can be used by all tests in the test suite  // for Foo. }; // Tests that the Foo::Bar() method does Abc. TEST_F(FooTest, MethodBarDoesAbc) { const std::string input_filepath = \u0026#34;this/package/testdata/myinputfile.dat\u0026#34;; const std::string output_filepath = \u0026#34;this/package/testdata/myoutputfile.dat\u0026#34;; Foo f; EXPECT_EQ(f.Bar(input_filepath, output_filepath), 0); } // Tests that Foo does Xyz. TEST_F(FooTest, DoesXyz) { // Exercises the Xyz feature of Foo. } } // namespace } // namespace project } // namespace my  int main(int argc, char **argv) { ::testing::InitGoogleTest(\u0026amp;argc, argv); return RUN_ALL_TESTS(); }   ::testing::InitGoogleTest()å‡½æ•°è§£æå‘½ä»¤è¡Œä»¥è·å– googletest flagsï¼Œå¹¶åˆ é™¤æ‰€æœ‰å·²è¯†åˆ«çš„æ ‡å¿—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§æ ‡å¿—æ¥æ§åˆ¶æµ‹è¯•ç¨‹åºçš„è¡Œä¸ºï¼ŒAdvancedGuide ä»‹ç»äº†è¿™äº›æ ‡å¿—ã€‚å¿…é¡»åœ¨è°ƒç”¨RUN_ALL_TESTS()ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¦åˆ™æ ‡å¿—å°†æ— æ³•æ­£ç¡®åˆå§‹åŒ–ã€‚\nåœ¨ Windows ä¸Šï¼ŒInitGoogleTest()ä¹Ÿé€‚ç”¨äºå®½å­—ç¬¦ä¸²ï¼Œå› æ­¤å®ƒä¹Ÿå¯ç”¨äºä»¥UNICODEæ¨¡å¼ç¼–è¯‘çš„ç¨‹åºã€‚\nç¼–å†™æ‰€æœ‰è¿™äº›mainå‡½æ•°éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ï¼Œæ‰€ä»¥Google Testæä¾›main()å‡½æ•°çš„åŸºç¡€å®ç°ï¼Œå¦‚æœå®ƒç¬¦åˆéœ€æ±‚ï¼Œåªéœ€è¦å°†gtest_mainå’Œæµ‹è¯•é“¾æ¥èµ·æ¥å³å¯ã€‚\n3.7 å±€é™æ€§ Google Test è¢«è®¾è®¡ä¸ºçº¿ç¨‹å®‰å…¨çš„ã€‚è¯¥å®ç°åœ¨ pthreads åº“å¯ç”¨çš„ç³»ç»Ÿä¸Šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç›®å‰åœ¨å…¶ä»–ç³»ç»Ÿï¼ˆä¾‹å¦‚ Windowsï¼‰ä¸ŠåŒæ—¶ä½¿ç”¨æ¥è‡ªä¸¤ä¸ªçº¿ç¨‹çš„ Google æµ‹è¯•æ–­è¨€æ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨å¤§å¤šæ•°æµ‹è¯•ä¸­ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºé€šå¸¸æ–­è¨€æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆçš„ã€‚\n4 é™„å½• 4.1 git commit hashè·å–æ–¹æ³• ï¼ˆ1ï¼‰é¦–å…ˆåœ¨googletestçš„Gité¡µé¢æ‰¾åˆ°releaseï¼Œè·³è½¬åˆ°Releaseé¡µé¢åç‚¹å‡»å›¾1çº¢æ¡†éƒ¨åˆ†ï¼ˆæˆ–ç‚¹å‡»çº¢æ¡†ä¸‹é¢çš„e2239eeå¯ç›´æ¥è·³è½¬åˆ°ç¬¬3æ­¥ï¼‰ï¼›\nå›¾1 Releaseé¡µé¢:\r\r ï¼ˆ2ï¼‰é¡µé¢è·³è½¬åï¼Œç‚¹å‡»å›¾2çº¢æ¡†éƒ¨åˆ†ï¼›\nå›¾2 Releaseç‰ˆæœ¬å¯¹åº”çš„æºç :\r\r ï¼ˆ3ï¼‰é¡µé¢è·³è½¬åï¼Œå›¾3çº¢æ¡†ä¸­çš„å†…å®¹å³ä¸ºcommit hashã€‚\nå›¾3 Releaseç‰ˆæœ¬å¯¹åº”çš„Commit Hash:\r\r ","description":"Google Testçš„åˆçº§ä½¿ç”¨æ–¹æ³•","id":7,"section":"posts","tags":["C"],"title":"å·¥å…·ä½¿ç”¨ï¼šGoogleTest","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8googletest/"},{"content":"æœºå™¨å­¦ä¹ å…¥é—¨ 1 åŸºæœ¬æ¦‚å¿µ ã€€æ³¨ï¼šä»…ä½œç®€è¦ä»‹ç»ï¼Œå¸®åŠ©ç†è§£ã€‚éœ€è¦é˜…è¯»æˆ–å­¦ä¹ è¿‡ã€Šæœºå™¨å­¦ä¹ ã€‹ã€ã€Šçº¿æ€§ä»£æ•°ã€‹è¯¾ç¨‹ï¼ˆå¯ä»¥æ²¡å­¦æ˜ç™½ï¼Œä½†å¾—ä¸Šè¿‡è¯¾ï¼‰ã€‚\n1.1 çº¿æ€§ä»£æ•° ã€€å‘é‡åœ¨æœºå™¨å­¦ä¹ ä¸­å°±æ˜¯å¯¹è±¡çš„å±æ€§åˆ—è¡¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå±æ€§listï¼Œæ¯”å¦‚[ç™½(é¢œè‰²), ä½“ç§¯(å¤§), æˆç†Ÿ(æ˜¯å¦æˆç†Ÿ)]ï¼Œé¢œè‰²ã€ä½“ç§¯ã€æˆç†Ÿç¨‹åº¦æ˜¾ç„¶æ²¡æœ‰åœ¨ä¸€ä¸ªæ¬¡å…ƒé‡Œï¼Œä¸èƒ½ç›´æ¥åšåŠ å‡ä¹˜é™¤è¿ç®—ï¼Œç›´æ¥è¿ç®—ï¼ˆæ¯”å¦‚ä¸‰ä¸ªå€¼ç›¸åŠ ï¼‰æ²¡æœ‰ä»»ä½•å®é™…æ„ä¹‰ï¼›ä¸ºäº†è®¡ç®—å‡ºåˆç†è€Œæœ‰æ„ä¹‰çš„å€¼ï¼Œç”¨ä¸€ä¸ªåˆ—è¡¨æ¥è¡¨ç¤ºè¿™äº›å±æ€§ï¼Œæ¯ä¸€ä¸ªå±æ€§å¤„åœ¨è‡ªå·±çš„ç»´åº¦ä¸­ï¼Œè¿™å°±æ˜¯çº¿æ€§ä»£æ•°ï¼Œç„¶ååˆ©ç”¨çº¿æ€§ä»£æ•°å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¿ç®—ã€‚ä¸ºäº†è®¡ç®—æ–¹ä¾¿ï¼Œç”¨ä¸åŒçš„å­—æ¯è¡¨ç¤ºè¿™äº›å±æ€§[a, b, c]ã€‚\nã€€å¾ˆå¤šæ–‡ç« ç”¨äºŒç»´ä¸‰ç»´å›¾æ¥å¸®åŠ©ç†è§£çº¿æ€§ä»£æ•°ï¼Œè¯»å®Œä»¥åã€å›°æƒ‘å¢åŠ äº†ã€‘ï¼ŒäºŒç»´ä¸‰ç»´å›¾æ˜¯ä¸ºäº†å¸®åŠ©ç†è§£çº¿æ€§ä»£æ•°çš„å‡ ä½•å«ä¹‰ï¼Œç†è§£è¿™äº›å±æ€§åœ¨ç»´åº¦ä¸Šçš„åŒºåˆ«å’Œè”ç³»ï¼Œå³è™½ç„¶å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ªç»´åº¦é‡Œï¼Œä¾ç„¶èƒ½å¤Ÿäº’ç›¸å½±å“ï¼Œè¯æ˜çº¿æ€§ä»£æ•°è¿ç®—æ³•åˆ™çš„æ­£ç¡®æ€§ã€‚\n1.2 ç›‘ç£å­¦ä¹  ã€€æ•°æ®é›†ä¸­çš„æ¯æ¡è®°å½•éƒ½åŒ…å«ä¸€ä¸ªæ ‡ç­¾æˆ–æ ‡å¿—ï¼›å³æ•°æ®é›†æœ‰æ˜ç¡®çš„åˆ†ç±»ç»“æœã€‚\n å›å½’ï¼šè¾“å‡ºè¿ç»­å€¼ï¼Œæ¯”å¦‚é¢„æµ‹ç²—ç³™åº¦ã€‚æ¨¡å‹åŒ…æ‹¬æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ï¼Œäººå·¥ç¥ç»ç½‘ç»œï¼Œlogisticå›å½’ï¼Œå†³ç­–æ ‘å’Œéšæœºæ ‘ï¼› åˆ†ç±»ï¼šè¾“å‡º0/1æˆ–è€…ç¦»æ•£å€¼ï¼Œæ¯”å¦‚é¢„æµ‹å®ƒä¸æ˜¯ä¸€ä¸ªå¥½åƒçš„ç“œğŸ‰ã€‚æ¨¡å‹åŒ…æ‹¬çº¿æ€§å›å½’ï¼Œè´å¶æ–¯çº¿æ€§å›å½’ï¼Œå†³ç­–æ ‘å›å½’ã€‚  1.3 æ— ç›‘ç£å­¦ä¹  ã€€æ•°æ®é›†ä¸­çš„è®°å½•ä¸åŒ…å«ä»»ä½•æ ‡ç­¾æˆ–æ ‡å¿—ï¼›å³æ•°æ®é›†æ²¡æœ‰æ˜ç¡®çš„åˆ†ç±»\n èšç±»ï¼šé€šè¿‡èšç±»ç®—æ³•æŠŠæŸäº›æ•°æ®èšé›†åœ¨ä¸€èµ·ï¼Œè¡¨ç°ä¸ºä¸€å›¢ä¸€å›¢æˆ–ä¸€å †ä¸€å †ã€‚æ¨¡å‹åŒ…æ‹¬å±‚æ¬¡èšç±»ï¼Œk- å‡å€¼èšç±»ã€‚  1.4 å¼ºåŒ–å­¦ä¹  ã€€æ„ŸçŸ¥ç¯å¢ƒçŠ¶æ€ï¼Œæ ¹æ®åé¦ˆçš„ç»“æœ(å¥–åŠ±ï¼ŒReward)ï¼Œå­¦ä¹ å‡ºä¸€ä¸ªæœ€å¤§åŒ–é•¿æœŸæ€»æ”¶ç›Šçš„ç­–ç•¥ï¼ˆåŠ¨ä½œï¼ŒActionï¼‰ï¼Œå¹¶ä¸æ–­å¼ºåŒ–ç­–ç•¥ã€‚å¦‚AlphaGoã€‚\n1.5 ç‰¹å¾å·¥ç¨‹ ã€€å¯¹ä¸Šè¯¾å†…å®¹æ²¡ä»€ä¹ˆå°è±¡ğŸ˜…ï¼Œæˆ‘çš„ç†è§£æ˜¯ä¸€ç§ç‰©ä½“æœ‰å¾ˆå¤šä¸ªç‰¹å¾ï¼Œä½†æ˜¯ä¸åŒåœºæ™¯ä¸‹ï¼Œä¸€ç§ç‰©ä½“å’Œå¦ä¸€ç§ç‰©ä½“åŒºåˆ†å¼€åªéœ€è¦å…¶ä¸­å‡ ç§ç‰¹å¾ï¼ˆæ¯”å¦‚ä¸€ä¸ªè¢‹å­ä¸­åªæœ‰é’¢çƒå’Œæ£‰èŠ±çƒï¼Œåªéœ€è¦ç”¨è½¯ç¡¬ç¨‹åº¦ä¸€ç§ç‰¹å¾å°±å¯ä»¥åŒºåˆ†äº†ï¼‰ï¼Œç‰¹å¾å·¥ç¨‹å°±æ˜¯åœ¨é—®é¢˜åœºæ™¯ä¸‹ï¼Œç­›é€‰å‡ºèƒ½å¤Ÿè§£å†³é—®é¢˜çš„ç‰¹å¾ï¼Œç®€åŒ–è¿ç®—è¿‡ç¨‹ï¼ŒèŠ‚çœè®¡ç®—èµ„æºã€‚ä¸‹é¢æ˜¯å‡ ç§ç‰¹å¾åˆ†ææ–¹æ³•çš„æåã€‚\nã€€ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼šçº¿æ€§é™ç»´æ–¹æ³•ï¼Œæ‰¾å‡ºåŒ…å«ä¿¡æ¯é‡è¾ƒé«˜çš„ç‰¹å¾ä¸»æˆåˆ†ã€‚\nã€€å‰å‘æœç´¢ï¼šæœ€å¼€å§‹ä¸é€‰å–ä»»ä½•ç‰¹å¾ï¼Œè®¡ç®—æ¨¡å‹çš„äº¤å‰éªŒè¯è¯¯å·®ï¼Œç„¶åé€‰æ‹©æœ€ç›¸å…³çš„ç‰¹å¾ï¼Œå°†è¿™ä¸ªç‰¹å¾åŠ å…¥åˆ°å·²æœ‰ç‰¹å¾ï¼›é‡å¤é€‰å–å…¶å®ƒæ‰€æœ‰å€™é€‰ç‰¹å¾ç›´åˆ°è¾¾åˆ°æœŸæœ›æ•°é‡çš„ç‰¹å¾ä¸ºæ­¢ã€‚\nã€€åå‘æœç´¢ï¼šä»æ‰€æœ‰ç‰¹å¾å¼€å§‹ã€‚è®¡ç®—æ¨¡å‹çš„äº¤å‰éªŒè¯è¯¯å·®å…ˆç§»é™¤æœ€ä¸ç›¸å…³çš„ç‰¹å¾ï¼Œå¯¹å…¶å®ƒæ‰€æœ‰å€™é€‰ç‰¹å¾ï¼Œé‡å¤è¿™ä¸€è¿‡ç¨‹ç›´åˆ°è¾¾åˆ°æœŸæœ›æ•°é‡çš„ç‰¹å¾ä¸ºæ­¢ã€‚\n1.6 æ¨¡å‹  æ‘˜å½•æ€»ç»“è‡ªã€Šæœºå™¨å­¦ä¹ ã€‹å‘¨å¿—å\n ã€€æœºå™¨å­¦ä¹ ç ”ç©¶çš„ä¸»è¦å†…å®¹æ˜¯è¿™æ ·ä¸€ç§å­¦ä¹ ç®—æ³•ï¼šåˆ©ç”¨è®¡ç®—æœºï¼Œä»æ•°æ®ä¸­äº§ç”Ÿæ¨¡å‹çš„ç®—æ³•ã€‚\nã€€æ¨¡å‹ï¼šæŠŠç»éªŒæ•°æ®æä¾›ç»™å­¦ä¹ ç®—æ³•ï¼Œå­¦ä¹ ç®—æ³•æ ¹æ®è¿™äº›æ•°æ®äº§ç”Ÿæ¨¡å‹ï¼Œå³ä»æ•°æ®ä¸­å­¦å¾—çš„ç»“æœã€‚\n1.7 æŸ¥å‡†ç‡(Precision)å’ŒæŸ¥å…¨ç‡(Recall) ã€€Precisionå’ŒRecallé€šå¸¸ç”¨æ¥è¯„ä¼°æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ€§èƒ½ã€‚\nã€€ğŸ“æŸ¥å…¨ç‡å¾ˆå¤šäººç§°ä¸ºå¬å›ç‡ï¼Œä½†å¬å›å’Œå…¶è®¡ç®—æ–¹å¼å®Œå…¨æ‰¾ä¸åˆ°è”ç³»ï¼Œä¸ªäººè¿™ä¸ªç¿»è¯‘ä¸å¤Ÿçµæ´»ï¼Œä¸åˆ©äºç†è§£ã€‚\n TPï¼šçœŸæ­£ä¾‹(True Positive)ï¼ŒçœŸå€¼1ï¼Œé¢„æµ‹å€¼1ï¼› FPï¼šå‡æ­£ä¾‹(False Positive)ï¼ŒçœŸå€¼0ï¼Œé¢„æµ‹å€¼1ï¼› TNï¼šçœŸåä¾‹(True Negative)ï¼ŒçœŸå€¼0ï¼Œé¢„æµ‹å€¼0ï¼› FNï¼šå‡åä¾‹(False Negative)ï¼ŒçœŸå€¼1ï¼Œé¢„æµ‹å€¼0ï¼›  ã€€æŸ¥å‡†ç‡(Precision)è®¡ç®—æ–¹æ³•ï¼šP=TP/(TP+FP)ï¼›\nã€€æŸ¥å…¨ç‡(Recall)è®¡ç®—æ–¹æ³•ï¼šR=TP/(TP+FN)ã€‚\n2 è¿‡ç¨‹ 2.1 å·¥å…· ã€€æ•°æ®ï¼šcsvæ–‡ä»¶\nã€€ç¼–ç¨‹è¯­è¨€ï¼šä¾¿äºå­¦ä¹ çš„Pythonã€‚\n pandasï¼šæ•°æ®åˆ†æåº“ï¼Œæ‰©å±•äº†æ•°æ®å…³ç³»ï¼Œæä¾›äº†å¤§é‡èƒ½ä½¿æˆ‘ä»¬å¿«é€Ÿä¾¿æ·åœ°å¤„ç†æ•°æ®çš„å‡½æ•°å’Œæ–¹æ³•ã€‚å¯ç”¨äºå¯¼å…¥æ•°æ® numpyï¼šæ˜¯ä¸€ä¸ªç”±å¤šç»´æ•°ç»„å¯¹è±¡å’Œç”¨äºå¤„ç†æ•°ç»„çš„ä¾‹ç¨‹é›†åˆç»„æˆçš„åº“ã€‚å¯å®ŒæˆåŸºç¡€æ•°å€¼è®¡ç®—ã€‚ matplotlibï¼šç”¨äºæ•°æ®å¯è§†åŒ–ï¼Œä¸numpyä¸€èµ·ä½¿ç”¨ï¼Œæˆä¸ºäº†æœ‰æ•ˆåœ°Matlabå¼€æºæ›¿ä»£æ–¹æ¡ˆã€‚ scikit-learnï¼šå¼€æºçš„Pythonæœºå™¨å­¦ä¹ åº“ï¼Œæä¾›äº†å¤§é‡ç”¨äºæ•°æ®æŒ–æ˜å’Œåˆ†æçš„å·¥å…·ï¼ŒåŒ…æ‹¬æ•°æ®é¢„å¤„ç†ã€äº¤å‰éªŒè¯ã€ç®—æ³•ä¸å¯è§†åŒ–ç®—æ³•ç­‰ä¸€ç³»åˆ—æ¥å£ã€‚åŸºæœ¬åŠŸèƒ½åˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼Œåˆ†ç±»ï¼Œå›å½’ï¼Œèšç±»ï¼Œæ•°æ®é™ç»´ï¼Œæ¨¡å‹é€‰æ‹©ï¼Œæ•°æ®é¢„å¤„ç†ã€‚  ã€€ipython notebookï¼šæ˜¯ä¸€ä¸ª Webåº”ç”¨ç¨‹åºï¼Œä¾¿äºåˆ›å»ºå’Œå…±äº«æ–‡å­¦åŒ–ç¨‹åºæ–‡æ¡£ï¼Œæ”¯æŒå®æ—¶ä»£ç ï¼Œæ•°å­¦æ–¹ç¨‹ï¼Œå¯è§†åŒ–å’Œmarkdownã€‚ ç”¨é€”åŒ…æ‹¬ï¼šæ•°æ®æ¸…ç†å’Œè½¬æ¢ï¼Œæ•°å€¼æ¨¡æ‹Ÿï¼Œç»Ÿè®¡å»ºæ¨¡ï¼Œæœºå™¨å­¦ä¹ ç­‰ç­‰ã€‚ç¬¬3ç« ä¸­Kaggleçš„Codeå¹³å°å°±æ˜¯ç”¨çš„è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚\n2.2 æœºå™¨å­¦ä¹ æ–¹æ³•åº”ç”¨æµç¨‹ å¾—åˆ°æ•°æ®é›†ï¼Œå¼€å§‹ä½¿ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•ï¼š\nã€€-\u0026gt;äº†è§£æ•°æ®(ç®±å‹å›¾ã€å¯†åº¦å›¾/ç›´æ–¹å›¾ã€æ•£ç‚¹å›¾)\nã€€-\u0026gt;æ•°æ®é¢„å¤„ç†ï¼ˆå¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼ï¼›åˆ©ç”¨ç‰¹å¾å·¥ç¨‹é€‰å‡ºç‰¹å¾ï¼‰\nã€€-\u0026gt;æŠŠæ•°æ®æ‹†åˆ†ä¸ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†\nã€€-\u0026gt;æŒ‘é€‰ä¸€ä¸ªæ¨¡å‹\nã€€-\u0026gt;ä½¿ç”¨ç®¡é“ç»„è£…\nã€€-\u0026gt;è®­ç»ƒæ¨¡å‹-\u0026gt;ä½¿ç”¨æ¨¡å‹ï¼Œè¾“å…¥æµ‹è¯•é›†\nã€€-\u0026gt;è¯„ä¼°æ¨¡å‹å¹¶å¯è§†åŒ–\nã€€-\u0026gt;è°ƒæ•´è¶…å‚æ•°ï¼ˆäººä¸ºè®¾ç½®çš„å‚æ•°ï¼‰\näº†è§£æ•°æ®çš„æ–¹æ³•ï¼š\n ç®±å‹å›¾ï¼šè¯†åˆ«å¼‚å¸¸å€¼ å¯†åº¦å›¾/ç›´æ–¹å›¾ï¼šæ˜¾ç¤ºæ•°æ®çš„åˆ†å¸ƒ æ•£ç‚¹å›¾ï¼šæè¿°åŒå˜é‡å…³ç³»  3 ç»ƒä¹  ã€€æš‚æ—¶ç”¨å¤§å®¶éƒ½æ¨èçš„å¹³å°è¿›è¡Œå­¦ä¹ å’Œæ¢ç´¢ï¼šhttps://www.kaggle.com/\nã€€é€‰ç”¨kaggleçš„Titanicæ•™ç¨‹è¿›è¡Œç»ƒä¹ ï¼Œå‚è€ƒå…¶æ•™ç¨‹ï¼Œå¯¹æ•™ç¨‹è¿›è¡Œè§£æï¼Œä¸å†é‡å¤å…¶å¹³å°æ“ä½œæ•™ç¨‹ã€‚\nã€€ğŸ“£ï¼šå¯èƒ½æ‰¾ä¸åˆ°æ§åˆ¶å°ï¼ŒCodeå°±æ˜¯æ§åˆ¶å°ï¼Œæ”¹è¿‡å¥½å¤šæ¬¡åã€‚\n å‚è€ƒç»ƒä¹ çš„æ•™ç¨‹ï¼šhttps://www.kaggle.com/alexisbcook/titanic-tutorial\n 3.1 é—®é¢˜æè¿° ã€€Titanicï¼šä»€ä¹ˆæ ·çš„äººæ›´æœ‰å¯èƒ½ç”Ÿå­˜ï¼Ÿä½¿ç”¨ä¹˜å®¢æ•°æ®ï¼ˆå³å§“åï¼Œå¹´é¾„ï¼Œæ€§åˆ«ï¼Œç¤¾ä¼šç»æµèˆ±ç­‰ï¼‰\nã€€æ•°æ®é›†ï¼šç»™å®šäº†è®­ç»ƒé›†train.csvå’Œtest.csvã€‚train.csvç»™å®šäº†ä¹˜å®¢çš„è¯¦ç»†å±æ€§ä»¥åŠæ˜¯å¦è·æ•‘ã€‚test.csvæ²¡æœ‰æ ‡å®šä¹˜å®¢çš„è·æ•‘ä¿¡æ¯ã€‚ä½¿ç”¨891ä¸ªæ•°æ®ç”Ÿæˆçš„é¢„æµ‹æ¨¡å‹ï¼Œé¢„æµ‹418åä¹˜å®¢æ˜¯å¦è·æ•‘ã€‚\nã€€è¾“å‡ºï¼šä¸€ä¸ªcsvæ–‡ä»¶ï¼ŒåŒ…å«ä¸¤åˆ—ï¼Œä¸€å…±418è¡Œï¼Œç¬¬ä¸€åˆ—ä¸ºPassengerIdï¼Œç¬¬äºŒåˆ—ä¸ºSurvivedï¼Œå€¼ä¸º0/1ã€‚\nã€€å±æ€§é›†ï¼šPassengerIdã€Survived(0-æœªè·æ•‘ï¼Œ1-è·æ•‘)ã€Pclass(ç¤¾ä¼šç»æµåœ°ä½ä»£è¡¨ï¼Œ1-é«˜ï¼Œ2-ä¸­ï¼Œ3-ä½)ã€Nameã€Sexã€Age(20% missing)ã€SibSp(å‡ ä¸ªå…„å¼Ÿ/é…å¶)ã€Parch(å‡ ä¸ªå­©å­/çˆ¶æ¯)ã€Ticketã€Fareã€‚\n3.2 äº†è§£æ•°æ® ã€€ç”¨pandasè¯»å…¥æ•°æ®ï¼Œç”¨scikit-learnå»ºç«‹æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚\n pandasæ–‡æ¡£ï¼šhttps://pandas.pydata.org/pandas-docs/stable/\nsklearnæ–‡æ¡£ï¼šhttps://scikit-learn.org/stable/\n 3.2.1 è¯»å…¥æ•°æ® 1 2 3 4 5  #pd.read_csvè¯»å–csvæ–‡ä»¶ï¼Œtest_dataæ˜¯DataFrameå¯¹è±¡ test_data = pd.read_csv(\u0026#34;/kaggle/input/titanic/test.csv\u0026#34;) train_data = pd.read_csv(\u0026#34;/kaggle/input/titanic/train.csv\u0026#34;) #dataFrame.head()ï¼Œåˆ—å‡ºè¯¥dataFrameçš„å‰5è¡Œ test_data.head()   å›¾1 è¾“å‡ºtest_dataçš„å‰5è¡Œ:\r\r 3.2.2 ç²—ç•¥åˆ†ææ•°æ® ã€€ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒdataFrame.loc[è¡Œ][åˆ—]è¡¨ç¤ºæå–æŒ‡å®šçš„è¡Œå’Œåˆ—ï¼Œè¿™é‡Œæå–Sex=femaleçš„è¡Œå¯¹åº”çš„Survivedåˆ—ã€‚ä¸€å…±æœ‰314è¡Œï¼Œwomençš„é•¿åº¦ä¸º314ï¼Œè€Œè·æ•‘çš„Survivedå€¼ä¸º1ï¼Œæ‰€ä»¥å¯ä»¥ç”¨sum(women)å¿«é€Ÿç»Ÿè®¡è·æ•‘çš„å¥³æ€§æ•°é‡ï¼Œä»è€Œç”¨sum(women)/len(women)è®¡ç®—å‡ºå¥³æ€§è·æ•‘çš„æ¯”ç‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11  #æå–Sex=femaleçš„è¡Œå¯¹åº”çš„Survivedåˆ— women = train_data.loc[train_data.Sex == \u0026#39;female\u0026#39;][\u0026#34;Survived\u0026#34;] print(women) rate_women = sum(women)/len(women) print(\u0026#34;% of women who survived:\u0026#34;, rate_women) men = train_data.loc[train_data.Sex == \u0026#39;male\u0026#39;][\u0026#34;Survived\u0026#34;] rate_men = sum(men)/len(men) print(\u0026#34;% of men who survived:\u0026#34;, rate_men)   å›¾2 è¾“å‡ºç”·æ€§å’Œå¥³æ€§è·æ•‘çš„æ¯”ç‡:\r\r ã€€å¯ä»¥çœ‹å‡ºæ€§åˆ«æ˜¯ä¸€ä¸ªå¾ˆå¼ºçš„è·æ•‘ç‰¹å¾ã€‚è€Œä»…é€šè¿‡ä¸€ä¸ªç‰¹å¾å°±å¯èƒ½åšå‡ºæœ‰æ•ˆçš„é¢„æµ‹ï¼Œå¦‚æœè€ƒè™‘å¤šä¸ªç‰¹å¾ï¼ˆåˆ—ï¼‰ï¼Œå¯èƒ½ä¼šæœ‰æ›´æœ‰æ•ˆåœ°é¢„æµ‹ç»“æœï¼Œå¯ä»¥é€šè¿‡æœºå™¨å­¦ä¹ ï¼ˆå®é™…å°±æ˜¯åˆ©ç”¨çº¿æ€§ä»£æ•°è¿›è¡Œè¿ç®—ï¼‰æ¥å®Œæˆç»¼åˆå¤šä¸ªåˆ—çš„é¢„æµ‹ã€‚\n3.2.3 å¤„ç†ç©ºå€¼ ã€€è§‚å¯Ÿæ•°æ®ï¼Œå‘ç°å¹´é¾„æœ‰ç©ºå€¼ï¼Œå¹¶ä¸”æ ¹æ®å¸¸è¯†ï¼Œå¹´é¾„å¯èƒ½ä¼šå½±å“è·æ•‘ï¼Œè€ƒè™‘å¤„ç†å¹´é¾„çš„ç©ºå€¼ã€‚(æ ¹æ®å®é™…æƒ…å†µï¼Œå¹´é¾„ä¸¢å¤±çš„ï¼Œåº”å½“100%æœªè·æ•‘ï¼Œè·æ•‘æ€ä¹ˆå¯èƒ½å”¯ç‹¬ä¸çŸ¥é“å¹´é¾„ï¼Œé™¤éæ”¶é›†å¥½çš„æ•°æ®åœ¨åç»­å­˜å‚¨å‡ºç°äº†ä¸¢å¤±ï¼‰\nã€€ä¸¤ç§åŠæ³•å¤„ç†ç©ºå€¼ï¼šï¼ˆ1ï¼‰åˆ é™¤[8]ï¼›ï¼ˆ2ï¼‰å¡«å……\nã€€æ ¹æ®ä¸ªäººæ°´å¹³ï¼ˆå¾ˆğŸ¥¦ï¼‰ï¼Œé€‰æ‹©ä¸ºå¹´é¾„å¡«å……å¹³å‡å€¼çš„æ–¹æ³•ï¼ˆçŒœæµ‹å¡«å……ä¼—æ•°æ›´åˆç†ï¼‰ï¼š\n1 2 3 4 5  #fill na age with avg #inplace : boolean, é»˜è®¤å€¼ Falseã€‚å¦‚æœä¸ºTure,åœ¨åŸåœ°å¡«æ»¡ã€‚ #fill na age with avg train_data[\u0026#39;Age\u0026#39;].fillna(train_data[\u0026#39;Age\u0026#39;].mean(),inplace = True) test_data[\u0026#39;Age\u0026#39;].fillna(test_data[\u0026#39;Age\u0026#39;].mean(),inplace = True)   3.3 æ‹†åˆ†æ•°æ®é›† ã€€è¿™é‡Œå·²ç»æ‹†å¥½æ•°æ®é›†å’Œæµ‹è¯•é›†ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚\n3.4 äº†è§£æ¨¡å‹ï¼Œé€‰æ‹©æ¨¡å‹ ã€€è¿™é‡Œæ²¡æœ‰è¿›è¡Œæ¯”è¾ƒï¼Œä¸ºæ•™å­¦è¯´æ˜ï¼Œç›´æ¥é€‰æ‹©äº†éšæœºæ£®æ—æ¨¡å‹ã€‚\n3.4.1 éšæœºæ£®æ—  éšæœºæ£®æ—å†…å®¹å¼•ç”¨ï¼šhttps://easyai.tech/ai-definition/random-forest/\n ã€€éšæœºæ£®æ—ç”±è®¸å¤šå†³ç­–æ ‘æ„æˆï¼Œä¸åŒå†³ç­–æ ‘ä¹‹é—´æ²¡æœ‰å…³è”ï¼›å½“æ‰§è¡Œåˆ†ç±»ä»»åŠ¡æ—¶ï¼Œè¾“å…¥æ ·æœ¬ï¼Œæ ·æœ¬è¿›å…¥æ¯ä¸€æ£µå†³ç­–æ ‘è¿›è¡Œåˆ¤æ–­ï¼Œæ¯æ£µæ ‘ä¼šå¾—åˆ°ä¸€ä¸ªåˆ†ç±»ç»“æœï¼Œæœ€ç»ˆå±äºå“ªä¸ªåˆ†ç±»çš„ç»“æœæœ€å¤šï¼Œå°±æŠŠè¯¥æ ·æœ¬åˆ¤æ–­ä¸ºå“ªä¸ªåˆ†ç±»ã€‚\nå†³ç­–æ ‘å½¢æˆï¼š\n ä¸€ä¸ªæ ·æœ¬å®¹é‡ä¸ºNçš„æ ·æœ¬ï¼Œæœ‰æ”¾å›çš„æŠ½å–Næ¬¡ï¼Œæ¯æ¬¡æŠ½å–1ä¸ªï¼Œæœ€ç»ˆå½¢æˆäº†Nä¸ªæ ·æœ¬ã€‚è¿™é€‰æ‹©å¥½äº†çš„Nä¸ªæ ·æœ¬ç”¨æ¥è®­ç»ƒä¸€ä¸ªå†³ç­–æ ‘ï¼Œä½œä¸ºå†³ç­–æ ‘æ ¹èŠ‚ç‚¹å¤„çš„æ ·æœ¬ã€‚ å½“æ¯ä¸ªæ ·æœ¬æœ‰Mä¸ªå±æ€§æ—¶ï¼Œåœ¨å†³ç­–æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éœ€è¦åˆ†è£‚æ—¶ï¼Œéšæœºä»è¿™Mä¸ªå±æ€§ä¸­é€‰å–å‡ºmä¸ªå±æ€§ï¼Œæ»¡è¶³æ¡ä»¶m \u0026laquo; Mã€‚ç„¶åä»è¿™mä¸ªå±æ€§ä¸­é‡‡ç”¨æŸç§ç­–ç•¥ï¼ˆæ¯”å¦‚è¯´ä¿¡æ¯å¢ç›Šï¼‰æ¥é€‰æ‹©1ä¸ªå±æ€§ä½œä¸ºè¯¥èŠ‚ç‚¹çš„åˆ†è£‚å±æ€§ã€‚ å†³ç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŒ‰ç…§æ­¥éª¤2æ¥åˆ†è£‚ï¼ˆå¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœä¸‹ä¸€æ¬¡è¯¥èŠ‚ç‚¹é€‰å‡ºæ¥çš„é‚£ä¸€ä¸ªå±æ€§æ˜¯åˆšåˆšå…¶çˆ¶èŠ‚ç‚¹åˆ†è£‚æ—¶ç”¨è¿‡çš„å±æ€§ï¼Œåˆ™è¯¥èŠ‚ç‚¹å·²ç»è¾¾åˆ°äº†å¶å­èŠ‚ç‚¹ï¼Œæ— é¡»ç»§ç»­åˆ†è£‚äº†ï¼‰ã€‚ä¸€ç›´åˆ°ä¸èƒ½å¤Ÿå†åˆ†è£‚ä¸ºæ­¢ã€‚æ³¨æ„æ•´ä¸ªå†³ç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œå‰ªæã€‚ æŒ‰ç…§æ­¥éª¤1~3å»ºç«‹å¤§é‡çš„å†³ç­–æ ‘ï¼Œè¿™æ ·å°±æ„æˆäº†éšæœºæ£®æ—äº†ã€‚  ä¼˜ç¼ºç‚¹ï¼š\n ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼›æ— éœ€é™ç»´ï¼Œæ— éœ€ç‰¹å¾é€‰æ‹©ï¼Œå¯ç”¨äºé«˜ç»´æ•°æ®ï¼›æœ‰éƒ¨åˆ†ç‰¹å¾é—å¤±ï¼Œä»å¯ä»¥ç»´æŒå‡†ç¡®åº¦ï¼›è®­ç»ƒé€Ÿåº¦è¾ƒå¿«ï¼Œå®¹æ˜“å®ç°å¹¶è¡Œæ–¹æ³•ã€‚ ç¼ºç‚¹ï¼šå–å€¼åˆ’åˆ†å¤šçš„å±æ€§ä¼šå¯¹éšæœºæ£®æ—äº§ç”Ÿæ›´å¤§çš„å½±å“ã€‚  å®ç°ï¼š\nã€€DolphinDBé€Ÿåº¦æœ€å¿«ï¼Œscikit-learnæ•ˆæœä¹Ÿä¸é”™ã€‚\nã€€è¿™é‡Œé€‰ç”¨scikit-learnçš„pythonåŒ…sklearnï¼Œå…¶éšæœºæ£®æ—ç±»ä¸ºRandomForestClassifierã€‚\n3.5 è®­ç»ƒå¹¶é¢„æµ‹ ã€€å¼€å§‹è®­ç»ƒå¹¶é¢„æµ‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  from sklearn.ensemble import RandomForestClassifier y = train_data[\u0026#34;Survived\u0026#34;] features = [\u0026#34;Pclass\u0026#34;, \u0026#34;Sex\u0026#34;, \u0026#34;SibSp\u0026#34;, \u0026#34;Parch\u0026#34;, \u0026#34;Age\u0026#34;] #get_demmies(data,...)æå–æŒ‡å®šç‰¹å¾ï¼Œå³ä»train_dataä¸­æå–è¿™5ä¸ªç‰¹å¾ X = pd.get_dummies(train_data[features]) X_test = pd.get_dummies(test_data[features]) #n_estimatorsï¼šéšæœºæ£®æ—ä¸­æ ‘çš„ä¸ªæ•°ï¼›max_depthï¼šæ ‘çš„æœ€å¤§æ·±åº¦ï¼›random_stateï¼šéšæœºçŠ¶æ€ï¼Œé»˜è®¤ç”±np.numpyç”Ÿæˆ model = RandomForestClassifier(n_estimators=100, max_depth=5, random_state=1) #fit:Xæ˜¯è¾“å…¥æ•°æ®ï¼Œyæ˜¯æ ‡ç­¾ model.fit(X, y) #predictçš„è¿”å›å€¼æ˜¯æ•°å€¼ï¼Œè¡¨ç¤ºæ ·æœ¬å±äºæ¯ä¸€ä¸ªç±»åˆ«çš„æ¦‚ç‡ predictions = model.predict(X_test) output = pd.DataFrame({\u0026#39;PassengerId\u0026#39;: test_data.PassengerId, \u0026#39;Survived\u0026#39;: predictions}) output.to_csv(\u0026#39;my_submission.csv\u0026#39;, index=False) print(\u0026#34;Your submission was successfully saved!\u0026#34;)   ã€€ç»“æœå‡ºç°ä¸‹å›¾ï¼Œåˆ™é¢„æµ‹æˆåŠŸã€‚\nå›¾3 è®­ç»ƒæˆåŠŸ:\r\r ã€€ç„¶åå³ä¸Šè§’ç‚¹å‡»Save Versionã€‚ä¿å­˜å¥½åé‡æ–°è¿›å…¥Codeé¡µé¢ï¼Œé€‰æ‹©è¯¥Workï¼Œå³è¾¹æ é€‰æ‹©Outputï¼Œé€‰ä¸­è¯¥æ–‡ä»¶ï¼Œç„¶åSubmitã€‚\nå›¾4 Codeé¡µé¢:\r\r å›¾5 Outputé¡µé¢æäº¤:\r\r ã€€æäº¤åæŸ¥çœ‹ç»“æœï¼ŒğŸ˜…ã€‚\nå›¾6 é¢„æµ‹ç»“æœ1:\r\r ã€€ä¸ä½¿ç”¨Ageç‰¹å¾çš„ç»“æœï¼ŒğŸ¤“ã€‚\nå›¾7 é¢„æµ‹ç»“æœ2:\r\r ã€€ğŸ°æœºå™¨å­¦ä¹ çš„ä½“éªŒè¿‡ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚\nå‚è€ƒèµ„æ–™ 1.æœºå™¨å­¦ä¹ åŸºç¡€ï¼šhttps://developer.ibm.com/zh/articles/introduction-to-machine-learning/\n2.æœºå™¨å­¦ä¹ å…¥é—¨å®æˆ˜ï¼šhttps://developer.ibm.com/zh/tutorials/build-and-test-your-first-machine-learning-model-using-python-and-scikit-learn/\n3.å­¦ä¹ æœºå™¨å­¦ä¹ ä¹‹å¦‚ä½•æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸€ç§ç®—æ³•ï¼šhttps://blog.csdn.net/weixin_43730955/article/details/100599229\n4.å¦‚ä½•æ­£ç¡®é€‰æ‹©æœºå™¨å­¦ä¹ ç®—æ³•ï¼šhttps://zhuanlan.zhihu.com/p/141985216\n5.éšèº«GPUæœåŠ¡å™¨ï¼šKaggleä¸­kernelsçš„å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼šhttps://oldpan.me/archives/kaggle-kernels-quick-introduction\n6.pandasè¯»å–æˆ–é€‰æ‹©æŸå‡ åˆ—ï¼šhttps://blog.csdn.net/aaa_aaa1sdf/article/details/77414387\n7.fillnaæ–¹æ³•å®ç°éƒ¨åˆ†è‡ªåŠ¨å¡«å……ï¼šhttps://zhuanlan.zhihu.com/p/114319226\n8.[æ•°æ®æ¸…æ´—]pandas dataframeç©ºå€¼çš„å¤„ç†æ–¹æ³•ï¼šhttps://zhuanlan.zhihu.com/p/35321806\n9.å°†DataFrameæŸåˆ—ä¸­çš„ç©ºå€¼å¡«å……ä¸º0ï¼šhttps://blog.csdn.net/weixin_43474731/article/details/101689897\n","description":"åŒ…æ‹¬æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µï¼Œè¿ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•çš„è¿‡ç¨‹ä»¥åŠä¸€ä¸ªç®€å•çš„æœºå™¨å­¦ä¹ æ–¹æ³•è¿ç”¨å®ä¾‹","id":8,"section":"posts","tags":["åˆ†å¸ƒå¼"],"title":"ç ”ç©¶æ–¹æ³•ï¼šæœºå™¨å­¦ä¹ ","uri":"https://yyyIce.github.io/zh/posts/%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šOffloading Real-time DDoS Attack Detection to Programmable Data Planes\nã€€ä¼šè®®ä¿¡æ¯ï¼š2020 IFIP Networking Conference (Networking)\nã€€æˆæœï¼šåœ¨å—åˆ°DDoSæ”»å‡»æ—¶ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€çš„åˆ†å¸ƒå¾€å¾€ä¼šåç¦»åˆæ³•æ¨¡å¼ï¼Œæœ¬æ–‡å‚è€ƒå¼‚å¸¸æ£€æµ‹å¸¸ç”¨ç‰¹å¾ï¼Œç”±mä¸ªæ•°æ®åŒ…å†…çš„æºIPå’Œç›®çš„IPçš„ç†µè®¡ç®—æºIPå’Œç›®çš„IPçš„é›†ä¸­è¶‹åŠ¿æŒ‡æ•°å’Œåˆ†æ•£æŒ‡æ•°ï¼Œåˆ©ç”¨ä¸¤ä¸ªæŒ‡æ•°åœ¨å¯ç¼–ç¨‹æ•°æ®å¹³é¢è¿›è¡ŒDDoSæ”»å‡»æ£€æµ‹ã€‚\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šé˜²å¾¡æœºåˆ¶ä¾èµ–äºç›‘è§†åŸè¯­ï¼šåˆ†ç»„é‡‡æ ·(sFlow)ã€åŸºäºæµçš„ç»Ÿè®¡(NetFlowã€OpenFlow)ï¼Œç›‘è§†åŸè¯­å¸¦æ¥æ•°æ®åŒ…å¤„ç†å’Œèµ„æºåˆ©ç”¨çš„å¤§é‡å¼€é”€ï¼ˆé‡‡æ ·å’Œè‰å›¾ï¼‰ï¼Œæ§åˆ¶å¾ªç¯é•¿ï¼Œæ£€æµ‹ç­‰å¾…æ—¶é—´é•¿ã€‚Snoataã€MarpleåŸºäºå¯ç¼–ç¨‹æ•°æ®å¹³é¢é…ç½®è‡ªé€‚åº”è¿‡æ»¤å™¨ï¼Œç”±æ»¤æ³¢å™¨ç¡®å®šéœ€è¦è½¬å‘åˆ°æ§åˆ¶å¹³é¢è¿›è¡Œæ£€æŸ¥çš„æ•°æ®åŒ…æµï¼Œå½±å“äº†ç½‘ç»œä½¿ç”¨ç‡ï¼Œç”¨äºæ”»å‡»æ£€æµ‹å¯èƒ½é€ æˆè¾ƒé«˜çš„å»¶è¿Ÿï¼›StateSecæ˜¯å®Œå…¨åŸºäºè½¯ä»¶çš„SDN DDoSæ”»å‡»æ£€æµ‹æœºåˆ¶ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ã€‚\nã€€æœ¬æ–‡å·¥ä½œï¼šåœ¨è½¬å‘è®¾å¤‡ä¸Šå®Œå…¨å®ç°å®æ—¶DDoSæ”»å‡»æ£€æµ‹ã€‚ä¼°è®¡ä¼ å…¥æ•°æ®åŒ…æºIPå’Œç›®çš„IPçš„ç†µï¼Œç”¨ç†µå€¼è®¡ç®—ä¸¤ä¸ªç‰¹å¾çš„é˜ˆå€¼â€”â€”é›†ä¸­è¶‹åŠ¿æŒ‡æ•°å’Œåˆ†æ•£æŒ‡æ•°ï¼Œç”¨äºæ£€æµ‹DDoSæ”»å‡»ã€‚ä¸ºæ»¡è¶³è½¬å‘è®¾å¤‡çš„é™åˆ¶ï¼Œä½¿ç”¨å®šç‚¹è¡¨ç¤ºæ³•è¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œé€šè¿‡ä¸“é—¨å®šåˆ¶çš„è®¡æ•°è‰å›¾(sketch)ä¼°ç®—ä¸åŒIPåœ°å€çš„é¢‘æ•°ï¼Œä½¿ç”¨LPMè¡¨æŸ¥æ‰¾çš„æ–¹å¼è¿‘ä¼¼å¯¹æ•°è¿ç®—ï¼Œåˆ©ç”¨ç†µå€¼å¢å‡å‡å°‘ç›´æ¥æ ¹æ®å…¬å¼è®¡ç®—ç†µå€¼çš„è®¡ç®—é‡ã€‚\nä¸€ã€èƒŒæ™¯ ã€€DDoSæ”»å‡»æ£€æµ‹çš„ç°æœ‰æ–¹æ¡ˆç†è®ºä¸Šå¯è¡Œï¼Œä½†åŸºæœ¬å­˜åœ¨æ£€æµ‹æ—¶é—´é•¿ã€å¯¹ç½‘ç»œä½¿ç”¨ç‡å½±å“å¤§ã€é€Ÿåº¦æ…¢ç­‰ç¼ºç‚¹ã€‚æ–‡ç« å‚è€ƒå¼‚å¸¸å…¥ä¾µæ£€æµ‹çš„æ–¹æ³•ï¼Œé€šè¿‡è§‚æµ‹æºIPåœ°å€å’Œç›®çš„IPåœ°å€çš„é¦™å†œä¿¡æ¯ç†µè®¡ç®—ä¸¤ä¸ªç‰¹å¾æŒ‡æ•°ï¼Œå¾—åˆ°æºIPåœ°å€å’Œç›®çš„IPåœ°å€çš„åˆ†å¸ƒï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦å‘ç”ŸDDoSæ”»å‡»ã€‚\né¦™å†œä¿¡æ¯ç†µ ã€€é¦™å†œä¿¡æ¯ç†µï¼šè¡¡é‡ä¿¡æ¯çš„ä¸ç¡®å®šç¨‹åº¦ï¼Œè¶Šä¸ç¡®å®šï¼Œç†µè¶Šå¤§ã€‚\nè‡ªä¿¡æ¯é‡  ä¿¡æ¯å‡ºç°çš„æ¦‚ç‡è¶Šå¤§ï¼Œä¸ç¡®å®šç¨‹åº¦è¶Šå°ï¼Œä¸ç¡®å®šæ€§å‡½æ•°fæ˜¯æ¦‚ç‡Pçš„å‡å‡½æ•°ï¼› ä¸¤ä¸ªç‹¬ç«‹ç¬¦å·æ‰€äº§ç”Ÿçš„ä¸ç¡®å®šæ€§åº”è¯¥ç­‰äºå„è‡ªä¸ç¡®å®šæ€§ä¹‹å’Œï¼Œå³f(P1,P2)=f(P1)+f(P2)ï¼Œå³å¯åŠ æ€§ã€‚  ã€€å¯¹æ•°å‡½æ•°æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ï¼šf(P) = log(1/p)=-log(p)\nã€€I(X)ï¼šè‡ªä¿¡æ¯é‡ï¼ŒI(x)=log(1/x)\nã€€ä¿¡æ¯ç†µæ˜¯ä¿¡æ¯é‡çš„æœŸæœ›ï¼ˆå‡å€¼ï¼‰ï¼Œå®ƒä¸æ˜¯é’ˆå¯¹æ¯æ¡ä¿¡æ¯ï¼Œè€Œæ˜¯é’ˆå¯¹æ•´ä¸ªä¸ç¡®å®šæ€§ç»“æœé›†è€Œè¨€ï¼Œä¿¡æ¯ç†µè¶Šå¤§ï¼Œäº‹ä»¶ä¸ç¡®å®šæ€§å°±è¶Šå¤§ã€‚å•æ¡ä¿¡æ¯åªèƒ½ä»æŸç§ç¨‹åº¦ä¸Šå½±å“ç»“æœé›†æ¦‚ç‡çš„åˆ†å¸ƒã€‚\nå›¾1 ä¿¡æ¯ç†µ:\r\r äºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€æ”»å‡»åœºæ™¯å’Œå¨èƒæ¨¡å‹ï¼šæ”»å‡»è€…åè°ƒåˆ†å¸ƒå„åœ°çš„ä¸»æœºï¼Œå‘å•ä¸ªå—å®³è€…å‘é€éæ³•çš„æœåŠ¡è¯·æ±‚\nã€€å‡è®¾DDoSæ”»å‡»çš„ç‰¹å¾æ˜¯å¤§é‡ä¸»æœºæµé‡æ±‡èšåˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªå—å®³è€…ï¼Œåœ¨å­˜åœ¨æ¶æ„æ´»åŠ¨çš„æƒ…å†µä¸‹ï¼ŒæºIPåœ°å€å’Œç›®çš„IPåœ°å€çš„åˆ†å¸ƒå¾€å¾€åç¦»åˆæ³•æ¨¡å¼ã€‚\nã€€ä¼°è®¡è¾“å…¥æ•°æ®åŒ…æµçš„è¿ç»­åˆ†åŒº(è§‚å¯Ÿçª—å£)çš„IPåœ°å€çš„ç†µï¼Œåœ¨æ¯ä¸ªè§‚å¯Ÿçª—å£çš„ç»“å°¾ï¼Œç”¨æµé‡è¡¨å¾å•å…ƒè¯»å–ç†µå€¼ä»¥ç”Ÿæˆåˆæ³•çš„æµé‡æ¨¡å‹(å³ä¸¤ä¸ªç‰¹å¾æŒ‡æ•°ï¼šEWMAå’ŒEWMMD)ï¼›å¼‚å¸¸æ£€æµ‹å•å…ƒæ ¹æ®æ¨¡å‹è®¡ç®—2ä¸ªå€¼ï¼Œåˆ¤æ–­æ˜¯å¦å‘ç”ŸDDoSæ”»å‡»ï¼Œå¦‚æœå‘ç”ŸDDoSæ”»å‡»åˆ™å‘å‡ºè­¦æŠ¥ã€‚\nå›¾2 DDOSæ”»å‡»æ£€æµ‹æ¨¡å‹:\r\r ä¸‰ã€å®ç° 1 ç†µä¼°è®¡æ¨¡å— ç†µçš„æ¨å¯¼ ã€€è®¾Xä¸ºæ¯ä¸ªçª—å£ä¸­çš„å…¨éƒ¨IPåœ°å€ï¼Œå…±è®¡mä¸ªï¼ŒNç§ï¼Œåˆ™ï¼š\nå›¾3 mä¸ªIPåœ°å€çš„ç†µè®¡ç®—:\r\r ã€€å½“mèƒ½å¤Ÿå……åˆ†ä»£è¡¨å½“å‰æºã€ç›®çš„IPåœ°å€çš„åˆ†å¸ƒæ—¶ï¼Œå‘ç”Ÿæ”»å‡»æ—¶ï¼ŒæºIPåœ°å€çš„ç†µéšå…¶é¢‘æ•°çš„å¢åŠ è€Œå¢å¤§ï¼Œç›®çš„IPåœ°å€çš„ç†µéšå…¶é¢‘æ•°çš„å¢åŠ è€Œé™ä½ã€‚\nã€€må€¼å¢å¤§ï¼Œåˆ™æ¯æ¬¡æµ‹é‡éœ€è¦æ¥æ”¶æ›´å¤šçš„æ•°æ®åŒ…ï¼Œä»è€Œå¢åŠ æ”»å‡»æ£€æµ‹å»¶è¿Ÿï¼›må€¼å‡å°ï¼Œåˆ™æ— æ³•åŒºåˆ†ä¸æ¶æ„æµé‡ç›¸å…³çš„åˆ†å¸ƒå˜åŒ–ä¸åˆæ³•æµé‡çš„çŸ­æœŸæ³¢åŠ¨ã€‚\nç†µä¼°è®¡çš„å®ç° å›¾4 IPåœ°å€çš„ç†µ:\r\r ã€€å¾—åˆ°çš„ç†µè®¡ç®—å¼å¯¹äºå¯ç¼–ç¨‹äº¤æ¢æœºæ¥è¯´è¾ƒä¸ºå¤æ‚ï¼Œæ–‡ç« åˆ©ç”¨è¿‘ä¼¼æ¥ç®€åŒ–è®¡ç®—è¿‡ç¨‹ï¼š\n ä½¿ç”¨Count-Sketchä¼°è®¡çª—å£ä¸­IPåœ°å€çš„é¢‘æ•° å°†mè®¾ç½®ä¸º2çš„ä¹˜æ–¹ï¼Œä»¥ä¾¿log2(m)æ˜¯æ•´æ•°ï¼Œå¹¶ä¸”ç†µè®¡ç®—å¼çš„ç¬¬äºŒé¡¹S/må¯ä»¥è¡¨ç¤ºä¸ºç§»ä½è®¡ç®— ç”¨ç†µçš„å¢é‡è®¡ç®—ä¸‹ä¸€ä¸ªçª—å£çš„ç†µå€¼ æå‰è®¡ç®—ä¸åŒé¢‘æ•°ä¸‹ç†µçš„å¢é‡å€¼ï¼Œæ„å»ºLPMæŸ¥æ‰¾è¡¨ï¼ŒKeyä¸ºé¢‘æ•°  å›¾5 ç†µä¼°è®¡æµæ°´çº¿:\r\r Count Sketchæ•°æ®ç»“æ„ï¼šdä¸ªå¯„å­˜å™¨(æ·±åº¦)ï¼Œå…±wä¸ªæ§½(å®½åº¦)ï¼Œæ¯ä¸ªæ§½æ˜¯ä¸€ä¸ªIPåœ°å€çš„è®¡æ•°å™¨å’Œè¯¥IPæ‰€åœ¨çª—å£çš„ID\n  å“ˆå¸Œå‡½æ•°h_iå°†IPåœ°å€æ˜ å°„åˆ°ç¬¬iä¸ªå¯„å­˜å™¨çš„æ§½ä¸­\n  å“ˆå¸Œå‡½æ•°g_iç¡®å®šIPåœ°å€çš„è®¡æ•°å™¨æ˜¯é€’å¢è¿˜æ˜¯é€’å‡çš„ï¼Œå¤„ç†h_içš„IPåœ°å€å†²çª\n  å®šä¹‰äº†ä¸¤ä¸ªæ“ä½œï¼š\n Update(C;x)ï¼šè®¡æ•°å™¨çš„å€¼ï¼ˆå“ˆå¸Œh_iï¼‰åŠ ä¸Šå“ˆå¸Œg_içš„ç»“æœ Estimate(C,x)ï¼šxå‡ºç°çš„é¢‘ç‡è®¡æ•°çš„ä¼°è®¡å€¼ï¼Œdä¸ªå“ˆå¸Œg_iå’Œå“ˆå¸Œh_içš„ä¹˜ç§¯çš„ä¸­ä½æ•°ï¼Œæ­¤ä¸­ä½æ•°ä½œä¸ºé¢‘æ•°    å›¾6 Count-Sketchè®¡ç®—æµç¨‹:\ré¢‘æ•°ä¼°è®¡æ–¹æ³•\r\r å›¾7 ç†µå€¼ä¼°ç®—æ–¹æ³•:\r\r 2 æµé‡è¡¨å¾æ¨¡å— ã€€è®¡ç®—ä¸¤ä¸ªæŒ‡æ•°è¡¨å¾æµé‡ï¼š\n é›†ä¸­è¶‹åŠ¿æŒ‡æ•°Mnï¼šæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å€¼ï¼ˆEWMAï¼‰ åˆ†æ•£æŒ‡æ•°Dnï¼šæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å·®ï¼ˆEWMMDï¼‰  å›¾8 æŒ‡æ•°è®¡ç®—å…¬å¼:\r\r 3 å¼‚å¸¸æ£€æµ‹æ¨¡å— ã€€æˆç«‹ä¸‹å›¾ä¸­çš„ä¸€ä¸ªæ¡ä»¶ï¼Œå°±ä¼šè§¦å‘DDoSæ”»å‡»è­¦æŠ¥ï¼š\nå›¾9 å¼‚å¸¸æ£€æµ‹å…¬å¼:\r\r ã€€å…¶ä¸­kæ˜¯çµæ•åº¦ç³»æ•°ï¼Œkå€¼å¢åŠ ä¼šä½¿æ£€æµ‹æ¡ä»¶æ›´ä¸¥æ ¼ï¼Œä»¥è·å¾—æ›´é«˜çš„å‡†ç¡®æ€§ï¼›kå€¼é™ä½å¯èƒ½ä¼šå¢åŠ è¯¯æŠ¥ï¼Œä»è€Œæ‰©å¤§å¼‚å¸¸æ£€æµ‹çš„è¦†ç›–èŒƒå›´ã€‚\nå››ã€è¯„ä¼° 1 å®éªŒç¯å¢ƒ æ•°æ®é›†  åˆæ³•æµé‡ï¼šCAIDA Anonymized Internet Traces 2016 æ¶æ„æµé‡ï¼šCAIDA DDoS Attack 2007  P4å®ç°  ä¸ºæ¯ä¸ªSketchåˆ†é…ä¸€ä¸ª32ä½å¯„å­˜å™¨ï¼Œå¹¶ä¸ºå…¶å…³è”çš„è§‚å¯Ÿçª—å£æ ‡è¯†ç¬¦åˆ†é…ä¸€ä¸ª8ä½å¯„å­˜å™¨ã€‚ è€ƒè™‘åˆ°å…·æœ‰4ä¸ªå°æ•°ä½çš„å®šç‚¹è¡¨ç¤ºå½¢å¼ï¼Œæˆ‘ä»¬å°†Så’ŒHçš„ä¼°å€¼å­˜å‚¨åœ¨32ä½å¯„å­˜å™¨ä¸­ã€‚ å»ºç«‹LPMæŸ¥æ‰¾è¡¨ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæ¡ç›®çš„æœ€å¤§è¯¯å·®ä¸º2^(-4)ï¼Œæ€»å…±245ä¸ªTCAMæ¡ç›®ã€‚  å‚æ•°è®¾ç½® å›¾10 ç³»ç»Ÿå‚æ•°è®¾ç½®:\r\r 2 è¯„ä¼°ç»“æœ ã€€ç†µä¼°è®¡è¯¯å·®éšç€Sketchå®½åº¦çš„å¢åŠ è€Œå‡å°ï¼Œä½†æ˜¯è¿™ç§å‡å°éšç€å®½åº¦çš„å¢åŠ è€Œè¡°å‡å¹¶ç¨³å®šåœ¨æ¥è¿‘1ï¼…çš„æ°´å¹³ï¼›Sketchæ·±åº¦çš„å¢åŠ ä¼šå‡å°‘ç¢°æ’æ¦‚ç‡ï¼Œä½†å¢åŠ æ·±åº¦ä¼šå¯¼è‡´éœ€è¦å¯¹æ¯ä¸ªIPåœ°å€å¤„ç†æ›´å¤šçš„Hashå‡½æ•°ï¼Œå¢åŠ å€¼è¿ç®—çš„å¤æ‚æ€§ã€‚\nå›¾11 ç†µä¼°è®¡è¯¯å·®ä¸Sketchå®½åº¦å’Œæ·±åº¦çš„å…³ç³»:\r\r ã€€è¾ƒä½çš„çµæ•åº¦ç³»æ•°å€¼ä¼šæé«˜æ£€æµ‹é˜ˆå€¼ï¼Œä»è€Œå¯¼è‡´è¾ƒé«˜çš„æ£€æµ‹ç‡ï¼Œä½†ä¼šé€ æˆé«˜è¯¯æŠ¥ç‡ã€‚ç”Ÿäº§ç½‘ç»œä¸­å…·æœ‰åŠ¨æ€æ€§ï¼Œå¯èƒ½éœ€è¦å®šæœŸè°ƒæ•´kå€¼ã€‚\nå›¾12 çµæ•åº¦ç³»æ•°å’ŒçœŸé˜³æ€§å‡é˜³æ€§çš„å…³ç³»:\r\r ã€€æ¶æ„æµé‡æ‰€å çš„æ¯”ä¾‹è¶Šé«˜ï¼Œæ£€æµ‹å‡†ç¡®ç‡å°†è¶Šæ¥è¶Šé«˜ï¼ˆè¶…è¿‡90ï¼…ï¼‰ï¼Œè¯¥ç²¾åº¦å—è®¡æ•°è‰å›¾å®½åº¦çš„å½±å“å¾ˆå¤§ã€‚\nå›¾13 æ¶æ„æµé‡å æ¯”å’Œæ£€æµ‹å‡†ç¡®ç‡çš„å…³ç³»:\r\r ã€€ä¸sFlowå¯¹æ¯”ï¼Œæ–‡ç« é¢˜å‡ºçš„æ–¹æ³•å‡æ¯”sFlow(é‡‡æ ·æ¯”ä¸º1:100å’Œ1:1000)å¥½ã€‚\nå›¾14 ä¸sFlowå¯¹æ¯”:\r\r ","description":"åœ¨å—åˆ°DDoSæ”»å‡»æ—¶ï¼ŒæºIPåœ°å€å’Œç›®æ ‡IPåœ°å€çš„åˆ†å¸ƒå¾€å¾€ä¼šåç¦»åˆæ³•æ¨¡å¼ï¼Œæœ¬æ–‡å‚è€ƒå¼‚å¸¸æ£€æµ‹å¸¸ç”¨ç‰¹å¾ï¼Œç”±mä¸ªæ•°æ®åŒ…å†…çš„æºIPå’Œç›®çš„IPçš„ç†µè®¡ç®—æºIPå’Œç›®çš„IPçš„é›†ä¸­è¶‹åŠ¿æŒ‡æ•°å’Œåˆ†æ•£æŒ‡æ•°ï¼Œåˆ©ç”¨ä¸¤ä¸ªæŒ‡æ•°åœ¨å¯ç¼–ç¨‹æ•°æ®å¹³é¢è¿›è¡ŒDDoSæ”»å‡»æ£€æµ‹ã€‚","id":9,"section":"posts","tags":["P4"],"title":"è®ºæ–‡é˜…è¯»ï¼šå¸è½½å®æ—¶DDoSæ”»å‡»æ£€æµ‹åˆ°å¯ç¼–ç¨‹æ•°æ®å¹³é¢","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E5%8D%B8%E8%BD%BD%E5%AE%9E%E6%97%B6ddos%E6%94%BB%E5%87%BB%E6%A3%80%E6%B5%8B%E5%88%B0%E5%8F%AF%E7%BC%96%E7%A8%8B%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šMachine-learning-assisted DDoS attack detection with P4 language\nã€€ä¼šè®®ä¿¡æ¯ï¼š2020 IEEE International Conference on Communications (ICC). IEEE, 2020: 1-6.\nã€€æˆæœï¼šå¼€å‘äº†ç”¨äºSDNç½‘ç»œçš„æœºå™¨å­¦ä¹ è¾…åŠ©DDoSæ”»å‡»æ£€æµ‹æ¡†æ¶ï¼Œåˆ©ç”¨P4å¯ç¼–ç¨‹æ•°æ®å¹³é¢å®Œæˆç‰¹å¾æå–ï¼Œå‡å°‘æ£€æµ‹å»¶è¿Ÿã€‚\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šåœ¨SDNæ§åˆ¶å™¨ä¸Šè¿›è¡Œç‰¹å¾æå–é€ æˆå»¶è¿Ÿè¾ƒå¤§ã€‚\nã€€æœ¬æ–‡å·¥ä½œï¼šåˆ©ç”¨P4å¯ç¼–ç¨‹æ•°æ®å¹³é¢å®Œæˆç‰¹å¾æå–ï¼Œå®šæœŸå‘æ§åˆ¶å™¨æŠ¥å‘Šç‰¹å¾ï¼Œåœ¨æ§åˆ¶å™¨ä¸Šåˆ©ç”¨ä¸‰ç§æœºå™¨å­¦ä¹ ç®—æ³•å¯¹ç‰¹å¾è¿›è¡ŒäºŒåˆ†ç±»ï¼Œåšå‡ºå†³ç­–ï¼Œå®æ—¶æ£€æµ‹DDoSæ”»å‡»ï¼ˆä»¥TCP Floodæ”»å‡»ä¸ºä¾‹ï¼‰ã€‚\nä¸€ã€èƒŒæ™¯ ã€€è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰ä¸ä¼ ç»Ÿç½‘ç»œç›¸æ¯”å…·æœ‰è®¸å¤šä¼˜åŠ¿ï¼Œå¦‚è‡ªåŠ¨åŒ–ç½‘ç»œæ§åˆ¶ã€æœ‰æ•ˆèµ„æºåˆ©ç”¨ã€çµæ´»å’Œå¿«é€Ÿçš„é‡é…ç½®ç­‰ã€‚ç”±äºSDNæ§åˆ¶å™¨çš„é›†ä¸­å¼ç‰¹ç‚¹ï¼Œå®ƒå®¹æ˜“å—åˆ°DDoSæ”»å‡»ï¼Œå‘é€éæ³•æ•°æ®åŒ…ä¼šä½¿æ§åˆ¶å™¨è¶…è½½ï¼Œä»è€ŒæŠ‘åˆ¶æ•°æ®å¹³é¢è®¾å¤‡çš„æ­£å¸¸è¿è¡Œï¼Œå³ä½¿DDoSæ”»å‡»çš„ç›®æ ‡ä¸æ˜¯SDNæ§åˆ¶å™¨ï¼Œç”±äºSDNäº¤æ¢æœºå®ç°çš„é»˜è®¤è½¬å‘ç­–ç•¥ï¼Œå®ƒä¹Ÿå¯èƒ½è¢«æ·¹æ²¡ã€‚\nã€€DDoSæ”»å‡»æ£€æµ‹ï¼ˆDADï¼‰éœ€è¦è‡ªåŠ¨å­¦ä¹ æµé‡ä¸­çš„éšè—æ¨¡å¼å¹¶æ£€æµ‹å¼‚å¸¸ï¼Œé€šå¸¸ä¾èµ–äºæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰ã€‚ å·²æœ‰çš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ä½¿ç”¨æ”¯æŒå‘é‡æœºåˆ†ç±»å™¨ï¼ˆSVMï¼‰ã€ä½¿ç”¨string kernelæ”¹è¿›SVMåˆ†ç±»ã€æ·±åº¦é€’å½’ç¥ç»ç½‘ç»œã€æ”¹è¿›k-è¿‘é‚»ç­‰æ–¹æ³•ã€‚åˆ©ç”¨çŠ¶æ€æ•°æ®å¹³é¢ååŠ©DDoSæ”»å‡»æ£€æµ‹æ˜¯æœ€è¿‘çš„ç ”ç©¶è¶‹åŠ¿ã€‚\nã€€é’ˆå¯¹ç½‘ç»œ/ä¼ è¾“çº§çš„DDoSé˜²å¾¡æœºåˆ¶ï¼šåŸºäºæºã€åŸºäºç›®æ ‡ã€åŸºäºç½‘ç»œã€‚\nTCP Flood ã€€æ”»å‡»è€…ä¼ªè£…æˆå¤šä¸ªIPåœ°å€å‘å—å®³è€…åŒæ—¶å‘é€å¤šä¸ªSYNè¯·æ±‚ï¼Œå—å®³è€…çš„ç³»ç»Ÿå‘é€ACKå“åº”ï¼Œç­‰å¾…SYN-ACKæ•°æ®åŒ…ï¼Œæ”»å‡»è€…ä¸å‘é€SYN-ACKæ•°æ®åŒ…ï¼Œå¯¼è‡´å—å®³è€…ä¸€ç›´ç­‰å¾…ï¼Œèµ„æºè¢«å¤§é‡æ¶ˆè€—ï¼Œç›´è‡³æ­»æœºï¼Œå¯¼è‡´å—å®³è€…æ— æ³•å“åº”å…¶å®ƒæ­£å¸¸ç”¨æˆ·çš„TCPè¿æ¥è¯·æ±‚ã€‚\nã€€æ”»å‡»è€…éœ€è¦æ³¨æ„ï¼Œä¼ªè£…çš„IPåœ°å€ä¸èƒ½å¤Ÿå¯¹æ”¶åˆ°çš„SYN-ACKæ•°æ®åŒ…è¿›è¡Œå“åº”ã€‚\n é˜²å¾¡æ‰‹æ®µå‚è€ƒ1ï¼šhttps://www.cnblogs.com/sunsky303/p/11811097.html\n å‡å°‘SYN-ACKæ•°æ®åŒ…çš„é‡å‘æ¬¡æ•°ï¼› ä½¿ç”¨SYN Cookieï¼› å¢åŠ backlogé˜Ÿåˆ—ï¼› é™åˆ¶SYNå¹¶å‘æ•°ã€‚  SYN FloodåŸç†é˜²å¾¡æ‰‹æ®µå‚è€ƒ2ï¼šhttps://blog.csdn.net/shixin_0125/article/details/78829069\nã€€TCB(TCP ä¼ è¾“æ§åˆ¶å—)æ˜¯ä¸€ç§åŒ…å«ä¸€ä¸ªè¿æ¥æ‰€æœ‰ä¿¡æ¯çš„ä¼ è¾“åè®®æ•°æ®ç»“æ„(å®é™…ä¸Šåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­å®ƒæ˜¯ç”¨äºå¤„ç†è¿›ç«™(inbound)è¿æ¥è¯·æ±‚çš„ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¿å­˜é‚£äº›å¤„äºåŠå¼€æ”¾(half-open)çŠ¶æ€çš„TCPè¿æ¥é¡¹ç›®ï¼Œä»¥åŠå·²å»ºç«‹å®Œæ•´è¿æ¥ä½†ä»æœªç”±åº”ç”¨ç¨‹åºé€šè¿‡accept()è°ƒç”¨æå–çš„é¡¹ç›®)ã€‚\nã€€ä¸€ä¸ªå•ä¸€çš„TCBæ‰€å å†…å­˜å¤§å°å–å†³äºè¿æ¥ä¸­æ‰€ç”¨çš„TCPé€‰é¡¹å’Œå…¶ä»–ä¸€äº›åŠŸèƒ½çš„å®ç°ã€‚é€šå¸¸ä¸€ä¸ªTCBè‡³å°‘280å­—èŠ‚ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸­å·²ç»è¶…è¿‡äº†1300å­—èŠ‚ã€‚TCPçš„SYN-RECEIVEDçŠ¶æ€ç”¨äºæŒ‡å‡ºè¿™ä¸ªè¿æ¥ä»…ä»…æ˜¯åŠå¼€è¿æ¥ï¼Œè¯·æ±‚æ˜¯å¦åˆæ³•ä»è¢«è´¨ç–‘ã€‚æ³¨æ„ï¼ŒTCBåˆ†é…ç©ºé—´çš„å¤§å°å–å†³äºæ¥æ”¶çš„SYNåŒ…ã€‚\nã€€åˆ°è¾¾çš„SYNåŒ…å°†è¢«åˆ†é…è¿‡å¤šçš„TCBè€Œå¯¼è‡´ä¸»æœºçš„å†…æ ¸å†…å­˜è¢«è€—å°½ã€‚ä¸ºäº†é¿å…è¿™ç§å†…å­˜è€—å°½ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ç»™ç›‘å¬æ¥å£å…³è”äº†ä¸€ä¸ª\u0026quot;backlog\u0026quot;é˜Ÿåˆ—å‚æ•°ï¼Œå®ƒåŒæ—¶ç»´æŠ¤è¿æ¥çš„TCBä¸Šé™æ•°é‡å’ŒSYN-RECEIVEDçŠ¶æ€ã€‚å°½ç®¡è¿™ç§æ–¹æ¡ˆä½¿ä¸»æœºçš„å¯ç”¨å†…å­˜å…é­æ”»å‡»ï¼Œä½†æ˜¯backlogé˜Ÿåˆ—æœ¬èº«å°±å¸¦æ¥äº†ä¸€ä¸ª(å°çš„)å—æ”»å‡»æºã€‚å½“backlogä¸­æ²¡æœ‰ç©ºé—´æ—¶ï¼Œå°±ä¸å¯èƒ½å†å“åº”æ–°çš„è¿æ¥è¯·æ±‚ï¼Œé™¤éTCBèƒ½è¢«å›æ”¶æˆ–è€…ä»SYN-RECIEVEçŠ¶æ€ä¸­ç§»é™¤ã€‚\nã€€è¯•å›¾å‘é€è¶³å¤Ÿå¤šçš„SYNåŒ…è€Œè€—å°½backlogæ˜¯TCP SYNæ´ªæ³›çš„ç›®çš„ã€‚æ”»å‡»è€…åœ¨SYNåŒ…ä¸­åŠ å…¥æºIPåœ°å€ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´ä¸»æœºå°†å·²åˆ†é…çš„TCBä»SYN-RECEVIEDçŠ¶æ€é˜Ÿåˆ—ä¸­ç§»é™¤(å› ä¸ºä¸»æœºå°†å“åº”SYN-ACK)ã€‚å› ä¸ºTCPæ˜¯å¯é çš„ï¼Œç›®çš„ä¸»æœºåœ¨æ–­å¼€åŠå¼€è¿æ¥å¹¶åœ¨SYN-RECIEVEDé˜Ÿåˆ—ä¸­ç§»é™¤TCBä¹‹å‰å°†ç­‰å¾…ç›¸å½“é•¿çš„æ—¶é—´ã€‚åœ¨æ­¤æœŸé—´ï¼ŒæœåŠ¡å™¨å°†ä¸èƒ½å“åº”å…¶ä»–åº”ç”¨ç¨‹åºåˆæ³•çš„æ–°TCPè¿æ¥è¯·æ±‚ã€‚\n ã€€æ ¹æ®TCP FloodåŸç†ï¼ŒåŸºäºç›®æ ‡çš„é˜²å¾¡æ‰‹æ®µå¯ä»¥é‡‡ç”¨å‚è€ƒ1ä¸­çš„æ–¹æ³•ï¼Œå¦‚SYN Cookieï¼ŒåŸºäºç½‘ç»œçš„é˜²å¾¡æ–¹æ³•åŒ…æ‹¬è¿‡æ»¤ï¼ˆç”¨å¤„ä¸å¤§ï¼‰ã€é˜²ç«å¢™ä»£ç†ã€æ´»åŠ¨ç›‘è§†å™¨ã€‚\n é˜²ç«å¢™ä½œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†ï¼Œåœ¨é˜²ç«å¢™ä¸Šé…ç½®SYN Cookiesæˆ–SYNç¼“å­˜ï¼Œåªéœ€è¦é˜²ç«å¢™é¡¶ä½SYN Floodæ”»å‡»ã€‚ æ´»åŠ¨ç›‘è§†å™¨å¦‚æœå‘ç°SYNåŒ…æ¥æºäºå®ƒçŸ¥é“çš„æ”»å‡»è€…æºåœ°å€å°±ä¼šç«‹åˆ»å‘é€ä¼ªè£…RSTåŒ…ç»™æœåŠ¡å™¨ï¼Œé‡Šæ”¾SYNè¿æ¥ã€‚  äºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€æ–‡ç« é‡‡ç”¨åŸºäºç½‘ç»œçš„é˜²å¾¡æœºåˆ¶ï¼Œç»“åˆæœºå™¨å­¦ä¹ å’ŒP4æœ‰æ•ˆæ‰§è¡ŒDDoSæ”»å‡»ä¸­çš„TCP Floodæ£€æµ‹ã€‚æ­£ç¡®çš„æ”»å‡»æ£€æµ‹éœ€è¦è€—æ—¶ä¸”æ˜‚è´µçš„æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥ï¼Œéœ€è¦å‡è½»SDNæ§åˆ¶å™¨çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥æ–‡ç« ä½¿ç”¨P4å¯ç¼–ç¨‹æ•°æ®å¹³é¢è¿›è¡Œæ•°æ®åŒ…å¤„ç†ï¼Œå¹¶å°†DDoSæ”»å‡»æ£€æµ‹å»ºæ¨¡ä¸ºåŸºäºæœºå™¨å­¦ä¹ çš„åˆ†ç±»é—®é¢˜ã€‚æ–‡ç« è¯´ä»–ä»¬æ˜¯ç¬¬ä¸€ä¸ªå°†æœºå™¨å­¦ä¹ å’ŒP4æ•°æ®å¹³é¢ç»“åˆçš„å·¥ä½œã€‚\nä¸‰ã€å®ç° ã€€æ”»å‡»æ£€æµ‹ç³»ç»Ÿæ•´ä½“æ¡†æ¶å¦‚ä¸‹å›¾ã€‚\nå›¾1 æ•´ä½“æ¡†æ¶:\r\r æœºå™¨å­¦ä¹ æ£€æµ‹æ¨¡å— ã€€DDoSæ”»å‡»æ£€æµ‹æ¨¡å—å®šæœŸä»P4äº¤æ¢æœºæ¥æ”¶æµé‡ä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¿¡æ¯æ‰§è¡Œæ”»å‡»æ£€æµ‹ï¼Œå†³å®šæ˜¯å¦è½¬å‘æ•°æ®åŒ…ã€‚æ£€æµ‹æ¨¡å—å¯¹ç»™å®šæ—¶é—´é—´éš”å†…è§‚å¯Ÿåˆ°çš„æµé‡ï¼ˆå³ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åŒ…åˆ°è¾¾P4äº¤æ¢æœºï¼‰è¾“å‡ºå†³ç­–ï¼Œå³æ ‡ç­¾ä¸ºæ”»å‡»æˆ–æ— æ”»å‡»è¡¨ç¤ºåœ¨æ‰€è€ƒè™‘çš„æ—¶é—´èŒƒå›´å†…æ˜¯å¦å­˜åœ¨æ”»å‡»ã€‚\nã€€æ£€æµ‹æ¨¡å—ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\n ç‰¹å¾æå–å™¨ï¼› æœºå™¨å­¦ä¹ åˆ†ç±»å™¨ã€‚  ã€€ç‰¹å¾æå–å™¨ï¼šæå–5ä¸ªç‰¹å¾\n Len(t)ï¼šæ—¶é—´çª—å£ä¸­æ•°æ®åŒ…çš„å¹³å‡å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼› RTCP(t):TCPæ•°æ®åŒ…åœ¨æ—¶é—´çª—å£æ€»æ•°ä¸­æ‰€å çš„ç™¾åˆ†æ¯”ï¼› RUDP(t)ï¼šUDPæ•°æ®åŒ…åœ¨æ—¶é—´çª—å£æ€»æ•°ä¸­æ‰€å çš„ç™¾åˆ†æ¯”ï¼› RTU(t)ï¼šæ—¶é—´çª—å£ï¼ˆtï¼Œt + Tï¼‰ä¸­TCPå’ŒUDPæ•°æ®åŒ…ä¹‹é—´çš„æ¯”ç‡ã€‚ Flags(t)ï¼šå…·æœ‰æ´»åŠ¨SYNæ ‡å¿—çš„TCPæ•°æ®åŒ…åœ¨æ€»æ—¶é—´çª—å£ï¼ˆtï¼Œt + Tï¼‰ä¸­æ‰€å çš„ç™¾åˆ†æ¯”ã€‚  ã€€æœºå™¨å­¦ä¹ ç®—æ³•ï¼šäºŒåˆ†ç±»ï¼Œè¾“å‡º0è¡¨ç¤ºno attackï¼Œ1è¡¨ç¤ºTCP floodã€‚\n éšæœºæ£®æ—ï¼ˆRFï¼‰ï¼› æœ€è¿‘é‚»ï¼ˆKNNï¼‰ï¼› æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ã€‚  P4ç¨‹åº ã€€æµé‡ä¿¡æ¯åœ¨æ»‘åŠ¨çª—å£ï¼ˆæŒç»­æ—¶é—´ä¸ºTï¼‰çš„åŸºç¡€ä¸Šå®šæœŸï¼ˆæ¯Î´ç§’ï¼‰ä»P4äº¤æ¢æœºå‘é€åˆ°æ£€æµ‹æ¨¡å—ï¼Œæ¯ä¸ªçª—å£éƒ½åŒ…å«æœ€è¿‘Tç§’çš„ä¿¡æ¯ï¼Œç‹¬ç«‹äºå…¶ä»–çª—å£è¿›è¡Œï¼›ç„¶ååˆ©ç”¨åˆ†ç±»å¾—åˆ°çš„æ ‡ç­¾æ‰§è¡Œæ•°æ®åŒ…æ“ä½œï¼Œå¦‚ä¸¢å¼ƒã€‚\nã€€æ–‡ç« ä½¿ç”¨P4_14è¯­è¨€ã€‚\nã€€ç¨‹åºå®šä¹‰ä¸‰å±‚åè®®å’Œå››å±‚åè®®çš„æ•°æ®åŒ…å¤´éƒ¨ï¼›å®šä¹‰è‡ªå®šä¹‰å¤´éƒ¨ï¼ŒåŒ…æ‹¬switch_idå’Œ4ä¸ª2å­—èŠ‚çš„å­—æ®µï¼ŒæŠ¥å‘Šæ€»æ•°ã€TCPã€UDPã€TCP SYNæ•°æ®åŒ…çš„æ•°é‡ã€‚\nã€€ç¨‹åºå®šä¹‰4ä¸ªå¯„å­˜å™¨ï¼šå­˜å‚¨IPã€UDPã€TCPã€SYNæ•°æ®åŒ…æ•°é‡ã€‚\nã€€ç¨‹åºå®šä¹‰4å¼ Match-Action Tableï¼šm_ipã€m_transportã€m_synã€go_headerã€‚\nã€€å„ç±»å‹æ•°æ®åŒ…åˆ°æ¥æ—¶ï¼ŒåŒ¹é…å¯¹åº”çš„Table(å¦‚m_transport)ï¼Œè§¦å‘ç›¸åº”åŠ¨ä½œï¼Œæ›´æ–°å¯„å­˜å™¨ï¼ˆå¦‚udp_actionï¼‰çš„å€¼ï¼›\nã€€åœ¨æµé‡çª—å£çš„æ•°æ®åŒ…è®¡æ•°(meta.counter_tot)è¾¾åˆ°å…è®¸çš„æœ€å¤§æ•°æ®åŒ…æ•°æ—¶ï¼Œåº”ç”¨go_headerè¡¨ï¼Œå°†è‡ªå®šä¹‰å¤´éƒ¨æ’å…¥æ•°æ®åŒ…(åŠ¨ä½œä¸ºadd_int)ï¼Œå°†å¯„å­˜å™¨ä¸­çš„å€¼å’Œå’Œç»“æœæ•°æ®åŒ…å‘é€åˆ°æ£€æµ‹æ¨¡å—ï¼Œç„¶åå¯„å­˜å™¨å¤ä½(go_read_reset)ã€‚\nå›¾2 éƒ¨åˆ†P4ä»£ç :\r\r å››ã€è¯„ä¼° å®éªŒè®¾ç½® ã€€åœ¨å…·æœ‰8Ã—2 GHzå¤„ç†å™¨å’Œ8 GB RAMçš„æ¡Œé¢ä¸Šï¼Œä½¿ç”¨keraså’Œsklearnåº“ï¼Œå·²ç»ä½¿ç”¨åŸºäºPythonçš„è„šæœ¬å®ç°äº†MLç®—æ³•ã€‚\nã€€ä½¿ç”¨Spirent N4Uæµé‡ç”Ÿæˆå™¨æ”¶é›†ç”¨äºè®­ç»ƒå’Œæµ‹è¯•ç®—æ³•çš„æµé‡æ•°æ®ã€‚\nã€€ç”Ÿæˆäº†30åˆ†é’Ÿçš„æµé‡ï¼Œå…¶ä¸­å°†10ã€50æˆ–100 kbit/sæ’å®šæ¯”ç‰¹ç‡çš„TCP Floodæ”»å‡»æµæ·»åŠ åˆ°10 Mbit/sçš„å¸¸è§„åå°æµé‡ä¸­ã€‚æ”»å‡»çš„å¹³å‡æŒç»­æ—¶é—´ä¸º10ç§’ï¼Œåå°æµé‡ç”±ä¸‰ç§ä¸åŒçš„æµé‡ç»„æˆï¼š4.5 Mbit/s TCPæµé‡ï¼Œ3.8 Mbit/s UDPæµé‡å’Œ1.7 Mbit/s IPæµé‡ï¼Œæ•°æ®åŒ…é•¿åº¦éµå¾ªiMixåˆ†é…ã€‚å¯¹æ‰€æœ‰æŒç»­æ—¶é—´ä¸ºTçš„çª—å£ï¼Œå¹¶ä»…åœ¨å…¶åŒ…å«è‡³å°‘ä¸€ä¸ªå±äºTCPæ³›æ´ªæ”»å‡»çš„æ•°æ®åŒ…æ—¶æ‰åˆ†é…æ ‡ç­¾1ï¼šTCP floodï¼Œå¦åˆ™ä¸ºè¯¥çª—å£åˆ†é…æ ‡ç­¾0ï¼šnoattackã€‚\nã€€å®éªŒè°ƒæ•´äº†ä¸¤ä¸ªè¿ç»­çª—å£ä¹‹é—´çš„è·ç¦»ï¼Œå³å‚æ•°Î´ï¼Œå› æ­¤æ•°æ®é›†ä¸­çª—å£çš„æ€»æ•°å–å†³äºÎ´çš„å€¼ï¼ŒÎ´=1sæ—¶ï¼Œçª—å£æ€»æ•°ä¸º1800ï¼ŒÎ´=0.05sæ—¶ï¼Œçª—å£æ€»æ•°ä¸º36000ã€‚å¯¹äºæ¯å¯¹(Tï¼ŒÎ´)éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œç”¨äºè®­ç»ƒå’Œæµ‹è¯•ç®—æ³•ã€‚\nè¡¨1 æ•°æ®é›†æµé‡å‚æ•°:\r\r æœºå™¨å­¦ä¹ ç®—æ³•æ€§èƒ½è¯„ä¼° ã€€å¯¹äºæ‰€æœ‰æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œé‡‡ç”¨kå€äº¤å‰éªŒè¯(k=5)ï¼Œè®¡ç®—å¹³å‡åˆ†ç±»ç²¾åº¦ï¼Œå¹¶è¿›è¡Œè¶…å‚æ•°é€‰æ‹©(SVMä¸­çš„kernelã€RFä¸­çš„æ ‘æ•°ã€KNNä¸­çš„é‚»å±…æ•°)ã€‚\nã€€è¯„ä¼°æŒ‡æ ‡ï¼š\n åˆ†ç±»ç²¾åº¦ ç®—æ³•å¤æ‚åº¦ï¼šè®­ç»ƒæŒç»­æ—¶é—´å’Œé¢„æµ‹æ—¶é—´  çª—å£è·ç¦»Î´çš„å½±å“ ã€€å›ºå®šT=1sï¼Œé€æ¸å¢åŠ Î´å€¼ï¼Œè§‚å¯Ÿåˆ†ç±»ç²¾åº¦ï¼ˆaï¼‰å’Œç®—æ³•å¤æ‚åº¦ï¼ˆbã€cï¼‰\nå›¾4 Tä¸å˜ï¼Œåˆ†ç±»ç²¾åº¦å’Œç®—æ³•å¤æ‚åº¦ç»“æœ:\r\r  (a)ï¼šåˆ†ç±»ç²¾åº¦ä¸Šï¼ŒRFåˆ†ç±»å™¨ \u0026gt; SVMåˆ†ç±»å™¨ \u0026gt; KNNåˆ†ç±»å™¨ï¼›å¯¹äºæ‰€æœ‰åˆ†ç±»å™¨ï¼Œéšç€Î´å€¼å¢åŠ ï¼Œåˆ†ç±»ç²¾åº¦é™ä½ï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®é›†è¾ƒå°ã€‚ (b)ï¼šåœ¨è®­ç»ƒå’Œæµ‹è¯•æ€»æ—¶é—´ï¼ˆäº¤å‰éªŒè¯æ—¶é—´ï¼‰ä¸Šï¼Œå®ƒéšÎ´çš„å¢åŠ è€Œå‡å°‘ï¼Œå…¶ä¸­RFçš„é™å¹…æœ€å°ï¼Œå¹¶ä¸”äº¤å‰éªŒè¯æ—¶é—´æœ€çŸ­ã€‚ (c)ï¼šæµ‹è¯•æ—¶é—´ä¸Šï¼ŒSVMåœ¨Î´â‰¥0.1æ—¶æµ‹è¯•æ—¶é—´æœ€çŸ­ï¼Œè€ŒÎ´å€¼ä¸æ˜¾è‘—å½±å“RFå’ŒKNNçš„æµ‹è¯•æ—¶é—´ã€‚  ã€€ç»¼åˆæ¥çœ‹ï¼Œéšæœºæ£®æ—åˆ†ç±»å™¨ï¼ˆRFï¼‰å’Œæ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰éƒ½æ˜¯DDoSæ”»å‡»æ£€æµ‹çš„å¤‡é€‰ç®—æ³•ï¼ŒRFçš„ç²¾åº¦æ›´é«˜ï¼ŒSVMçš„ç®—æ³•å¤æ‚åº¦æ›´ä½ã€‚\nçª—å£æŒç»­æ—¶é—´Tçš„å½±å“ ã€€å›ºå®šÎ´=0.2sï¼Œé€æ¸å¢åŠ Tå€¼ã€‚\nã€€åˆ†ç±»ç²¾åº¦ä¸Šï¼ŒRFåˆ†ç±»å™¨ \u0026gt; SVMåˆ†ç±»å™¨ \u0026gt; KNNåˆ†ç±»å™¨ï¼›å¯¹äºæ‰€æœ‰åˆ†ç±»å™¨ï¼Œéšç€Tå€¼å¢åŠ ï¼Œåˆ†ç±»ç²¾åº¦é™ä½ï¼Œæ˜¯å› ä¸ºçª—å£æŒç»­æ—¶é—´ç›¸å¯¹äºæ”»å‡»æ¥è¯´è¿‡å¤§ï¼Œä¸å¸¸è§„èƒŒæ™¯æµé‡ç›¸æ¯”ï¼Œçª—å£ä¸­å­˜åœ¨çš„æ”»å‡»æ•°æ®åŒ…æ•°é‡è¾ƒå°‘ï¼Œè¿™ä½¿å¾—è¯†åˆ«æ”»å‡»ç‰¹å¾æ›´åŠ å›°éš¾ã€‚\nå›¾5 Î´ä¸å˜ï¼Œåˆ†ç±»ç²¾åº¦:\r\r P4äº¤æ¢æœºä¸­å®ç°DDoSæ”»å‡»æ£€æµ‹ ã€€å‡è®¾å·²ç»éƒ¨ç½²äº†æœ€åˆé€‚çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œè¯„ä¼°åœ¨æ•°æ®å¹³é¢è¿›è¡Œç‰¹å¾æå–å¼•å…¥çš„å»¶è¿Ÿå½±å“ã€‚è€ƒè™‘3ç§P4äº¤æ¢æœºå‘åˆ†ç±»å™¨æä¾›æµé‡ä¿¡æ¯çš„æƒ…å†µï¼š\n aï¼šå‘é€æ•°æ®åŒ…é•œåƒåˆ°åˆ†ç±»å™¨ bï¼šå‘é€æ•°æ®åŒ…å¤´éƒ¨åˆ°åˆ†ç±»å™¨ cï¼šä»å¤´éƒ¨æå–ä¿¡æ¯å­˜å…¥å…ƒæ•°æ®ï¼Œå°†å…ƒæ•°æ®å‘é€åˆ°åˆ†ç±»å™¨  ç¡®å®šä¸‰ç§å»¶è¿Ÿï¼š\n t1ï¼šP4äº¤æ¢æœºå¤„ç†æ•°æ®åŒ…çš„æ—¶é—´ï¼Œå¹¶å°†æ•°æ®åŒ…å‘é€åˆ°æ”»å‡»æ£€æµ‹æ¨¡å—çš„æ—¶é—´ï¼› t2ï¼šåœ¨æ”»å‡»æ£€æµ‹æ¨¡å—ä¸­æå–çª—å£ç‰¹å¾æ‰€éœ€æ—¶é—´ï¼› t3ï¼šåˆ†ç±»å™¨åˆ†ç±»æ—¶é—´ã€‚  ã€€åˆ†ç±»å™¨é€‰æ‹©RFå’ŒSVMç®—æ³•ï¼Œå¯¹ä¸¤ç§ç®—æ³•è¿›è¡Œæ¨¡å‹é€‰æ‹©ï¼ŒRFé‡‡ç”¨10ç§ä¸åŒçš„æ ‘å’ŒåŸºäºGini impurityçš„åˆ†å‰²æ ‡å‡†ï¼ŒSVMåˆ†ç±»å™¨é‡‡ç”¨åŸºäºRadialçš„å‡½æ•°å†…æ ¸ã€‚\nã€€åœ¨T=1sï¼ŒÎ´=0.2sçš„å‚æ•°ä¸‹ï¼Œä½¿ç”¨åœ¨Linux Boxä¸Šè¿è¡ŒBMV2ï¼Œåœ¨Intel Xeon CPU E5-2620 v2 @ 2.10GHzï¼ŒRAM 16GBå’Œ10Gä»¥å¤ªç½‘å…‰æ¥å£æ¥è¯„ä¼°P4äº¤æ¢æœºå¼•å…¥çš„å»¶è¿Ÿï¼Œå¹¶ä½¿ç”¨Spirent N4U Traffic Generatorå’Œåˆ†æä»ªè¿›è¡Œæµ‹é‡ã€‚å¹¶æŒ‰è¡¨1æ‰€ç¤ºæ³¨å…¥æµé‡é…ç½®æ–‡ä»¶ã€‚\nã€€å¾—åˆ°çš„ç»“æœå¦‚è¡¨2ã€‚\nè¡¨2 ä¸åŒæƒ…å†µä¸‹çš„è€—æ—¶:\r\r ã€€P4äº¤æ¢æœºæå–ç‰¹å¾å¹¶å¤„ç†æ•°æ®åŒ…å¤§æ¦‚åªéœ€è¦110Î¼sï¼Œè€Œåœ¨å¤–éƒ¨ç‰¹å¾æå–æ¨¡å—ä¸­æå–ç‰¹å¾éœ€è¦14-16sï¼Œåœ¨äº¤æ¢æœºä¸Šæ‰€éœ€çš„é¢å¤–æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œè€Œåˆ†ç±»æ—¶é—´å–å†³äºæ‰€é€‰ç”¨çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚\nå‚è€ƒèµ„æ–™ Spirent N4Uï¼šhttps://www.spirent.com/products/testcenter-ethernet-ip-cloud-test\n","description":"åˆ©ç”¨P4å’Œæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œä»¥TCP Floodä¸ºä¾‹ï¼ŒåŸºäºç½‘ç»œè¿›è¡ŒDDoSæ”»å‡»æ£€æµ‹","id":10,"section":"posts","tags":["P4"],"title":"è®ºæ–‡é˜…è¯»ï¼šåŸºäºP4çš„æœºå™¨å­¦ä¹ è¾…åŠ©DDoSæ”»å‡»æ£€æµ‹","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E5%9F%BA%E4%BA%8Ep4%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%BE%85%E5%8A%A9ddos%E6%94%BB%E5%87%BB%E6%A3%80%E6%B5%8B/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šP4DAD: Securing Duplicate Address Detection Using P4\nã€€ä¼šè®®ä¿¡æ¯ï¼š2020 IEEE International Conference on Communications (ICC). IEEE, 2020: 1-7.\nã€€æˆæœï¼šæå‡ºäº†P4DADï¼Œæ˜¯ä¸€ç§è½»é‡çº§ï¼Œå¯éƒ¨ç½²ï¼Œå¥å£®ï¼Œå®‰å…¨çš„DADæœºåˆ¶ã€‚é€šè¿‡å¼•å…¥P4ï¼ŒP4DADæ— éœ€ä¿®æ”¹NDPæˆ–ä¸»æœºå †æ ˆå³å¯ä¿æŠ¤ç½‘ç»œä¸­çš„NDPæ¶ˆæ¯ã€‚\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šè½»é‡ã€éƒ¨ç½²éš¾æ˜“ç¨‹åº¦ã€å¥å£®æ€§ã€å®‰å…¨æ€§ä¸èƒ½å…¼é¡¾ã€‚\nã€€æœ¬æ–‡å·¥ä½œï¼šæå‡ºP4DADçš„å®‰å…¨é‡å¤åœ°å€æ£€æµ‹æœºåˆ¶ï¼Œå¹¶åœ¨bmv2ä¸Šå®ç°P4DADåŸå‹ï¼Œå¹¶ä»åŠŸèƒ½ã€æ€§èƒ½ã€å¯æ‰©å±•æ€§ä¸‰æ–¹é¢è¿›è¡Œè¯„ä¼°ã€‚\nä¸€ã€èƒŒæ™¯ 1.NDP(Neighbor Discovery Protocol) ã€€ä»…åšç®€è¦ä»‹ç»ã€‚\n æ¥æºï¼šRFC4861\nå‚è€ƒï¼šhttps://cshihong.github.io/2018/01/29/IPv6%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AE/\n NDPç®€ä»‹ ã€€é‚»å±…å‘ç°åè®®ï¼Œç”¨äºIPv6ï¼Œè´Ÿè´£åœ¨é“¾è·¯ä¸Šå‘ç°å…¶ä»–èŠ‚ç‚¹å’Œç›¸åº”çš„IPåœ°å€ï¼Œå¹¶ç¡®å®šå¯ç”¨è·¯ç”±å’Œç»´æŠ¤å…³äºå¯ç”¨è·¯å¾„å’Œå…¶ä»–æ´»åŠ¨èŠ‚ç‚¹çš„ä¿¡æ¯å¯è¾¾æ€§ã€‚\nã€€å’ŒARPçš„åŠŸèƒ½ç›¸ä¼¼ï¼Œåœ¨IPv6ä¸­é€šè¿‡NDPè·å¾—ç›®æ ‡ä¸»æœºçš„é“¾è·¯å±‚åœ°å€ã€‚NDPåŸºäºICMPv6å®ç°ï¼Œä»¥å¤ªç½‘åè®®ç±»å‹ä¸º0x86DDï¼Œå³IPv6æŠ¥æ–‡ï¼Œä¸‹ä¸€ä¸ªæŠ¥å¤´å­—æ®µå€¼ä¸º58ï¼Œè¡¨ç¤ºICMPv6æŠ¥æ–‡ï¼ŒNDPçš„æ‰€æœ‰æŠ¥æ–‡éƒ½å°è£…åœ¨ICMPv6æŠ¥æ–‡ä¸­ã€‚\nã€€åœ°å€è§£æè¿‡ç¨‹ä¸­ä½¿ç”¨äº†ä¸¤ç§ICMPv6æŠ¥æ–‡ï¼š\n é‚»å±…è¯·æ±‚æŠ¥æ–‡NSï¼ˆNeighbor Solicitationï¼‰ï¼šType=135ï¼ŒCode=0ï¼Œç±»ä¼¼äºARPè¯·æ±‚æŠ¥æ–‡ï¼› é‚»å±…é€šå‘ŠæŠ¥æ–‡NAï¼ˆNeighbor Advertisementï¼‰ï¼šType=136ï¼ŒCode=0ï¼Œç±»ä¼¼äºARPåº”ç­”æŠ¥æ–‡ã€‚  å›¾1 NDPæµç¨‹ :\r\r ã€€ä¸»æœºAå‘ä¸»æœºBå‘é€æŠ¥æ–‡ä¹‹å‰å¿…é¡»çŸ¥é“Bçš„é“¾è·¯å±‚åœ°å€ï¼Œæ‰€ä»¥ä¸»æœºAå‘é€NSæŠ¥æ–‡ï¼Œä¸»æœºAçš„é“¾è·¯å±‚åœ°å€æ”¾åœ¨Optionså­—æ®µä¸­ï¼›ä¸»æœºBæ”¶åˆ°NSæŠ¥æ–‡ä»¥åï¼Œå›åº”NAæŠ¥æ–‡ï¼Œä¸»æœºBçš„é“¾è·¯å±‚åœ°å€è¢«æ”¾åœ¨Optionså­—æ®µä¸­ã€‚\né‡å¤åœ°å€æ£€æµ‹(Duplicate Address Detect)  å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/110407399\n ã€€å½“èŠ‚ç‚¹è·å–åˆ°ä¸€ä¸ªIPv6åœ°å€åï¼Œéœ€è¦ä½¿ç”¨é‡å¤åœ°å€æ£€æµ‹åŠŸèƒ½ç¡®å®šè¯¥åœ°å€æ˜¯å¦å·²è¢«å…¶ä»–èŠ‚ç‚¹ä½¿ç”¨ï¼ˆä¸IPv4çš„Gratuitous ARPåŠŸèƒ½ç›¸ä¼¼ï¼‰ã€‚é€šè¿‡NSå’ŒNAå¯ä»¥å®ç°é‡å¤åœ°å€æ£€æµ‹ã€‚\n Gratuitous ARPï¼Œæ— æ•…ï¼ˆå…è´¹ï¼‰ARP\næ²¡æœ‰äººé—®è‡ªå·±çš„æƒ…å†µä¸‹ï¼Œæ— ç¼˜æ— æ•…è‡ªé—®è‡ªç­”ï¼Œæ˜¯è®¾å¤‡å‘é€çš„ä¸€ä¸ªå‘é€ç«¯IPåœ°å€å’Œç›®æ ‡IPåœ°å€éƒ½æ˜¯æœ¬è®¾å¤‡IPåœ°å€çš„ARP request/replyæŠ¥æ–‡ã€‚\nå¦‚æœARP requestæ”¶åˆ°äº†ARP replyï¼Œè¯´æ˜ç½‘ç»œä¸­å­˜åœ¨å’Œè‡ªå·±IPåœ°å€ç›¸åŒçš„è®¾å¤‡ã€‚\nå‚è€ƒï¼šhttps://zhiliao.h3c.com/Theme/details/27896\n ã€€åœ¨è¿›è¡ŒDADæ£€æµ‹æ—¶ï¼Œä¸€ä¸ªIPv6å•æ’­åœ°å€åœ¨åˆ†é…ç»™ä¸€ä¸ªæ¥å£ä¹‹åä¸”é€šè¿‡é‡å¤åœ°å€æ£€æµ‹ä¹‹å‰ç§°ä¸ºè¯•éªŒåœ°å€ï¼ˆTentative Addressï¼‰ã€‚æ­¤æ—¶è¯¥æ¥å£ä¸èƒ½ä½¿ç”¨è¿™ä¸ªè¯•éªŒåœ°å€è¿›è¡Œå•æ’­é€šä¿¡ï¼Œä½†æ˜¯ä»ç„¶ä¼šåŠ å…¥ä¸¤ä¸ªç»„æ’­ç»„ï¼šALL-NODESç»„æ’­ç»„å’Œå®éªŒåœ°å€æ‰€å¯¹åº”çš„Solicited-Nodeç»„æ’­ç»„ã€‚\nã€€IPv6é‡å¤åœ°å€æ£€æµ‹æŠ€æœ¯å’ŒIPv4ä¸­çš„Gratuitous ARPç±»ä¼¼ï¼šèŠ‚ç‚¹å‘ä¸€ä¸ªè‡ªå·±å°†ä½¿ç”¨çš„è¯•éªŒåœ°å€æ‰€åœ¨çš„Solicited-Nodeç»„æ’­ç»„å‘é€ä¸€ä¸ªä»¥è¯¥å®éªŒåœ°å€ä¸ºè¯·æ±‚çš„ç›®æ ‡åœ°å€çš„NSæŠ¥æ–‡ï¼Œå¦‚æœæ”¶åˆ°èŠ‚ç‚¹å›åº”çš„NAæŠ¥æ–‡ï¼Œå°±è¯æ˜è¯¥åœ°å€å·²è¢«ç½‘ç»œä¸Šä½¿ç”¨ï¼ŒèŠ‚ç‚¹å°†ä¸èƒ½ä½¿ç”¨è¯¥å®éªŒåœ°å€é€šè®¯ã€‚\nå›¾2 DADç¤ºä¾‹ :\r\r ã€€PC1çš„IPv6åœ°å€2000::1ä¸ºæ–°é…ç½®åœ°å€ï¼Œå³2000::1ä¸ºPC1çš„è¯•éªŒåœ°å€ã€‚PC1å‘2000::1çš„Solicited-Nodeç»„æ’­ç»„å‘é€ä¸€ä¸ªä»¥2000::1ä¸ºè¯·æ±‚çš„ç›®æ ‡åœ°å€çš„NSæŠ¥æ–‡è¿›è¡Œé‡å¤åœ°å€æ£€æµ‹ï¼Œç”±äº2000::1å¹¶æœªæ­£å¼æŒ‡å®šï¼Œæ‰€ä»¥NSæŠ¥æ–‡çš„æºåœ°å€ä¸ºæœªæŒ‡å®šåœ°å€ã€‚å½“PC2æ”¶åˆ°è¯¥NSæŠ¥æ–‡åï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼š\n å¦‚æœPC2å‘ç°2000::1æ˜¯è‡ªèº«çš„ä¸€ä¸ªå®éªŒåœ°å€ï¼Œåˆ™PC2æ”¾å¼ƒä½¿ç”¨è¿™ä¸ªåœ°å€ä½œä¸ºæ¥å£åœ°å€ï¼Œå¹¶ä¸”ä¸ä¼šå‘é€NAæŠ¥æ–‡ã€‚ å¦‚æœPC2å‘ç°2000::1æ˜¯ä¸€ä¸ªå·²ç»æ­£å¸¸ä½¿ç”¨çš„åœ°å€ï¼Œé‚£ä¹ˆPC2ä¼šå‘è¯¥åœ°å€çš„ALL-NODESç»„æ’­ç»„å‘é€ä¸€ä¸ªNAæŠ¥æ–‡ï¼Œè¯¥æ¶ˆæ¯ä¸­ä¼šåŒ…å«2000::1ã€‚è¿™æ ·ï¼ŒPC1æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯åå°±ä¼šå‘ç°è‡ªèº«çš„å®éªŒåœ°å€æ˜¯é‡å¤çš„ï¼Œä»è€Œå¼ƒç”¨è¯¥åœ°å€ã€‚  å®‰å…¨å¨èƒ  å¼•ç”¨ï¼šhttps://www.secrss.com/articles/13813\n ã€€é‡å¤åœ°å€æ£€æµ‹æ”»å‡»ï¼šå½“ç›®æ ‡èŠ‚ç‚¹å‘FF02 :: 16æ‰€æœ‰èŠ‚ç‚¹å‘é€NSæ•°æ®åŒ…è¿›è¡Œé‡å¤åœ°å€æ£€æµ‹æ—¶ï¼Œæ”»å‡»è€…å¯å‘è¯¥èŠ‚ç‚¹å‘é€NAæŠ¥æ–‡è¿›è¡Œå“åº”ï¼Œå¹¶è¡¨æ˜è¯¥åœ°å€å·²è¢«è‡ªå·±ä½¿ç”¨ã€‚å½“èŠ‚ç‚¹æ¥æ”¶åˆ°è¯¥åœ°å€å·²è¢«å ç”¨æ¶ˆæ¯åé‡æ–°ç”Ÿæˆæ–°çš„IPv6åœ°å€å¹¶å†ä¸€æ¬¡è¿›è¡Œé‡å¤åœ°å€æ£€æµ‹æ—¶ï¼Œæ”»å‡»è€…å¯ç»§ç»­è¿›è¡ŒNAå“åº”å®ç°DoSæ”»å‡»ã€‚ä½¿ç›®æ ‡èŠ‚ç‚¹æ— æ³•é…ç½®ä»»ä½•åœ°å€ã€‚\nã€€æ³›æ´ªæ”»å‡»ï¼šæ”»å‡»è€…å¯ä¼ªé€ ä¸åŒç½‘ç»œå‰ç¼€RAæ¶ˆæ¯å¯¹FF02 :: 1è¿›è¡Œæ³›æ´ªæ”»å‡»ï¼Œæ¥æ”¶èŠ‚ç‚¹å°†ä¼šæ ¹æ®ä¸åŒçš„ç½‘ç»œå‰ç¼€è¿›è¡Œæ›´æ–°ï¼Œä»è€Œæ¶ˆè€—å¤§é‡çš„CPUèµ„æºã€‚\nã€€2020å¹´ï¼Œå°†æœ‰è¶…è¿‡200äº¿çš„ç‰©è”ç½‘è®¾å¤‡è¿æ¥åˆ°äº’è”ç½‘ã€‚è¿™äº›ç‰©è”ç½‘è®¾å¤‡å€¾å‘äºä½¿ç”¨IPv6åœ°å€è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å®ƒä»¬ä»éœ€è¦ä½¿ç”¨é‡å¤åœ°å€æ£€æµ‹æœºåˆ¶æ¥ç¡®å®šIPv6åœ°å€çš„å”¯ä¸€æ€§ã€‚\nå·²æœ‰è§£å†³æ–¹æ¡ˆ ã€€æœ¬æ–‡é’ˆå¯¹é‡å¤åœ°å€æ£€æµ‹æ”»å‡»çš„é˜²å¾¡ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸ŠåŸºæœ¬æœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š\n éšè—ç›®æ ‡åœ°å€ï¼šå‘é€NSæ•°æ®åŒ…æ—¶å°†ç›®æ ‡åœ°å€éšè—åœ¨NSæ¶ˆæ¯ä¸­ï¼ŒNSæ¶ˆæ¯ä¸ç›´æ¥å¡«å†™åœ°å€ï¼Œè€Œæ˜¯å¡«å†™åœ°å€çš„å“ˆå¸Œå€¼ã€‚å…¶ä»–ä¸»æœºè®¡ç®—è‡ªå·±åœ°å€çš„å“ˆå¸Œå€¼ï¼Œä¸NSæ¶ˆæ¯ä¸­çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™éœ€è¦å¯¹NDPè¿›è¡Œä¿®æ”¹ã€‚ éªŒè¯NDPæ¶ˆæ¯ï¼šå°†æ¶ˆæ¯è®¤è¯ç é™„åŠ åˆ°NDPæ¶ˆæ¯ã€‚è¿™éœ€è¦å¯¹NDPè¿›è¡Œä¿®æ”¹ã€‚ ç»Ÿä¸€ç­”å¤NAæ¶ˆæ¯ï¼šåˆ©ç”¨ä¸€ä¸ªå¯é çš„ä¸­å¤®èŠ‚ç‚¹ç»Ÿä¸€ç­”å¤NAæ¶ˆæ¯ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘é€çš„NAæ¶ˆæ¯éƒ½å°†è¢«å¿½ç•¥ã€‚å®ƒé¢ä¸´å•ç‚¹æ•…éšœé—®é¢˜ã€‚  ã€€è¡¨1æ€»ç»“äº†ç°æœ‰æ–¹æ¡ˆçš„å±€é™æ€§ã€‚\nè¡¨1 ç°æœ‰æ–¹æ¡ˆå±€é™æ€§:\r\r äºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€ç›®æ ‡ï¼šå¢å¼ºé‡å¤åœ°å€æ£€æµ‹çš„å®‰å…¨æ€§ï¼Œè½»é‡ï¼ˆæ— å“ˆå¸Œï¼‰æ˜“éƒ¨ç½²ï¼ˆä¸ä¿®æ”¹ç½‘ç»œå †æ ˆï¼‰ä¸”å¥å£®ï¼ˆæ— ä¸­å¤®èŠ‚ç‚¹ï¼‰ã€‚\nã€€åŸºäºP4è®¾è®¡å®‰å…¨çš„é‡å¤åœ°å€æ£€æµ‹æœºåˆ¶ã€‚æ–‡ç« å‡è®¾ä¸»æœºç›´æ¥è¿æ¥åˆ°äº¤æ¢æœºï¼Œä¸»æœºå¯èƒ½æ˜¯æ¶æ„çš„ï¼Œäº¤æ¢æœºæ˜¯å¯ä¿¡ä»»çš„ã€‚\nã€€è§£å†³ä¸¤ä¸ªæŒ‘æˆ˜ï¼šæ¯ä¸ªä¸»æœºé€šå¸¸é…ç½®å¤šä¸ªIPv6åœ°å€ï¼›åœ¨æœ¬åœ°é…ç½®å’Œå¡«å……äº¤æ¢æœºçš„æµè§„åˆ™ã€‚\nä¸‰ã€è®¾è®¡åŠå®ç° 1 P4DADè®¾è®¡ 1ï¼‰åœ¨è§£æå™¨ä¸­æå–NS/NAæ¶ˆæ¯ä¸­çš„åœ°å€\n2ï¼‰ç”¨æœ‰çŠ¶æ€å¯„å­˜å™¨åœ¨æ•°æ®å¹³é¢ä¸­ä¿ç•™ç«¯å£å’ŒIPv6åœ°å€çš„ç»‘å®šï¼Œå…è®¸åŒä¸€ç«¯å£å¯¹åº”å¤šä¸ªIPv6åœ°å€ã€‚\n3ï¼‰P4DADå°†æ‰€éœ€ä¿¡æ¯çš„æ‘˜è¦ä»¥æ•°æ®åŒ…å½¢å¼ä¼ åˆ°æ§åˆ¶å¹³é¢ï¼Œå¹¶é€šçŸ¥æ§åˆ¶é¢å®æ—¶å¡«å……æµè§„åˆ™ã€‚\nP4DADçš„æ€»ä½“è®¾è®¡å¦‚å›¾3ã€‚\nå›¾3 P4DADæ€»ä½“è®¾è®¡:\r\r NS/NAæ•°æ®åŒ…ç»è¿‡çš„åŠ¨ä½œåŒ¹é…è¡¨å¦‚è¡¨2ã€‚\nè¡¨2 NS/NAæ¶ˆæ¯ç»è¿‡çš„åŠŸèƒ½:\r\r 2 P4ç¨‹åºå®ç° ã€€è§£æå™¨è§£ææ•°æ®åŒ…å¤´éƒ¨å­—æ®µã€‚\nã€€ipv6_regï¼šè®°å½•ä¸»æœºIPv6åœ°å€ä¸äº¤æ¢æœºç«¯å£çš„æ˜ å°„å…³ç³»ã€‚ä½¿ç”¨2ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨1çš„æ§½ä¸­å­˜å‚¨IPv6åœ°å€ï¼Œå¯„å­˜å™¨2ä¸­å­˜å‚¨IPv6åœ°å€çŠ¶æ€ï¼ˆæš‚å®štentativeï¼Œé¦–é€‰preferredï¼Œä¸æ¨èä½¿ç”¨deprecatedï¼‰\nã€€å¯„å­˜å™¨ç´¢å¼•è®¡ç®—ï¼šç´¢å¼•å· = ä¸»æœºIPv6åœ°å€ä¸ªæ•° Ã— äº¤æ¢æœºç«¯å£å· + è¯¥ç«¯å£å·²ä¿å­˜çš„IPv6åœ°å€æ•°é‡ã€‚å¦‚å›¾4ã€‚\nå›¾4 P4DADå¯„å­˜å™¨è®¾è®¡:\r\r ã€€Match-Acitonè¡¨åŒ…æ‹¬MAC-learningè¡¨ã€Target-Address-Queryè¡¨ã€Forwardingè¡¨\nã€€Mac-learningè¡¨ï¼šä½¿ç”¨packet digestï¼Œå°†æ‘˜è¦å‘é€åˆ°æ§åˆ¶å¹³é¢å®ç°MACå­¦ä¹ ã€‚\nã€€Target-Address-Queryè¡¨ï¼š\n å¦‚æœæ•°æ®åŒ…æ˜¯NSåŒ…ï¼Œä¸”Target Addressä¸åœ¨è¡¨ä¸­ï¼Œåˆ™å°†å…¶IPv6å€¼å’ŒçŠ¶æ€å­˜å…¥å¯„å­˜å™¨1å’Œå¯„å­˜å™¨2ä¸­(default action)ï¼Œå¹¶é€šçŸ¥æ§åˆ¶å¹³é¢ä¸ºè¡¨æ·»åŠ æ¡ç›®ï¼› å¦‚æœæ•°æ®åŒ…æ˜¯NAåŒ…ï¼Œå¹¶ä¸”Target Addressä¸åœ¨è¡¨ä¸­ï¼Œè¯´æ˜å‘ç”Ÿäº†æ¬ºéª—ï¼Œä¸¢å¼ƒã€‚ å¦‚æœæ•°æ®åŒ…æ˜¯NAåŒ…ï¼Œå¹¶ä¸”Target Addressåœ¨è¡¨ä¸­ï¼Œåˆ™è·å–å…¶ç´¢å¼•(action)ï¼Œæ ¹æ®ç´¢å¼•ä»å¯„å­˜å™¨1å’Œå¯„å­˜å™¨2ä¸­è·å–IPv6åœ°å€åŠå…¶çŠ¶æ€ï¼›  å¦‚æœIPv6åœ°å€çš„çŠ¶æ€ä¸ºtentativeï¼Œåˆ™P4DADä¼šé‡ç½®å¯¹åº”çš„å¯„å­˜å™¨1å’Œå¯„å­˜å™¨2ã€‚    3 P4DADå·¥ä½œæµç¨‹ ã€€NS/NAæ¶ˆæ¯é€šè¿‡åŒ¹é…Target-Address-Queryè¡¨é˜²å¾¡é‡å¤åœ°å€æ£€æµ‹DoSæ”»å‡»ã€‚\nã€€ä¸»æœº1å’Œä¸»æœº2ï¼ˆæ¶æ„ä¸»æœºï¼‰åˆ†åˆ«é…ç½®äº†IPv6åœ°å€ï¼Œå› æ­¤IPv6 1å’ŒIPv6 2çš„ç»‘å®šæ¡ç›®å·²åœ¨P4äº¤æ¢æœº1ä¸­å»ºç«‹ã€‚ä¸»æœº3å’Œä¸»æœº4æ­£åœ¨è¿›è¡ŒDADè¿›ç¨‹ã€‚\nã€€ä¸»æœº3å°è¯•é…ç½®ä¸ä¸»æœº1ç›¸åŒçš„IPv6åœ°å€ï¼Œä¸»æœº4é…ç½®æ–°åœ°å€ã€‚\nã€€å½“P4äº¤æ¢æœº2æ¥æ”¶åˆ°ä¸»æœº3å’Œä¸»æœº4å‘é€çš„NSæ•°æ®åŒ…æ—¶ï¼Œå°†å»ºç«‹IPv6 1å’ŒIPv6 3çš„ç»‘å®šæ¡ç›®ï¼Œå¹¶å°†ç›¸åº”çš„IPv6åœ°å€çŠ¶æ€è®¾ç½®ä¸ºtentativeã€‚\nã€€ä¸»æœº1å°†å›å¤ä»¥IPv6 1ä¸ºæºåœ°å€å’Œç›®æ ‡åœ°å€çš„NAæ•°æ®åŒ…ã€‚ä½†æ¶æ„ä¸»æœº2å°†åˆ†åˆ«å‘é€ä¸¤ä¸ªä»¥IPv6 1å’ŒIPv6 3ä¸ºTarget Addressçš„æ¬ºéª—æ€§NAæ•°æ®åŒ…ã€‚å½“P4äº¤æ¢æœº1æ¥æ”¶åˆ°æ¬ºéª—æ€§çš„NAæ•°æ®åŒ…æ—¶ï¼Œå°†å¯¹å®ƒä»¬è¿›è¡Œç›´æ¥è¿‡æ»¤ï¼Œå› ä¸ºTarget-Address-Queryè¡¨ä¸­æ²¡æœ‰è¯¥Target Addressçš„è¡¨é¡¹ï¼Œå³è¿æ¥è¯¥äº¤æ¢æœºçš„ä¸»æœºæ²¡æœ‰æ­¤IPv6åœ°å€ã€‚è¿™æ„å‘³ç€å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢DADå—åˆ°DoSæ”»å‡»ã€‚\nã€€å½“P4äº¤æ¢æœº2æ”¶åˆ°ä¸»æœº1å‘é€çš„NAæŠ¥æ–‡æ—¶ï¼Œå°†æ¸…é™¤IPv6 1çš„ç»‘å®šè¡¨é¡¹ã€‚å½“P4äº¤æ¢æœº2åœ¨ç‰¹å®šæ—¶é—´æœªæ”¶åˆ°æœ‰å…³IPv6 3çš„NAæ•°æ®åŒ…æ—¶ï¼Œç›¸åº”çš„IPv6åœ°å€çŠ¶æ€å°†è®¾ç½®ä¸ºpreferredã€‚\nå›¾5 P4DADå·¥ä½œæµç¨‹:\r\r 4 åŸå‹å®ç° ã€€P4DADåŸå‹ç”±æ•°æ®å¹³é¢ç¨‹åºå’Œæ§åˆ¶å¹³é¢ç¨‹åºç»„æˆã€‚\n æ•°æ®å¹³é¢ç¨‹åºç”±P4_16å®ç°ï¼Œå¯ä»¥ç›´æ¥åœ¨bmv2ä¸Šç¼–è¯‘ã€‚ æ§åˆ¶å¹³é¢ç¨‹åºæ˜¯ç”¨Pythonç¼–å†™çš„ï¼Œå®ƒé€šè¿‡notifications-addrä¸æ•°æ®å¹³é¢é€šä¿¡ã€‚  å››ã€è¯„ä¼° ã€€å®éªŒåœ¨IntelÂ®Coreâ„¢i7-7700 CPUå’Œ7840 MB RAMçš„Dell OptiPlex 7050æœåŠ¡å™¨ä¸Šè¿›è¡Œã€‚\nåŠŸèƒ½æµ‹è¯• ã€€å°†å®‰è£…æœ‰parasite6å·¥å…·çš„ä¸¤ä¸ªè™šæ‹Ÿæœºï¼ˆå—å®³è€…å’Œæ”»å‡»è€…ï¼‰è¿æ¥åˆ°ç”±bmv2å®ç°çš„P4è½¯ä»¶äº¤æ¢æœºã€‚\nã€€æ”»å‡»è€…éšæœºå‘é€æ¬ºéª—æ€§NS/NAæ¶ˆæ¯ï¼Œè€Œå—å®³è€…éšæœºå‘é€æ ‡å‡†NS/NAæ¶ˆæ¯ã€‚\nã€€è®¡ç®—ç”±æ”»å‡»è€…å’Œå—å®³è€…åˆ†åˆ«å‘é€çš„æ•°æ®åŒ…æ•°é‡ä»¥åŠç”±P4DADæ¥æ”¶å’Œè¿‡æ»¤çš„æ•°æ®åŒ…æ•°é‡ï¼Œ ç»“æœå‘ç°P4DADè¿‡æ»¤çš„æ•°æ®åŒ…æ•°é‡ç­‰äºæ”»å‡»è€…å‘é€çš„æ•°æ®åŒ…æ•°é‡ï¼Œè¿™æ„å‘³ç€P4DADå¯ä»¥æœ‰æ•ˆè¯†åˆ«å’Œè¿‡æ»¤æ¬ºéª—çš„NS/NAæ¶ˆæ¯ã€‚\næ€§èƒ½æµ‹è¯• ã€€é€‰æ‹©åŸå§‹NDPçš„æ€§èƒ½ï¼ˆä¸è¿›è¡Œä»»ä½•æ›´æ”¹ï¼‰ä½œä¸ºåŸºå‡†ï¼Œå¹¶æ¯”è¾ƒP4DADå’ŒåŸºå‡†ä¹‹é—´NS/NAæ¶ˆæ¯çš„å¤„ç†æ—¶é—´ã€‚\nã€€NS-For-DADå’ŒNS-For-Othersåˆ†åˆ«è¡¨ç¤ºä¸ºç”¨äºå¤„ç†DADå’Œå…¶ä»–NDPåŠŸèƒ½çš„NSæ¶ˆæ¯ï¼Œå¦‚å›¾6æ‰€ç¤ºã€‚\nã€€NS-for-DADå’ŒNA-for-DADçš„P4DADçš„å¤„ç†æ—¶é—´å¤§äºåŸºçº¿ï¼Œè€ŒNS-for-Otherså’ŒNA-for-Othersçš„P4DADçš„å¤„ç†æ—¶é—´éå¸¸æ¥è¿‘åŸºçº¿ï¼ŒåŸå› æ˜¯NS-for-DADå’ŒNA-for-DADçš„æ“ä½œæ¯”åŸºçº¿å¤šä¸‰åˆ°å››æ¬¡ã€‚\nå›¾6 äº¤æ¢æœºå¤„ç†NS/NAæ¶ˆæ¯çš„æ—¶é—´:\r\r ã€€æ–‡ç« æµ‹é‡ä»æ•°æ®å¹³é¢æ‘˜è¦æ•°æ®åŒ…ä¿¡æ¯çš„å¼€å§‹åˆ°æ§åˆ¶å¹³é¢å¡«å……æµè§„åˆ™ç»“æŸçš„æ—¶é—´ï¼Œå¹³å‡æ—¶é—´ä¸º4.126æ¯«ç§’ã€‚\né€šå¸¸ï¼ŒDADä»…å‡ºç°åœ¨åœ°å€é…ç½®è¿‡ç¨‹ä¸­ï¼Œè€Œæ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ä¹‹é—´çš„é€šä¿¡ä»…éœ€è¦åœ¨DADçš„è¿‡ç¨‹ä¸­è¿›è¡Œã€‚å› æ­¤ï¼ŒP4DADå¸¦æ¥çš„å¤„ç†å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚\nå¯æ‰©å±•æ€§æµ‹è¯• ã€€å¢åŠ ä¸»æœºæ•°é‡æ—¶ï¼Œæµ‹é‡P4äº¤æ¢æœºçš„å†…å­˜æ¶ˆè€—ä»¥è¯„ä¼°P4DADçš„å¯ä¼¸ç¼©æ€§ã€‚\nã€€P4DADçš„å†…å­˜æ¶ˆè€—éšä¸»æœºæ•°é‡çº¿æ€§å¢åŠ ï¼Œè¡¨æ˜P4DADå…·æœ‰ä»¤äººæ»¡æ„çš„å¯æ‰©å±•æ€§ã€‚\n","description":"æå‡ºäº†P4DADï¼Œæ˜¯ä¸€ç§è½»é‡çº§ï¼Œå¯éƒ¨ç½²ï¼Œå¥å£®ï¼Œå®‰å…¨çš„DADæœºåˆ¶ã€‚é€šè¿‡å¼•å…¥P4ï¼ŒP4DADæ— éœ€ä¿®æ”¹NDPæˆ–ä¸»æœºå †æ ˆå³å¯ä¿æŠ¤ç½‘ç»œä¸­çš„NDPæ¶ˆæ¯ã€‚","id":11,"section":"posts","tags":["P4"],"title":"è®ºæ–‡é˜…è¯»ï¼šåŸºäºP4çš„å®‰å…¨é‡å¤åœ°å€æ£€æµ‹","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E5%9F%BA%E4%BA%8Ep4%E7%9A%84%E5%AE%89%E5%85%A8%E9%87%8D%E5%A4%8D%E5%9C%B0%E5%9D%80%E6%A3%80%E6%B5%8B/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šDefeating Protocol Abuse with P4: Application to Explicit Congestion Notification\nã€€ä¼šè®®ä¿¡æ¯ï¼š2020 IFIP Networking Conference (Networking)\nã€€æˆæœï¼šæå‡ºè¿›è¡Œç½‘ç»œéªŒè¯çš„EFSMé€šç”¨æŠ½è±¡ï¼Œå®ç°å®‰å…¨ç›‘è§†åŠŸèƒ½ï¼Œä»¥ECNä¸ºä¾‹åœ¨P4äº¤æ¢æœºä¸­å®ç°è¯¥æŠ½è±¡ã€‚\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šP4CEPé€šè¿‡ä½¿ç”¨å¸¸è§„çš„æœ‰é™çŠ¶æ€æœºæè¿°å¤æ‚çš„äº‹ä»¶å¤„ç†åŠŸèƒ½æ¥ç®€åŒ–P4çš„ä½¿ç”¨ï¼Œå¯ä¼¸ç¼©æ€§ä¸è¶³ï¼Œå¯èƒ½é¢ä¸´çŠ¶æ€ç©ºé—´çˆ†ç‚¸çš„å±é™©ã€‚\nã€€æœ¬æ–‡å·¥ä½œï¼šæå‡ºEFSMæŠ½è±¡ï¼Œç›‘è§†ä»»ä½•åè®®è¡Œä¸ºå¹¶å¯¹ä¹‹åšå‡ºååº”ï¼›å¹¶å°†å°†EFSMæ¨¡å‹æ˜ å°„åˆ°P4ï¼Œä»¥ECNä¸ºä¾‹å¯¹æ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œå¯¹æ•ˆæœè¿›è¡Œè¯„ä¼°ï¼Œå»ºè®®éƒ¨åˆ†éƒ¨ç½²EFSMã€‚\nä¸€ã€èƒŒæ™¯ 1.ECN(Explicit Congestion Notification)  æ¥æºï¼šRFC3168\nå‚è€ƒï¼šhttps://blog.csdn.net/z1143709608/article/details/52682150\n ã€€åœ¨ç½‘ç»œä¸­çš„è·¯ç”±å™¨çš„è½¬å‘é˜Ÿåˆ—é€šå¸¸å®ç°äº†Random Early Detection (RED)åŠŸèƒ½ï¼Œå³ï¼Œè·¯ç”±å™¨ä¼šæ ¹æ®å½“å‰è½¬å‘é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦æ¥åšä¸¢åŒ…å†³ç­–ï¼Œå¹¶ä¸”éšæœºçš„ä¸¢å¼ƒä¸€äº›TCPæµé‡çš„æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯ç­‰å¾…é˜Ÿåˆ—æº¢å‡ºåä¸¢å¼ƒå…¨éƒ¨çš„æŠ¥æ–‡ï¼Œè¿™æ ·èƒ½å¤Ÿå¾ˆå¥½çš„é¿å…æ‰€æœ‰TCPåŒæ—¶è¶…æ—¶çš„é—®é¢˜ã€‚ç”±äºæŒ‰ç…§é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦æ¥è¿›è¡Œä¸¢åŒ…ï¼Œè€Œä¸æ˜¯é˜Ÿåˆ—æ»¡é•¿ï¼Œæ‰€ä»¥ä¼šå¼•èµ·ä¸€éƒ¨åˆ†TCPçš„é€€é¿ï¼Œè®©ä¸€éƒ¨åˆ†TCPå…ˆæ”¾ç¼“ï¼Œä¿è¯å¦ä¸€äº›TCPçš„é€šç•…ã€‚å¹¶ä¸”ä½¿ç”¨éšæœºä¸¢å¼ƒï¼Œé’ˆå¯¹æ‰€æœ‰TCPè¿æ¥æ¥è¯´æ˜¯ç›¸å¯¹å…¬å¹³çš„ã€‚\nã€€åœ¨RFC3168ä¸­å®šä¹‰äº†ECNçš„è®¾è®¡ç›®æ ‡ï¼Œæ˜¯é€šè¿‡TCPå‘é€ç«¯å’Œæ¥æ”¶ç«¯ä»¥åŠä¸­é—´è·¯ç”±å™¨çš„é…åˆï¼Œæ„ŸçŸ¥ä¸­é—´è·¯å¾„çš„æ‹¥å¡ï¼Œå¹¶ä¸»åŠ¨çš„å‡ç¼“TCPçš„å‘é€é€Ÿç‡ï¼Œä»è€Œä»æ—©æœŸé¿å…æ‹¥å¡è€Œå¯¼è‡´çš„ä¸¢åŒ…ï¼Œå®ç°ç½‘ç»œæ€§èƒ½çš„æœ€å¤§åˆ©ç”¨ã€‚èƒ½å¤Ÿè§£å†³çš„é—®é¢˜å¦‚ä¸‹ï¼š\n æ‰€æœ‰TCPå‘é€ç«¯èƒ½å¤Ÿæ—©æœŸæ„ŸçŸ¥ä¸­é—´è·¯å¾„æ‹¥å¡ï¼Œå¹¶ä¸»åŠ¨æ”¾ç¼“å‘é€é€Ÿç‡ï¼Œé¢„é˜²æ‹¥å¡å‘ç”Ÿã€‚ åœ¨ä¸­é—´è·¯ç”±å™¨ä¸Šè½¬å‘çš„é˜Ÿåˆ—ä¸Šï¼Œå¯¹äºè¶…è¿‡å¹³å‡é˜Ÿåˆ—é•¿åº¦çš„TCPæŠ¥æ–‡è¿›è¡ŒECNæ ‡è®°ï¼Œå¹¶ç»§ç»­è¿›è¡Œè½¬å‘ï¼Œä¸å†ä¸¢å¼ƒæŠ¥æ–‡ã€‚é¿å…äº†æŠ¥æ–‡çš„ä¸¢å¼ƒå’ŒTCPçš„é‡ä¼ ã€‚ ç”±äºå‡å°‘äº†ä¸¢åŒ…ï¼ŒTCPä¸éœ€è¦ç»è¿‡å‡ ç§’è´§å‡ åç§’çš„é‡ä¼ å®šæ—¶å™¨å‡ºå‘æŠ¥æ–‡é‡ä¼ ï¼Œæé«˜äº†æ—¶å»¶æ•æ„Ÿåº”ç”¨çš„ç”¨æˆ·æ„Ÿå—ã€‚ ä¸æ²¡æœ‰éƒ¨ç½²ECNåŠŸèƒ½çš„ç½‘ç»œç›¸æ¯”ï¼Œç½‘ç»œçš„åˆ©ç”¨ç‡æ›´å¥½ï¼Œä¸å†åœ¨è¿‡è½½å’Œè½»è½½ä¹‹å‰æ¥å›éœ‡è¡ã€‚  1.1 æŠ¥æ–‡æ ¼å¼ IPå¤´éƒ¨çš„ä¿®æ”¹ ã€€IPå¤´éƒ¨çš„TOSå­—æ®µä¸­çš„ç¬¬7bitå’Œ8bitçš„reså­—æ®µè¢«é‡æ–°å®šä¹‰ä¸ºECNå­—æ®µï¼Œå…¶ä¸­æœ‰å››ä¸ªå–å€¼\n 00ä»£è¡¨è¯¥æŠ¥æ–‡å¹¶ä¸æ”¯æŒECNï¼Œæ‰€ä»¥è·¯ç”±å™¨çš„å°†è¯¥æŠ¥æ–‡æŒ‰ç…§åŸå§‹éECNæŠ¥æ–‡å¤„ç†å³å¯ï¼Œå³ï¼Œè¿‡è½½ä¸¢åŒ…ã€‚ 01å’Œ10è¿™ä¸¤ä¸ªå€¼é’ˆå¯¹è·¯ç”±å™¨æ¥è¯´æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è¡¨æ˜è¯¥æŠ¥æ–‡æ”¯æŒECNåŠŸèƒ½ã€‚01å’Œ10çš„å…·ä½“åŒºåˆ«è¯·å‚è€ƒRFC3168ã€‚ å¦‚æœå‘ç”Ÿæ‹¥å¡ï¼Œåˆ™ECNå­—æ®µçš„è¿™ä¸¤ä¸ªå°†ä¿®æ”¹ä¸º11æ¥è¡¨ç¤ºæŠ¥æ–‡ç»è¿‡äº†æ‹¥å¡ï¼Œå¹¶ç»§ç»­è¢«è·¯ç”±å™¨è½¬å‘ã€‚  ã€€æ‰€ä»¥è·¯ç”±å™¨è½¬å‘ä¾§è¦æ”¯æŒECNï¼Œéœ€è¦æœ‰ä»¥ä¸‹æ–°å¢åŠŸèƒ½ï¼š\n å½“æ‹¥å¡å‘ç”Ÿæ—¶ï¼Œé’ˆå¯¹ECN=00çš„æŠ¥æ–‡ï¼Œèµ°åŸæœ‰æ™®é€šéECNæµç¨‹ï¼Œè¿›è¡ŒREDä¸¢åŒ…ã€‚ å½“æ‹¥å¡å‘ç”Ÿæ—¶ï¼Œé’ˆå¯¹ECN=01(ECT=1)æˆ–ECN=10(ECT=0)çš„æŠ¥æ–‡ï¼Œéƒ½éœ€è¦ä¿®æ”¹ä¸ºECN=11ï¼Œå¹¶ç»§ç»­è½¬å‘æµç¨‹ã€‚ å½“æ‹¥å¡å‘ç”Ÿæ—¶ï¼Œé’ˆå¯¹ECN=11(CE)çš„æŠ¥æ–‡ï¼Œéœ€è¦ç»§ç»­è½¬å‘ã€‚ ä¸ºäº†ä¿è¯ä¸ä¸æ”¯æŒECNæŠ¥æ–‡çš„å…¬å¹³æ€§ï¼Œåœ¨é˜Ÿåˆ—è¶…è¿‡ä¸€å®šé•¿åº¦æ—¶ï¼Œéœ€è¦è€ƒè™‘å¯¹æ”¯æŒECNæŠ¥æ–‡çš„ä¸¢å¼ƒã€‚  TCPå¤´éƒ¨çš„ä¿®æ”¹ ã€€åœ¨ä¸»æœºç«¯ï¼Œå°†TCPå¤´éƒ¨çš„6ä½ä¿ç•™å­—æ®µçš„åä¸¤ä½è®¾ç½®ä¸ºCWRå’ŒECE(å³URGçš„å‰ä¸¤ä½)ã€‚\n CWRï¼šæ‹¥å¡çª—å£ç¼©å° ECEï¼šECNå›æ˜¾  ã€€åœ¨RFC3168ä¸­è®¾è®¡å¦‚ä¸‹ï¼š\n åœ¨TCPæ¥æ”¶ç«¯æ”¶åˆ°çš„IPå¤´ä¸­æœ‰ECN=11æ ‡è®°ï¼Œåˆ™åœ¨å›å¤ACKæ—¶å°†ECE bitç½®1ã€‚å¹¶åœ¨åç»­çš„ACKæ€»å°†ECE bitç½®1ã€‚ åœ¨TCPå‘é€ç«¯æ”¶åˆ°ECE bitç½®1çš„ACKæŠ¥æ–‡æ—¶ï¼Œéœ€è¦å°†è‡ªå·±çš„å‘é€é€Ÿç‡å‡åŠï¼Œå¹¶åœ¨å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ—¶ï¼Œå°†CWR bitç½®1ã€‚ åœ¨æ¥æ”¶ç«¯æ”¶åˆ°CWR bitç½®1çš„æŠ¥æ–‡æ—¶ï¼Œåç»­çš„ECE bitå°†ä¸å†ç½®1ã€‚ç›´åˆ°å†æ¬¡æ”¶åˆ°IPå¤´éƒ¨ECN=11æ—¶ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ TCPå‘é€ç«¯åœ¨æ”¶åˆ°ä¸€ä¸ªECE=1æ—¶ï¼Œç¼©å°å‘é€çª—å£ï¼Œå¹¶ä¸”åœ¨æœ¬æ¬¡RTTæ—¶é—´å†…å°†ä¸å†ç¼©å°å‘é€çª—å£ã€‚ TCPæ¥æ”¶ç«¯å‘å‘é€ç«¯å›åº”ACKæ—¶ï¼Œå¦‚æœè¯¥ACKæ˜¯ä¸€ä¸ªä¸å¸¦æ•°æ®çš„â€œçº¯â€ACKï¼Œé‚£ä¹ˆIPå¤´éƒ¨å¿…é¡»è®¾ç½®ECN=00ï¼Œå› ä¸ºTCPæ²¡æœ‰æœºåˆ¶å¯¹çº¯ACKè¿›è¡Œå“åº”ï¼Œå°±æ— æ³•é’ˆå¯¹çº¯ACKå‘é€æ‹¥å¡é€šçŸ¥ã€‚å³æ¡æ‰‹é˜¶æ®µECN=00ã€‚ å¯¹äºæ”¯æŒIP ECNçš„ä¸»æœºï¼ŒTCPå±‚åœ¨å‘é€æŠ¥æ–‡æ—¶éœ€è¦å°†IPé¦–éƒ¨ä¸­çš„ECNç½®ä¸º01æˆ–10ã€‚  å®‰å…¨é—®é¢˜  å‚è€ƒï¼šTCPæŠ¥æ–‡åˆ°è¾¾ç¡®è®¤æœºåˆ¶ï¼šhttp://blog.csdn.net/wjtxt/article/details/6606022\nã€€TCPæ•°æ®åŒ…ä¸­çš„åºåˆ—å·ï¼ˆSequence Numberï¼‰ä¸æ˜¯ä»¥æŠ¥æ–‡æ®µæ¥è¿›è¡Œç¼–å·çš„ï¼Œè€Œæ˜¯å°†è¿æ¥ç”Ÿå­˜å‘¨æœŸå†…ä¼ è¾“çš„æ‰€æœ‰æ•°æ®å½“ä½œä¸€ä¸ªå­—èŠ‚æµï¼Œåºåˆ—å·å°±æ˜¯æ•´ä¸ªå­—èŠ‚æµä¸­æ¯ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚ä¸€ä¸ªTCPæ•°æ®åŒ…ä¸­åŒ…å«å¤šä¸ªå­—èŠ‚æµçš„æ•°æ®ï¼ˆå³æ•°æ®æ®µï¼‰ï¼Œè€Œä¸”æ¯ä¸ªTCPæ•°æ®åŒ…ä¸­çš„æ•°æ®å¤§å°ä¸ä¸€å®šç›¸åŒã€‚åœ¨å»ºç«‹TCPè¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹ä¸­ï¼Œé€šä¿¡åŒæ–¹å„è‡ªå·²ç¡®å®šäº†åˆå§‹çš„åºå·xå’Œyï¼ŒTCPæ¯æ¬¡ä¼ é€çš„æŠ¥æ–‡æ®µä¸­çš„åºå·å­—æ®µå€¼è¡¨ç¤ºæ‰€è¦ä¼ é€æœ¬æŠ¥æ–‡ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚\nã€€TCPçš„æŠ¥æ–‡åˆ°è¾¾ç¡®è®¤ï¼ˆACKï¼‰ï¼Œæ˜¯å¯¹æ¥æ”¶åˆ°çš„æ•°æ®çš„æœ€é«˜åºåˆ—å·çš„ç¡®è®¤ï¼Œå¹¶å‘å‘é€ç«¯è¿”å›ä¸€ä¸ªä¸‹æ¬¡æ¥æ”¶æ—¶æœŸæœ›çš„TCPæ•°æ®åŒ…çš„åºåˆ—å·ï¼ˆAck Numberï¼‰ã€‚ä¾‹å¦‚ï¼Œ ä¸»æœºAå‘é€çš„å½“å‰æ•°æ®åºå·æ˜¯400ï¼Œæ•°æ®é•¿åº¦æ˜¯100ï¼Œåˆ™æ¥æ”¶ç«¯æ”¶åˆ°åä¼šè¿”å›ä¸€ä¸ªç¡®è®¤å·æ˜¯501çš„ç¡®è®¤å·ç»™ä¸»æœºAã€‚\nã€€TCPæä¾›çš„ç¡®è®¤æœºåˆ¶ï¼Œå¯ä»¥åœ¨é€šä¿¡è¿‡ç¨‹ä¸­å¯ä»¥ä¸å¯¹æ¯ä¸€ä¸ªTCPæ•°æ®åŒ…å‘å‡ºå•ç‹¬çš„ç¡®è®¤åŒ…ï¼ˆDelayed ACKæœºåˆ¶ï¼‰ï¼Œè€Œæ˜¯åœ¨ä¼ é€æ•°æ®æ—¶ï¼Œé¡ºä¾¿æŠŠç¡®è®¤ä¿¡æ¯ä¼ å‡ºï¼Œ è¿™æ ·å¯ä»¥å¤§å¤§æé«˜ç½‘ç»œçš„åˆ©ç”¨ç‡å’Œä¼ è¾“æ•ˆç‡ã€‚åŒæ—¶ï¼ŒTCPçš„ç¡®è®¤æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡ç¡®è®¤å¤šä¸ªæ•°æ®æŠ¥ï¼Œä¾‹å¦‚ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†201ï¼Œ301ï¼Œ401çš„æ•°æ®æŠ¥ï¼Œåˆ™åª éœ€è¦å¯¹401çš„æ•°æ®åŒ…è¿›è¡Œç¡®è®¤å³å¯ï¼Œå¯¹401çš„æ•°æ®åŒ…çš„ç¡®è®¤ä¹Ÿæ„å‘³ç€401ä¹‹å‰çš„æ‰€æœ‰æ•°æ®åŒ…éƒ½å·²ç»ç¡®è®¤ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æé«˜ç³»ç»Ÿçš„æ•ˆç‡ã€‚\nã€€è‹¥å‘é€æ–¹åœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ–¹çš„ç¡®è®¤ä¿¡æ¯ï¼Œå°±è¦å°†æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…é‡æ–°å‘é€ã€‚æ¥æ”¶æ–¹å¦‚æœæ”¶åˆ°ä¸€ä¸ªæœ‰å·®é”™çš„æŠ¥æ–‡ï¼Œåˆ™ä¸¢å¼ƒæ­¤æŠ¥æ–‡ï¼Œå¹¶ä¸å‘å‘é€æ–¹å‘é€ç¡®è®¤ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTCPæŠ¥æ–‡çš„é‡ä¼ æœºåˆ¶æ˜¯ç”±è®¾ç½®çš„è¶…æ—¶å®šæ—¶å™¨æ¥å†³å®šçš„ï¼Œåœ¨å®šæ—¶çš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œåˆ™è¿›è¡Œé‡ä¼ ã€‚è¿™ä¸ªå®šæ—¶çš„æ—¶é—´å€¼çš„è®¾å®šéå¸¸é‡è¦ï¼Œå¤ªå¤§ä¼šä½¿åŒ…é‡ä¼ çš„å»¶æ—¶æ¯”è¾ƒå¤§ï¼Œå¤ªå°åˆ™å¯èƒ½æ²¡æœ‰æ¥å¾—åŠæ”¶åˆ°å¯¹æ–¹çš„ç¡®è®¤åŒ…å‘é€æ–¹å°±å†æ¬¡é‡ä¼ ï¼Œä¼šä½¿ç½‘ç»œé™·å…¥æ— ä¼‘æ­¢çš„é‡ä¼ è¿‡ç¨‹ä¸­ã€‚æ¥æ”¶æ–¹å¦‚æœæ”¶åˆ°äº†é‡å¤çš„æŠ¥æ–‡ï¼Œå°†ä¼šä¸¢å¼ƒé‡å¤çš„æŠ¥æ–‡ï¼Œä½†æ˜¯å¿…é¡»å‘å›ç¡®è®¤ä¿¡æ¯ï¼Œå¦åˆ™å¯¹æ–¹ä¼šå†æ¬¡å‘é€ã€‚\n  ç»ˆç«¯ä¸»æœºå®£å¸ƒè‡ªå·±å…·æœ‰ECNåŠŸèƒ½ä½†å¿½ç•¥æ¥è‡ªäº¤æ¢æœºçš„æ‹¥å¡é€šçŸ¥ï¼Œå³æ”¶åˆ°ECN=11æ—¶ï¼Œä»å°†ECEç½®0ï¼Œå¯¼è‡´å‘é€æ–¹ä¸å‡å°‘æ‹¥å¡çª—å£ï¼Œé€ æˆæ‹¥å¡ï¼› åœ¨å‘é€æ–¹å·²ç»å‡å°‘æ‹¥å¡çª—å£åï¼Œæ¥æ”¶è€…ä»ç„¶ç»§ç»­å‘é€è®¾ç½®äº†ECE=1çš„æ•°æ®åŒ…ï¼Œå¯¼è‡´æ‹¥å¡çª—å£åŠ å€å‡å°ï¼Œæµªè´¹å¸¦å®½ï¼› å‘é€æ–¹åœ¨æ”¶åˆ°ECE=1ä¹‹åï¼Œä¸å°†CWRç½®1ï¼Œå³ä¸ç¼©å°æ‹¥å¡çª—å£ï¼Œé€ æˆæ‹¥å¡ã€‚  ã€€ä¸Šè¿°è¿™ä¸‰ç§ä¸å½“è¡Œä¸ºéƒ½ä¼šä¸¥é‡é™ä½ç½‘ç»œæ€§èƒ½ã€‚å›¾1ä¸­ç®­å¤´ä¸Šè“è‰²å­—è¡¨ç¤ºæ­£ç¡®çš„ECNè¡Œä¸ºï¼Œçº¢è‰²çš„å­—è¡¨ç¤ºé”™è¯¯çš„ECNè¡Œä¸ºã€‚\nå›¾1 ECNæµç¨‹ :\r\r äºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€ç›®æ ‡ï¼šå®æ—¶ç›‘è§†ç½‘ç»œæµé‡è¯†åˆ«åè®®æ»¥ç”¨ã€‚\nã€€å°†åè®®è§„èŒƒè½¬ä¸ºæ‰©å±•æœ‰é™çŠ¶æ€æœº(EFSM)ï¼Œå¹¶ç”¨P4ç¨‹åºå®ç°EFSMæ¨¡å‹ï¼Œç¼–è¯‘P4ç¨‹åºå¹¶å®‰è£…åœ¨PISAäº¤æ¢æœºä¸Šï¼Œé€šè¿‡ç»´æŠ¤æ¯ä¸ªè¿æ¥çš„å½“å‰çŠ¶æ€ä»¥åŠEFSMçš„æ‰€æœ‰ç›¸å…³å˜é‡æ¥åœ¨çº¿è·Ÿè¸ªæ‰€æœ‰æµã€‚å½“EFSMæ¨¡å‹è¿›å…¥æ ‡è®°ä¸ºä¸å½“è¡Œä¸ºçš„çŠ¶æ€æ—¶ï¼Œç¨‹åºå¯ä»¥è§¦å‘ä¸åŒçš„åŠ¨ä½œï¼Œå¦‚ä¸¢å¼ƒæ•°æ®åŒ…ã€ç”Ÿæˆè­¦æŠ¥ç­‰ã€‚\nã€€ä»¥ECNä¸ºä¾‹ï¼Œå¯¹æ­¤æ–¹æ³•è¿›è¡Œè¯„ä¼°ã€‚\nå›¾2 æ•´ä½“è®¾è®¡ :\r\r ä¸‰ã€å®ç° 1 æ¨¡å‹è®¾è®¡ ã€€æ–‡ç« ä½¿ç”¨7å…ƒç»„(S, E, A, I, V, C, T)è¡¨ç¤ºEFSMï¼Œå„å…ƒå«ä¹‰å¦‚å›¾3ã€‚\nå›¾3 EFSM7å…ƒç»„:\r\r ã€€ECNçš„EFSM7å…ƒç»„å¯¹åº”å®ä¾‹å¦‚å›¾4ã€‚\nå›¾4 ECNçš„EFSM7å…ƒç»„:\r\r ã€€å®Œæ•´çš„ECN EFSMå›¾æ¨¡å‹å¦‚å›¾5ï¼Œç„¶åä½¿ç”¨P4äº¤æ¢æœºçš„Externç»„ä»¶å’ŒP4ç¨‹åºå®ç°è¿™ä¸ªæ¨¡å‹ã€‚\nå›¾5 ECN EFSM:\r\r 2 P4ç¨‹åºå®ç° 2.1 Externs ã€€å¯„å­˜å™¨å­˜å‚¨æµçŠ¶æ€ï¼šç”¨å¯„å­˜å™¨å­˜å‚¨è¿æ¥çŠ¶æ€ï¼Œå¯¹äº”å…ƒç»„\u0026lt;dstIpã€srcIpã€dstPortã€srcPortã€åè®®\u0026gt;åšHASHè¿ç®—ï¼Œå¾—åˆ°è¯¥æµäº”å…ƒç»„å¯¹åº”çš„å¯„å­˜å™¨ç´¢å¼•ï¼Œå¯¹äºTCPè¿æ¥çš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œå¦‚æœdspIp \u0026gt; srcIpï¼ŒæŒ‰ç…§\u0026lt;dstIpã€srcIpã€dstPortã€srcPortã€åè®®\u0026gt;çš„é¡ºåºåšHASHè¿ç®—ï¼Œå¦åˆ™æŒ‰ç…§\u0026lt; srcIpã€ dstIpã€ srcPortã€ dstPortã€srcPortã€åè®®\u0026gt;çš„é¡ºåºåšHASHè¿ç®—ã€‚ä¸€å…±6ä¸ªçŠ¶æ€ï¼Œå¯¹åº”å¯„å­˜å™¨æ§½å†…çš„å€¼æ˜¯å¯¹åº”çš„çŠ¶æ€ï¼Œåˆå§‹æ—¶ä¸ºinitçŠ¶æ€ã€‚\n2.2 å…ƒæ•°æ®  congestionï¼šæ¥è‡ªäº¤æ¢é˜Ÿåˆ—çš„å ç”¨çº§åˆ« å¤´éƒ¨å­—æ®µï¼šæ ‡å¿—ä½ã€æ ¡éªŒå’Œ  2.3 åŒ¹é…-åŠ¨ä½œè¡¨ ã€€æ–‡ç« æ²¡æœ‰å…·ä½“æè¿°å…¶è®¾è®¡ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªæˆ‘ç†è§£çš„Naive ç‰ˆæœ¬ï¼Œå¦‚æœä»”ç»†æ„æ€ä¸€ä¸‹å¯èƒ½æœ‰æ›´èŠ‚çœç©ºé—´ã€æ›´ä¼˜é›…çš„å®ç°æ–¹å¼ã€‚\n   Key Action     æµçŠ¶æ€ä¸ºinit, ECT=1, congestion=1 CE=1, forward, æµçŠ¶æ€æ”¹ä¸ºcongestion   æµçŠ¶æ€ä¸ºcongestion, ECE = 1 forward, æµçŠ¶æ€æ”¹ä¸ºnotified   æµçŠ¶æ€ä¸ºcongestion, ECE = 0 ECE=1, update_chk, forward, æµçŠ¶æ€æ”¹ä¸ºnotified(ä¿®æ­£äº†misbehavingçŠ¶æ€)   æµçŠ¶æ€ä¸ºnotified, CWR=1 forward, æµçŠ¶æ€æ”¹ä¸ºwin_reduction   æµçŠ¶æ€ä¸ºnotified, CWR=0 drop, æµçŠ¶æ€æ”¹ä¸ºmisbehaving   æµçŠ¶æ€ä¸ºwin_reduction, ECE=0 forward, æµçŠ¶æ€æ”¹ä¸ºnotification_stopped   æµçŠ¶æ€ä¸ºwin_reduction, ECE=1 ECE=0, update_chk, forward, æµçŠ¶æ€æ”¹ä¸ºnotification_stopped    2.4 åŠ¨ä½œ  update_chkï¼šä½¿ç”¨å¢é‡è¿‡ç¨‹è®¡ç®—æ•°æ®åŒ…æ ¡éªŒå’Œï¼Œæ— éœ€é‡æ–°è®¡ç®—æ ¡éªŒå’Œã€‚  TCPæ–°æ ¡éªŒå’Œ=æ—§æ ¡éªŒå’Œ-TCPå€¼å­—æ®µçš„16ä½æ—§å€¼çš„è¡¥ç -16ä½å­—æ®µçš„æ–°å€¼   forward drop CEç½®1 ECEç½®0  å››ã€è¯„ä¼° ã€€ä½¿ç”¨mininetæ„å»ºç½‘ç»œï¼Œå¹¶ä½¿ç”¨P4-Bmv2äº¤æ¢æœºè¿›è¡Œå®éªŒã€‚æ„å»ºçš„ç½‘ç»œæ‹“æ‰‘å¦‚å›¾6ã€‚æ‰€æœ‰ä¸»æœºéƒ½å…·æœ‰ECNåŠŸèƒ½ï¼Œå¹¶ä¸”é“¾è·¯å»¶è¿Ÿè®¾ç½®ä¸º1msï¼Œé™åˆ¶äº†è¾“å‡ºé˜Ÿåˆ—é€Ÿç‡ï¼ˆé»˜è®¤ä¸º2000ä¸ªæ•°æ®åŒ…/ç§’ï¼‰ã€‚æ ¹æ®å…ˆå‰å·¥ä½œï¼Œ10 Gbits / sç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œ65ä¸ªæ•°æ®åŒ…åœ¨äº¤æ¢æœºä¸­æ’é˜Ÿåå°±å‘ç”Ÿäº†æ‹¥å¡ï¼Œå¯¹äºmininetï¼Œè§‚å¯Ÿåˆ°çš„æœ€å¤§ååé‡çº¦ä¸º40 Mbits/sï¼Œå› æ­¤é˜Ÿåˆ—ä¸­è¶…è¿‡3ä¸ªæ•°æ®åŒ…å°±è¢«è§†ä¸ºæ‹¥å¡ï¼Œå°†è§¦å‘äº‹ä»¶congestionï¼Œä»è€Œç¦»å¼€EFSMçš„initçŠ¶æ€ã€‚\nå›¾6 ç½‘ç»œæ‹“æ‰‘å›¾:\r\r  h1ï¼šä¸å›æ˜¾æ‹¥å¡ä¿¡æ¯ï¼Œå³ä¸è®¾ç½®TCP ECEæ ‡å¿—ï¼Œä½¿h1æˆä¸ºå¼‚å¸¸ä¸»æœºï¼› h1-\u0026gt;h2ï¼šå¼‚å¸¸æµï¼Œåœ¨h1ä¸Šä½¿ç”¨iperfç”ŸæˆTCPæµå‘é€ç»™h2ã€‚ h3-\u0026gt;h4ï¼šæ­£å¸¸æµï¼Œh3ä¸Šä½¿ç”¨iperfç”ŸæˆTCPæµå‘é€ç»™h4ã€‚  ã€€ç»“æœå¦‚å›¾7ï¼Œ å…¶ä¸­noMisbehaving-forwardè¡¨ç¤ºh1-\u0026gt;h2ï¼Œh3-\u0026gt;h4éƒ½æ˜¯æ­£å¸¸æµï¼›Misbehaving-noReactionè¡¨ç¤ºh1è¡Œä¸ºå¼‚å¸¸ï¼Œä½†äº¤æ¢æœºä¸åšå¤„ç†ï¼›Misbehaving-ECEreactionè¡¨ç¤ºåªå®ç°äº†ECEçº æ­£ï¼Œæœªå®ç°å…¶å®ƒçº æ­£ï¼›Misbehaving-fullReactionå®Œå…¨å®ç°äº†å›¾5çš„EFSMçŠ¶æ€æœºã€‚\nå›¾7 ECNè¡Œä¸ºå¯¹å¸¦å®½çš„å½±å“:\r\r ã€€å¯¹äºMisbehaving-noReactionï¼Œå¯ä»¥çœ‹åˆ°å¼‚å¸¸æµh1-\u0026gt;h2æ¶ˆè€—äº†å¤§éƒ¨åˆ†å¯ç”¨å¸¦å®½ï¼Œæµh3-\u0026gt;h4å—åˆ°äº†æŸå¤±ã€‚å®é™…ä¸Šï¼Œæ­£å¸¸æµï¼ˆh3-\u0026gt;h4ï¼‰å“åº”æ‹¥å¡ä¿¡å·å¹¶é™ä½å…¶ä¼ è¾“é€Ÿç‡ï¼Œä»è€Œä¸ºè¡Œä¸ºå¼‚å¸¸çš„æµç•™å‡ºæ›´å¤šçš„é˜Ÿåˆ—ç©ºé—´ï¼Œä»è€Œè·å¾—äº†æ›´å¤šçš„å¸¦å®½ä»½é¢ã€‚ä½†æ˜¯ï¼Œæœ‰æ•ˆååé‡ä»ç„¶å—åˆ°å‘é€æ–¹å®¹é‡çš„é™åˆ¶ï¼Œå› æ­¤è¡Œä¸ºå¼‚å¸¸æµçš„å¢åŠ ä½äºå“åº”æµååé‡çš„æŸå¤±ã€‚\nã€€å¯¹äºMisbehaving-ECEreactionï¼Œé‡æ–°æ­£å¸¸çš„åˆ†é…å¸¦å®½ï¼Œæ­£å¸¸æµçš„æŸå¤±é™ä½ï¼Œä½†æ•´ä½“ååé‡ä¸‹é™ã€‚\nã€€å¯¹äºMisbehaving-fullReactionï¼Œååé‡ä¸¥é‡ä¸‹é™ï¼Œç”šè‡³ä¸å¦‚Misbehaving-noReactionã€‚\nã€€æ ¹æ®ä¸Šè¿°å®éªŒç»“æœï¼Œå»ºè®®éƒ¨åˆ†éƒ¨ç½²EFSMã€‚\nã€€åœ¨éƒ¨ç½²EFSMä¹‹å‰ï¼Œå¿…é¡»å…ˆéªŒè¯æ˜¯å¦é€‚åˆç½‘ç»œæ¡ä»¶ï¼›EFSMè¶Šå¤æ‚ï¼Œå¼€é”€è¶Šé«˜ã€‚ï¼ˆEFSMè™½ç„¶æœ‰æ•ˆä½†ä¸æ˜¯ç‰¹åˆ«å¥½ï¼‰\n","description":"å»ºç«‹ECNæ»¥ç”¨é˜²å¾¡çš„EFSM(æœ‰é™çŠ¶æ€æœº)æ¨¡å‹ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°P4ç¨‹åºä¸Šï¼Œå®ç°æ•°æ®å¹³é¢çš„ECNæ»¥ç”¨é˜²å¾¡","id":12,"section":"posts","tags":["P4"],"title":"è®ºæ–‡é˜…è¯»ï¼šåŸºäºP4çš„ECNæ»¥ç”¨é˜²å¾¡","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E5%9F%BA%E4%BA%8Ep4%E7%9A%84ecn%E5%8D%8F%E8%AE%AE%E6%BB%A5%E7%94%A8%E9%98%B2%E5%BE%A1/"},{"content":"1 æ¦‚è¿° ã€€S3: Simple Storage Service æ˜¯å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå…·ä½“æ¥è¯´æ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªURLï¼ˆå¦‚http://endpoint_url/\u0026lt;bucket_name\u0026gt;/\u0026lt;key\u0026gt;ï¼‰è·å–å­˜å‚¨å¯¹è±¡ï¼ŒæœåŠ¡å¯¹å¤–æä¾›HTTPæ¥å£ï¼Œå¯ä»¥é€šè¿‡PUTè¯·æ±‚ä¸Šä¼ å¯¹è±¡ï¼ŒGETè¯·æ±‚è·å–å¯¹è±¡ç­‰ã€‚\nã€€åº”ç”¨åœºæ™¯ï¼ˆå¤§æ•°æ®åˆ†æï¼‰ï¼šå†…å®¹å­˜å‚¨å’Œåˆ†å‘ï¼›ç”¨äºæ•°æ®åˆ†æçš„å­˜å‚¨ï¼›å¤‡ä»½ã€å­˜æ¡£ä¸ç¾éš¾æ¢å¤ï¼›é™æ€ç½‘ç«™æ‰˜ç®¡ã€‚\nã€€ä»ä»»æ„ä½ç½®å­˜å‚¨å’Œæ£€ç´¢ä»»æ„æ•°é‡çš„æ•°æ®è€Œæ„å»ºçš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ˜¯é¢å‘å¯¹è±¡çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆé™æ€æ–‡ä»¶ä¸€æ¬¡å†™å…¥ï¼Œä¸é€‚åˆç»å¸¸ä¿®æ”¹çš„æ–‡ä»¶ã€‚\nã€€S3ä¸­çš„æ¦‚å¿µBucket ã€Object ã€Endpoint ã€AccessKey å’ŒSecretKey ï¼š\n Bucketï¼šå­˜æ”¾Objectçš„å®¹å™¨ï¼Œä¸èƒ½åµŒå¥—ã€‚ Objectï¼šå¯¹è±¡ï¼ŒåŒ…å«keyå’Œvalueã€‚ Endpointï¼šå¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸåã€‚ AccessKeyï¼šASCIIå­—ç¬¦ä¸²ï¼Œç”¨äºæ ‡è¯†å®¢æˆ·èº«ä»½ã€‚ SecretKeyï¼šASCå­—ç¬¦ä¸²ï¼Œä½œä¸ºç§é’¥å­˜å‚¨åœ¨å®¢æˆ·æœåŠ¡å™¨ï¼Œä¸åœ¨ç½‘ç»œä¸­ä¼ é€’ï¼›ä½¿ç”¨AccessKeyè¿›è¡Œèº«ä»½è¯†åˆ«ï¼Œç”¨SecretKeyè¿›è¡Œæ•°å­—ç­¾åï¼Œä»è€Œå®Œæˆåº”ç”¨æ¥å…¥ä¸è®¤è¯æˆæƒï¼›ç”¨äºè®¿é—®æ¡¶ã€è·å–æ¡¶æ‰€åœ¨çš„æ•°æ®ä¸­å¿ƒã€‚  2 å¯¹è±¡å­˜å‚¨ ã€€æ‰å¹³åŒ–çš„å‘½åç©ºé—´ï¼šå°†æ•°æ®ä»¥å¯¹è±¡ï¼ˆObjectï¼‰å½¢å¼å­˜å‚¨åœ¨æ¡¶ï¼ˆBucketï¼‰ä¸­ï¼Œé€šè¿‡æ¡¶åç§°å’Œå¯¹è±¡çš„é”®åï¼ˆBucket_name + Key_nameï¼‰æ¥å®šä½ä¸€ä¸ªå¯¹è±¡çš„æœ€ç»ˆè·¯å¾„ã€‚\nã€€å¯¹è±¡ï¼ˆObjectï¼‰ï¼šç”±é”®åï¼ˆKeyï¼‰ã€é”®å€¼ï¼ˆValueï¼‰ã€è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€å…ƒæ•°æ®ï¼ˆMetadataï¼‰ç»„æˆã€‚\nå›¾1 S3å¯¹è±¡:\r\r 3 Amazon S3çš„ä½¿ç”¨ 3.1 æ³¨å†Œ ã€€(1)æ™®é€šå…è´¹ä¸€å¹´çš„Amazonè´¦å·éœ€è¦ç»‘å®šé“¶è¡Œå¡ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¥‡æ€ªçš„è´¹ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å­¦ç”Ÿè´¦å·ï¼Œä»https://www.awseducate.com/æ³¨å†Œï¼Œæ³¨å†Œåç‚¹å‡»ç™»å½•ã€‚\nå›¾2 ç™»å½•:\r\r ã€€(2)å³ä¸Šå¯¼èˆªæ \u0026quot;AWS Acount\u0026quot;ï¼Œç‚¹å‡»â€œAWS Educate Starter Accountâ€\nå›¾3 è¿›å…¥å­¦ç”Ÿè´¦å·:\r\r ã€€(3)è¿›å…¥ä¸‹å›¾é¡µé¢åï¼Œç‚¹å‡»AWS Consoleï¼Œå³å¯è¿›å…¥AWSæ§åˆ¶å°\nå›¾4 è¿›å…¥AWSæ§åˆ¶å°:\r\r ã€€(4)åœ¨æ§åˆ¶å°ç•Œé¢æœç´¢S3ï¼Œè¿›å…¥S3æ§åˆ¶å°\nå›¾5 è¿›å…¥S3æ§åˆ¶å°:\r\r ã€€(5)åˆ›å»ºä¸€ä¸ªBucketç”¨äºæµ‹è¯•\nå›¾6 åˆ›å»ºä¸€ä¸ªæ¡¶:\r\r 3.2 è·å–AcessKeyå’ŒSecretKey ã€€åœ¨å®¢æˆ·ç«¯ä½¿ç”¨S3æ—¶ï¼Œéœ€è¦é…ç½®è®¤è¯Keyï¼Œå³AccessKeyå’ŒSecretKeyï¼Œæ‰èƒ½å’ŒS3å»ºç«‹è¿æ¥ï¼Œæ™®é€šç”¨æˆ·åœ¨æ§åˆ¶å°ä¸»é¡µæœç´¢IAMï¼ŒæŒ‰ç…§ç½‘ä¸Šçš„è§£å†³æ–¹æ¡ˆç”ŸæˆAccessKeyå³å¯ã€‚æ•™è‚²è´¦å·éœ€è¦åœ¨ä¸‹å›¾è¿™ä¸ªç•Œé¢ç‚¹å‡»â€œAccount Detailsâ€\nå›¾7 è¿›å…¥AWSæ§åˆ¶å°:\r\r ã€€åœ¨å¼¹å‡ºçš„å­çª—å£ä¸­ç‚¹å‡»â€œshowâ€ï¼Œåˆ™èƒ½å¤Ÿè·å¾—AccessKeyå’ŒSecretKeyï¼Œå…¶æœ‰æ•ˆæœŸæ˜¯ä¸‰å°æ—¶\nå›¾8 è·å–AccessKey:\r\r 3.3 ä½¿ç”¨pythonæ“ä½œS3 ã€€boto3æ˜¯S3å®˜æ–¹å»ºè®®ä½¿ç”¨çš„pythonåŒ…ï¼Œå®‰è£…ï¼š\n1  $ pip install boto3   ã€€è¿æ¥åˆ°s3ï¼šä½¿ç”¨ä¸Šé¢2ä¸­è·å¾—çš„AccessKeyå’ŒSecretKeyå°±å¯ä»¥ï¼Œä¸æŠ¥é”™å°±è¿ä¸Šäº†ï¼Œæ³¨æ„ä¸€å®šè¦æœ‰session_tokenï¼Œå¦åˆ™ä¼šæŸ¥æ‰¾ä¸åˆ°AccessKeyã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  #!/usr/bin/python #encoding:utf-8  import boto3 from boto3.session import Session session = Session(aws_access_key_id=\u0026#39;ASIASR3FIDV6NEAZGO3V\u0026#39;, aws_secret_access_key=\u0026#39;1WuKe42HfTslTtMuH885D442t1OWVo/vg59Uk/N3\u0026#39;, aws_session_token=\u0026#39;\u0026lt;å¤ªé•¿äº†ï¼Œç•¥è¿‡ä¸å†™\u0026gt;\u0026#39;, region_name=\u0026#39;us-east-1\u0026#39;) s3 = session.resource(\u0026#39;s3\u0026#39;) client = session.client(\u0026#39;s3\u0026#39;) #ä¸Šä¼  data = open(\u0026#39;pcapng-demo.pcap.pcapng\u0026#39;, \u0026#39;rb\u0026#39;) file_obj = s3.Bucket(\u0026#39;mesalybtest\u0026#39;).put_object(Key=\u0026#39;pcapng-demo.pcap.pcapng\u0026#39;, Body=data) #è·å–URL presigned_url = client.generate_presigned_url( \u0026#39;get_object\u0026#39;, Params={\u0026#39;Bucket\u0026#39;: file_obj.bucket_name, \u0026#39;Key\u0026#39;: file_obj.key}, ExpiresIn= 3600*30*12 ) print(presigned_url)   4 å‚è€ƒèµ„æ–™ 1.ä¸€æ–‡è¯»æ‡‚AWS S3ï¼šhttps://zhuanlan.zhihu.com/p/112057573\n2.å¯¹è±¡å­˜å‚¨æ¦‚å¿µï¼šhttps://cloud.tencent.com/developer/article/1073409\n3.AWS S3å¼€å‘æŒ‡å—ï¼šhttps://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/VirtualHosting.html#path-style-access\n4.KS3å¯¹è±¡å­˜å‚¨æ¦‚å¿µï¼šhttps://docs.ksyun.com/documents/2286\n5.file_transferï¼šhttps://docs.aws.amazon.com/code-samples/latest/catalog/python-s3-file_transfer-demo_file_transfer.py.html\n6.boto3å®˜æ–¹ä½¿ç”¨ï¼šhttps://github.com/boto/boto3\n7.ä½¿ç”¨Pythonæ“ä½œAmazon S3ï¼šhttps://xingzuoshe.cn/python-operate-s3.html\nbin/kafka-console-consumer.sh \u0026ndash;bootstrap-server localhost:9092 \u0026ndash;topic test \u0026ndash;from-beginning\n","description":"S3æœåŠ¡çš„ä½¿ç”¨","id":13,"section":"posts","tags":["åˆ†å¸ƒå¼"],"title":"å·¥å…·ä½¿ç”¨ï¼šS3","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8s3/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šDistributed SIP DDoS Defense with P4\nã€€ä¼šè®®ä¿¡æ¯ï¼š2019 IEEE Wireless Communications and Networking Conference (WCNC)\nã€€æˆæœï¼šåˆ©ç”¨å¯ç¼–ç¨‹äº¤æ¢æœºç¼“è§£SIP INVITE DDoSæ”»å‡»\nã€€è´¡çŒ®ï¼šé€šè¿‡å¯¹ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ•°æ®å¹³é¢ç¼–ç¨‹ï¼ˆP4ï¼‰å’Œæ§åˆ¶å¹³é¢ç¼–ç¨‹è¿›è¡Œå®éªŒï¼Œä¸ºæ¯ä¸ªäº¤æ¢ç«¯å£çš„SIP INVITE DDoSæ”»å‡»æä¾›ç¬¬ä¸€è·³æ£€æµ‹å’Œç¼“è§£åŠŸèƒ½ã€‚\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šåŸºäºç›®æ ‡çš„æ–¹æ³•éœ€è¦ç½‘ç»œè®¾å¤‡ä¸Šå¤§é‡CPUå’Œå†…å­˜èµ„æºï¼›ç¼ºå°‘ç¬¬ä¸€è·³æ£€æµ‹å’Œç¼“è§£ï¼Œæ£€æµ‹å’Œè¯†åˆ«SIPäº‹åŠ¡çš„ä¼ æ„Ÿå™¨å¤ªå°‘ï¼›ç¼“è§£ç‚¹æ•°é‡æœ‰é™ã€‚\nã€€æœ¬æ–‡å·¥ä½œï¼šé€šè¿‡ä½¿ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ•°æ®å¹³é¢ç¼–ç¨‹è¿›è¡ŒSIP DDoSæ£€æµ‹ï¼Œå¯¹ä»¥å¤ªç½‘äº¤æ¢æœºä¸Šæ¯ä¸ªç«¯å£çš„ç¬¬ä¸€è·³SIP DDoSæ”»å‡»æ£€æµ‹å’Œç¼“è§£åŠŸèƒ½ä»¥åŠåˆ†å¸ƒå¼SIPåœ¨ç½‘ç»œè¾¹ç¼˜ä½¿ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºçš„DDoSé˜²å¾¡æ–¹æ³•ã€‚\nä¸€ã€èƒŒæ™¯ 1.SIP Floodæ”»å‡»  æ¥æºï¼šhttps://forum.huawei.com/enterprise/zh/thread-298913.html\n ã€€SIP(Session Initiation Protocol)æ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„ä¿¡ä»¤æ§åˆ¶åè®®ã€‚ç”¨äºåˆ›å»ºã€ä¿®æ”¹å’Œé‡Šæ”¾ä¸€ä¸ªæˆ–å¤šä¸ªå‚ä¸è€…çš„ä¼šè¯ã€‚è¿™äº›ä¼šè¯å¯ä»¥æ˜¯Internetå¤šåª’ä½“ä¼šè®®ã€IPç”µè¯æˆ–å¤šåª’ä½“åˆ†å‘ã€‚ä¾‹å¦‚ï¼ŒSIPæœåŠ¡æä¾›å•†å¯ä»¥å»ºç«‹åŒ…å«è¯­éŸ³ã€è§†é¢‘å’ŒèŠå¤©å†…å®¹çš„å…¨æ–°åª’ä½“ã€‚\n1.1 SIPåè®®æµç¨‹ç®€ä»‹  å‚è€ƒï¼šhttps://blog.csdn.net/c80486/article/details/43391961\nå‚è€ƒï¼šhttps://www.w3cschool.cn/session_initiation_protocol/session_initiation_protocol_messaging.html\n ã€€SIPåè®®å·¥ä½œçš„æµç¨‹å’Œäººæ‰“ç”µè¯çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºè½¯ç”µè¯ï¼Œä¸åŒä¹‹å¤„ä¸æ˜¯é€šè¿‡è®²è¯è€Œæ˜¯é€šè¿‡IPæ•°æ®åŒ…æ¥ä¼ é€’ä¿¡æ¯ã€‚\nã€€SIPé»˜è®¤ç«¯å£ä¸º5060ï¼Œé»˜è®¤é‡‡å–UDPä¼ è¾“ã€‚\nã€€SIPè´¦å·ï¼šé‡‡ç”¨URIè¡¨ç¤ºæ–¹æ³•ï¼Œå³sip:username@ip:portï¼Œå…¶ä¸­ipä¹Ÿå¯ä»¥å¡«å†™æœåŠ¡å™¨æ‰€å±åŸŸåã€‚\nã€€SIPæ¶ˆæ¯ï¼šç”¨æ¥ä¼ é€’é€šè¯ä¿¡å·çš„IPæ•°æ®åŒ…ã€‚åŒ…æ‹¬6ä¸­æ ¸å¿ƒæ¶ˆæ¯ï¼šINVITEã€BYEã€REGISTERã€CANCELã€ACKã€OPTIONSã€‚\nã€€SIPé€šè¯è¿‡ç¨‹å¦‚å›¾1ã€‚\nå›¾1 SIPé€šè¯è¿‡ç¨‹ :\r\r  Aliceå‘Bobå‘é€ä¸€ä¸ªè¯·æ±‚SIPæ¶ˆæ¯INVITEï¼Œé‚€è¯·Bobå‚ä¸é€šè¯ BobæŒ¯é“ƒï¼Œå‘Aliceå›å¤å“åº”180 Ringingï¼Œé€šçŸ¥Aliceè‡ªå·±æ­£åœ¨æŒ¯é“ƒï¼Œè¯·Aliceç­‰å¾… Bobæ¥èµ·è½¯ç”µè¯ï¼Œå‘Aliceå‘é€å“åº”200 OKï¼Œé€šçŸ¥Aliceå¯ä»¥é€šè¯äº† Aliceå‘Bobå‘é€è¯·æ±‚SIPæ¶ˆæ¯ACKï¼Œé€šè¯æ­£å¼å»ºç«‹ ç„¶åå¼€å§‹é€šè¯ï¼Œé€šè¿‡RTPæˆ–TCP BobæŒ‚æ‰è½¯ç”µè¯ï¼Œå‘Aliceå‘é€è¯·æ±‚SIPæ¶ˆæ¯BYEï¼Œé€šçŸ¥Aliceé€šè¯ç»“æŸ Aliceå‘Bå›å¤ä¸€ä¸ª200 OKï¼Œé€šè¯ç»“æŸã€‚  1.2 SIP Floodçš„æºè®¤è¯é˜²å¾¡åŸç†  æ¥æºï¼šhttps://blog.csdn.net/c80486/article/details/43391961\n ã€€æ”»å‡»è€…é€šè¿‡å‘é€å¤§é‡çš„INVITEæ¶ˆæ¯æˆ–REGISTERæ¶ˆæ¯åˆ°SIPæœåŠ¡å™¨ï¼Œå¯¼è‡´è¢«æ”»å‡»SIPæœåŠ¡å™¨åˆ†é…å¤§é‡çš„èµ„æºç”¨ä»¥è®°å½•å’Œè·Ÿè¸ªä¼šè¯ï¼Œç›´åˆ°èµ„æºè€—å°½è€Œæ— æ³•å“åº”åˆæ³•ç”¨æˆ·çš„å‘¼å«è¯·æ±‚ï¼›æˆ–è€…é’ˆå¯¹VoIPè®¾å¤‡åœ¨SIPåè®®å®ç°ä¸Šçš„æ¼æ´æ„é€ å¹¶å‘é€ç›¸åº”çš„ç•¸å½¢SIPæŠ¥æ–‡ï¼Œä»è€Œå¯¼è‡´SIPæœåŠ¡å™¨æ‹’ç»æœåŠ¡ã€‚\nã€€OPTIONSæ–¹æ³•ç”¨äºSIPåè®®é€šä¿¡åŒæ–¹æŸ¥è¯¢å¯¹æ–¹æ”¯æŒçš„æ–¹æ³•ã€å†…å®¹ç±»å‹ã€æ‰©å±•ç­‰ã€‚SIPæºè®¤è¯æ˜¯å‘é€OPTIONSè¯·æ±‚æŠ¥æ–‡ä½œä¸ºæ¢æµ‹æŠ¥æ–‡æ¢æµ‹æºçš„çœŸå®æ€§ï¼Œå¦‚æœå‘é€ç«¯çš„æºIPçœŸå®å­˜åœ¨ï¼Œå°±ä¼šå¯¹è¯¥æ¢æµ‹æŠ¥æ–‡è¿›è¡Œå›åº”ï¼ŒAnti-DDoSè®¾å¤‡æ£€æŸ¥å›åº”æŠ¥æ–‡æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™å…è®¸é€šè¿‡ï¼Œå°†æºIPåœ°å€åŠ å…¥ç™½åå•ï¼Œå¦åˆ™ä¸¢å¼ƒæŠ¥æ–‡ã€‚å…·ä½“å¤„ç†è¿‡ç¨‹å¦‚å›¾2æ‰€ç¤ºã€‚\nå›¾2 SIPæºè®¤è¯ :\r\r äºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€P4æ§åˆ¶å™¨é€šè¿‡TCPå¥—æ¥å­—è¿æ¥æ§åˆ¶P4äº¤æ¢æœºã€‚\nã€€äº¤æ¢æœºä¸Šçš„æ¯ä¸ªç«¯å£éƒ½å¯ä»¥å¯¹INVITEæˆ–REGISTERæ‰§è¡Œæ•°æ®åŒ…æ£€æŸ¥ï¼Œæ¯ä¸ªç«¯å£éƒ½æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯¹æ”¶åˆ°çš„INVITEæˆ–REGISTERçš„æ•°é‡è¿›è¡Œè®¡æ•°ã€‚\nã€€P4æ§åˆ¶å™¨æ¯ç§’éƒ½å¯¹è¿™ä¸ªè®¡æ•°å™¨è¿›è¡Œè¯„ä¼°ï¼Œç¡®å®šæ˜¯å¦å‘ç”Ÿäº†SIP INVITE Floodæ”»å‡»ï¼Œå½“ç¡®å®šå‘ç”Ÿäº†æ”»å‡»æ—¶ï¼Œå®ƒå‘P4äº¤æ¢æœºå‘é€ä¸€æ¡å‘½ä»¤ï¼Œä»¥ä»è¯¥ç‰¹å®šç«¯å£ä¸¢å¼ƒåç»­çš„INVITEæˆ–REGISTERæ•°æ®åŒ…ã€‚å½“æ”»å‡»åœæ­¢1åˆ†é’Ÿåï¼ŒP4æ§åˆ¶å™¨å‘P4äº¤æ¢æœºå‘é€å‘½ä»¤ï¼Œä»è€Œæ¢å¤åˆ°æ­£å¸¸å¤„ç†æ¨¡å¼ã€‚\nå›¾3 ç³»ç»Ÿè®¾è®¡ :\r\r ä¸‰ã€å®ç° 1.1 P4æ§åˆ¶å™¨ï¼šPythonè„šæœ¬ ã€€åˆå§‹åŒ–ï¼šåˆå§‹åŒ–è¡¨é¡¹ï¼Œåœ¨sipinvite_tableè¡¨ä¸­æ·»åŠ \u0026lt;å…¥å£ç«¯å£ SIPæ•°æ®åŒ…ç¬¬ä¸€è¡Œ\u0026gt;çš„è¡¨é¡¹ï¼Œå¹¶è®¾ç½®é»˜è®¤æ“ä½œä¸º_nopï¼ˆå³æ— æ“ä½œï¼‰ï¼Œä¾‹ï¼štable_add sipinvite_table _nop 2 0x494e56495445 =\u0026gt;\nã€€è¯„ä¼°sipinviteè®¡æ•°å™¨ï¼šè®¡æ•°å™¨æ¯ç§’æ£€æŸ¥æ¯ä¸ªäº¤æ¢æœºç«¯å£ä¸Šçš„sipinvite_counteræ¥å®ç°æ”»å‡»æ£€æµ‹ã€‚ä¾‹ï¼šcounter_read sipinvite_counter 2ï¼Œæ£€æŸ¥ç«¯å£2æ¥æ”¶åˆ°çš„SIP INVITEæ•°æ®åŒ…çš„æ•°é‡ã€‚\nã€€é€šè¿‡æˆ–æ”¾å¼ƒï¼šå½“æ¯ç§’è¶…è¿‡10ä¸ªSIP INVITEæ•°æ®åŒ…æ—¶ï¼Œå°†æ£€æµ‹åˆ°SIP DOSæ”»å‡»ï¼Œä¸ºè¯¥ç«¯å£æ¿€æ´»DOSæ¨¡å¼ï¼Œå³å‘P4äº¤æ¢æœºå‘é€å‘½ä»¤å°†è¡¨sipinvite_tableçš„é»˜è®¤åŠ¨ä½œæ”¹ä¸ºdropã€‚å½“ä¸€åˆ†é’Ÿå†…SIP INVITEæ•°æ®åŒ…çš„ä¸ªæ•°éƒ½ä½äºé˜ˆå€¼æ—¶ï¼Œå°†ç«¯å£è®¾ç½®ä¸ºæ­£å¸¸æ¨¡å¼ï¼Œå³å‘P4äº¤æ¢æœºå‘é€å‘½ä»¤å°†è¡¨sipinvite_tableçš„é»˜è®¤åŠ¨ä½œæ”¹ä¸º_nopã€‚æ”»å‡»åœæ­¢åï¼Œå…è®¸åˆæ³•ç”¨æˆ·åœ¨æ¥ä¸‹æ¥çš„60ç§’å†…å‘èµ·å‘¼å«ã€‚\nå›¾4 sipinvite_tableè¡¨:\r\r 1.2 P4ç¨‹åº  å®šä¹‰ä»¥å¤ªç½‘å¸§ã€IPv4ã€UDPã€SIPæ•°æ®åŒ…ï¼Œåœ¨è§£æå™¨ä¸­è¿›è¡Œè§£æï¼› è®¾ç½®ipv4_lpmã€forwardã€sipinvite_tableè¡¨ï¼Œå‰ä¸¤ä¸ªç”¨äºå¸¸è§„IPæ•°æ®åŒ…è½¬å‘ï¼Œç¬¬ä¸‰ä¸ªè¡¨ç”¨äºæŸ¥æ‰¾SIP INVITEï¼Œkeyæ˜¯ingress_portå’ŒSIP INVITEã€‚ å®šä¹‰äº†ä¸€ä¸ªè®¡æ•°å™¨æ¥è®°å½•æ¯ä¸ªç«¯å£æ¥æ”¶åˆ°çš„SIP INVITEæ•°æ®åŒ…çš„æ•°é‡ï¼Œè¿æ¥åˆ°sipinvite_tableã€‚  å››ã€è¯„ä¼° ã€€ä½¿ç”¨å…·æœ‰2GB RAMå’Œ2ä¸ªCPUçš„Ubuntuè™šæ‹Ÿæœºæ¥è¿è¡Œmininetï¼Œåœ¨Ubuntuè™šæ‹Ÿæœºä¸Šåˆ›å»º3ä¸ªè™šæ‹Ÿä¸»æœºå’Œ3ä¸ªè™šæ‹Ÿäº¤æ¢æœºæ‹“æ‰‘ã€‚\n SIPä»£ç†ï¼ˆ10.0.0.1ï¼‰è¿æ¥åˆ°äº¤æ¢æœº1çš„ç«¯å£1 æ”»å‡»è€…ï¼ˆ10.0.0.2ï¼‰è¿æ¥åˆ°äº¤æ¢æœº2çš„ç«¯å£2 åˆæ³•ç”¨æˆ·ï¼ˆ10.0.0.3ï¼‰è¿æ¥åˆ°äº¤æ¢æœº- 3ç«¯å£3  ã€€æ§åˆ¶å™¨æ˜¯pythonè„šæœ¬ï¼Œåœ¨ä¸»æœºä¸Šè¿è¡Œï¼Œå¹¶é€šè¿‡å¥—æ¥å­—è¿æ¥ä¸ä¸‰ä¸ªäº¤æ¢æœºé€šä¿¡ï¼ˆäº¤æ¢æœº1çš„ç«¯å£TCP/22221ï¼Œäº¤æ¢æœº2çš„TCP/22222å’Œäº¤æ¢æœº3çš„TCP/ 22223ï¼‰ã€‚\nã€€ä½¿ç”¨bmv2 P4å…¼å®¹è™šæ‹Ÿäº¤æ¢æœºï¼Œè€Œä¸æ˜¯minineté™„å¸¦çš„é»˜è®¤è™šæ‹Ÿäº¤æ¢æœºï¼›ç”¨p4c-bmçš„P4é…ç½®ç”Ÿæˆå™¨ç”¨äºå°†P4ä»£ç è½¬æ¢ä¸ºbmv2æ‰€éœ€çš„JSONé…ç½®æ–‡ä»¶ã€‚\nã€€SIPpæ˜¯ç”¨äºç”ŸæˆSIPæµé‡çš„SIPæ•°æ®åŒ…ç”Ÿæˆå·¥å…·ã€‚å¯¹äºSIPä»£ç†ï¼Œå®ƒè®¾ç½®ä¸ºåœ¨ç”¨æˆ·ä»£ç†æœåŠ¡å™¨ï¼ˆUASï¼‰æ¨¡å¼ä¸‹è¿è¡Œï¼Œè€Œå¯¹äºSIPå®¢æˆ·ç«¯ï¼Œå®ƒåœ¨ç”¨æˆ·ä»£ç†å®¢æˆ·ç«¯ï¼ˆUACï¼‰æ¨¡å¼ä¸‹è¿è¡Œã€‚\nã€€æ•°æ®åŒ…æ•è·ï¼ˆpcapï¼‰å®ç”¨å·¥å…·tsharkç”¨äºéªŒè¯SIPä»£ç†ï¼ˆåœ¨äº¤æ¢æœº1ï¼šç«¯å£1ï¼‰å’ŒSIPå®¢æˆ·ç«¯ï¼ˆåœ¨äº¤æ¢æœº2ï¼šç«¯å£2ï¼‰å‘é€å’Œæ¥æ”¶çš„æ•°æ®åŒ…ã€‚\nå›¾5 æµ‹è¯•ç¯å¢ƒ:\r\r ã€€è¯„ä¼°ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ–¹é¢ï¼šæ£€æµ‹å’Œç¼“è§£èƒ½åŠ›ï¼›æ£€æµ‹å’Œç¼“è§£æ—¶é—´ï¼›ç³»ç»Ÿèµ„æºæ¶ˆè€—\nã€€è¯„ä¼°è·Ÿè¸ªå˜é‡ï¼šå‘é€å’Œæ¥æ”¶çš„SIP INVITEæ•°æ®åŒ…æ•°ï¼›å‘é€å’Œæ¥æ”¶çš„ICMPæ•°æ®åŒ…æ•°ï¼›CPUå’Œå†…å­˜æ¶ˆè€—\nã€€è¯„ä¼°ç»“æœè¡¨æ˜ï¼š\n P4äº¤æ¢æœºä»…ä¸¢å¼ƒSIP INVITEæ•°æ®åŒ…ï¼ŒICMPæ•°æ®åŒ…ä¸å—å½±å“ï¼Œå¦‚æœè®¡ç®—æœºæ„ŸæŸ“äº†åƒµå°¸ç½‘ç»œ/æ¶æ„è½¯ä»¶ï¼Œåˆ™åœ¨é˜»æ­¢ç”±æ¶æ„è½¯ä»¶ç”Ÿæˆçš„SIP INVITEæ•°æ®åŒ…çš„åŒæ—¶ï¼Œç”¨æˆ·ä»ç„¶å¯ä»¥ä½¿ç”¨å…¶ä»–åº”ç”¨ç¨‹åºã€‚ å¼€å§‹é˜»æ­¢SIP INVITEæ•°æ®åŒ…æ‰€èŠ±è´¹çš„æ—¶é—´ä¸º1.47ç§’ã€‚ åœ¨æ”»å‡»æœŸé—´ï¼Œå¹³å‡CPUåˆ©ç”¨ç‡ä¸º24.49ï¼…ï¼ˆå³°å€¼ä¸º71ï¼…ï¼‰ã€‚å†…å­˜æ¶ˆè€—æœ€é«˜è¾¾åˆ°3ï¼…ã€‚  ","description":"åˆ©ç”¨å¯ç¼–ç¨‹äº¤æ¢æœºå’ŒP4è¯­è¨€å®ç°åŸºäºæºçš„SIP Floodæ”»å‡»é˜²å¾¡å’Œç¼“è§£","id":14,"section":"posts","tags":["P4"],"title":"è®ºæ–‡é˜…è¯»ï¼šåŸºäºP4çš„SIP DDoSæ”»å‡»é˜²å¾¡","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E5%9F%BA%E4%BA%8Ep4%E7%9A%84sip-ddos%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1/"},{"content":"1 æ¦‚è¿° ã€€Kafkaæ˜¯æ¶ˆæ¯ç³»ç»Ÿã€‚\n  æ¶ˆæ¯ç³»ç»Ÿï¼šåœ¨åº”ç”¨ç¨‹åºä¹‹é—´å‘é€æ¶ˆæ¯\n  åº”ç”¨åœºæ™¯ï¼šæ—¥å¿—æ”¶é›†ç³»ç»Ÿå’Œæ¶ˆæ¯ç³»ç»Ÿï¼Œé‡‡ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼\n  å¸¸ç”¨çš„Message Queueï¼šRabbitMQ(é‡é‡çº§)ï¼ŒRedisï¼ŒZeroMQï¼ŒActiveMQï¼ŒKafka\n  ã€€kafkaå·¥ä½œç¤ºæ„å›¾ï¼š\nå›¾1 kafkaå·¥ä½œç¤ºæ„å›¾:\r\r ã€€topicï¼šæ¶ˆæ¯ç±»åˆ«\nã€€partitionï¼štopicä¸­çš„æ•°æ®åˆ†å‰²æˆpartitionï¼Œpartitionä¸­çš„æ•°æ®ç”±å¤šä¸ªsegmentæ–‡ä»¶å­˜å‚¨ï¼Œpartitionä¸­çš„æ•°æ®ï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æœ‰åºçš„ï¼›åŒä¸€ä¸ªPartitionçš„Replicaå°½é‡åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚\npartitionä¸­çš„0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œæ˜¯offsetï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯ä½ç½®ï¼Œç”±Consumerå†³å®šï¼ŒConsumeræ¶ˆè´¹å®Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šé€’å¢offsetã€‚\nã€€brokerï¼šå­˜å‚¨partitionçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œä¸€ä¸ªbrokerå­˜å‚¨topicçš„ä¸€ä¸ªpartitionï¼›brokeræ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯åï¼Œå°†è¯¥æ¶ˆæ¯è¿½åŠ åˆ°å½“å‰ç”¨äºè¿½åŠ æ•°æ®çš„segmentæ–‡ä»¶ä¸­ã€‚\nã€€Producerä½¿ç”¨pushæ¨¡å¼å°†æ¶ˆæ¯å‘å¸ƒåˆ°brokerï¼ŒConsumerä½¿ç”¨pullæ¨¡å¼ä»brokerè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚ï¼ˆPushæ¨¡å¼ï¼šä¸»åŠ¨å‘é€å†…å®¹æ›´æ–°ï¼›Pullæ¨¡å¼ï¼šè¯¢é—®æ˜¯å¦æœ‰æ›´æ–°ï¼‰\nã€€Producerå‘é€æ¶ˆæ¯åˆ°brokerï¼Œä¼šæ ¹æ®Partitionæœºåˆ¶é€‰æ‹©å°†å…¶å­˜å‚¨åˆ°å“ªä¸ªPartitionï¼Œå¦‚æœPartitionæœºåˆ¶è®¾ç½®åˆç†ï¼Œæ‰€æœ‰æ¶ˆæ¯å¯ä»¥å‡åŒ€åˆ†å¸ƒåˆ°ä¸åŒPartitionä¸­ã€‚åœ¨å‘é€ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¿™æ¡æ¶ˆæ¯çš„keyï¼ŒProduceræ ¹æ®è¿™ä¸ªkeyå’ŒPartitionæœºåˆ¶æ¥åˆ¤æ–­å°†è¿™æ¡æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªPartitionã€‚\nã€€åŒä¸€Topicçš„ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ªConsumer Groupå†…çš„ä¸€ä¸ªConsumeræ¶ˆè´¹ï¼Œä½†å¤šä¸ªConsumer Groupå¯åŒæ—¶æ¶ˆè´¹è¿™ä¸€æ¶ˆæ¯ã€‚\nã€€å¹¿æ’­ï¼šæ¯ä¸ªConsumeræœ‰ä¸€ä¸ªç‹¬ç«‹çš„Groupï¼Œå•æ’­ï¼šæ‰€æœ‰çš„Consumeråœ¨åŒä¸€ä¸ªGroupé‡Œã€‚\nã€€å¯¹äºkafkaè€Œè¨€ï¼Œpullæ¨¡å¼æ›´åˆé€‚ï¼Œä½¿Consumerè‡ªä¸»æ§åˆ¶æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿç‡ã€‚\nã€€kafkaé»˜è®¤ä¿è¯ At least oneï¼Œå³æ¶ˆæ¯ç»ä¸ä¼šä¸¢ï¼Œä½†å¯èƒ½ä¼šé‡å¤ï¼šä½“ç°åœ¨è®¾ç½®å‚æ•°ä¸ºauto_offset_reset='earliest'ï¼Œå¦‚æœConsumer Groupä¸­çš„ä¸€ä¸ªConsumeræŒ‚äº†ï¼Œå‰©ä½™çš„Consumerä¼šé‡æ–°ä»å¤´æ¶ˆè´¹æ¶ˆæ¯ã€‚\nã€€Producerå’ŒConsumeråªä¸Leaderäº¤äº’ï¼Œå…¶ä»–Replicaä½œä¸ºFollowerä»Leaderä¸­å¤åˆ¶æ•°æ®ã€‚\n2 å®‰è£…  å®‰è£…æ–¹æ³•ï¼šhttps://blog.csdn.net/qq_42881421/article/details/86741617\nè½¯é“¾æ¥ç”¨æ³•ï¼šhttps://blog.csdn.net/Leonis_v/article/details/52353706\n å®‰è£…ç¯å¢ƒï¼šubuntu16.0.4\nã€€(1)ä¸‹è½½åœ°å€ï¼šhttps://kafka.apache.org/downloads\nã€€å¦‚ï¼škafka_2.12-2.7.0.tgzï¼Œå…¶ä¸­2.12æ˜¯Scalaç‰ˆæœ¬å·ï¼Œ2.7.0æ˜¯kafkaç‰ˆæœ¬å·ã€‚\nã€€(2)è§£å‹å®‰è£…åŒ…\n1 2  $ cd soft/ $ tar -zxf kafka_2.11-0.10.2.0.tgz   ã€€(3)é…ç½®ç¯å¢ƒå˜é‡\n1  $ nano ~/.bashrc   ã€€æ·»åŠ ä¸‹åˆ—è¯­å¥ï¼š\n1 2  export KAFKA_HOME=~/soft/kafka export PATH=$PATH:$KAFKA_HOME/bin   ã€€(4)ä¿å­˜åï¼Œè®©ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ\n1  $ source ~/.bashrc   3 ç®€å•ä½¿ç”¨ 3.1 ä½¿ç”¨å®˜æ–¹æä¾›çš„Shellè„šæœ¬æ“ä½œkafka ã€€åœ¨kafkaçš„å®‰è£…ç›®å½•ä¸‹ï¼š\nã€€å¯åŠ¨Zookeeperï¼šbin/zookeeper-server-start.sh config/zookeeper.properties\n1  bin/zookeeper-server-start.sh config/zookeeper.properties   ã€€å¯åŠ¨kafkaï¼šbin/kafka-server-start.sh config/server.properties\n1  bin/kafka-server-start.sh config/server.properties   ã€€åˆ›å»ºtopicï¼šbin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor \u0026lt;\u0026gt; --partitions \u0026lt;partition_number\u0026gt; --topic \u0026lt;topic_name\u0026gt;\n1  bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test   ã€€å¯åŠ¨ç”Ÿäº§è€…ï¼šbin/kafka-console-producer.sh --broker-list \u0026lt;produce_servers\u0026gt; --topic \u0026lt;topic_name\u0026gt;\n1  bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test   ã€€å¯åŠ¨æ¶ˆè´¹è€…ï¼šbin/kafka-console-consumer.sh --bootstrap-server \u0026lt;consume_servers\u0026gt; --topic \u0026lt;topic_name\u0026gt;--from-beginning\n1  bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning   3.2 ä½¿ç”¨Pythonæ“ä½œKafka æ¶ˆè´¹è€… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  #!/usr/bin/python #encoding:utf-8  from kafka import KafkaConsumer import json \u0026#39;\u0026#39;\u0026#39; æ¶ˆè´¹è€… æ¶ˆè´¹testä¸»é¢˜ä¸­çš„æ•°æ® æ³¨æ„äº‹é¡¹ï¼šå¦‚éœ€ä»¥jsonæ ¼å¼è¯»å–æ•°æ®éœ€åŠ ä¸Švalue_deserializerå‚æ•° \u0026#39;\u0026#39;\u0026#39; def consume_to_kafka(): consumer = KafkaConsumer(\u0026#39;test1\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;, bootstrap_servers=[\u0026#39;localhost:9092\u0026#39;], value_deserializer=lambda m: json.loads(m.decode(\u0026#39;ascii\u0026#39;)) ) for message in consumer: test_data = message.value url = test_data[\u0026#39;packet_url\u0026#39;] print(url) if __name__ == \u0026#34;__main__\u0026#34;: try: consume_to_kafka() except KeyboardInterrupt: print(\u0026#34;Quit.\u0026#34;)   ç”Ÿäº§è€… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  #!/usr/bin/python #encoding:utf-8  from kafka import KafkaProducer import json def produce_one_item(topic, producer): pkt = { \u0026#34;id\u0026#34;: 1, \u0026#34;nicname\u0026#34;:\u0026#34;enp6s0\u0026#34;, \u0026#34;raw_packet\u0026#34;: \u0026#34;TOu9fJMVMKrkRBubCABFIAAoEh0AAHQGjPrYOtKuwKg8BwG75osRSr9s/dLbA1AQAQl1XgAAAAAAAAAA\u0026#34; } producer.send(topic, pkt) producer.close() def produce_more_items(count,topic,producer): i = 0 for i in range(count): pkt = { \u0026#34;id\u0026#34;: 1, \u0026#34;nicname\u0026#34;:\u0026#34;enp6s0\u0026#34;, \u0026#34;raw_packet\u0026#34;: \u0026#34;TOu9fJMVMKrkRBubCABFIAAoEh0AAHQGjPrYOtKuwKg8BwG75osRSr9s/dLbA1AQAQl1XgAAAAAAAAAA\u0026#34; } producer.send(topic, pkt) i = i + 1 #æ³¨æ„å…¨å‘å®Œäº†å†close producer.close() if __name__ == \u0026#34;__main__\u0026#34;: producer = KafkaProducer( value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;), bootstrap_servers=\u0026#34;localhost:9092\u0026#34; ) #produce_one_item(\u0026#39;test1\u0026#39;,producer) produce_more_items(2000,\u0026#39;test1\u0026#39;, producer)   3.3 kafkaæ¶ˆè´¹è€…åˆ†ç»„ä¸åˆ†åŒºæ•°ï¼ˆPartitionï¼‰çš„å…³ç³»  æ¥æºï¼šhttps://blog.csdn.net/gdkyxy2013/article/details/86644919\n  æ¶ˆè´¹è€…æ•° ï¼ åˆ†åŒºæ•°ï¼šå¤šä½™çš„æ¶ˆè´¹è€…ç©ºé—² æ¶ˆè´¹è€…æ•° ï¼œ åˆ†åŒºæ•°ï¼šå¤šæ¶ˆè´¹è€…å¯¹åº”å¤šä¸ªåˆ†åŒº æ¶ˆè´¹è€…æ•° = åˆ†åŒºæ•°ï¼šä¸€ä¸ªæ¶ˆè´¹è€…å¯¹åº”ä¸€ä¸ªåˆ†åŒº  å‚è€ƒèµ„æ–™ 1.kafkaå­¦ä¹ ä¹‹è·¯ä¸€ï¼šhttps://www.cnblogs.com/qingyunzong/p/9004509.html\n2.kafkaå­¦ä¹ ä¹‹è·¯äºŒï¼šhttps://www.cnblogs.com/qingyunzong/archive/2004/01/13/9004593.html\n3.kafkaå­¦ä¹ ä¹‹è·¯ä¸‰ï¼šhttps://www.cnblogs.com/qingyunzong/archive/2004/01/13/9004703.html\n4.kafkaä¸­æ–‡æ–‡æ¡£ï¼šhttps://kafka.apachecn.org/intro.html\n5.kafkaå®‰è£…ï¼šhttps://www.cnblogs.com/qingyunzong/archive/2004/01/13/9005062.html\n6.kafka-pythonçš„åŸºæœ¬ä½¿ç”¨ï¼šhttps://zhuanlan.zhihu.com/p/38330574\n7.é€šè¿‡pythonæ“ä½œkafkaï¼šhttps://developer.aliyun.com/article/584524\n","description":"Kafkaçš„å®‰è£…ä¸ä½¿ç”¨ï¼Œä»…åšç®€å•çš„æµ‹è¯•ç”¨ï¼Œç”¨æ³•è¾ƒä¸ºç®€å•","id":15,"section":"posts","tags":["åˆ†å¸ƒå¼"],"title":"å·¥å…·ä½¿ç”¨ï¼šKafka","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8kafka/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šNetCache: Balancing Key-Value Stores with Fast In-Network Caching\nã€€ä¼šè®®ä¿¡æ¯ï¼šSOSP â€™17, October 28, 2017, Shanghai, China\nã€€æˆæœï¼šåˆ©ç”¨ToRå¯ç¼–ç¨‹äº¤æ¢æœºåšç¼“å­˜å±‚ï¼Œå®ç°æœºæ¶è§„æ¨¡çš„æ•°åäº¿ååé‡çš„è¯»å¯†é›†å‹é”®å€¼å­˜å‚¨ç³»ç»Ÿ\nã€€è´¡çŒ®ï¼šä½¿ç”¨ç¼“å­˜è§£å†³è´Ÿè½½ä¸å‡è¡¡é—®é¢˜ï¼Œåˆ©ç”¨å¯ç¼–ç¨‹äº¤æ¢æœºçš„çº¿é€Ÿå¤„ç†ï¼Œè§£å†³äº†ç¼“å­˜å’Œå­˜å‚¨å±‚ä¹‹é—´æ²¡æœ‰æ˜æ˜¾é€Ÿåº¦å·®åˆ«çš„é—®é¢˜ï¼›åˆ©ç”¨äº†å¯ç¼–ç¨‹äº¤æ¢æœºçš„ç‰¹æ€§ï¼Œæ˜¯å¯ç¼–ç¨‹äº¤æ¢æœºçš„ä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œè¯¦ç»†è®²è§£äº†å¯ç¼–ç¨‹äº¤æ¢æœºçš„ä½¿ç”¨æ–¹æ³•å’Œæ€è·¯\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šä¼ ç»Ÿçš„é”®å€¼å­˜å‚¨å½“å­˜å‚¨å±‚ä¹Ÿåœ¨å†…å­˜æ—¶ï¼Œç¼“å­˜å’Œå­˜å‚¨å±‚ä¹‹é—´æ²¡æœ‰æ˜æ˜¾é€Ÿåº¦å·®åˆ«ï¼›ä¸ºä¿è¯å„ä¸ªå‰¯æœ¬é—´çš„æ•°æ®è¿ç§»ï¼Œæ•°æ®ä¸€è‡´æ€§å’ŒæŸ¥è¯¢è·¯ç”±ä½¿å¾—ç³»ç»Ÿæ›´åŠ å¤æ‚å¹¶å¼•å…¥äº†å¼€é”€\nã€€æœ¬æ–‡å·¥ä½œï¼šåˆ©ç”¨ToRå¯ç¼–ç¨‹äº¤æ¢æœºåšé”®å€¼å­˜å‚¨ç³»ç»Ÿçš„ç¼“å­˜å±‚ï¼Œè®¾è®¡NetCacheæ•°æ®åŒ…ï¼Œåœ¨å¯ç¼–ç¨‹äº¤æ¢æœºä¸Šå®ç°è·¯ç”±æ¨¡å—ã€é”®å€¼å­˜å‚¨æ¨¡å—ï¼ˆå…¥å£çš„Lookup Tableå’Œå‡ºå£çš„Value Tableï¼‰ã€æŸ¥è¯¢ç»Ÿè®¡æ¨¡å—ï¼ˆCount-Minè‰å›¾å’ŒBloom Filterï¼‰ï¼›å®¢æˆ·ç«¯å®ç°æŸ¥è¯¢APIï¼ŒæœåŠ¡ç«¯æŠŠNetCacheæ•°æ®åŒ…è½¬æ¢æˆæŸ¥è¯¢ï¼›NetCacheé€‚ç”¨èŒƒå›´å’Œä¸è¶³çš„è®¨è®ºï¼›æ€§èƒ½è¯„ä¼°ï¼Œä¸»è¦ä¸NoCacheå¯¹æ¯”ã€‚\nã€€è¯¦ç»†é˜…è¯»å¯ä»¥å‚è€ƒæ¼”ç¤ºé¡µé¢ä¸‹çš„NetCacheï¼Œæœ¬æ–‡åªç®€å•åœ°è¿›è¡Œä¸€ä¸‹æ€»ç»“ã€‚\nä¸€ã€èƒŒæ™¯ 1.å†…å­˜é”®å€¼å­˜å‚¨ ã€€ç°ä»£ç½‘ç»œæœåŠ¡ï¼ˆå¦‚ç§‘ç ”ã€ç¤¾ä¼šç½‘ç»œå’Œç”µå­å•†åŠ¡ï¼‰é«˜åº¦ä¾èµ–äºé«˜æ€§èƒ½é”®å€¼å­˜å‚¨ã€‚ç³»ç»Ÿè¿è¥å•†éœ€è¦å†…å­˜ä¸­çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼ˆMemcachedã€Redisï¼‰æ¥æ»¡è¶³å¿…è¦çš„ååé‡å’Œå»¶è¿Ÿéœ€æ±‚ã€‚\nã€€ç°ä»£ç½‘ç»œæœåŠ¡çš„çƒ­ç‚¹äº‹ä»¶æŸ¥è¯¢æ¬¡æ•°è¿œè¶…å…¶å®ƒäº‹ä»¶ï¼Œå¹¶ä¸”çƒ­ç‚¹äº‹ä»¶çš„é›†åˆå¤„äºå¿«é€Ÿå˜åŠ¨çš„çŠ¶æ€ä¸­ï¼Œè¿™ç§åæ–œçš„è´Ÿè½½å¯¼è‡´ä¸¥é‡çš„ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚\nã€€ç¼“å­˜æ˜¯å‡è¡¡è´Ÿè½½çš„æœ‰æ•ˆæ–¹æ³•ã€‚ä¼ ç»Ÿçš„é”®å€¼å­˜å‚¨ï¼ˆåŸºäºé—ªå­˜ã€åŸºäºç¡¬ç›˜ï¼‰ä½¿ç”¨å¿«é€Ÿå†…å­˜ç¼“å­˜å±‚å‡è¡¡è´Ÿè½½ã€‚è€ŒåŸºäºæœåŠ¡çš„ç¼“å­˜ç”±äºå…¶å­˜å‚¨å±‚å°±åœ¨å†…å­˜ä¸­ï¼ŒåŸºäºå†…å­˜çš„ç¼“å­˜å±‚å¹¶ä¸ç”Ÿæ•ˆã€‚\n1.1 ç¼“å­˜å¤§å° ã€€æ ¹æ®è®ºæ–‡Small Cache, Big Eect: Provable Load Balancing for Randomly Partitioned Cluster Services.å¾—çŸ¥ï¼Œå¹³è¡¡Nä¸ªå­˜å‚¨èŠ‚ç‚¹çš„hashåˆ†åŒºé”®å€¼é›†ç¾¤ï¼Œåªéœ€è¦è®¾ç½®èƒ½å¤Ÿå­˜å‚¨O(NlogN)ä¸ªé¡¹ç›®çš„ç¼“å­˜ã€‚\n1.2 ç¼“å­˜æ”¾ç½®çš„ä½ç½® ã€€å®¢æˆ·ç«¯\u0026mdash;\u0026gt;ç½‘ç»œ\u0026mdash;\u0026gt;æœåŠ¡ç«¯\n æ”¾åœ¨å®¢æˆ·ç«¯ä¸Šï¼šéš¾ä»¥ä¿è¯ç¼“å­˜ä¸€è‡´æ€§ï¼›å®¢æˆ·ç«¯è®¿é—®çƒ­ç‚¹æ—¶é—´çš„å…¬å…±é›†åˆå¹¶ä¸å¯¹æ¯ä¸ªå®¢æˆ·ç«¯éƒ½æ˜¯çƒ­ç‚¹äº‹ä»¶ æ”¾åœ¨æœåŠ¡ç«¯ä¸Šï¼šå­˜å‚¨å±‚æœ¬èº«å°±åœ¨å†…å­˜ä¸­ï¼ŒåŸºäºå†…å­˜çš„ç¼“å­˜å±‚å¹¶ä¸ç”Ÿæ•ˆ æ”¾åœ¨ç½‘ç»œä¸­ï¼šç”±äºç¡¬ä»¶çš„å‘å±•ï¼Œå¯ç¼–ç¨‹äº¤æ¢æœºçš„èŠ¯ç‰‡èµ„æºè¶³å¤Ÿå­˜å‚¨O(NlogN)é¡¹ï¼Œå¹¶ä¸”å®ƒæ¯ç§’èƒ½å¤Ÿå¤„ç†æ•°åäº¿æ•°æ®åŒ…  ã€€æ‰€ä»¥è€ƒè™‘å°†ç¼“å­˜å±‚æ„å»ºåˆ°ç½‘ç»œ(å¯ç¼–ç¨‹äº¤æ¢æœº)ä¸­ã€‚\näºŒã€æœ¬æ–‡çš„å·¥ä½œ 1.ç³»ç»Ÿè®¾è®¡ ã€€ç³»ç»Ÿè®¾è®¡è§å›¾1ï¼Œç³»ç»Ÿè®¾è®¡ä¸»è¦æœ‰3ä¸ªç‚¹ï¼Œå‰ä¸¤ç‚¹è¾ƒä¸ºå·§å¦™ï¼Œç¬¬ä¸‰ç‚¹æ¯”è¾ƒæ™®é€šï¼Œå…·ä½“å®ç°å‚è€ƒæ¼”ç¤ºé¡µé¢ä¸‹çš„NetCacheï¼Œè¿™é‡Œä»…æ¦‚æ‹¬æ ¸å¿ƒæ€æƒ³ï¼Œä¸å†è¯¦ç»†è¡¨è¿°ã€‚\nå›¾1 NetCacheè®¾è®¡:\r\r 1.1 å®ç°å˜é•¿é”®å€¼å­˜å‚¨ï¼Œå¹¶æœ€å°åŒ–å¼€é”€  ä½¿ç”¨å¤šä¸ªé˜¶æ®µæŠŠå€¼è¿æ¥èµ·æ¥æ„æˆå¤§çš„å€¼ï¼› åœ¨æŸ¥æ‰¾è¡¨(Lookup Table)ä½¿ç”¨ä½å›¾ç´¢å¼•åˆ°ValueTableï¼ŒåŠ¨ä½œæ•°æ®åªæœ‰ä½å›¾å’Œæ§½ç´¢å¼•ï¼ŒèŠ‚çœäº†æŸ¥æ‰¾è¡¨(Lookup Table)çš„ç©ºé—´ï¼›è¯»å–ç»™å®šå¯„å­˜å™¨çš„ç´¢å¼•æ§½(idx)ï¼ŒKeyæ˜¯ä½å›¾çš„ä¸€ä¸ªä½ï¼ŒèŠ‚çœäº†å€¼è¡¨(Value Table)çš„ç©ºé—´ï¼› ç”¨é‡å¤çš„åŠ¨ä½œå®šä¹‰ï¼ˆä»£ç çš„å¢åŠ ï¼‰ä»£æ›¿å­˜å‚¨ç©ºé—´çš„å¢åŠ ï¼Œå¤šä¸ªå¯„å­˜å™¨çš„ç›¸åŒç´¢å¼•çš„æ§½å¯ä»¥å­˜å‚¨ä¸åŒKeyçš„Valueï¼Œä»è€Œèƒ½å¤Ÿå¤§é™åº¦åœ°å°†æ‰€æœ‰å¯„å­˜å™¨çš„æ§½å ç”¨ï¼Œå……åˆ†åˆ©ç”¨äº†ç©ºé—´ã€‚  1.2 æ ‡è®°çƒ­ç‚¹äº‹ä»¶  ä½¿ç”¨Count-Minè‰å›¾å¯¹Keyçš„æŸ¥è¯¢é¢‘ç‡è¿›è¡Œè®¡æ•°ï¼Œä¸å­˜å‚¨keyï¼Œæ¯æ¬¡å¯¹keyåšHashè¿ç®—ï¼Œæ˜ å°„åˆ°4ä¸ªå¯„å­˜å™¨æ•°ç»„çš„4ä¸ªç´¢å¼•ä¸Šï¼Œ4ä¸ªç´¢å¼•ä¸­çš„å€¼åŠ 1ï¼Œ4ä¸ªå€¼ä¸­æœ€å°çš„å€¼ä½œä¸ºæŸ¥è¯¢é¢‘ç‡ï¼Œå¦‚æœæœ€å°å€¼è¶…è¿‡äº†æ§åˆ¶å™¨é…ç½®çš„é˜ˆå€¼ï¼Œå°±æŠŠå®ƒæ ‡è®°ä¸ºçƒ­ç‚¹ï¼Œå‘é€ç»™æ§åˆ¶å™¨ã€‚ ä½¿ç”¨Bloom Filteræ£€æµ‹è¯¥Keyæ˜¯å¦å·²ç»ä¸ŠæŠ¥ç»™æ§åˆ¶å™¨ã€‚  1.3 ç¼“å­˜æ›´æ–° ã€€Heavy Hitterå‘æ§åˆ¶å™¨æŠ¥å‘Šè®¿é—®æ¬¡æ•°è¶…è¿‡äº†é˜ˆå€¼çš„é”®ï¼›\nã€€æ§åˆ¶å™¨ä»ç¼“å­˜ä¸­é‡‡æ ·å¾ˆå°‘çš„Keyï¼Œå°†ä»–ä»¬çš„è®¡æ•°å™¨ä¸HHæŠ¥å‘Šçš„è¿›è¡Œæ¯”è¾ƒï¼Œé©±é€ä¸æµè¡Œçš„Keyï¼Œæ’å…¥æ›´æµè¡Œçš„Key\n é©±é€Keyå³å°†å…¶å„é˜¶æ®µå¯„å­˜å™¨çš„å¯¹åº”çš„ç´¢å¼•æ§½ä¸­çš„å€¼å…¨æ¸…é›¶ï¼› æ’å…¥Keyæ˜¯èƒŒåŒ…é—®é¢˜ï¼Œé‡‡ç”¨æœ€å…ˆé€‚åˆç®—æ³•åˆ†é…å¯„å­˜å™¨çš„ç´¢å¼•æ§½ï¼Œç„¶åä»å­˜å‚¨æœåŠ¡å™¨è·å–è¿™äº›Keyçš„å€¼ã€‚  2.æµæ°´çº¿å¸ƒå±€ ã€€æµæ°´çº¿å¸ƒå±€å¦‚å›¾2ï¼Œå…·ä½“å®ç°å‚è€ƒæ¼”ç¤ºé¡µé¢ä¸‹çš„NetCacheã€‚\nå›¾2 NetCacheæµæ°´çº¿å¸ƒå±€:\r\r ä¸‰ã€å®ç° ã€€å„éƒ¨åˆ†å®ç°çš„ç®€æ´å›¾ç¤ºå‚è€ƒæ¼”ç¤ºé¡µé¢ä¸‹çš„NetCacheã€‚\nã€€äº¤æ¢æœºæ•°æ®å¹³é¢ç”¨P4ç¼–å†™ï¼Œå¹¶ç”¨Barefoot Capilanoè½¯ä»¶å¥—ä»¶ç¼–è¯‘åˆ°Barefoot Tofino ASICä¸Šã€‚ç¼“å­˜æŸ¥æ‰¾è¡¨çš„16å­—èŠ‚é”®æœ‰64Kæ¡ç›®ã€‚å€¼è¡¨å’Œå¯„å­˜å™¨æ•°ç»„åˆ†å¸ƒåœ¨8ä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µæä¾›64K 16å­—èŠ‚çš„æ§½ã€‚è¿™ç¼“å­˜çš„æ€»å¤§å°æ˜¯8MBï¼Œå…¶å€¼å¤§å°ä¸º16å­—èŠ‚ï¼Œæœ€å¤§ä¸º128å­—èŠ‚ã€‚Count-Minè‰å›¾åŒ…æ‹¬4ä¸ªå¯„å­˜å™¨ç»„ï¼Œæ¯ä¸ªæœ‰64K 16ä½çš„æ§½ã€‚å¸ƒéš†è¿‡æ»¤å™¨åŒ…æ‹¬3ä¸ªå¯„å­˜å™¨æ•°ç»„ï¼Œæ¯ä¸ªæœ‰256K 1ä½çš„æ§½ã€‚Count-Minè‰å›¾å’Œå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨Tofino ASICæä¾›çš„å“ˆå¸Œå‡½æ•°ï¼Œæ‰§è¡Œé”®å­—æ®µçš„ä½çš„ä»»æ„å¼‚æˆ–è¿ç®—ã€‚\nã€€æ§åˆ¶å™¨å¯ä»¥é…ç½®é‡ç½®Count-Minè‰å›¾å’Œå¸ƒéš†è¿‡æ»¤å™¨çš„é¢‘ç‡ã€‚æ–‡ç« åœ¨å®éªŒä¸­æ¯ç§’é‡ç½®å®ƒä»¬ä¸€æ¬¡ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬çš„æ•°æ®å¹³é¢å®ç°ä½¿ç”¨çš„ç‰‡ä¸Šå†…å­˜å°‘äºTofino ASICæä¾›çš„50%ï¼Œç•™ä¸‹çš„ç©ºé—´è¶³å¤Ÿç”¨äºä¼ ç»Ÿç½‘ç»œå¤„ç†ã€‚æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†L3è·¯ç”±ä½œä¸ºè·¯ç”±æ¨¡å—ï¼ŒåŸºäºç›®çš„IPåœ°å€è½¬å‘æ•°æ®åŒ…ã€‚\nã€€æ§åˆ¶å™¨ä½¿ç”¨Pythonç¼–å†™ã€‚P4ç¼–è¯‘å™¨é€šè¿‡äº¤æ¢æœºé©±åŠ¨åœ¨è¿è¡Œæ—¶ä¸ºæ§åˆ¶å™¨ç”ŸæˆThrift APIã€‚æ§åˆ¶å™¨ä»æ•°æ®å¹³é¢ä½¿ç”¨è¿™äº›APIåƒ4.3èŠ‚é‚£æ ·æ¥æ¥æ”¶heavy hitteræŠ¥å‘Šï¼Œè·å–è®¡æ•°å™¨ï¼Œå¹¶æ›´æ–°ç¼“å­˜çš„äº‹é¡¹ã€‚\nã€€ä¸ºä¼˜åŒ–IOæ€§èƒ½ï¼Œå®¢æˆ·ç«¯åº“å’ŒæœåŠ¡å™¨ä»£ç†ç”¨Intel DPDKå’ŒCè¯­è¨€å®ç°ã€‚å®¢æˆ·ç«¯åº“æä¾›é”®å€¼æ¥å£ï¼Œå¹¶å°†APIè°ƒç”¨è½¬æ¢ä¸ºNetCacheæ•°æ®åŒ…ã€‚æ ¹æ®æ··åˆè¯»å†™æ“ä½œçš„Zipfç‰ˆæœ¬ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨æ–‡ç« çš„æœåŠ¡å™¨ä¸Šç”¨40Gçš„ç½‘å¡ç”Ÿæˆå¤šè¾¾35MQPSçš„é”®å€¼æŸ¥è¯¢ã€‚\nå››ã€æ¶‰åŠåˆ°çš„åŸºç¡€çŸ¥è¯† ã€€æœ¬æ–‡è®²è¿°çš„éå¸¸æ¸…æ™°ï¼Œå‡ ä¹ä¸éœ€è¦é¢å¤–æŸ¥æ‰¾ç›¸å…³èµ„æ–™ã€‚\n","description":"åˆ©ç”¨é«˜é€Ÿç¼“å­˜è§£å†³å†…å­˜é”®å€¼å­˜å‚¨ç³»ç»Ÿçš„è´Ÿè½½ä¸å‡è¡¡é—®é¢˜ï¼Œé€šè¿‡å°†ç¼“å­˜æ”¾ç½®åœ¨å¯ç¼–ç¨‹äº¤æ¢æœºä¸Šå®ç°â€œé«˜é€Ÿâ€","id":16,"section":"posts","tags":["P4"],"title":"NetCache ï¼šåŸºäºç½‘ç»œå†…ç¼“å­˜å¿«é€Ÿå‡è¡¡é”®å€¼å­˜å‚¨è´Ÿè½½","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBnetcache/"},{"content":"Some photos.\n","description":"éšä¾¿æ‹æ‹ï¼Œè®°å½•å¿«ä¹","id":18,"section":"gallery","tags":null,"title":"éšæ‹","uri":"https://yyyIce.github.io/zh/gallery/%E9%9A%8F%E6%8B%8D/"},{"content":"éšä¾¿ç”»ç”»ã€‚\n","description":"éšä¾¿ç”»ç‚¹ä»€ä¹ˆ","id":19,"section":"gallery","tags":null,"title":"éšç¬”","uri":"https://yyyIce.github.io/zh/gallery/%E9%9A%8F%E7%AC%94/"},{"content":"ã€€Mininetæ˜¯ä¸€ä¸ªç½‘ç»œæ¨¡æ‹Ÿå™¨ï¼Œå¯ä»¥åˆ›å»ºè™šæ‹Ÿä¸»æœºï¼Œäº¤æ¢æœºï¼Œæ§åˆ¶å™¨å’Œè¿æ¥çš„ç½‘ç»œã€‚\nã€€Mininetä¸»æœºè¿è¡Œæ ‡å‡†çš„Linuxç½‘ç»œè½¯ä»¶ï¼Œæ”¯æŒOpenFlowã€‚æ”¯æŒå¼€å‘ã€å­¦ä¹ ã€æµ‹è¯•ã€è°ƒè¯•ï¼Œè®©ä½¿ç”¨è€…åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šå°±å¯ä»¥æ‹¥æœ‰å®Œæ•´çš„å®éªŒç½‘ç»œã€‚åœ¨Mininetä¸Šä¸ºOpenFlowæ§åˆ¶å™¨ï¼Œä¿®æ”¹åçš„äº¤æ¢æœºæˆ–ä¸»æœºå¼€å‘å’Œæµ‹è¯•çš„ä»£ç å¯ä»¥è¿ç§»åˆ°å…·æœ‰è¾ƒå°‘æ›´æ”¹çš„å®é™…ç³»ç»Ÿä¸­ã€‚é€šå¸¸Mininetä¸­è¿è¡Œçš„è®¾è®¡å¯ä»¥ç›´æ¥ç§»æ¤åˆ°ç¡¬ä»¶äº¤æ¢æœºï¼Œä»¥è¿›è¡Œçº¿é€Ÿæ•°æ®åŒ…è½¬å‘ã€‚åŸºäºMininetçš„ç½‘ç»œä¸èƒ½è¶…è¿‡å½“å‰CPUæˆ–åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šæ‰€è·å¾—çš„å¸¦å®½ã€‚\n1.å®‰è£…   mininetçš„å®˜æ–¹é¡µé¢ï¼šhttp://mininet.org/\n  mininetçš„githubï¼šhttps://github.com/mininet/mininet\n  1.1 è™šæ‹Ÿæœºæ•´æœº   ä¸‹è½½åœ°å€ï¼šhttps://github.com/mininet/mininet/releases\n  amd64æ˜¯64ä½çš„ubuntuï¼›i386æ˜¯32ä½çš„ubuntuã€‚\n  ç”¨æˆ·åï¼šmininet å¯†ç ï¼šmininet\n  è·å–rootæƒé™ï¼š\n  1  sudo -i   1.2 åœ¨å·²æœ‰è™šæ‹Ÿæœºä¸Šå®‰è£…  å®‰è£…å‚è€ƒï¼šhttps://blog.csdn.net/AsNeverBefore/article/details/78916645\n (1)è·å–æºç \n1  git clone git://github.com/mininet/mininet   (2)è¿›å…¥mininetç›®å½•ï¼Œå¯é€šè¿‡æŸ¥çœ‹INSTALLæ–‡ä»¶æŸ¥è¯¢ç‰ˆæœ¬ç›®å½•\n1  cd mininet   (3)å®‰è£…Mininetï¼Œæ ¹æ®./mininet/util/install.sh -hå‘½ä»¤é€‰æ‹©å‚æ•°è¿›è¡Œå®‰è£…\n1  util/install.sh -n3V 2.5.9   (4)å®‰è£…æˆåŠŸï¼Œå¹¶æŸ¥çœ‹mininetçš„ç‰ˆæœ¬\n1 2 3 4  mn --version #æµ‹è¯•Mininetæ˜¯å¦å®‰è£…æˆåŠŸ sudo mn --test pingall   å›¾1 å®‰è£…æˆåŠŸ:\r\r ã€€æ³¨ï¼šå°½é‡ä¸è¦ç”¨-aé€‰é¡¹è¿›è¡Œå®‰è£…ã€‚æˆ‘ç”¨äº†ï¼Œè£…äº†3å¤©ï¼Œæœ€åè¿˜ä¸å¥½ç”¨ã€‚\n1.3 å¯èƒ½å‡ºç°çš„é—®é¢˜ ã€€(1)ç”±äºé¢‘ç¹ç»“æŸå®‰è£…è¿›ç¨‹å¯èƒ½å‡ºç°Could not get lock /var/lib/apt/lists/lock - open (11: Resource temporarily unavailable)ï¼Œè§£å†³åŠæ³•ï¼šhttps://blog.csdn.net/weixin_42489042/article/details/81296472 æˆ–é‡å¯ã€‚\nã€€(2)mininetç”¨./mininet/miniedit.pyåšçš„å›¾å½¢åŒ–ç•Œé¢ï¼Œpingallä¸€ä¸ªéƒ½ä¸é€šï¼›ç‰ˆæœ¬2.3.0d6\nå›¾2 pingä¸é€š:\r\r ã€€è§£å†³æ–¹æ¡ˆï¼šèœå•æ Edit-\u0026gt;Preferencesï¼Œåªå‹¾é€‰OpenFlow1.0ï¼Œæˆ–åŒæ—¶å‹¾é€‰OpenFlow1.0å’ŒOpenFlow1.3ï¼Œåªå‹¾é€‰1.3å°±ä¼šå‡ºç°ä¸Šé¢çš„ç°è±¡ã€‚\n2.ä½¿ç”¨ 2.1 ç½‘ç»œæ„å»º 2.1.1 åˆ©ç”¨topoå‚æ•°æ„å»º å¯ä»¥å¿«é€Ÿæ„å»ºä¸€ä¸ªäº¤æ¢æœºè¿æ¥ä¸¤å°ä¸»æœºçš„æ‹“æ‰‘\n1  sudo mn   (1)å•ä¸€æ‹“æ‰‘\n1 2 3 4  sudo mn --topo=single,3 # æ„å»ºæ‹“æ‰‘çš„è¿çº¿ (h1, s1) (h2, s1) (h3, s1)   (2)çº¿æ€§æ‹“æ‰‘\n1 2 3 4  sudo mn --topo=linear,4 # æ„å»ºæ‹“æ‰‘çš„è¿çº¿ (h1, s1) (h2, s2) (h3, s3) (h4, s4) (s2, s1) (s3, s2) (s4, s3)   (3)æ ‘å½¢æ‹“æ‰‘\n1 2 3 4  sudo mn --topo=tree,depth=2,fanout=2 # æ„å»ºæ‹“æ‰‘çš„è¿çº¿ (s1, s2) (s1, s3) (s2, h1) (s2, h2) (s3, h3) (s3, h4)   (4)è‡ªå®šä¹‰æ‹“æ‰‘\n1  sudo mn --custom file.py --topo mytopo   2.1.2 åˆ©ç”¨æ–‡ä»¶æ„å»º (1)å†™å¥½ä¸€ä¸ªmininetçš„pythonè„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95  #!/usr/bin/python import mininet.term from mininet.net import Mininet from mininet.node import Controller, RemoteController, OVSController from mininet.node import CPULimitedHost, Host, Node from mininet.node import OVSKernelSwitch, UserSwitch from mininet.node import IVSSwitch from mininet.cli import CLI from mininet.log import setLogLevel, info from mininet.link import TCLink, Intf from subprocess import call import os def myNetwork(): net = Mininet( topo=None, build=False, ipBase=\u0026#39;10.0.0.0/8\u0026#39;) info( \u0026#39;*** Adding controller\\n\u0026#39; ) c0=net.addController(name=\u0026#39;c0\u0026#39;, controller=RemoteController, ip=\u0026#39;127.0.0.1\u0026#39;, protocol=\u0026#39;tcp\u0026#39;, port=6633) info( \u0026#39;*** Add switches\\n\u0026#39;) s1 = net.addSwitch(\u0026#39;s1\u0026#39;, cls=OVSKernelSwitch, dpid=\u0026#39;0000000000000001\u0026#39;) s2 = net.addSwitch(\u0026#39;s2\u0026#39;, cls=OVSKernelSwitch, dpid=\u0026#39;0000000000000002\u0026#39;) s3 = net.addSwitch(\u0026#39;s3\u0026#39;, cls=OVSKernelSwitch, dpid=\u0026#39;0000000000000003\u0026#39;) s4 = net.addSwitch(\u0026#39;s4\u0026#39;, cls=OVSKernelSwitch, dpid=\u0026#39;0000000000000004\u0026#39;) info( \u0026#39;*** Add hosts\\n\u0026#39;) h1 = net.addHost(\u0026#39;h1\u0026#39;, mac=\u0026#39;00:00:00:00:00:01\u0026#39;, cls=Host, ip=\u0026#39;10.0.0.1\u0026#39;, defaultRoute=None) h2 = net.addHost(\u0026#39;h2\u0026#39;, mac=\u0026#39;00:00:00:00:00:02\u0026#39;, cls=Host, ip=\u0026#39;10.0.0.2\u0026#39;, defaultRoute=None) h3 = net.addHost(\u0026#39;h3\u0026#39;, mac=\u0026#39;00:00:00:00:00:03\u0026#39;, cls=Host, ip=\u0026#39;10.0.0.3\u0026#39;, defaultRoute=None) h4 = net.addHost(\u0026#39;h4\u0026#39;, mac=\u0026#39;00:00:00:00:00:04\u0026#39;, cls=Host, ip=\u0026#39;10.0.0.4\u0026#39;, defaultRoute=None) info( \u0026#39;*** Add links\\n\u0026#39;) net.addLink(s1, h1) net.addLink(s1, h2) net.addLink(s1, s3) net.addLink(s1, s4) net.addLink(s2, h3) net.addLink(s2, h4) net.addLink(s2, s3) net.addLink(s2, s4) info( \u0026#39;*** Starting network\\n\u0026#39;) net.build() info( \u0026#39;*** Starting controllers\\n\u0026#39;) for controller in net.controllers: controller.start() info( \u0026#39;*** Starting switches\\n\u0026#39;) net.get(\u0026#39;s1\u0026#39;).start([c0]) net.get(\u0026#39;s2\u0026#39;).start([c0]) net.get(\u0026#39;s3\u0026#39;).start([c0]) net.get(\u0026#39;s4\u0026#39;).start([c0]) info( \u0026#39;*** Post configure switches and hosts\\n\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=1,dl_src=00:00:00:00:00:01,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=2,dl_src=00:00:00:00:00:02,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=3,dl_src=00:00:00:00:00:03,action=output:1\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=3,dl_src=00:00:00:00:00:04,action=output:2\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=1,dl_src=00:00:00:00:00:03,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=2,dl_src=00:00:00:00:00:04,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=3,dl_src=00:00:00:00:00:01,action=output:1\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=3,dl_src=00:00:00:00:00:02,action=output:2\u0026#39;) \u0026#39;\u0026#39;\u0026#39; os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=1,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s1 in_port=3,action=output:1\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=1,action=output:3\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s2 in_port=3,action=output:1\u0026#39;) \u0026#39;\u0026#39;\u0026#39; os.system(\u0026#39;ovs-ofctl add-flow s3 in_port=1,action=output:2\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s3 in_port=2,action=output:1\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s4 in_port=1,action=output:2\u0026#39;) os.system(\u0026#39;ovs-ofctl add-flow s4 in_port=2,action=output:1\u0026#39;) CLI(net) #makeTerm(h1) net.stop() if __name__ == \u0026#39;__main__\u0026#39;: setLogLevel( \u0026#39;info\u0026#39; ) myNetwork() #term.makeTerm(h1)   (2)ç”¨sudoè¿è¡Œpythonè„šæœ¬\n1  sudo python filename.py   2.1.3 åˆ©ç”¨minieditæ„å»º (1)è¿›å…¥mininetçš„examplesç›®å½•ï¼Œè¿è¡Œ\nsudo ./miniedit.py\r(2)ä»å·¦è¾¹å›¾æ ‡æ‹–åŠ¨å›¾æ ‡ï¼Œæ„å»ºç½‘ç»œæ‹“æ‰‘ï¼Œåœ¨å¯¹åº”å…ƒä»¶ä¸Šé•¿æŒ‰é¼ æ ‡å³é”®ï¼Œæ»‘åˆ°Propertieså¯ä»¥è®¾ç½®åŸä»¶å±æ€§\nå›¾3 Properties:\r\r å›¾4 è®¾ç½®æ§åˆ¶å™¨:\r\r å›¾5 è®¾ç½®äº¤æ¢æœº:\r\r å›¾6 è®¾ç½®ä¸»æœº:\r\r (3)å·¦ä¸Šè§’Edit-\u0026gt;Preferenceå¯ä»¥è¿›è¡Œå…¨å±€é…ç½®ï¼Œæ³¨æ„ä¸èƒ½åªå‹¾é€‰OpenFlow 1.3\nå›¾7 å…¨å±€é…ç½®:\r\r (4)å‹¾é€‰Start CLIï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„Runï¼Œå¯ä»¥åœ¨ç»ˆç«¯çœ‹åˆ°CLIã€‚\nå›¾8 Run:\r\r (5)File-\u0026gt;Export Level 2 Scriptï¼Œä¿å­˜ä¸ºPythonè„šæœ¬ï¼Œç„¶åä¸‹é¢å‘½ä»¤å³å¯åˆ›å»ºç½‘ç»œæ‹“æ‰‘\n1 2  chmod -R 777 test.py ./test.py   å›¾9 ä¿å­˜ä¸ºPythonè„šæœ¬:\r\r 2.1.4 æ¸…é™¤é…ç½®ä¿¡æ¯ å¦‚æœæ‹“æ‰‘å»ºç«‹å¤±è´¥ï¼Œæç¤ºå·²è¢«å ç”¨ï¼Œå¯ä»¥ç”¨ä¸‹åˆ—å‘½ä»¤æ¸…ç©ºé…ç½®\n1  mn -c   2.2è¿æ¥æ§åˆ¶å™¨ (1)å¦‚æœæ²¡æœ‰æŒ‡å®šæ§åˆ¶å™¨ï¼Œä¼šä½¿ç”¨mininetä¸­é»˜è®¤çš„æ§åˆ¶å™¨ã€‚\n(2)ä¸‹åˆ—å‘½ä»¤å¯ä»¥ è¿æ¥æŒ‡å®šip:portçš„æ§åˆ¶å™¨\n1  sudo mn --controller=remote, --ip=\u0026lt;controller_ip\u0026gt;,--port=[port]   (3)å¯åŠ¨mininetï¼Œ--controller=remoteå¯ä»¥è¿ä¸Šå¯åŠ¨çš„RYUæ§åˆ¶å™¨ã€‚\nå› ä¸ºå¯åŠ¨RYUæ§åˆ¶å™¨ï¼Œå¯åŠ¨åœ¨6653ç«¯å£ï¼Œremoteé»˜è®¤è¿æ¥6653ç«¯å£ï¼Œæ‰€ä»¥mininetçš„ç½‘ç»œå¯ä»¥è¿æ¥ä¸ŠRYUã€‚\n","description":"mininetçš„å®‰è£…ä¸ä½¿ç”¨ï¼Œä»¥åŠè¸©è¿‡çš„å‘","id":20,"section":"posts","tags":["sdn"],"title":"å·¥å…·ä½¿ç”¨ï¼šmininet","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8mininet/"},{"content":"1 åç¨‹ ã€€åç¨‹æ˜¯å¹¶å‘çš„ä¸€ç§å®ç°æ–¹å¼ã€‚å’Œå¤šçº¿ç¨‹çš„æŠ¢å å¼ä¸åŒï¼Œå®ƒæ˜¯å½“å‰è¿è¡Œçš„åç¨‹Aåœ¨éœ€è¦ç­‰å¾…ç¬¬ä¸‰æ–¹ç»“æœæ—¶ï¼Œä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œç„¶åç”±å…¶å®ƒç©ºé—²çš„å°±ç»ªåç¨‹Bç»§ç»­æ‰§è¡Œï¼Œå½“Bä¹Ÿéœ€è¦ç­‰å¾…ç»“æœæ—¶ï¼Œå†ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œè®©å…¶å®ƒåç¨‹ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåç¨‹çš„è¿è¡Œæ–¹å¼æ˜¯ä¸€ç»„åç¨‹è½®æµè·å¾—æ§åˆ¶æƒï¼Œä»¥å……åˆ†åˆ©ç”¨ç­‰å¾…æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å°å­¦å­¦è¿‡çš„â€œæ—¶é—´ç»Ÿç­¹â€ï¼Œåœ¨ç”µé¥­ç…²ç…®é¥­çš„åŒæ—¶å¯ä»¥åˆ‡èœï¼Œåœ¨æ´—è¡£æœºæ´—è¡£æœçš„åŒæ—¶å¯ä»¥ç‚’èœã€‚\nã€€æ‰€æœ‰åç¨‹è¿è¡Œåœ¨å•è¿›ç¨‹çš„ä¸€ä¸ªçº¿ç¨‹ä¸Šï¼Œæ‰€ä»¥ä¸éœ€è¦å¯¹èµ„æºåŠ é”ï¼ŒåŒä¸€æ—¶åˆ»ä»…ä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹è®¿é—®èµ„æºï¼Œå‡å°‘äº†é”çš„å¼€é”€ï¼Œä¹Ÿå‡å°‘äº†ç¨‹åºçš„å¤æ‚åº¦å’Œå¥‡æ€ªçš„é”™è¯¯ã€‚ä½†æ³¨æ„è€ƒè™‘æ§åˆ¶æƒç§»äº¤å‰åçš„åŒæ­¥èµ„æºé—®é¢˜ã€‚\nã€€ç”±äºåç¨‹çš„ä¸»è¦åŸç†æ˜¯åœ¨åç¨‹Aç­‰å¾…çš„æ—¶é—´è®©å‡ºæ§åˆ¶æƒè®©ä¸éœ€ç­‰å¾…ç»“æœçš„åç¨‹Bç»§ç»­è¿è¡Œï¼Œæ‰€ä»¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡ä¸Šæ›´é€‚åˆåç¨‹ï¼Œå³IOå¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼ˆç½‘ç»œIOï¼‰ï¼Œæ–‡ä»¶è¯»å†™ç­‰ç­‰ã€‚\n2 asyncio \rasyncioçš„å®˜æ–¹æ–‡æ¡£åœ°å€\n\r \rã€€æˆ‘ä»¬è¿™é‡Œåªè®²åŸºäºåŸç”Ÿåç¨‹ï¼ˆé€šè¿‡async defå£°æ˜ï¼‰çš„åç¨‹ï¼Œä¸è®²åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼ˆå³é€šè¿‡è£…é¥°å™¨@asyncio.coroutineå£°æ˜çš„åç¨‹ï¼‰ï¼Œå› ä¸ºåŸºäºç”Ÿæˆå™¨çš„åç¨‹å°†åœ¨Python3.10ä¸­åºŸå¼ƒã€‚\nã€€ç¬¬1èŠ‚ä¸­æåˆ°ï¼Œåç¨‹çš„è¿è¡Œæ–¹å¼æ˜¯ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿè®©å‡ºæ§åˆ¶æƒå’Œåˆ†é…æ§åˆ¶æƒç»™å…¶å®ƒåç¨‹çš„æœºåˆ¶ã€‚asyncioå®ç°è¿™ç§æœºåˆ¶çš„æ–¹å¼æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚å®ƒå°†æ‰€æœ‰åç¨‹æ”¾å…¥ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ï¼ŒæŒ‰ç…§æŸç§é¡ºåºä¾æ¬¡è¯¢é—®åç¨‹æ˜¯å¦ç©ºé—²ï¼Œç©ºé—²çš„åç¨‹Aè·å¾—æ§åˆ¶æƒå¹¶å¼€å§‹è¿è¡Œï¼Œç›´åˆ°Aå¼€å§‹ç­‰å¾…ï¼ŒAä¸»åŠ¨äº¤å‡ºæ§åˆ¶æƒï¼Œäº‹ä»¶å¾ªç¯å†æ¬¡è¯¢é—®åç¨‹æ˜¯å¦ç©ºé—²ï¼Œç›´è‡³è¯¢é—®åˆ°ä¸‹ä¸€ä¸ªç©ºé—²çš„åç¨‹ï¼Œç›´è‡³æ‰€æœ‰çš„åç¨‹éƒ½è¿è¡Œå®Œæ¯•ã€‚\nä¸€ä¸ªç®€å•çš„åç¨‹ç¤ºä¾‹ ã€€ç”¨æ­¤ç¨‹åºæ¥ä½“ä¼šä¸€ä¸‹åç¨‹ã€‚\n ç¨‹åºæ¥æºï¼šhttps://realpython.com/async-io-python/ countasync.py\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  # simple_asyncio.py import asyncio async def count(): print(\u0026#34;One\u0026#34;) await asyncio.sleep(1) print(\u0026#34;Two\u0026#34;) async def main(): await asyncio.gather(count(), count(), count()) if __name__ == \u0026#34;__main__\u0026#34;: import time s = time.perf_counter() asyncio.run(main()) elapsed = time.perf_counter() - s print(f\u0026#34;{__file__} executed in {elapsed:0.2f} seconds.\u0026#34;)   ã€€è¿è¡Œç»“æœï¼š\n1 2 3 4 5 6 7 8  $ python3.7 simple_asyncio.py One One One Two Two Two simple_asyncio.py executed in 1.00 seconds.   ã€€å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¨‹åºè¿è¡Œäº†ä¸‰æ¬¡è€Œå®é™…ç”¨æ—¶å´åªç”¨äº†1sã€‚\nåç¨‹å‡½æ•°çš„å®šä¹‰ ã€€åç¨‹é€šè¿‡async/awaitè¯­æ³•è¿›è¡Œå£°æ˜ï¼Œéœ€è¦ä½¿ç”¨Python3.7ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨async/awaitè¯­æ³•çš„æ—¶å€™éœ€è¦å¼•ç”¨asyncioåŒ…ï¼š\n1  import asyncio   ã€€å£°æ˜ä¸€ä¸ªåç¨‹å‡½æ•°åœ¨defå‰åŠ ä¸Šasyncå…³é”®å­—å³å¯ã€‚å…¶ä¸­çš„å†…å®¹éœ€è¦æœ‰èƒ½å¤Ÿä¸»åŠ¨è®©å‡ºä¸»åŠ¨æƒçš„è¯­å¥ï¼Œå¦‚awaitã€returnã€yieldï¼Œæ‰èƒ½å¤Ÿæœ‰æ¡ä»¶è®©å…¶å®ƒå‡½æ•°åœ¨å…¶ç­‰å¾…æœŸé—´è¿è¡Œï¼Œè¾¾åˆ°å¹¶å‘æ•ˆæœã€‚ä½†æ˜¯è¯·æ³¨æ„async defå£°æ˜çš„åç¨‹å‡½æ•°å†…éƒ¨ä¸èƒ½æœ‰yield fromã€‚ä¸å†è®²è¿°returnå’Œyieldã€‚awaitåé¢å¿…é¡»æ˜¯ä¸€ä¸ªå¯ç­‰å¾…å¯¹è±¡ï¼Œæ„æ€æ˜¯ç­‰å¾…è¿™ä¸ªåç¨‹è¿è¡Œå®Œæ¯•ã€‚\nã€€åœ¨ä¸‹é¢è¿™ä¸ªç¨‹åºä¸­ï¼Œasyncio.sleep(delay)å¯ä»¥æ›¿æ¢æˆä»»æ„å¯ç­‰å¾…å¯¹è±¡ï¼š\n1 2 3  async def say_after(delay, what): await asyncio.sleep(delay) print(what)   \r\r é€šè¿‡è£…é¥°å™¨@asyncio.coroutineå£°æ˜çš„åç¨‹å†…éƒ¨çš„yield fromå°±ç›¸å½“äºasync defå£°æ˜çš„åç¨‹å†…éƒ¨çš„awaitã€‚ ä½†æ˜¯ï¼Œasync defå£°æ˜çš„åç¨‹å‡½æ•°å†…éƒ¨ä¸èƒ½æœ‰yield fromã€‚  \r \rå¯ç­‰å¾…å¯¹è±¡ ä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼Œåç¨‹ã€ä»»åŠ¡ã€Futureã€‚\n åç¨‹ï¼šåç¨‹å‡½æ•°ï¼ˆç”¨async defå®šä¹‰çš„å‡½æ•°ï¼‰ï¼Œåç¨‹å¯¹è±¡ï¼ˆè°ƒç”¨åç¨‹å‡½æ•°æ‰€è¿”å›çš„å¯¹è±¡ï¼‰ ä»»åŠ¡ï¼šç”¨æ¥æ”¾å…¥è°ƒåº¦æ§½ï¼Œå‡†å¤‡ç«‹å³è¿è¡Œ Futureï¼šç‰¹æ®Šçš„ä½å±‚çº§å¯ç­‰å¾…å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœï¼Œä¸€èˆ¬ä¸å‡ºç°åœ¨åº”ç”¨å±‚çº§ä»£ç ä¸­ã€‚  åç¨‹çš„è¿è¡Œ ã€€è¿è¡Œåç¨‹é€šå¸¸ä¼šè®¾å®šä¸€ä¸ªmain()å…¥å£ï¼Œåœ¨main()ä¸­å®‰æ’ã€è°ƒç”¨å„ä¸ªå…·ä½“çš„åç¨‹ä»»åŠ¡ï¼Œé€šè¿‡asyncio.run(main())è¿›å…¥åç¨‹ã€‚\nã€€åœ¨ä¸‹é¢çš„ç¤ºä¾‹ï¼ˆæ¥è‡ªäºå®˜æ–¹æ–‡æ¡£ï¼‰ä¸­ï¼Œå®šä¹‰äº†åç¨‹å‡½æ•°say_after()å’Œåç¨‹å‡½æ•°main()ï¼Œå…¶ä¸­main()ä½œä¸ºåç¨‹å…¥å£ï¼Œç”¨asyncio.run(main())è¿›å…¥main()ï¼Œåœ¨main()ä¸­è°ƒç”¨ä¸¤æ¬¡åç¨‹å‡½æ•°say_after()ã€‚\n\r asyncio.run(coro, ***, debug=False)\næ‰§è¡Œ coroutine coro å¹¶è¿”å›ç»“æœã€‚\n æ­¤å‡½æ•°ä¼šè¿è¡Œä¼ å…¥çš„åç¨‹ï¼Œè´Ÿè´£ç®¡ç† asyncio äº‹ä»¶å¾ªç¯ï¼Œç»ˆç»“å¼‚æ­¥ç”Ÿæˆå™¨ï¼Œå¹¶å…³é—­çº¿ç¨‹æ± ã€‚ å½“æœ‰å…¶ä»– asyncio äº‹ä»¶å¾ªç¯åœ¨åŒä¸€çº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œæ­¤å‡½æ•°ä¸èƒ½è¢«è°ƒç”¨ã€‚ å¦‚æœ debug ä¸º Trueï¼Œäº‹ä»¶å¾ªç¯å°†ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œã€‚ æ­¤å‡½æ•°æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯å¹¶åœ¨ç»“æŸæ—¶å…³é—­ã€‚å®ƒåº”å½“è¢«ç”¨ä½œ asyncio ç¨‹åºçš„ä¸»å…¥å£ç‚¹ï¼Œç†æƒ³æƒ…å†µä¸‹åº”å½“åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  # asyncio_no_concurrency.py import asyncio import time async def say_after(delay, what): await asyncio.sleep(delay) print(what) async def main(): print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) await say_after(1, \u0026#39;hello\u0026#39;) await say_after(2, \u0026#39;world\u0026#39;) print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main())   \rã€€è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹æˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\n1 2 3 4 5  $python3.7 asyncio_no_concurrency.py started at 11:31:11 hello world finished at 11:31:14   \rã€€å¯ä»¥å‘ç°è™½ç„¶ç”¨äº†åç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¹¶å‘æ‰§è¡Œï¼Œè¿è¡Œçš„æ€»æ—¶é—´è¿˜æ˜¯3ç§’ã€‚å¦‚ä½•å¹¶å‘è¿è¡Œåç¨‹å‘¢ï¼Ÿ\nåç¨‹çš„å¹¶å‘è¿è¡Œ ã€€å¹¶å‘è¿è¡Œåç¨‹éœ€è¦æŠŠåç¨‹å°è£…ä¸ºTaskå¯¹è±¡ï¼ˆasyncio.create_task(\u0026lt;async def\u0026gt;)ï¼‰ï¼Œæ­¤æ—¶åç¨‹å·²ç»å¼€å§‹è¿è¡Œï¼Œå¯ä»¥åˆ†åˆ«awaitè¿™äº›Taskå¯¹è±¡ä»¥è·å–å…¶æ‰§è¡Œç»“æœï¼›æˆ–è€…ä½¿ç”¨await asyncio.gather(\u0026lt;async def1\u0026gt;, \u0026lt;async def2\u0026gt;, ...)ã€‚asyncio.gather()ä¼šæŠŠåç¨‹å½“ä½œä»»åŠ¡ï¼ŒåŠ å…¥æ—¥ç¨‹ã€‚\nã€€ä¹Ÿå°±æ˜¯è¯´asyncio.create_taskæäº¤ä»»åŠ¡ï¼Œæ­¤æ—¶ä»»åŠ¡åœ¨åå°è¿è¡Œï¼Œä¸ä¼šè¾“å‡ºç»“æœï¼Œå¯ä»¥ç”¨awaitç­‰å¾…ç»“æœï¼›await asyncio.gather()æäº¤ä»»åŠ¡å¹¶ç­‰å¾…ç»“æœã€‚\n asyncio.create_task(coro, ***, name=None)\nå°† coro åç¨‹ æ‰“åŒ…ä¸ºä¸€ä¸ª Task æ’å…¥æ—¥ç¨‹å‡†å¤‡æ‰§è¡Œã€‚è¿”å› Task å¯¹è±¡ã€‚\n ã€€asyncio.create_task()è¿”å›ä¸€ä¸ªTaskå¯¹è±¡ï¼Œå®ƒçš„å‚æ•°æ˜¯åç¨‹ã€‚å¯ä»¥ç”¨awaitè·å–å®ƒè¿è¡Œæ—¶çš„ä¸€äº›ç»“æœï¼›å¦‚æœè¯¥Taskå¯¹è±¡å·²ç»è¿è¡Œç»“æŸäº†ï¼Œä»ä¼šä¿ç•™å…¶ç»“æœï¼Œè¿˜å¯ä»¥é€šè¿‡awaitè¯­å¥æŸ¥çœ‹ã€‚\n awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)\nå¹¶å‘è¿è¡Œawsåºåˆ—ä¸­çš„å¯ç­‰å¾…å¯¹è±¡ã€‚\n å¦‚æœæ‰€æœ‰å¯ç­‰å¾…å¯¹è±¡éƒ½æˆåŠŸå®Œæˆï¼Œç»“æœå°†æ˜¯ä¸€ä¸ªç”±æ‰€æœ‰è¿”å›å€¼èšåˆè€Œæˆçš„åˆ—è¡¨ã€‚ç»“æœå€¼çš„é¡ºåºä¸ aws ä¸­å¯ç­‰å¾…å¯¹è±¡çš„é¡ºåºä¸€è‡´ã€‚ å¦‚æœ aws ä¸­çš„æŸä¸ªå¯ç­‰å¾…å¯¹è±¡ä¸ºåç¨‹ï¼Œå®ƒå°†è‡ªåŠ¨ä½œä¸ºä¸€ä¸ªä»»åŠ¡åŠ å…¥æ—¥ç¨‹ã€‚ loopåœ¨Python3.8ä¸­å·²ç»åºŸå¼ƒï¼Œ3.10ä¸­å°†è¢«åˆ é™¤ã€‚ å¦‚æœ return_exceptions ä¸º False (é»˜è®¤)ï¼Œæ‰€å¼•å‘çš„é¦–ä¸ªå¼‚å¸¸ä¼šç«‹å³ä¼ æ’­ç»™ç­‰å¾… gather() çš„ä»»åŠ¡ã€‚aws åºåˆ—ä¸­çš„å…¶ä»–å¯ç­‰å¾…å¯¹è±¡ ä¸ä¼šè¢«å–æ¶ˆ å¹¶å°†ç»§ç»­è¿è¡Œã€‚  å¦‚æœ return_exceptions ä¸º Trueï¼Œå¼‚å¸¸ä¼šå’ŒæˆåŠŸçš„ç»“æœä¸€æ ·å¤„ç†ï¼Œå¹¶èšåˆè‡³ç»“æœåˆ—è¡¨ã€‚ å¦‚æœ gather() è¢«å–æ¶ˆï¼Œæ‰€æœ‰è¢«æäº¤ (å°šæœªå®Œæˆ) çš„å¯ç­‰å¾…å¯¹è±¡ä¹Ÿä¼š è¢«å–æ¶ˆã€‚     ã€€asyncio.gather()çš„å‚æ•°æ˜¯å¯ç­‰å¾…å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å°†asyncio.create_task()è¿”å›çš„Taskå¯¹è±¡ä½œä¸ºå®ƒçš„å‚æ•°ã€‚\nã€€è¿è¡Œä¸‹é¢çš„ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  # asyncio_concurrency_await.py import asyncio import time async def nested(): print(\u0026#34;Coro nested Started.\u0026#34;) await asyncio.sleep(3) print(\u0026#34;Coro nested Finished.\u0026#34;) async def main(): print(\u0026#34;Coro main Started.\u0026#34;) task = asyncio.create_task(nested()) print(\u0026#34;Coro main Finished.\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main()) print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;)   ã€€ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š\n1 2 3 4 5 6  $python3.7 asyncio_concurrency_await.py started at 15:11:25 Coro main Started. Coro main Finished. Coro nested Started. finished at 15:11:25   ã€€å¯ä»¥çœ‹åˆ°æ˜¯ä»åç¨‹main()è¿›å…¥çš„ï¼Œå¹¶ä¸”ç”±äºæ²¡æœ‰awaitï¼Œmain()åœ¨returnå‰ä¸ä¼šäº¤å‡ºæ§åˆ¶æƒï¼Œæ‰€ä»¥åœ¨è¾“å‡ºFinieshedä»¥åï¼Œnested()è·å¾—æ§åˆ¶æƒï¼Œè¿è¡Œåˆ°sleepï¼Œäº¤å‡ºæ§åˆ¶æƒï¼Œå›åˆ°___main__ä¸­ï¼Œè¿è¡Œåˆ°æœ€åä¸€å¥ï¼Œç„¶åç›´æ¥é€€å‡ºã€‚å¦‚æœæƒ³è¦çœ‹åˆ°nested()çš„ç»“æœï¼Œéœ€è¦await nested()ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  # asyncio_concurrency_await.py import asyncio import time async def nested(): print(\u0026#34;Coro nested Started.\u0026#34;) await asyncio.sleep(3) print(\u0026#34;Coro nested Finished.\u0026#34;) async def main(): print(\u0026#34;Coro main Started.\u0026#34;) task = asyncio.create_task(nested()) await task #await asyncio.gather(nested()) print(\u0026#34;Coro main Finished.\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main()) print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;)   ã€€å°†å¾—åˆ°ä¸‹é¢çš„è¾“å‡ºç»“æœï¼š\n1 2 3 4 5 6 7  $python3.7 asyncio_concurrency_await.py started at 15:17:53 Coro main Started. Coro nested Started. Coro nested Finished. Coro main Finished. finished at 15:17:56   ã€€å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å°†è¿™ä¸¤å¥æ›¿æ¢ä¸ºawait asyncio.gather(nested())ã€‚\nã€€æ‰€ä»¥åœ¨æœ‰å¤šä¸ªä»»åŠ¡æ—¶ï¼Œé€šå¸¸ä½¿ç”¨asyncio.create_task()å¹¶å‘å¯åŠ¨ä»»åŠ¡ï¼Œç”¨await asyncio.gather()è¯­å¥ç­‰å¾…æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚ç”¨asyncio.create_task()æ–¹ä¾¿åˆ›å»ºtask listï¼Œå› ä¸ºç›´æ¥åˆ›å»ºåœ¨listä¸­ä¼šé¡ºåºè¿è¡Œè¿™äº›ç¨‹åºï¼Œè€Œç”¨æ¨å¯¼å¼ï¼ˆåˆ—è¡¨ç”Ÿæˆå¼ï¼‰å’Œasyncio.create_task()å¯ä»¥ä½¿ä»£ç ç¾è§‚ï¼š\n1 2 3 4 5 6 7 8 9 10  #ç¨‹åºæ¥è‡ªäºé™„å½•[1]çš„asyncq.py ... producers = [asyncio.create_task(produce(n, q)) for n in range(nprod)] consumers = [asyncio.create_task(consume(n, q)) for n in range(ncon)] await asyncio.gather(*producers) ... #è¿™æ ·å†™ä¼šå¯¼è‡´é¡ºåºè¿è¡Œproduce(0,q)ï¼Œproduce(1,q)ï¼Œç„¶åä¸€ç›´ç­‰å¾…ï¼Œæ— æ³•è·å¾—ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ producers = [produce(n, q) for n in range(nprod)] #å¦‚æœä¸ä½¿ç”¨create_task()ï¼Œå°±è¦å†™æˆä¸‹é¢çš„æ ¼å¼ï¼Œè¿™å¾ˆç³Ÿç³• await asyncio.gather(produce(0,q), produce(1,q),...)   æ§åˆ¶å¹¶å‘é‡ ã€€ä¸€æ¬¡å¹¶å‘å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„ç»“æœï¼Œæ¯”å¦‚å¹¶å‘é‡ä¸º5000ï¼Œä½†æœåŠ¡å™¨å¯èƒ½æ£€æµ‹åˆ°2000ä¸ªè¯·æ±‚å°±å°†ä½ æ ‡è®°ä¸ºå¯ç–‘ã€‚å¯ä»¥é€šè¿‡asyncio.Semaphore(\u0026lt;num\u0026gt;)æ§åˆ¶åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„æœ€å¤§ä»»åŠ¡æ•°ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 6  #æœ€å¤šå¹¶å‘10ä¸ªä»»åŠ¡ï¼Œè¶…è¿‡10ä¸ªçš„ä»»åŠ¡å°†ç­‰å¾… sem = asyncio.Semaphore(10) # ... later async with sem: # work with shared resource   \r class asyncio.Semaphore(value=1, ***, loop=None)\nSemaphoreä¼šç®¡ç†ä¸€ä¸ªå†…éƒ¨è®¡æ•°å™¨ï¼Œè¯¥è®¡æ•°å™¨ä¼šéšæ¯æ¬¡ acquire() è°ƒç”¨é€’å‡å¹¶éšæ¯æ¬¡ release()è°ƒç”¨é€’å¢ã€‚è®¡æ•°å™¨çš„å€¼æ°¸è¿œä¸ä¼šé™åˆ°é›¶ä»¥ä¸‹ï¼›å½“ acquire()å‘ç°å…¶å€¼ä¸ºé›¶æ—¶ï¼Œå®ƒå°†ä¿æŒé˜»å¡ç›´åˆ°æœ‰æŸä¸ªä»»åŠ¡è°ƒç”¨äº† release()\nSource\n asyncio.Semaphore(\u0026lt;num\u0026gt;)æ¨èä½¿ç”¨async withè¯­å¥ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ç­‰ä»·äºï¼š\n1 2 3 4 5 6 7 8  sem = asyncio.Semaphore(10) # ... later await sem.acquire() try: # work with shared resource finally: sem.release()   æ€»ç»“ ã€€Pythonå®˜æ–¹æä¾›çš„å¼‚æ­¥IOåŒ…ä¸ºasyncioï¼Œéœ€è¦Python3.7ä»¥ä¸Šç‰ˆæœ¬ã€‚\nã€€å¯¹äºå•ä¸ªåç¨‹æ¥è¯´ï¼Œä½¿ç”¨async defå®šä¹‰ï¼ŒåŒæ—¶åç¨‹å‡½æ•°ä½“ä¸­åº”æœ‰äº¤å‡ºæ§åˆ¶æƒçš„å…³é”®è¯ï¼Œå¦‚awaitã€yieldã€returnã€‚\nã€€å¯¹äºæ‰€æœ‰åç¨‹æ¥è¯´ï¼Œéœ€è¦ä¸€ä¸ªåç¨‹çš„å…¥å£main()ï¼Œä¹Ÿè¢«ç§°ä½œåŒ…è£…å™¨ï¼ˆwrapperï¼‰ï¼Œé€šè¿‡asyncio.run(main())å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼Œå¹¶æ‰§è¡Œmain()ã€‚åœ¨main()ä¸­æŠŠè¦æ‰§è¡Œçš„åç¨‹ç”¨asyncio.create_task()å°è£…ä¸ºtask()å¯¹è±¡ï¼Œå¹¶å‘æ‰§è¡Œï¼Œç„¶åä½¿ç”¨await asyncio.gather()è·å¾—ä»–ä»¬çš„æ‰§è¡Œç»“æœã€‚\nã€€å¯ä»¥å®šä¹‰ä¸€ä¸ªç¨‹åºæ¨¡æ¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  import asyncio async def coro1(): await asyncio.sleep(5) async def coro2(): ... async def main(): task1 = asyncio.create_task(coro1()) ... await asyncio.gather(task1,...) if __name__ == \u0026#34;__main__\u0026#34;: asyncio.run(main())   \r\r ç»™å®šåç¨‹ä¸­çš„ä»»ä½•è¡Œ(hang)éƒ½ä¼šé˜»å¡å…¶å®ƒåç¨‹ï¼Œé™¤éè¯¥è¡Œä½¿ç”¨yieldï¼Œawaitæˆ–returnã€‚æ‰€ä»¥å†™æˆæ›´é€‚ç”¨äºIOå¯†é›†å‹ä»»åŠ¡ï¼ŒæŠŠIOä»»åŠ¡å°è£…ä¸ºåç¨‹å‡½æ•°ï¼Œæé«˜CPUåˆ©ç”¨ç‡ã€‚ ä¸æ˜¯åœ¨æ‰€æœ‰å‡½æ•°å‰åŠ ä¸Šasyncå®ƒæœ¬èº«å°±èƒ½å¤Ÿå¼‚æ­¥è¿è¡Œäº†ï¼Œéœ€è¦è¯¥å‡½æ•°çš„å®ç°æ”¯æŒå¼‚æ­¥ï¼Œå¦‚å‘é€HTTPè¯·æ±‚éœ€è¦aiohttpåŒ…ã€‚æ›´å¤šå¯ä»¥å‚è€ƒé™„å½•[1]çš„æ–‡æœ«ã€‚ è¦å¹¶å‘çš„ä»»åŠ¡åŠ¡å¿…ä½¿ç”¨.create_task()ï¼Œç„¶åå…¨éƒ¨æ”¾å…¥.gather()ä¸­ç­‰å¾…ï¼Œå¦åˆ™ä¸ä¼šå¹¶å‘æ‰§è¡Œï¼Œä»æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚  \r \r3 å¸¸è§ç”¨æ³•åŠæ³¨æ„äº‹é¡¹ asyncio.Queue ã€€æ–‡æ¡£åœ°å€ï¼šhttps://docs.python.org/3.9/library/asyncio-queue.html?highlight=asyncio%20queue#asyncio.Queue\n class asyncio.Queue(maxsize=0, ***, loop=None)\nå…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—\nmaxsizeï¼šé˜Ÿåˆ—ä¸­æœ€å¤§å…ƒç´ ä¸ªæ•°ï¼Œmaxsize â‰¤ 0ï¼Œé˜Ÿåˆ—å¤§å°æ˜¯æ— é™çš„ï¼Œå¦‚æœæ˜¯å¤§äº0çš„æ­£æ•´æ•°ï¼Œå½“é˜Ÿåˆ—é•¿åº¦åˆ°è¾¾maxsizeæ—¶ï¼Œawait put()å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä¸­ä¸€é¡¹è¢«get()ç§»å‡ºé˜Ÿåˆ—ã€‚\nå’Œçº¿ç¨‹åº“ä¸­çš„queueä¸åŒï¼Œæ­¤é˜Ÿåˆ—çš„å¤§å°æ€»æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”é€šè¿‡è°ƒç”¨qsize()æ–¹æ³•è¿”å›é˜Ÿåˆ—å¤§å°ã€‚\n  empty()ï¼šå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å›Trueï¼Œå¦åˆ™è¿”å›falseã€‚ full()ï¼šå¦‚æœé˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°äº†maxsizeï¼Œåˆ™è¿”å›Trueï¼Œå¦‚æœé˜Ÿåˆ—maxsize=0ï¼Œåˆ™full()æ°¸è¿œä¹Ÿä¸ä¼šè¿”å›Trueã€‚ get_nowait()ï¼šå¦‚æœæœ‰ç«‹å³å¯è·å¾—çš„å…ƒç´ ï¼Œåˆ™è¿”å›è¯¥å…ƒç´ ï¼Œå¦åˆ™raise QueueEmptyã€‚ coroutine get()ï¼šä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¿”å›è¯¥å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…åˆ°å­˜åœ¨å¯ç”¨çš„å…ƒç´ ã€‚ put_nowait()ï¼šæ— é˜»å¡åœ°å‘é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çš„æ§½ï¼Œåˆ™raise QueueFullã€‚ coroutine put()ï¼šæŠŠå…ƒç´ æ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¸€ç›´ç­‰å¾…ç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºçš„æ§½ï¼Œç„¶åå°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—ã€‚ task_done()ï¼šè¡¨ç¤ºå…ˆå‰å…¥é˜Ÿçš„ä»»åŠ¡å·²ç»å®Œæˆã€‚ç”±é˜Ÿåˆ—æ¶ˆè´¹è€…è°ƒç”¨ã€‚å¯¹äºæ¯ä¸ªè·å–ä»»åŠ¡çš„get()ï¼Œåç»­éƒ½è¦è°ƒç”¨task_done()æ¥å‘Šè¯‰é˜Ÿåˆ—ï¼Œè¯¥ä»»åŠ¡çš„å¤„ç†å·²å®Œæˆã€‚å¦‚æœjoin()å½“å‰å¤„äºé˜»å¡çŠ¶æ€ï¼Œåˆ™å°†åœ¨å¤„ç†å®Œæ‰€æœ‰é¡¹ç›®åæ¢å¤è¿è¡Œï¼ˆæ„å‘³ç€å·²æ”¾å…¥é˜Ÿåˆ—çš„æ¯ä¸ªé¡¹ç›®éƒ½ä¼šæ¥æ”¶åˆ°task_done()è°ƒç”¨ï¼‰ã€‚å¦‚æœè¢«è°ƒç”¨çš„æ¬¡æ•°è¶…è¿‡é˜Ÿåˆ—ä¸­æ”¾ç½®çš„é¡¹ç›®çš„æ¬¡æ•°ï¼Œåˆ™å¼•å‘ValueErrorã€‚ coroutine join()ï¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ è¢«æ¥æ”¶å’Œå¤„ç†å®Œæ¯•ã€‚æ¯å½“å°†é¡¹ç›®æ·»åŠ åˆ°é˜Ÿåˆ—æ—¶ï¼Œæœªå®Œæˆä»»åŠ¡çš„æ•°é‡å°±ä¼šå¢åŠ ã€‚æ¯å½“æ¶ˆè´¹è€…åç¨‹è°ƒç”¨task_done()è¡¨ç¤ºå·²æ£€ç´¢åˆ°è¯¥ç‰©å“å¹¶ä¸”è¯¥ç‰©å“çš„æ‰€æœ‰å·¥ä½œå·²å®Œæˆæ—¶ï¼Œè¯¥è®¡æ•°å°±ä¼šå‡å°‘ã€‚å½“æœªå®Œæˆçš„ä»»åŠ¡æ•°é™è‡³é›¶æ—¶ï¼Œjoin()è§£é™¤é˜»æ­¢ã€‚  ã€€ä¸‹é¢çš„ç¨‹åºå±•ç¤ºäº†åœ¨æœ‰20ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ä¸­ï¼Œä½¿ç”¨3ä¸ªåç¨‹å…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­å…ƒç´ ï¼Œç¨‹åºæºäºå®˜æ–¹æ–‡æ¡£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  import asyncio import random import time async def worker(name, queue): while True: # Get a \u0026#34;work item\u0026#34; out of the queue. sleep_for = await queue.get() # Sleep for the \u0026#34;sleep_for\u0026#34; seconds. await asyncio.sleep(sleep_for) # Notify the queue that the \u0026#34;work item\u0026#34; has been processed. queue.task_done() print(f\u0026#39;{name} has slept for {sleep_for:.2f} seconds\u0026#39;) async def main(): # Create a queue that we will use to store our \u0026#34;workload\u0026#34;. queue = asyncio.Queue() # Generate random timings and put them into the queue. total_sleep_time = 0 for _ in range(20): sleep_for = random.uniform(0.05, 1.0) total_sleep_time += sleep_for queue.put_nowait(sleep_for) # Create three worker tasks to process the queue concurrently. tasks = [] for i in range(3): task = asyncio.create_task(worker(f\u0026#39;worker-{i}\u0026#39;, queue)) tasks.append(task) # Wait until the queue is fully processed. started_at = time.monotonic() await queue.join() total_slept_for = time.monotonic() - started_at # Cancel our worker tasks. for task in tasks: task.cancel() # Wait until all worker tasks are cancelled. await asyncio.gather(*tasks, return_exceptions=True) print(\u0026#39;====\u0026#39;) print(f\u0026#39;3 workers slept in parallel for {total_slept_for:.2f} seconds\u0026#39;) print(f\u0026#39;total expected sleep time: {total_sleep_time:.2f} seconds\u0026#39;) asyncio.run(main())   ã€€time.monotonic()ç”¨æ¥æµ‹é‡å‡†ç¡®çš„ç¨‹åºæ‰§è¡Œæ—¶é—´ï¼Œå®ƒè¿”å›ä¸€ä¸ªä¸ä¼šå€’é€€çš„æ—¶é—´ï¼Œä¸å—ç³»ç»Ÿæ—¶é—´åŒæ­¥æ›´æ–°å½±å“ã€‚\n\rã€€æŠ¥é”™ï¼šgot Future attached to a different loop\nã€€Queueå¿…é¡»åœ¨loopä¸­å®šä¹‰ï¼Œå³åœ¨è¿è¡Œasyncio.run()ä¹‹åå®šä¹‰ï¼Œå¦åˆ™Queueä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯ï¼Œç„¶åasyncio.run()ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¾ªç¯ï¼ŒQueueå’Œasyncio.run()ä¸­çš„å‡½æ•°å°±å¤„äºä¸åŒçš„å¾ªç¯ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ã€‚\nã€€å‚è€ƒï¼šhttps://stackoverflow.com/questions/53724665/using-queues-results-in-asyncio-exception-got-future-future-pending-attachedhttps://docs.python.org/zh-cn/3/library/asyncio.html?highlight=asyncio#module-asyncio)\n\r Task.cancel() ã€€å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„Taskå¯¹è±¡ï¼Œä½¿è¯¥Taskå¯¹è±¡æŠ›å‡ºä¸€ä¸ªCancelledErrorå¼‚å¸¸ç»™æ‰“åŒ…çš„åç¨‹ã€‚å¦‚æœå–æ¶ˆæœŸé—´åç¨‹æ­£åœ¨ç­‰å¾…ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè¯¥Futureå¯¹è±¡ä¹Ÿå°†è¢«å–æ¶ˆã€‚\nã€€ä¸‹é¢çš„ç¨‹åºä¸­ï¼Œå¦‚æœä¸æ•è·å¼‚å¸¸ï¼Œä¼šæŠ¥Tracebackçš„é”™ï¼Œå› ä¸ºå–æ¶ˆä»»åŠ¡å‘ç”Ÿåœ¨cancel_me()çš„awaitæœŸé—´ã€‚ç¨‹åºæºäºå®˜æ–¹æ–‡æ¡£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  # asyncio_task_cancel.py async def cancel_me(): print(\u0026#39;cancel_me(): before sleep\u0026#39;) try: # Wait for 1 hour await asyncio.sleep(3600) except asyncio.CancelledError: print(\u0026#39;cancel_me(): cancel sleep\u0026#39;) raise finally: print(\u0026#39;cancel_me(): after sleep\u0026#39;) async def main(): # Create a \u0026#34;cancel_me\u0026#34; Task task = asyncio.create_task(cancel_me()) # Wait for 1 second await asyncio.sleep(1) task.cancel() try: await task except asyncio.CancelledError: print(\u0026#34;main(): cancel_me is cancelled now\u0026#34;) asyncio.run(main()) # Expected output: # # cancel_me(): before sleep # cancel_me(): cancel sleep # cancel_me(): after sleep # main(): cancel_me is cancelled now    exception asyncio.CancelledError\nè¯¥æ“ä½œå·²è¢«å–æ¶ˆï¼Œå–æ¶ˆasyncioä»»åŠ¡æ—¶ï¼Œå¯ä»¥æ•è·æ­¤å¼‚å¸¸ä»¥æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚åœ¨å‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹ï¼Œéƒ½å¿…é¡»é‡æ–°å¼•å‘å¼‚å¸¸ã€‚\n ã€€åªæœ‰åœ¨awaitç­‰å¾…çš„ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæ—¶æ‰ä¼šæŠ›å‡ºCancelledErrorå¼‚å¸¸ï¼Œä¸ç„¶åªä¼šå–æ¶ˆä»»åŠ¡ï¼Œæ‰€ä»¥.cancel()å¸¸ç”¨äºå–æ¶ˆå¤„äºæ— é™å¾ªç¯çŠ¶æ€çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ç¬¬1èŠ‚ä¸­çš„task.cancel()ï¼‰ã€‚\nEvent Loop ã€€æ³¨ï¼šåº”ç”¨å¼€å‘è€…åº”ä½¿ç”¨é«˜å±‚çº§çš„asyncioå‡½æ•°ï¼Œå¦‚asyncio.run()ï¼Œåº”å°½é‡å‡å°‘å¾ªç¯å¯¹è±¡çš„ä½¿ç”¨ã€‚\nã€€å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/library/asyncio-eventloop.html?highlight=loop%20run_until_complete#asyncio.loop.run_until_complete\nã€€asyncio.get_event_loop()ï¼šè·å–å½“å‰äº‹ä»¶å¾ªç¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯å¹¶å°†å…¶è®¾ç½®ä¸ºå½“å‰äº‹ä»¶å¾ªç¯ï¼›æ³¨æ„ä¸€èˆ¬ä¸åœ¨åç¨‹å’Œå›è°ƒä¸­ä½¿ç”¨ã€‚\nã€€asyncio.get_running_loop()ï¼šè¿”å›å½“å‰ç³»ç»Ÿçº¿ç¨‹æ­£åœ¨è¿è¡Œçš„äº‹ä»¶å¾ªç¯ã€‚åœ¨åç¨‹å’Œå›è°ƒä¸­ä½¿ç”¨è¯¥å‡½æ•°è·å–äº‹ä»¶å¾ªç¯ã€‚\nã€€asyncio.set_event_loop(loop)ï¼šå°†loopè®¾ç½®ä¸ºå½“å‰ç³»ç»Ÿçº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ã€‚\nã€€asyncio.new_event_loop()ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯ã€‚\nã€€loop.run_until_complete(future)ï¼šè¿è¡Œfutureå®ä¾‹ï¼Œç›´åˆ°futureå®ä¾‹è¢«å®Œæˆã€‚å¦‚æœå‚æ•°æ˜¯coroutine objectï¼Œåˆ™å°†è¢«éšå¼è°ƒåº¦ä¸ºasyncio.Taskæ¥è¿è¡Œã€‚\nasyncio.run() ã€€æºä»£ç ï¼šhttps://github.com/python/cpython/blob/3.9/Lib/asyncio/runners.py\nã€€ç”±äºæ”¯æŒå¼‚æ­¥çš„ç¬¬ä¸‰æ–¹åº“ä¼šä½¿ç”¨event_loopï¼Œè¾ƒä¸ºåº•å±‚ï¼Œè€ƒè™‘æ›¿æ¢ä¸ºasyncio.run()ï¼Œæ‰€ä»¥ç®€å•æ¢ç©¶ä¸€ä¸‹asyncio.run()å’Œevent_loopçš„å…³ç³»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67  __all__ = \u0026#39;run\u0026#39;, from . import coroutines from . import events from . import tasks def run(main, *, debug=None): \u0026#34;\u0026#34;\u0026#34;Execute the coroutine and return the result. This function runs the passed coroutine, taking care of managing the asyncio event loop and finalizing asynchronous generators. This function cannot be called when another asyncio event loop is running in the same thread. If debug is True, the event loop will be run in debug mode. This function always creates a new event loop and closes it at the end. It should be used as a main entry point for asyncio programs, and should ideally only be called once. Example: async def main(): await asyncio.sleep(1) print(\u0026#39;hello\u0026#39;) asyncio.run(main()) \u0026#34;\u0026#34;\u0026#34; if events._get_running_loop() is not None: raise RuntimeError( \u0026#34;asyncio.run() cannot be called from a running event loop\u0026#34;) if not coroutines.iscoroutine(main): raise ValueError(\u0026#34;a coroutine was expected, got {!r}\u0026#34;.format(main)) loop = events.new_event_loop() try: events.set_event_loop(loop) if debug is not None: loop.set_debug(debug) return loop.run_until_complete(main) finally: try: _cancel_all_tasks(loop) loop.run_until_complete(loop.shutdown_asyncgens()) loop.run_until_complete(loop.shutdown_default_executor()) finally: events.set_event_loop(None) loop.close() def _cancel_all_tasks(loop): to_cancel = tasks.all_tasks(loop) if not to_cancel: return for task in to_cancel: task.cancel() loop.run_until_complete( tasks.gather(*to_cancel, loop=loop, return_exceptions=True)) for task in to_cancel: if task.cancelled(): continue if task.exception() is not None: loop.call_exception_handler({ \u0026#39;message\u0026#39;: \u0026#39;unhandled exception during asyncio.run() shutdown\u0026#39;, \u0026#39;exception\u0026#39;: task.exception(), \u0026#39;task\u0026#39;: task, })   ã€€æ ¹æ®æºä»£ç å¯ä»¥çœ‹å‡ºï¼Œasyncio.run()å®Œæˆäº†åˆ›å»ºäº‹ä»¶å¾ªç¯ï¼Œè®¾ç½®äº‹ä»¶å¾ªç¯å¹¶è¿è¡Œmainå®ä¾‹ã€‚\naiokafka  å®˜æ–¹æ–‡æ¡£ï¼šhttps://aiokafka.readthedocs.io/en/stable/\n ã€€kafkaçš„ç®€æ˜“å®‰è£…å’Œä½¿ç”¨å¯ä»¥å‚è€ƒå¦ä¸€ç¯‡å®‰è£…åŠä½¿ç”¨æ•™ç¨‹ï¼ˆæš‚æ—¶è¿˜æ²¡å†™ï¼‰ã€‚\næ¶ˆè´¹è€…(Consumer) ã€€å¯ä»¥å¼‚æ­¥æ¶ˆè´¹bootstrap_serversä¸­çš„topicåˆ—è¡¨ï¼Œå³ä¸‹é¢ç¨‹åºçš„test3å’Œtest4ã€‚\nã€€aiokafkaç»™å‡ºçš„å®˜æ–¹ç¤ºä¾‹ç¨‹åºå¼•ç”¨äº†asyncio.get_event_loop()ï¼Œè¿™æ˜¯Pythonå®˜æ–¹åœ¨åº”ç”¨ç¨‹åºä¸­ä¸å»ºè®®ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨asyncio.run()å°èŠ‚ä¸­å¯¹æ­¤å¥è¿›è¡Œäº†ä¿®æ”¹ã€‚\nã€€å®˜æ–¹ç¤ºä¾‹ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  from aiokafka import AIOKafkaConsumer import asyncio loop = asyncio.get_event_loop() async def consume(): consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, \u0026#39;test4\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;) # Get cluster layout and join group `my-group` await consumer.start() try: # Consume messages async for msg in consumer: print(\u0026#34;consumed: \u0026#34;, msg.topic, msg.partition, msg.offset, msg.key, msg.value, msg.timestamp) finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() loop.run_until_complete(consume())   ã€€ä¸Šè¿°ä»£ç ä½¿ç”¨åº•å±‚APIå¯åŠ¨è¯¥ä»»åŠ¡ï¼Œè€Œconsume()æ˜¯åç¨‹ï¼Œè€ƒè™‘ä½¿ç”¨åº”ç”¨çº§APIè¿›è¡Œä¿®æ”¹ã€‚asyncio.get_event_loop()åˆ›å»ºå¹¶è®¾ç½®å½“å‰äº‹ä»¶å¾ªç¯ï¼Œloop.run_until_complete(consume())è¿è¡Œåç¨‹ç›´åˆ°å®ƒç»“æŸã€‚\n ä½¿ç”¨asyncio.run()åˆ›å»ºäº‹ä»¶å¾ªç¯å¹¶è®¾ç½®äº‹ä»¶å¾ªç¯ï¼› åˆ›å»ºå…¥å£åç¨‹main()ï¼Œç”¨asyncio.run()å¯åŠ¨ï¼› ç”±äºconsumeréœ€è¦å½“å‰äº‹ä»¶å¾ªç¯ï¼Œæ‰€ä»¥åœ¨main()ä¸­ä½¿ç”¨asyncio.get_running_loop()è·å–å½“å‰äº‹ä»¶å¾ªç¯ï¼ˆæ³¨æ„ä¸è¦ä½¿ç”¨.get_event_loop()ï¼‰ï¼Œç„¶åå°†consume(loop)å°è£…ä¸ºtaskå¯åŠ¨åç¨‹ï¼Œå¹¶ä½¿ç”¨awaitç­‰å¾…è¿è¡Œã€‚  ã€€æ›¿æ¢åçš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  # aioconsumer.py from aiokafka import AIOKafkaConsumer import asyncio async def consume(loop): # loop åœ¨æ­¤å¤„è·å–ä¹Ÿå¯ä»¥ consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, \u0026#39;test4\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;) # Get cluster layout and join group `my-group` await consumer.start() try: # Consume messages async for msg in consumer: print(\u0026#34;consumed: \u0026#34;, msg.topic, msg.partition, msg.offset, msg.key, msg.value, msg.timestamp) finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() async def main(): loop = asyncio.get_running_loop() task = asyncio.create_task(consume(loop)) await task asyncio.run(main())   ç”Ÿäº§è€…(Producer) ã€€å…è®¸ç”Ÿäº§æ¶ˆæ¯åˆ°Topicæ—¶äº¤å‡ºæ§åˆ¶æƒã€‚åŒæ ·åœ°ï¼Œä¹Ÿå¯¹å®˜æ–¹ç¤ºä¾‹ç¨‹åºè¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸å†ä½¿ç”¨get_event_loopã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  # aioproducer.py from aiokafka import AIOKafkaProducer import asyncio import json async def produce(): loop = asyncio.get_running_loop() producer = AIOKafkaProducer( loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;)) # Get cluster layout and initial topic/partition leadership information await producer.start() try: # Produce message pkt = { \u0026#34;type\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;url\u0026#34;:\u0026#34;http://test.com/\u0026#34; } await producer.send_and_wait(\u0026#34;test3\u0026#34;, pkt) finally: # Wait for all pending messages to be delivered or expire. await producer.stop() async def main(): task = asyncio.create_task(produce()) await task asyncio.run(main())   ç”Ÿäº§è€…æ¶ˆè´¹è€…é€šè¿‡é˜Ÿåˆ—é€šä¿¡ ã€€ç¨‹åºæµç¨‹å’Œç¬¬2èŠ‚ä¸­æ€»ç»“éƒ¨åˆ†çš„ç¨‹åºæ¨¡æ¿ä¸€è‡´ã€‚è¿è¡Œç¨‹åºæ—¶å¯ä½¿ç”¨ä¸Šé¢çš„ç”Ÿäº§è€…å…ˆå‘kafkaä¸­ç”Ÿäº§ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65  # aiokafka_queue.py from aiokafka import AIOKafkaConsumer from aiokafka import AIOKafkaProducer import asyncio import json import time import base64 async def consume(consumer, queue): # Get cluster layout and join group `my-group` count = 0 await consumer.start() try: # Consume messages async for msg in consumer: count += 1 data = msg.value data.pop(\u0026#39;type\u0026#39;) data[\u0026#39;id\u0026#39;] = count await queue.put(data) finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() async def produce(producer, queue): # Get cluster layout and initial topic/partition leadership information await producer.start() while True: try: # Produce message data = await queue.get() await producer.send_and_wait(\u0026#34;test7\u0026#34;, data) print(f\u0026#34;produed at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) queue.task_done() except: # Wait for all pending messages to be delivered or expire. await producer.stop() async def main(): loop = asyncio.get_running_loop() queue = asyncio.Queue(5000) consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;, value_deserializer=lambda m: json.loads(m.decode(\u0026#39;ascii\u0026#39;))) producer = AIOKafkaProducer( loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;)) consume_task = asyncio.create_task(consume(consumer, queue)) produce_task = asyncio.create_task(produce(producer, queue)) await queue.join() await asyncio.gather(consume_task, produce_task) if __name__ == \u0026#34;__main__\u0026#34;: print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main()) print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;)   æ¶ˆè´¹çš„åŒæ—¶ç”Ÿäº§ ã€€ä¹Ÿå¯ä»¥å°†å¼‚æ­¥Kafkaç”Ÿäº§è¯­å¥åµŒå…¥æ¶ˆè´¹è€…ä¸­ï¼Œä½†ä¸€å®šæ³¨æ„ï¼Œè¦å°†await producer.start()è¯­å¥ç§»å‡ºæ¶ˆè´¹è€…ï¼ˆä¸ç§»å‡ºç”µè„‘ä¼šBoomï¼‰ã€‚åœ¨ä¸‹é¢çš„ç¨‹åºç¤ºä¾‹ä¸­ï¼Œä¸å¯ä»¥å°†await producer.start()æ”¾ç½®åœ¨produce()åç¨‹å‡½æ•°ä¸­ã€‚\nã€€å¼‚æ­¥æ¶ˆè´¹çš„åŒæ—¶ç”Ÿäº§ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ­¥Kafkaè¿›è¡Œç”Ÿäº§ï¼Œå‡å°‘äº¤å‡ºæ§åˆ¶æƒçš„æ¬¡æ•°ï¼ˆæ­¤å¤„ä¸å†åˆ—å‡ºç¨‹åºï¼Œå¯ä»¥å‚è€ƒç¬¬4èŠ‚åœ°å€ä¸­çš„aiokafka_consume_and_synproduce.pyï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58  # aiokafka_consume_and_produce.py from aiokafka import AIOKafkaConsumer from aiokafka import AIOKafkaProducer import asyncio import json import time import base64 async def consume(consumer, producer): # Get cluster layout and join group `my-group` count = 0 await consumer.start() try: # Consume messages async for msg in consumer: count += 1 data = msg.value data.pop(\u0026#39;type\u0026#39;) data[\u0026#39;id\u0026#39;] = count await produce(producer, data) finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() async def produce(producer, msg): try: await producer.send_and_wait(\u0026#34;test7\u0026#34;, msg) print(f\u0026#34;{msg[\u0026#39;id\u0026#39;]} produced at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) except: # Wait for all pending messages to be delivered or expire. await producer.stop() async def main(): loop = asyncio.get_running_loop() consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;, value_deserializer=lambda m: json.loads(m.decode(\u0026#39;ascii\u0026#39;))) producer = AIOKafkaProducer( loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;)) # æ­¤å¥ä¸€å®šä¸èƒ½åœ¨produceä¸­ await producer.start() consume_task = asyncio.create_task(consume(consumer, producer)) await asyncio.gather(consume_task) if __name__ == \u0026#34;__main__\u0026#34;: print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main()) #print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;)   aiohttp  å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.aiohttp.org/en/stable/\n å¹¶å‘å‘é€HTTPè¯·æ±‚ ã€€ä¸‹é¢çš„ä»£ç æ˜¯åˆ©ç”¨HTTPæ¥å£ä¸Šä¼ æ–‡ä»¶åˆ°S3æœåŠ¡ï¼Œuå¯æ›¿æ¢æˆS3æœåŠ¡åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  # aiohttp_send_req.py import sys import time import aiohttp import asyncio from aiohttp import ClientSession async def put_pcapng(url,session,semaphore,data,headers): async with semaphore: async with session.put(url,data=data,headers=headers) as resp: if resp.status == 200: return await resp.read() else: print(f\u0026#34;ERROR: {time.strftime(\u0026#39;%X\u0026#39;)} {resp.status} {url}.\u0026#34;) async def main(urls, data, headers): #è®¾ç½®æœ€å¤§å¹¶å‘é‡ï¼Œè¯¦ç»†è§ç¬¬2èŠ‚\u0026#34;æ§åˆ¶å¹¶å‘é‡\u0026#34; semaphore =asyncio.Semaphore(500) async with ClientSession() as session: tasks = [] for url in urls: tasks.append( put_pcapng(url=url, session=session, semaphore=semaphore,data=data,headers=headers) ) await asyncio.gather(*tasks) if __name__ == \u0026#34;__main__\u0026#34;: assert sys.version_info \u0026gt;= (3, 7), \u0026#34;Script requires Python 3.7+.\u0026#34; with open(\u0026#39;test.pcapng\u0026#39;, \u0026#39;rb\u0026#39;) as f: data = f.read() headers = { \u0026#34;Content-Type\u0026#34;:\u0026#34;pcapng\u0026#34;, \u0026#34;token\u0026#34;:\u0026#34;xxxxxxxxxxxxxxxxxxxxxxxx\u0026#34; } u = \u0026#39;http://endpoint_url/\u0026lt;bucket_name\u0026gt;/\u0026lt;key\u0026gt;\u0026#39; urls = [] for i in range(1,4001): url = u + \u0026#39;test\u0026#39; + str(i) + \u0026#39;.pcapng\u0026#39; urls.append(url) print(f\u0026#34;started at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) asyncio.run(main(urls,data,headers)) print(f\u0026#34;finished at {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;)   å¹¶å‘å‘é€HTTPè¯·æ±‚å¹¶è§£æHTMLé¡µé¢ ã€€å¯ä»¥å‚è€ƒé™„å½•1çš„areq.pyï¼Œç¨‹åºçš„è¯¦ç»†è§£æå¯ä»¥çœ‹é™„å½•çš„1ã€‚ä¸ºèŠ‚çœç¯‡å¹…ï¼Œæ­¤å¤„ä¸å†æ”¾ç½®æ­¤ç¨‹åºã€‚\naiokafkaã€aiohttpã€asyncio.queueç»¼åˆåº”ç”¨ ã€€åç¨‹1ä»kafkaçš„consume_topicä¸­æ¶ˆè´¹æ•°æ®ï¼Œä¿®æ”¹åæ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åç”Ÿäº§åˆ°produce_topicä¸­ï¼›åç¨‹2(100ä¸ª)ä»é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œä¸Šä¼ åˆ°S3æœåŠ¡ã€‚\nã€€ç”Ÿäº§è€…ç”¨AIOKafkaProducerï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116  # aiokafka_to_s3.py import json import time from aiokafka import AIOKafkaConsumer, AIOKafkaProducer import asyncio import base64 import aiohttp from aiohttp import ClientSession headers = { \u0026#34;Content-Type\u0026#34;:\u0026#34;pcapng\u0026#34;, \u0026#34;token\u0026#34;:\u0026#34;xxxxxxxxxxxxxx\u0026#34; } endpoint_url = \u0026#39;http://\u0026lt;endpoint_url\u0026gt;/\u0026lt;bucket_name\u0026gt;/\u0026#39; with open(\u0026#39;test.pcapng\u0026#39;, \u0026#39;rb\u0026#39;) as f: pcapng_data = f.read() total_s3 = 0 total_prod = 0 async def produce(producer, msg): # Get cluster layout and initial topic/partition leadership information try: await producer.send_and_wait(\u0026#34;test6\u0026#34;, msg) #print(f\u0026#34;INFO: {time.strftime(\u0026#39;%X\u0026#39;)} {msg[\u0026#39;id\u0026#39;]} produced. \u0026#34;) except: # Wait for all pending messages to be delivered or expire. await producer.stop() async def consume(consumer, producer, msg_q): # Get cluster layout and join group `my-group` global total_prod await consumer.start() try: # Consume messages async for msg in consumer: data = msg.value data.pop(\u0026#39;type\u0026#39;) data[\u0026#39;id\u0026#39;] = total_prod data[\u0026#39;url\u0026#39;] = endpoint_url + str(data[\u0026#39;id\u0026#39;]) + \u0026#39;.pcapng\u0026#39; await produce(producer, data) # jsonä¸­ä¸èƒ½æœ‰byteç±»å‹ data[\u0026#39;pcapng\u0026#39;] = pcapng_data await msg_q.put(data) total_prod += 1 finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() async def upload_to_s3(session,semaphore,queue): global total_s3 while True: data = await queue.get() url = data[\u0026#39;url\u0026#39;] async with semaphore: async with session.put(url,data=data[\u0026#39;pcapng\u0026#39;],headers=headers) as resp: if resp.status == 200: queue.task_done() total_s3 += 1 #print(f\u0026#34;INFO: {time.strftime(\u0026#39;%X\u0026#39;)} finish upload {data[\u0026#39;id\u0026#39;]} {url}. \u0026#34;) else: # æ­¤å¤„é”™è¯¯æ²¡æœ‰åšé‡ä¼ å¤„ç†ï¼Œå¯ä»¥é‡‡ç”¨å†æ”¾å›é˜Ÿåˆ—çš„æ–¹å¼ print(f\u0026#34;ERROR: {time.strftime(\u0026#39;%X\u0026#39;)} {resp.status} {url}. Retried. \u0026#34;) async def print_metric(start_time): while True: t_time = time.time() - start_time s3_speed = total_s3/t_time prod_speed = total_prod/t_time print(f\u0026#34;upload to s3: {s3_speed}\u0026#34;) print(f\u0026#34;produce to kafka: {prod_speed}\u0026#34;) await asyncio.sleep(1) async def main(): #åˆå§‹åŒ–å·¥ä½œ pcapng_q = asyncio.Queue(500) semaphore =asyncio.Semaphore(500) start_time = time.time() async with ClientSession() as session: loop = asyncio.get_running_loop() consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;, value_deserializer=lambda m: json.loads(m.decode(\u0026#39;ascii\u0026#39;))) producer = AIOKafkaProducer( loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;)) await producer.start() consume_task = asyncio.create_task(consume(consumer, producer, pcapng_q)) speed_task = asyncio.create_task(print_metric(start_time)) print(f\u0026#34;started {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) tasks_s3 = [] for i in range(100): tasks_s3.append(asyncio.create_task(upload_to_s3(session,semaphore,pcapng_q))) await pcapng_q.join() await asyncio.gather(consume_task, speed_task, *tasks_s3) if __name__ == \u0026#34;__main__\u0026#34;: try: asyncio.run(main()) except KeyboardInterrupt: print(\u0026#34;Quit.\u0026#34;)   \nã€€ç”Ÿäº§è€…ç”¨KafkaProducerï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108  # aiokafka_to_s3_synp.py  import json import time from aiokafka import AIOKafkaConsumer from kafka import KafkaProducer import asyncio import base64 import aiohttp from aiohttp import ClientSession headers = { \u0026#34;Content-Type\u0026#34;:\u0026#34;pcapng\u0026#34;, \u0026#34;token\u0026#34;:\u0026#34;xxxxxxxxxxxxxxxxxx\u0026#34; } endpoint_url = \u0026#39;http://\u0026lt;endpoint_url\u0026gt;/\u0026lt;bucket_name\u0026gt;/\u0026#39; with open(\u0026#39;test.pcapng\u0026#39;, \u0026#39;rb\u0026#39;) as f: pcapng_data = f.read() total_s3 = 0 total_prod = 0 async def consume(consumer, producer, msg_q): # Get cluster layout and join group `my-group` global total_prod await consumer.start() try: # Consume messages async for msg in consumer: data = msg.value data.pop(\u0026#39;type\u0026#39;) data[\u0026#39;id\u0026#39;] = total_prod data[\u0026#39;url\u0026#39;] = endpoint_url + str(data[\u0026#39;id\u0026#39;]) + \u0026#39;.pcapng\u0026#39; producer.send(\u0026#39;test6\u0026#39;, data) # jsonä¸­ä¸èƒ½æœ‰byteç±»å‹ data[\u0026#39;pcapng\u0026#39;] = pcapng_data await msg_q.put(data) total_prod += 1 finally: # Will leave consumer group; perform autocommit if enabled. await consumer.stop() async def upload_to_s3(session,semaphore,queue): global total_s3 while True: data = await queue.get() url = data[\u0026#39;url\u0026#39;] async with semaphore: async with session.put(url,data=data[\u0026#39;pcapng\u0026#39;],headers=headers) as resp: if resp.status == 200: total_s3 += 1 queue.task_done() #print(f\u0026#34;INFO: {time.strftime(\u0026#39;%X\u0026#39;)} finish upload {data[\u0026#39;id\u0026#39;]} {url}. \u0026#34;) else: # æ­¤å¤„é”™è¯¯æ²¡æœ‰åšé‡ä¼ å¤„ç†ï¼Œå¯ä»¥é‡‡ç”¨å†æ”¾å›é˜Ÿåˆ—çš„æ–¹å¼ print(f\u0026#34;ERROR: {time.strftime(\u0026#39;%X\u0026#39;)} {resp.status} {url}. Retried. \u0026#34;) async def print_metric(start_time): while True: t_time = time.time() - start_time s3_speed = total_s3/t_time prod_speed = total_prod/t_time print(f\u0026#34;upload to s3: {s3_speed}\u0026#34;) print(f\u0026#34;produce to kafka: {prod_speed}\u0026#34;) await asyncio.sleep(1) async def main(): #åˆå§‹åŒ–å·¥ä½œ pcapng_q = asyncio.Queue(500) semaphore =asyncio.Semaphore(500) start_time = time.time() async with ClientSession() as session: loop = asyncio.get_running_loop() consumer = AIOKafkaConsumer( \u0026#39;test3\u0026#39;, loop=loop, bootstrap_servers=\u0026#39;localhost:9092\u0026#39;, auto_offset_reset=\u0026#39;earliest\u0026#39;, value_deserializer=lambda m: json.loads(m.decode(\u0026#39;ascii\u0026#39;))) producer = KafkaProducer( value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;), bootstrap_servers=\u0026#39;localhost:9092\u0026#39; ) consume_task = asyncio.create_task(consume(consumer, producer, pcapng_q)) speed_task = asyncio.create_task(print_metric(start_time)) print(f\u0026#34;started {time.strftime(\u0026#39;%X\u0026#39;)}\u0026#34;) tasks_s3 = [] for i in range(100): tasks_s3.append(asyncio.create_task(upload_to_s3(session,semaphore,pcapng_q))) await pcapng_q.join() await asyncio.gather(consume_task, speed_task, *tasks_s3) if __name__ == \u0026#34;__main__\u0026#34;: try: asyncio.run(main()) except KeyboardInterrupt: print(\u0026#34;Quit.\u0026#34;)   ã€€å®é™…æµ‹è¯•ç”Ÿäº§è€…ç”¨KafkaProduceré€Ÿåº¦æ›´å¿«ï¼Œçº¦æ˜¯AIOKafkaProducerçš„2å€ã€‚\n4.å‚è€ƒä»£ç  ã€€åœ°å€ï¼šhttps://github.com/yyyIce/py_exercise/tree/main/asyncio\nã€€æœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\né™„å½• ã€€1.ä¸€ç¯‡asyncioæ•™ç¨‹ï¼ŒåŸæ–‡ï¼šhttps://realpython.com/async-io-python/\nã€€2.ä¸€ç¯‡å…³äºasyncio.gather()çš„å›ç­”ï¼šhttps://stackoverflow.com/questions/62528272/what-does-asyncio-create-task-do\n","description":"å¯¹Python asyncioå¼‚æ­¥ç¼–ç¨‹çš„ç†è§£å’Œåº”ç”¨","id":21,"section":"posts","tags":["python"],"title":"Pythonï¼šasyncioåç¨‹ç†è§£åŠç”¨æ³•","uri":"https://yyyIce.github.io/zh/posts/pythonasyncio%E5%8D%8F%E7%A8%8B%E7%90%86%E8%A7%A3%E5%8F%8A%E7%94%A8%E6%B3%95/"},{"content":"ã€€ç½‘ç»œç©ºé—´æµ‹ç»˜ä¹ä¸€å¬å¾ˆåƒæ–°é—»è”æ’­é‡Œçš„å¥å­ï¼Œå¯ä»¥åœ¨è¿™ç¯‡ç»¼è¿°ä¸­å¾—åˆ°èƒ½å¤Ÿè®©äººç†è§£çš„è§£é‡Šã€‚\né˜…è¯»å°è´´å£«ï¼šæœ¬æ–‡å†…å®¹ä¸»è¦æ‘˜æŠ„äºå‚è€ƒæ–‡çŒ®[1]ï¼Œä½œä¸ºç½‘ç»œç©ºé—´æµ‹ç»˜èƒŒæ™¯çš„å¿«é€Ÿå›é¡¾ï¼Œå¯ä»¥ä»¥æ–‡çŒ®[1]ä¸ºçº¿ç´¢ï¼Œè¿›è¡Œç›¸å…³æ–¹é¢èµ„æ–™çš„æŸ¥æ‰¾ã€‚\n1.ç½‘ç»œç©ºé—´(Cyberspace) ã€€ç½‘ç»œç©ºé—´å¯ä»¥ç†è§£ä¸ºçœ‹ä¸è§çš„æ„è¯†ç©ºé—´ã€ç”¨æˆ·ã€ç½‘ç»œä¸­çš„ä¿¡æ¯æµã€ç½‘ç»œé“¾è·¯ã€ç½‘ç»œè®¾å¤‡ç»„æˆçš„ç©ºé—´ã€‚çœ‹ä¸è§çš„æ„è¯†ç©ºé—´å¯ä»¥ç®€å•æè¿°ä¸ºç©ºé—´ä¸­ç”¨æˆ·çš„æ“ä½œã€ç”¨æˆ·çš„æƒ³æ³•ä»¥åŠé“¾è·¯ã€è®¾å¤‡ä¹‹é—´çš„é€»è¾‘ç»“æ„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nå›¾1 ç½‘ç»œç©ºé—´:\r\r ã€€æ–‡çŒ®[1]ä¸­å¯¹ç½‘ç»œç©ºé—´è¦ç´ è¿›è¡Œäº†æè¿°ï¼š\nã€€ç½‘ç»œç©ºé—´çš„ç»„æˆè¦ç´ åˆ†ä¸º4 ç§ç±»å‹: è½½ä½“ã€ä¿¡æ¯ã€ä¸»ä½“å’Œæ“ä½œã€‚\n  ã€€è½½ä½“ï¼šç½‘ç»œç©ºé—´çš„è½¯ç¡¬ä»¶è®¾æ–½,æ˜¯æä¾›ä¿¡æ¯é€šä¿¡çš„ç³»ç»Ÿå±‚é¢çš„é›†åˆ;\n  ã€€ä¿¡æ¯ï¼šæ˜¯åœ¨ç½‘ç»œç©ºé—´ä¸­æµè½¬çš„æ•°æ®å†…å®¹, åŒ…æ‹¬äººç±»ç”¨æˆ·åŠæœºå™¨ç”¨æˆ·èƒ½å¤Ÿç†è§£ã€è¯†åˆ«å’Œå¤„ç†çš„ä¿¡å·çŠ¶æ€;\n  ã€€ä¸»ä½“ï¼šäº’è”ç½‘ç”¨æˆ·, åŒ…æ‹¬ä¼ ç»Ÿäº’è”ç½‘ä¸­çš„äººç±»ç”¨æˆ·ä»¥åŠæœªæ¥ç‰©è”ç½‘ä¸­çš„æœºå™¨å’Œè®¾å¤‡ç”¨æˆ·;\n  ã€€æ“ä½œï¼šå¯¹ä¿¡æ¯çš„åˆ›é€ ã€å­˜å‚¨ã€æ”¹å˜ã€ä½¿ç”¨ã€ä¼ è¾“ã€å±•ç¤ºç­‰æ´»åŠ¨ã€‚\n  2.ç½‘ç»œç©ºé—´èµ„æº ã€€æŒ‰æ–‡çŒ®[1]ä¸­çš„å®šä¹‰ï¼Œå¯ä»¥å°†ç½‘ç»œç©ºé—´èµ„æºåˆ†ä¸ºå®ä½“èµ„æºå’Œè™šæ‹Ÿèµ„æºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nå›¾2 ç½‘ç»œç©ºé—´èµ„æº:\r\r ã€€ç½‘ç»œç©ºé—´èµ„æºç”¨å±æ€§æ¥è¿›è¡ŒåŒºåˆ†å’Œè¯†åˆ«ï¼Œæ˜¯æŒ‡ç½‘ç»œç©ºé—´èµ„æºå…·å¤‡çš„æ‰€æœ‰å…±åŒæ€§è´¨æˆ–ç‹¬æœ‰æ€§è´¨çš„æ€»å’Œã€‚æ¯”å¦‚è™šæ‹Ÿç”¨æˆ·ï¼Œæ‹¥æœ‰å…±åŒçš„å±æ€§ä¸ºæ€§åˆ«ã€ç”¨æˆ·åã€å¹´é¾„ç­‰ï¼Œä¸åŒçš„ç”¨æˆ·ç±»åˆ«å¯èƒ½æœ‰ç‹¬æœ‰çš„å±æ€§ï¼Œæ¯”å¦‚åªå…è®¸18å²ä»¥ä¸Šçš„ç”¨æˆ·å¯è§éƒ¨åˆ†å†…å®¹ã€‚\nå…³äºè®¡ç®—æœºç½‘ç»œæ–¹å‘çš„ç ”ç©¶å†…å®¹ä¸»è¦å›´ç»•èµ„æºåˆ†ç±»å›¾å±•å¼€ã€‚\n3.ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜ 3.1 ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜æ¦‚å¿µ ã€€åœ°ç†æµ‹ç»˜è¾ƒä¸ºå®¹æ˜“ç†è§£ï¼šåœ¨(x,y)å¤„ï¼Œæœ‰ä¸€ä¸ªæ¹–æ³Šï¼Œé¢ç§¯å¤šå¤§ï¼Œæœ‰ä»€ä¹ˆæ°´äº§å“ï¼Œå‘¨å›´äººå¦‚ä½•å¦‚ä½•ï¼Œä½ç½®å’Œå åœ°é¢ç§¯è®°å½•åœ¨åœ°å›¾ä¸Šï¼Œå…¶ä½™ç›¸å…³ä¿¡æ¯è®°å½•åœ¨ä¿¡æ¯åº“é‡Œã€‚\nã€€ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜å°±æ˜¯è®°å½•ç½‘ç»œç©ºé—´ä¸­å„ä¸ªå…ƒç´ çš„ä½ç½®ã€å±æ€§ï¼Œå°†æ•´ä¸ªç©ºé—´ç»˜åˆ¶å‡ºæ¥ã€‚\nã€€â€œæœ€åˆçš„ç½‘ç»œç©ºé—´æµ‹ç»˜çš„æ¦‚å¿µä¸»è¦æ˜¯é‡‡ç”¨ä¸€äº›æŠ€æœ¯æ–¹æ³•ï¼Œæ¥æ¢æµ‹å…¨çƒäº’è”ç½‘ç©ºé—´ä¸Šçš„èŠ‚ç‚¹åˆ†å¸ƒæƒ…å†µå’Œç½‘ç»œå…³ç³»ç´¢å¼•ï¼Œæ„å»ºå…¨çƒäº’è”ç½‘å›¾è°±çš„ä¸€ç§æ–¹æ³•ã€‚â€\nã€€è€Œç°åœ¨ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜æ˜¯å…¨é¢æŒæ¡ç½‘ç»œç©ºé—´èµ„æºçš„å±æ€§å’ŒçŠ¶æ€ï¼Œç»˜åˆ¶ç½‘ç»œç©ºé—´èµ„æºå…¨æ¯åœ°å›¾ï¼Œå³ï¼š\nã€€â€œå¯¹ç½‘ç»œç©ºé—´ä¸­çš„å„ç±»è™šå®èµ„æºåŠå…¶å±æ€§è¿›è¡Œæ¢æµ‹ã€åˆ†æå’Œç»˜åˆ¶çš„å…¨è¿‡ç¨‹ã€‚â€\n3.2 ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜æ–¹æ³• ã€€ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜ä½“ç³»æ˜¯ä¸€ä¸ªâ€œ æ¢æµ‹(Detecting)ã€åˆ†æ(Analyzing)ã€ç»˜åˆ¶(Visualizing)ã€åº”ç”¨(Applying)â€çš„å¾ªç¯è¿‡ç¨‹(DAVA Loop)ï¼›\n  å¯¹å„ç§ç½‘ç»œç©ºé—´èµ„æºè¿›è¡ŒååŒæ¢æµ‹, è·å–æ¢æµ‹æ•°æ®, å¯¹è¿™äº›æ•°æ®è¿›è¡Œèåˆåˆ†æå’Œå¤šåŸŸæ˜ å°„, å½¢æˆç½‘ç»œç©ºé—´èµ„æºçŸ¥è¯†åº“;\n  åœ¨æ­¤åŸºç¡€ä¸Š, é€šè¿‡å¤šåŸŸå åŠ å’Œç»¼åˆç»˜åˆ¶æ¥æ„å»ºç½‘ç»œç©ºé—´èµ„æºå…¨æ¯åœ°å›¾;\n  æœ€å, æ ¹æ®ä¸åŒçš„åœºæ™¯ç›®æ ‡æŒ‰éœ€åº”ç”¨è¿™ä¸€å…¨æ¯åœ°å›¾, é€šè¿‡è¿­ä»£æ¼”è¿›ä½¿å¾—æµ‹ç»˜èƒ½åŠ›ä¸æ–­æå‡ã€‚\n\r  å›¾3 ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜æŠ€æœ¯ä½“ç³»å›¾:\r\r ã€€æµ‹ç»˜æŠ€æœ¯ä¸»è¦åˆ†ä¸‰å¤§æ–¹é¢ï¼šååŒæ¢æµ‹ã€èåˆåˆ†æã€å…¨æ¯ç»˜åˆ¶\n3.3 ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜åº”ç”¨ ã€€ä¸€æ˜¯åŒºåŸŸèµ„äº§å‘ç°ã€è¯†åˆ«å’Œé£æ§ï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰ç ”ç©¶å†…å®¹ä¸å…¶ç›¸å…³ï¼›äºŒæ˜¯æœåŠ¡æµ‹ç»˜ï¼ŒæœåŠ¡æµ‹ç»˜åœ¨å¹³æ—¶ç ”ç©¶è¿‡ç¨‹ä¸­æœ‰æ‰€æ¶‰åŠã€‚\n4.æœåŠ¡æµ‹ç»˜ ã€€â€œç½‘ç»œç©ºé—´æœåŠ¡æ˜¯æŒ‡ç½‘ç»œç©ºé—´è½¯ä»¶è®¾æ–½ä¸­çš„å„ç§æ³›åœ¨åº”ç”¨ï¼Œå…¶ä¸­æœ€å…¸å‹çš„ä¸€ç§åº”ç”¨å°±æ˜¯ç½‘ç«™ã€‚â€\nã€€ç½‘ç»œç©ºé—´æœåŠ¡åŒ…æ‹¬å±æ€§(å†…åœ¨)ï¼Œå¤–å»¶çš„å…³ç³»ã€‚\nå›¾4 ç½‘ç»œç©ºé—´æœåŠ¡ç»“æ„å›¾:\r\r ã€€ç½‘ç»œç©ºé—´æœåŠ¡æµ‹ç»˜çš„ç›®æ ‡ï¼š\nã€€å°±æ˜¯åˆ©ç”¨ä¸»è¢«åŠ¨ååŒæ¢æµ‹å’Œæ™ºèƒ½åˆ†ææ‰‹æ®µ, å‘ç°åŠ¨æ€ã€æ—¶å˜ã€éšåŒ¿çš„æœåŠ¡å±æ€§å’Œå…³ç³», é€šè¿‡â€œåœ°å›¾â€çš„æ–¹å¼è¿›è¡Œå¯è§†åŒ–å±•ç¤º,ä»¥æ”¯æ’‘ç½‘ç»œç©ºé—´å®‰å…¨çš„å„ç§åº”ç”¨ã€‚\nã€€æœåŠ¡ç”»åƒï¼šåŒ…æ‹¬åŸºç¡€å±æ€§ã€ç½‘ç»œå±æ€§ã€ä½ç½®å±æ€§ã€é€šè”å±æ€§ç­‰ã€‚ä¾‹å¦‚ï¼š\n  åŸºç¡€å±æ€§åŒ…æ‹¬ä¼ä¸šæ³•äººã€ä¸»åŠå•ä½åç§°ã€ç½‘ç«™å¤‡æ¡ˆ/è®¸å¯è¯å·ã€ç½‘ç«™åç§°ã€ç½‘ç«™é¦–é¡µç½‘å€ç­‰;\n  ç½‘ç»œå±æ€§åŒ…æ‹¬ç½‘ç«™IPã€ç½‘ç«™åŸŸåã€AS å·ç ç­‰; ä½ç½®å±æ€§åŒ…æ‹¬å›½å®¶ã€åŒºåŸŸä»£ç ã€æ‰€åœ¨åœ°ã€ç»çº¬åº¦ã€åœ°å€ç­‰;\n  é€šè”å±æ€§åŒ…æ‹¬å¤–é“¾ç½‘å€, æœåŠ¡ä½¿ç”¨è€…IP ç­‰ã€‚\n  ã€€æœåŠ¡ä¿¡æ¯åœ¨æ—¶ç©ºèŒƒå›´å†…å¯ä¸å…¶ä»–èµ„æºä¿¡æ¯ç­‰å åŠ ,æŒ‰éœ€å±•ç¤ºå…³æ³¨ç‚¹ã€‚\n\rå›¾5 åŸºäºDAVA Loopå¾ªç¯çš„æœåŠ¡æµ‹ç»˜ä½“ç³»ç»“æ„å›¾:\r\r ã€€æœåŠ¡æµ‹ç»˜åº”ç”¨åœºæ™¯ï¼š\nã€€(1) ç‰¹å®šæœåŠ¡å‘ç°å’Œè¯†åˆ«åœºæ™¯: é€šè¿‡ä¸»åŠ¨æ‰«æã€æµé‡ç›‘æ§ç­‰å¤šç§æ¢æµ‹æ–¹å¼, è·å–ç‰¹å®šæœåŠ¡çš„ä¿¡æ¯ã€‚å¯¹å…³æ³¨åŒºåŸŸå†…çš„ç‰¹å®šæœåŠ¡è¿›è¡Œåˆ†æä¸ç»Ÿè®¡, ä¾¿äºå®‰å…¨ç›‘ç®¡éƒ¨é—¨ã€‚\nã€€(2) åŒºåŸŸæœåŠ¡çŠ¶æ€è¯„ä¼°åœºæ™¯: ç»˜åˆ¶ç½‘ç»œç©ºé—´ä¸ŠæœåŠ¡å½±å“èŒƒå›´çŠ¶æ€å›¾, åœ¨ç½‘ç»œæ”»é˜²çš„å®è·µä¸­, ä¸ºç½‘ç»œé¶åœºç­‰åº”ç”¨æä¾›ç²¾å‡†çš„æ”»å‡»æ•ˆæœè¯„ä¼°ã€‚\nã€€(3) ç‰¹å®šæœåŠ¡çš„ç”¨æˆ·åˆ†æåœºæ™¯: ç»˜åˆ¶ç½‘ç»œç©ºé—´ä¸ŠæœåŠ¡å’Œç”¨æˆ·çš„è¿æ¥å…³ç³»å›¾, å¯¹ç‰¹å®šæœåŠ¡çš„ç”¨æˆ·ä»¥åŠæ½œåœ¨ç”¨æˆ·è¿›è¡Œç¾¤ä½“åˆ†æã€‚\nã€€(4) ç‰¹å®šç”¨æˆ·çš„æœåŠ¡æ¨èåœºæ™¯: ç»˜åˆ¶ç½‘ç»œç©ºé—´ä¸ŠæœåŠ¡å’ŒæœåŠ¡çš„è¿æ¥å…³ç³»å›¾, å¯¹ç‰¹å®šç”¨æˆ·è¿›è¡ŒæœåŠ¡æ¨èã€‚\nå‚è€ƒèµ„æ–™ ã€€[1]éƒ­è‰, æ›¹äºšç”·, è‹é©¬å©§, et al. ç½‘ç»œç©ºé—´èµ„æºæµ‹ç»˜:æ¦‚å¿µä¸æŠ€æœ¯[J]. ä¿¡æ¯å®‰å…¨å­¦æŠ¥, 2018, 3(4).\n","description":"ç®€å•äº†è§£ä¸€ä¸‹æµ‹ç»˜æ–¹å‘ï¼Œå¯¹ç½‘ç»œç©ºé—´æœ‰ä¸ªæ•´ä½“æ¨¡ç³Šçš„è®¤è¯†","id":22,"section":"posts","tags":["ç½‘ç»œæµ‹ç»˜"],"title":"ç½‘ç»œç©ºé—´æµ‹ç»˜æ¦‚è¿°","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E6%B5%8B%E7%BB%98/"},{"content":"\r Pythonæ–‡æ¡£ï¼šhttps://realpython.com/async-io-python/ å¯ä»¥å…ˆå‚çœ‹ä»–äººåšå®¢ï¼Œå¤§æ¦‚äº†è§£ä»¥åçœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œä½¿ç”¨ï¼Œä¸å»ºè®®ç›´æ¥çœ‹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚  \r \r1 yield ã€€yieldåœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ï¼šhttps://docs.python.org/zh-cn/3/reference/expressions.html#yield-expressions\n åœ¨ä¸€ä¸ªå‡½æ•°ä½“å†…ä½¿ç”¨ yield è¡¨è¾¾å¼ä¼šä½¿è¿™ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ª async def å®šä¹‰çš„å‡½æ•°ä½“å†…ä½¿ç”¨ yield è¡¨è¾¾å¼ä¼šè®©åç¨‹å‡½æ•°å˜æˆå¼‚æ­¥ç”Ÿæˆå™¨ã€‚\n ã€€å³yieldåªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”ä¼šä½¿è¯¥å‡½æ•°å˜æˆç”Ÿæˆå™¨å‡½æ•°ã€‚å¦‚ä¸‹é¢ç¤ºä¾‹ï¼Œå«æœ‰yieldè¯­å¥çš„å‡½æ•°è¿”å›å€¼æ˜¯generatorç±»å‹ï¼Œä¸åŒ…å«yieldè¯­å¥çš„å‡½æ•°å…¶ç±»å‹æ˜¯returnå€¼çš„ç±»å‹ï¼Œå¦‚æ— è¿”å›å€¼åˆ™ä¸ºNoneTypeã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  \u0026gt;\u0026gt;\u0026gt; def foo(): ... for i in range(10): ... yield i ... \u0026gt;\u0026gt;\u0026gt; type(foo()) \u0026lt;class \u0026#39;generator\u0026#39;\u0026gt; \u0026gt;\u0026gt;\u0026gt; def boo(): ... for i in range(10): ... pass ... return i ... \u0026gt;\u0026gt;\u0026gt; type(boo()) \u0026lt;class \u0026#39;int\u0026#39;\u0026gt;   \rç®€å•ç¤ºä¾‹  å½“ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç§°ä¸ºç”Ÿæˆå™¨ã€‚ç„¶åè¿™ä¸ªç”Ÿæˆå™¨æ¥æ§åˆ¶ç”Ÿæˆå™¨å‡½æ•°çš„æ‰§è¡Œã€‚\nå½“è¿™ä¸ªç”Ÿæˆå™¨çš„æŸä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç”Ÿæˆå™¨å‡½æ•°å¼€å§‹æ‰§è¡Œã€‚è¿™æ—¶ä¼šä¸€ç›´æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª yield è¡¨è¾¾å¼ï¼Œåœ¨æ­¤æ‰§è¡Œå†æ¬¡è¢«æŒ‚èµ·ï¼Œç»™ç”Ÿæˆå™¨çš„è°ƒç”¨è€…è¿”å› expression_list çš„å€¼ã€‚\næŒ‚èµ·åï¼Œæˆ‘ä»¬è¯´æ‰€æœ‰å±€éƒ¨çŠ¶æ€éƒ½è¢«ä¿ç•™ä¸‹æ¥ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡çš„å½“å‰ç»‘å®šï¼ŒæŒ‡ä»¤æŒ‡é’ˆï¼Œå†…éƒ¨æ±‚å€¼æ ˆå’Œä»»ä½•å¼‚å¸¸å¤„ç†çš„çŠ¶æ€ã€‚\né€šè¿‡è°ƒç”¨ç”Ÿæˆå™¨çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œç”Ÿæˆå™¨å‡½æ•°ç»§ç»­æ‰§è¡Œã€‚\næ­¤æ—¶å‡½æ•°çš„è¿è¡Œå°±å’Œ yield è¡¨è¾¾å¼åªæ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°è°ƒç”¨çš„æƒ…å†µå®Œå…¨ä¸€è‡´ã€‚æ¢å¤å yield è¡¨è¾¾å¼çš„å€¼å–å†³äºè°ƒç”¨çš„å“ªä¸ªæ–¹æ³•æ¥æ¢å¤æ‰§è¡Œã€‚\nå¦‚æœç”¨çš„æ˜¯ __next__() (é€šå¸¸é€šè¿‡è¯­è¨€å†…ç½®çš„ for æˆ–æ˜¯ next() æ¥è°ƒç”¨) é‚£ä¹ˆç»“æœå°±æ˜¯ None. å¦åˆ™ï¼Œå¦‚æœç”¨ send(), é‚£ä¹ˆç»“æœå°±æ˜¯ä¼ é€’ç»™sendæ–¹æ³•çš„å€¼ã€‚\n ã€€å½“ç”Ÿæˆå™¨å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡â€”â€”ç”Ÿæˆå™¨ã€‚ç”Ÿæˆå™¨æ§åˆ¶ç”Ÿæˆå™¨å‡½æ•°çš„æ‰§è¡Œã€‚å³ç”Ÿæˆå™¨æ˜¯ç”Ÿæˆå™¨å‡½æ•°çš„è¿”å›å€¼ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªä¾‹å­è¯´æ˜yieldå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè§£é‡Šä¸€ä¸‹Pythonæ–‡æ¡£çš„å†…å®¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  #!/usr/bin python3 #yieldtest.py def foo(): for i in range(2,6): r = (yield i) print(f\u0026#34;i: {i}, r: {r}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: generator_foo = foo() print(next(generator_foo)) print(next(generator_foo)) print(generator_foo.send(66)) print(generator_foo.send(88)) print(next(generator_foo))   ã€€ç¤ºä¾‹é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°foo()ï¼ˆå› ä¸ºå®ƒåŒ…å«yieldè¯­å¥ï¼‰ï¼Œè¯¥å‡½æ•°å†…éƒ¨æœ‰ä¸€ä¸ªforå¾ªç¯ï¼Œiçš„å–å€¼ä¸º2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œç”¨yieldè¿”å›æ¯ä¸ªiçš„å–å€¼ï¼Œå¹¶è¾“å‡ºiå’Œrçš„å–å€¼ï¼Œæ¥è§‚å¯Ÿç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€‚\nã€€ï¼ˆ1ï¼‰åœ¨__main__ä¸­ï¼Œå…ˆå®šä¹‰äº†ä¸€ä¸ªç”Ÿæˆå™¨å˜é‡ï¼Œè·å–foo()å‡½æ•°è¿”å›çš„ç”Ÿæˆå™¨ï¼Œç„¶åç”¨next(\u0026lt;generator\u0026gt;)å¯åŠ¨ç”Ÿæˆå™¨ï¼Œæ§åˆ¶foo()å‡½æ•°çš„æ‰§è¡Œã€‚ç¬¬ä¸€æ­¥next(generator_foo)ï¼Œå¼€å§‹è¿è¡Œfoo()ï¼Œæ­¤æ—¶i=2ï¼Œç¨‹åºè¿è¡Œåˆ°yield iï¼Œä»foo()ä¸­è·³å‡ºï¼Œä¿å­˜foo()çš„è¿è¡Œè¿›åº¦ï¼Œè¿”å›2åˆ°__main__ä¸­ï¼Œè¾“å‡ºnext(generator_foo)çš„å€¼ï¼Œå³yield içš„iå€¼ï¼Œå½“å‰iä¸º2ï¼Œè¿™å¥ä¼šåœ¨å±å¹•ä¸Šè¾“å‡º2ã€‚\nã€€å¦‚æœæ­¤å¤„è¦ç”¨.send()æ–¹æ³•å¯åŠ¨ç”Ÿæˆå™¨ï¼Œåˆ™send()ä¸­å‚æ•°å¿…é¡»ä¸ºNoneã€‚\n1  print(generator_foo.send(None))   ã€€ï¼ˆ2ï¼‰è¿è¡Œç¬¬äºŒå¥next(generator_foo)ï¼Œæ¢å¤foo()çš„è¿è¡Œè¿›åº¦ï¼Œä»ä¸Šæ¬¡åœæ­¢å¤„ç»§ç»­è¿è¡Œï¼Œå³r=(yield i)å¤„ï¼Œä¸Šæ¬¡è¿è¡Œåˆ°yield iï¼Œè¿™æ¬¡è¦å¯¹rè¿›è¡Œèµ‹å€¼ã€‚rçš„å€¼ä¸è°ƒç”¨foo()çš„æ–¹å¼æœ‰å…³ï¼Œå¦‚æœæ˜¯ç”¨next(\u0026lt;generator\u0026gt;)ï¼Œåˆ™rçš„å€¼ä¸ºNoneï¼Œå¦‚æœæ˜¯ç”¨\u0026lt;generator\u0026gt;.send(xxx)ï¼Œåˆ™rçš„å€¼æ˜¯xxxã€‚æ­¤å¤„ç”¨next(\u0026lt;generator\u0026gt;)è°ƒç”¨foo()ï¼Œæ‰€ä»¥rçš„å€¼ä¸ºNoneã€‚æ‰€ä»¥è¾“å‡ºi: 2, r: Noneã€‚ä¹‹åforå¾ªç¯ç»§ç»­ï¼Œi=3ï¼Œç¨‹åºå†æ¬¡è¿è¡Œåˆ°yieldè¯­å¥ï¼Œæµç¨‹ä¸ï¼ˆ1ï¼‰ç›¸åŒï¼Œè¿™ä¸€å¥åœ¨å±å¹•ä¸Šè¾“å‡º3ã€‚\nã€€ï¼ˆ3ï¼‰è¿è¡Œåˆ°ç¬¬ä¸‰å¥generator_foo.send(66))ï¼Œæ¢å¤foo()çš„è¿è¡Œè¿›åº¦ï¼Œä»ä¸Šæ¬¡åœæ­¢å¤„ç»§ç»­è¿è¡Œï¼Œè¿™æ¬¡ä¸ï¼ˆ2ï¼‰ä¸­ä¸åŒï¼Œè¿™æ¬¡æ˜¯ç”¨.send(66)è°ƒç”¨foo()ï¼Œæ‰€ä»¥rçš„å€¼ä¸º66ã€‚åœ¨å±å¹•è¾“å‡ºi: 3, r: 66ã€‚ä¹‹åforå¾ªç¯ç»§ç»­ï¼Œi=4ï¼Œç¨‹åºå†æ¬¡è¿è¡Œåˆ°yieldè¯­å¥ï¼Œæµç¨‹ä¸ï¼ˆ1ï¼‰ç›¸åŒï¼Œè¿™ä¸€å¥åœ¨å±å¹•ä¸Šè¾“å‡º4ã€‚\nã€€ï¼ˆ4ï¼‰è¿è¡Œåˆ°ç¬¬å››å¥generator_foo.send(88)ï¼Œå’Œï¼ˆ3ï¼‰æµç¨‹ç›¸åŒï¼Œrçš„å€¼ä¸º88ï¼Œåœ¨å±å¹•ä¸Šè¾“å‡ºi: 4, r: 88ï¼Œç„¶åç»§ç»­ï¼Œæ­¤æ—¶i=5ï¼Œå†æ¬¡è¿è¡Œåˆ°yield iè¯­å¥ï¼Œè·³å‡ºfoo()ï¼Œè¿”å›åˆ°__main__ï¼Œè¾“å‡º5ã€‚\nã€€ï¼ˆ5ï¼‰è¿è¡Œåˆ°ç¬¬äº”å¥next(generator_foo)ï¼Œé€šè¿‡nextè°ƒç”¨foo()ï¼Œrå€¼ä¸ºNoneï¼Œæ‰€ä»¥è¾“å‡ºi: 5, r: Noneï¼Œæ­¤æ—¶ç”Ÿæˆå™¨æ²¡æœ‰ä¸‹ä¸€ä¸ªå€¼ï¼Œå¼•å‘StopIterationå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸è¡¨ç¤ºè¯¥è¿­ä»£å™¨ä¸èƒ½äº§ç”Ÿä¸‹ä¸€é¡¹ã€‚\nã€€æ‰€ä»¥ä¸Šé¢ä¾‹å­çš„è¾“å‡ºä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13  $ python3.7 yieldtest.py 2 i: 2, r: None 3 i: 3, r: 66 4 i: 4, r: 88 5 i: 5, r: None Traceback (most recent call last): File \u0026#34;yieldtest.py\u0026#34;, line 15, in \u0026lt;module\u0026gt; print(next(generator_foo)) StopIteration   æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ generator.\u0026lt;method()\u0026gt;ï¼š\n generator.__next__() generator.send(value) generator.throw(type[, value[, traceback]])ï¼šåœ¨ç”Ÿæˆå™¨æš‚åœçš„ä½ç½®å¼•å‘ type ç±»å‹çš„å¼‚å¸¸ï¼Œå¹¶è¿”å›è¯¥ç”Ÿæˆå™¨å‡½æ•°æ‰€äº§ç”Ÿçš„ä¸‹ä¸€ä¸ªå€¼ï¼ˆvalueå’Œtracebackæ˜¯å¯é€‰å‚æ•°ï¼Œé€šå¸¸å°±è¿™ä¹ˆå†™ï¼‰ã€‚ generator.close()ï¼šåœ¨ç”Ÿæˆå™¨å‡½æ•°æš‚åœçš„ä½ç½®å¼•å‘GeneratorExitã€‚å¦‚æœç”Ÿæˆå™¨ä¸äº§ç”Ÿå€¼ï¼Œåˆ™æ­£å¸¸é€€å‡ºï¼Œäº§ç”Ÿå€¼å¼•å‘ RuntimeErrorã€‚  å…·ä½“è¯´æ˜å¯ä»¥æŸ¥é˜…æ–‡æ¡£6.2.9.1ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  \u0026gt;\u0026gt;\u0026gt; def echo(value=None): ... print(\u0026#34;Execution starts when \u0026#39;next()\u0026#39; is called for the first time.\u0026#34;) ... try: ... while True: ... try: ... value = (yield value) ... except Exception as e: ... value = e ... finally: ... print(\u0026#34;Don\u0026#39;t forget to clean up when \u0026#39;close()\u0026#39; is called.\u0026#34;) ... \u0026gt;\u0026gt;\u0026gt; generator = echo(1) \u0026gt;\u0026gt;\u0026gt; print(next(generator)) Execution starts when \u0026#39;next()\u0026#39; is called for the first time. 1 \u0026gt;\u0026gt;\u0026gt; print(next(generator)) None \u0026gt;\u0026gt;\u0026gt; print(generator.send(2)) 2 \u0026gt;\u0026gt;\u0026gt; generator.throw(TypeError, \u0026#34;spam\u0026#34;) TypeError(\u0026#39;spam\u0026#39;,) \u0026gt;\u0026gt;\u0026gt; generator.close() Don\u0026#39;t forget to clean up when \u0026#39;close()\u0026#39; is called.   2 yield from ã€€å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/whatsnew/3.3.html#pep-380\nã€€PEP380æ·»åŠ äº†yield fromè¡¨è¾¾å¼ï¼Œå…è®¸ç”Ÿæˆå™¨æŠŠå®ƒçš„éƒ¨åˆ†æ“ä½œå§”æ‰˜ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨ã€‚è¿™è®©ä¸€éƒ¨åˆ†åŒ…å«yieldçš„ä»£ç åˆ†è§£å‡ºæ¥å¹¶æ”¾å…¥å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ã€‚æ­¤å¤–ï¼Œå­ç”Ÿæˆå™¨å¯ä»¥æœ‰è¿”å›å€¼ï¼Œå‘å‡ºå§”æ‰˜çš„ç”Ÿæˆå™¨å¯ä»¥è·å–è¯¥å€¼ã€‚\nã€€è™½ç„¶ä¸»è¦ç”¨äºå§”æ‰˜ç»™ä¸€ä¸ªå­ç”Ÿæˆå™¨ï¼Œyield fromè¡¨è¾¾å¼å®é™…ä¸Šä¹Ÿå…è®¸å§”æ‰˜ç»™ä»»æ„çš„å­è¿­ä»£å™¨ã€‚\nã€€å¯¹äºç®€å•çš„è¿­ä»£å™¨ï¼Œyield from iterableåŸºæœ¬ä¸Šä»…ä»…æ˜¯for item in iterable:yield itemçš„ç¼©å†™ï¼š\n1 2 3 4 5 6  \u0026gt;\u0026gt;\u0026gt; def g(x): ... yield from range(x, 0, -1) ... yield from range(x) ... \u0026gt;\u0026gt;\u0026gt; list(g(5)) [5, 4, 3, 2, 1, 0, 1, 2, 3, 4]   ã€€ç„¶è€Œï¼Œä¸æ™®é€šå¾ªç¯ä¸åŒï¼Œyield fromå…è®¸å­ç”Ÿæˆå™¨ç›´æ¥ä»è°ƒç”¨ä¸­æ¥æ”¶å‘é€çš„å’ŒæŠ›å‡ºçš„å€¼ï¼Œç„¶åè¿”å›ä¸€ä¸ªæœ€ç»ˆçš„å€¼ç»™å¤–éƒ¨çš„ç”Ÿæˆå™¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  \u0026gt;\u0026gt;\u0026gt; def accumulate(): ... tally = 0 ... while 1: ... next = yield ... if next is None: ... return tally ... tally += next ... \u0026gt;\u0026gt;\u0026gt; def gather_tallies(tallies): ... while 1: ... tally = yield from accumulate() ... tallies.append(tally) ... \u0026gt;\u0026gt;\u0026gt; tallies = [] \u0026gt;\u0026gt;\u0026gt; acc = gather_tallies(tallies) \u0026gt;\u0026gt;\u0026gt; next(acc) # Ensure the accumulator is ready to accept values \u0026gt;\u0026gt;\u0026gt; for i in range(4): ... acc.send(i) ... \u0026gt;\u0026gt;\u0026gt; acc.send(None) # Finish the first tally \u0026gt;\u0026gt;\u0026gt; for i in range(5): ... acc.send(i) ... \u0026gt;\u0026gt;\u0026gt; acc.send(None) # Finish the second tally \u0026gt;\u0026gt;\u0026gt; tallies [6, 10]   ã€€accumulate()æ˜¯å­ç”Ÿæˆå™¨å‡½æ•°ï¼Œgather_tallies()æ˜¯å¤–éƒ¨ç”Ÿæˆå™¨å‡½æ•°ã€‚accæ˜¯gather_tallies()è¿”å›çš„ç”Ÿæˆå™¨ã€‚é€šè¿‡next(acc)å¯åŠ¨accã€‚æ‰§è¡Œåˆ°yield from accumulate()ï¼Œæ‰§è¡Œåˆ°accumulate()ä¸­çš„yieldè¿”å›ï¼›ç„¶åé€šè¿‡acc.send(i)æ§åˆ¶å‡½æ•°æ‰§è¡Œï¼Œå‘é€0ç»™gather_tallies()ï¼Œä½†å‡½æ•°æ‰§è¡Œåˆ°accumulate()çš„next = yieldï¼Œæ‰€ä»¥å‘é€çš„å€¼ç”±nextå˜é‡æ¥æ”¶ï¼Œå› ä¸ºå­ç”Ÿæˆå™¨å¯ä»¥ç›´æ¥æ¥æ”¶å‘é€çš„å€¼ã€‚\nã€€å‘é€åˆ°3ä»¥åï¼Œå‘é€Noneï¼Œaccumulate()ä¸­çš„nextå˜é‡æ”¶åˆ°Noneï¼Œæ‰§è¡Œåˆ°return tallyï¼Œtallyçš„å€¼ä¸º1+2+3=6ï¼Œè¿”å›åˆ°gather_tallies()ï¼Œtallyçš„å€¼ä¸º6ï¼Œç„¶åtallies.append(tally)å°†6åŠ å…¥åˆ°talliesåˆ—è¡¨ä¸­ï¼Œæ­¤æ—¶tallies=[6,]ã€‚\nã€€ç„¶åå†è°ƒç”¨acc.send()ï¼Œä»ç”±accumulate()çš„nextå˜é‡æ¥æ”¶ï¼Œå‘é€åˆ°4ä»¥åï¼Œå‘é€Noneï¼Œaccumulate()ä¸­çš„nextå˜é‡æ”¶åˆ°Noneï¼Œæ‰§è¡Œåˆ°return tallyï¼Œtallyçš„å€¼ä¸º1+2+3+4=10ï¼Œè¿”å›åˆ°gather_tallies()ï¼Œtallyçš„å€¼ä¸º10ï¼Œç„¶åtallies.append(tally)å°†10åŠ å…¥åˆ°talliesåˆ—è¡¨ä¸­ï¼Œæ­¤æ—¶tallies=[6, 10]ã€‚\n\ryield fromè¯­å¥å…¶å®å°±æ˜¯è¡¨æ˜åé¢æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä½¿ä»£ç çœ‹èµ·æ¥æ›´æ•´æ´ã€‚\n\r \rã€€åšå‡ºè¿™ç§æ”¹å˜çš„ä¸»è¦åŸç†æ˜¯å…è®¸ç”Ÿæˆå™¨åˆ†å‰²æˆå¤šä¸ªå­ç”Ÿæˆå™¨å’ŒæŠŠå¤§çš„å‡½æ•°åˆ†è§£æˆå¤šä¸ªå­å‡½æ•°ä¸€æ ·ç®€å•ï¼Œé€šè¿‡sendå’Œthrowæ¥å®ç°åˆ†å‰²ã€‚\n","description":"å¯¹Python yieldçš„ç†è§£å’Œåº”ç”¨","id":23,"section":"posts","tags":["python"],"title":"Pythonï¼šyield ç”¨æ³•å’Œç†è§£","uri":"https://yyyIce.github.io/zh/posts/pythonyield%E7%94%A8%E6%B3%95%E5%92%8C%E7%90%86%E8%A7%A3/"},{"content":"\r Pythonæ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/library/threading.html å¯ä»¥å…ˆå‚çœ‹ä»–äººåšå®¢ï¼Œå¤§æ¦‚äº†è§£ä»¥åçœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œä½¿ç”¨ï¼Œä¸å»ºè®®ç›´æ¥çœ‹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚  \r \r1 threading  çº¿ç¨‹ç±»è¡¨ç¤ºåœ¨å•ç‹¬çš„æ§åˆ¶çº¿ç¨‹ä¸­è¿è¡Œçš„æ´»åŠ¨ã€‚æœ‰ä¸¤ç§æŒ‡å®šæ´»åŠ¨çš„æ–¹æ³•ï¼š\n ä¼ é€’ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ç»™æ„é€ å™¨ï¼› åœ¨å­ç±»ä¸­é‡å†™run()æ–¹æ³•ã€‚  å­ç±»ä¸­ä¸åº”è¯¥è¦†ç›–å…¶ä»–æ–¹æ³•ï¼ˆæ„é€ å‡½æ•°é™¤å¤–ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œåªå…è®¸é‡å†™è¿™ä¸ªç±»çš„__init__()å’Œrun()\n ã€€å¯è°ƒç”¨å¯¹è±¡ï¼šå¯ä»¥è¢«è°ƒç”¨æ‰§è¡Œçš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥ä¼ å…¥å‚æ•°ï¼Œå¦‚å‡½æ•°ã€ç±»ã€ç±»ä¸­çš„å‡½æ•°ã€å®ç°äº†__call__æ–¹æ³•çš„å®ä¾‹å¯¹è±¡ã€‚\nçº¿ç¨‹å¯¹è±¡Thread  class threading.Thread(group=None, target=None, name=None, args=(), kwargs={}, ***, daemon=None)\n  groupï¼šä¸å¿…ç®¡ï¼Œä¸ºäº†æ‰©å±•ThreadGroupç±»å®ç°è€Œä¿ç•™ targetï¼šrun()æ–¹æ³•è°ƒç”¨çš„å¯è°ƒç”¨å¯¹è±¡ nameï¼šçº¿ç¨‹åç§°ï¼Œé»˜è®¤æ ¼å¼ä¸ºThread-N argsï¼šè°ƒç”¨ç›®æ ‡å‡½æ•°çš„å‚æ•°å…ƒç»„ kwargsï¼šç”¨äºè°ƒç”¨ç›®æ ‡å‡½æ•°çš„å…³é”®å­—å‚æ•°å­—å…¸ daemonï¼šè®¾ç½®çº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤æ¨¡å¼ï¼Œä¸å»ºè®®ä½¿ç”¨setDaemon()  åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼š\n1 2  from threading import Thread t = Thread(target=\u0026lt;å¯è°ƒç”¨å¯¹è±¡\u0026gt;,args=(\u0026lt;å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°\u0026gt;),...)   å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼š\u0026lt;thread_instance\u0026gt;.start()\nt.start()\rå¼€å§‹çº¿ç¨‹æ´»åŠ¨ï¼š\u0026lt;thread_instance\u0026gt;.run()\nã€€åœ¨ä¸é‡å†™çº¿ç¨‹run()æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå°±æ˜¯æ™®é€šåœ°è¿è¡Œä¸€ä¸‹targetï¼ˆå¯è°ƒç”¨å¯¹è±¡ï¼‰ï¼Œä¸€èˆ¬æŒ‡å®štargetå°±è¡Œï¼Œéœ€è¦äººä¸ºæ§åˆ¶æš‚åœã€æ¢å¤å’Œé€€å‡ºçš„éœ€è¦è‡ªå®šä¹‰çº¿ç¨‹ç±»ã€‚\nã€€__init__()å’Œ.run()æ–¹æ³•çš„æºä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55  #Lib/threading.py def __init__(self, group=None, target=None, name=None, args=(), kwargs=None, *, daemon=None): \u0026#34;\u0026#34;\u0026#34;This constructor should always be called with keyword arguments. Arguments are: *group* should be None; reserved for future extension when a ThreadGroup class is implemented. *target* is the callable object to be invoked by the run() method. Defaults to None, meaning nothing is called. *name* is the thread name. By default, a unique name is constructed of the form \u0026#34;Thread-N\u0026#34; where N is a small decimal number. *args* is the argument tuple for the target invocation. Defaults to (). *kwargs* is a dictionary of keyword arguments for the target invocation. Defaults to {}. If a subclass overrides the constructor, it must make sure to invoke the base class constructor (Thread.__init__()) before doing anything else to the thread. \u0026#34;\u0026#34;\u0026#34; assert group is None, \u0026#34;group argument must be None for now\u0026#34; if kwargs is None: kwargs = {} self._target = target self._name = str(name or _newname()) self._args = args self._kwargs = kwargs if daemon is not None: self._daemonic = daemon else: self._daemonic = current_thread().daemon self._ident = None if _HAVE_THREAD_NATIVE_ID: self._native_id = None self._tstate_lock = None self._started = Event() self._is_stopped = False self._initialized = True # Copy of sys.stderr used by self._invoke_excepthook() self._stderr = _sys.stderr self._invoke_excepthook = _make_invoke_excepthook() # For debugging and _after_fork() _dangling.add(self) def run(self): \u0026#34;\u0026#34;\u0026#34;Method representing the thread\u0026#39;s activity. You may override this method in a subclass. The standard run() method invokes the callable object passed to the object\u0026#39;s constructor as the target argument, if any, with sequential and keyword arguments taken from the args and kwargs arguments, respectively. \u0026#34;\u0026#34;\u0026#34; try: if self._target: self._target(*self._args, **self._kwargs) finally: # Avoid a refcycle if the thread is running a function with # an argument that has a member that points to the thread. del self._target, self._args, self._kwargs   çº¿ç¨‹ä½¿ç”¨ç¤ºä¾‹ï¼š\n ç¨‹åºæ¥æºäºhttps://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p01_start_stop_thread.html\n 1 2 3 4 5 6 7 8 9 10 11 12  #simple_thread.py import time from threading import Thread def countdown(n): while n \u0026gt; 0: print(\u0026#39;T-minus\u0026#39;, n) n -= 1 time.sleep(5) #æ³¨æ„args=(10,)çš„é€—å·ä¸èƒ½çœï¼Œä¸ç„¶ä¸æ˜¯tupleæ˜¯int t = Thread(target=countdown, args=(10,)) t.start()   ç­‰å¾…çº¿ç¨‹.join()\nã€€åœ¨Açº¿ç¨‹ä¸­è°ƒç”¨B.join()ï¼Œåˆ™Açº¿ç¨‹åœ¨B.join()ä¹‹åçš„è¯­å¥ç›´åˆ°Bçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  # thread_join.py import time from threading import Thread def countdown(n, id): while n \u0026gt; 0: print(f\u0026#39;T{id}-minus {n}\u0026#39;) n -= 1 time.sleep(5) #æ³¨æ„args=(10,)çš„é€—å·ä¸èƒ½çœï¼Œä¸ç„¶ä¸æ˜¯tupleæ˜¯int t1 = Thread(target=countdown, args=(3,1)) t2 = Thread(target=countdown, args=(3,2)) t1.start() t2.start() t1.join() print(\u0026#34;after join.\u0026#34;) #è¾“å‡º T1-minus 3 T2-minus 3 T1-minus 2 T2-minus 2 T1-minus 1 T2-minus 1 after join.   æ³¨é‡Šæ‰t1.join()åçš„è¾“å‡ºå¦‚ä¸‹ï¼Œä¸»çº¿ç¨‹æ— éœ€ç­‰å¾…çº¿ç¨‹1è¿è¡Œå®Œæ¯•å†å‘åæ‰§è¡Œã€‚\n1 2 3 4 5 6 7  T1-minus 3 T2-minus 3 after join. T1-minus 2 T2-minus 2 T1-minus 1 T2-minus 1   å®ˆæŠ¤æ¨¡å¼daemon\n å‚è€ƒï¼šhttps://blog.csdn.net/dongfuguo/article/details/53899426\n ã€€é»˜è®¤å€¼ä¸ºFalseã€‚\nã€€å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº†å­çº¿ç¨‹ï¼Œå½“ä¸»çº¿ç¨‹ç»“æŸæ—¶æ ¹æ®å­çº¿ç¨‹daemonå±æ€§å€¼çš„ä¸åŒå¯èƒ½ä¼šå‘ç”Ÿä¸‹é¢çš„ä¸¤ç§æƒ…å†µä¹‹ä¸€ï¼š\n å¦‚æœæŸä¸ªå­çº¿ç¨‹çš„daemonå±æ€§ä¸ºFalseï¼Œä¸»çº¿ç¨‹ç»“æŸæ—¶ä¼šæ£€æµ‹è¯¥å­çº¿ç¨‹æ˜¯å¦ç»“æŸï¼Œå¦‚æœè¯¥å­çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œåˆ™ä¸»çº¿ç¨‹ä¼šç­‰å¾…å®ƒå®Œæˆåå†é€€å‡ºï¼› å¦‚æœæŸä¸ªå­çº¿ç¨‹çš„daemonå±æ€§ä¸ºTrueï¼Œä¸»çº¿ç¨‹è¿è¡Œç»“æŸæ—¶ä¸å¯¹è¿™ä¸ªå­çº¿ç¨‹è¿›è¡Œæ£€æŸ¥è€Œç›´æ¥é€€å‡ºï¼ŒåŒæ—¶æ‰€æœ‰daemonå€¼ä¸ºTrueçš„å­çº¿ç¨‹å°†éšä¸»çº¿ç¨‹ä¸€èµ·ç»“æŸï¼Œè€Œä¸è®ºæ˜¯å¦è¿è¡Œå®Œæˆã€‚  ã€€éœ€è¦æ³¨æ„çš„æ˜¯ç°åœ¨å·²ç»ä¸æå€¡ä½¿ç”¨t.setDaemon(True)æ¥è®¾ç½®ï¼Œè€Œæ˜¯ç›´æ¥åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®çº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤æ¨¡å¼ï¼Œè®¾ç½®æ–¹æ³•ï¼š\n1 2 3 4  from threading import Thread t = Thread(target=\u0026lt;å¯è°ƒç”¨å¯¹è±¡\u0026gt;,args=(\u0026lt;å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°\u0026gt;),daemon=True) #æˆ–ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œæ³¨æ„è¦åœ¨start()ä¹‹å‰è®¾ç½® t.daemon=True   ã€€daemonä½¿ç”¨æ•ˆæœç¤ºä¾‹å¦‚ä¸‹ï¼Œt1çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹è¿è¡Œå®Œæ¯•åä¸ç”¨ç†ä¼št1ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  # thread_daemon.py import time from threading import Thread def countdown(n, id): while n \u0026gt; 0: print(f\u0026#39;T{id}-minus {n}\u0026#39;) n -= 1 time.sleep(5) #t1 = Thread(target=countdown, args=(3,1), daemon=False) t1 = Thread(target=countdown, args=(3,1), daemon=True) t1.start() print(\u0026#34;Main Thread End.\u0026#34;) #è¾“å‡º T1-minus 3 Main Thread End.   ã€€å¦‚æœdaemonå€¼ä¸ºFalseï¼Œåˆ™åº”è¯¥è¾“å‡ºä¸‹é¢çš„å†…å®¹ï¼Œç¨‹åºä¼šåœ¨t1çº¿ç¨‹è¿è¡Œå®Œæ¯•å†é€€å‡ºã€‚\n1 2 3 4  T1-minus 3 Main Thread End. T1-minus 2 T1-minus 1   2.è‡ªå®šä¹‰çº¿ç¨‹ç±» ã€€è‡ªå®šä¹‰çš„çº¿ç¨‹å¯ä»¥æ§åˆ¶çº¿ç¨‹çš„æš‚åœã€æ¢å¤ã€é€€å‡ºï¼ŒThread()æ–¹æ³•å®šä¹‰çš„çº¿ç¨‹å¦‚æœæ˜¯while Trueçš„æ¶ˆè´¹è€…å°±æ²¡æ³•ç»“æŸå®ƒäº†ã€‚\nã€€ç¬¬1èŠ‚ä¸­æåˆ°ï¼Œç»§æ‰¿åªå…è®¸ä¿®æ”¹__init__æ–¹æ³•å’Œrun()æ–¹æ³•ï¼Œæ‰€ä»¥è‡ªå®šä¹‰çº¿ç¨‹ç±»ä¸­ä»…éœ€è¦é‡å†™è¿™ä¸¤é¡¹ï¼Œä¸ªäººæ„Ÿè§‰åˆå­¦æƒ…å†µä¸‹é‡å†™çš„ç±»è¿˜ä¸å¦‚åŸç”Ÿçš„ã€‚\nã€€è‡ªå®šä¹‰çº¿ç¨‹ç±»ç¤ºä¾‹ï¼Œå®ç°çš„åŠŸèƒ½å’Œä¸Šé¢çš„åŠŸèƒ½ç›¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  # thread_custom.py import threading import time #ç»§æ‰¿Threadç±»ï¼Œåˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ç±» class mythread(threading.Thread): def __init__(self, num, threadname): #superä¼šå°†åé¢çš„æ–¹æ³•å§”æ‰˜ç»™çˆ¶ç±»ï¼Œç­‰ä»·äºthreading.Thread.__init__(self, name=threadname) super().__init__(self, name=threadname) self.num = num #é‡å†™run()æ–¹æ³• def run(self): while self.num \u0026gt; 0: print(f\u0026#39;{self.name}-minus {self.num}\u0026#39;) self.num -= 1 time.sleep(5) t1 = mythread(3, \u0026#39;t1\u0026#39;) t1.start() #è¾“å‡º t1-minus 3 t1-minus 2 t1-minus 1   è‡ªå®šä¹‰çº¿ç¨‹æ§åˆ¶çº¿ç¨‹æš‚åœã€æ¢å¤ã€é€€å‡º  å‚è€ƒï¼šhttps://www.cnblogs.com/scolia/p/6132950.html\n ã€€åˆ©ç”¨çº¿ç¨‹çš„äº‹ä»¶å¯¹è±¡threading.Eventã€‚\n æ˜¯çº¿ç¨‹é—´é€šä¿¡çš„æœºåˆ¶ï¼šä¸€ä¸ªçº¿ç¨‹å‘å‡ºæ—¶é—´ä¿¡å·ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ä¿¡å·ã€‚ä¸€ä¸ªäº‹ä»¶ï¼ˆEventï¼‰å¯¹è±¡ç®¡ç†ä¸€ä¸ªå†…éƒ¨æ ‡è¯†ã€‚\nset()ï¼šå°†æ­¤äº‹ä»¶çš„å†…éƒ¨æ ‡è¯†ç½®ä¸ºTrueï¼Œæ‰€æœ‰ç­‰å¾…è¿™ä¸ªäº‹ä»¶çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ã€‚\nclear()ï¼šå°†æ­¤äº‹ä»¶çš„å†…éƒ¨æ ‡è¯†ç½®ä¸ºFalseï¼Œä¹‹åè°ƒç”¨wait()çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚\nwait(timeout=None)ï¼šå¦‚æœæ­¤äº‹ä»¶çš„å†…éƒ¨æ ‡è¯†ä¸ºTrueï¼Œç«‹å³è¿”å›ï¼›å¦åˆ™é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æ ‡è¯†ä¸ºTrueã€‚\nis_set()ï¼šå½“ä¸”ä»…å½“å†…éƒ¨æ ‡è¯†ä¸ºTrueæ—¶è¿”å›Trueã€‚\n ã€€çº¿ç¨‹æš‚åœä¸æ¢å¤ï¼šå¯ä»¥å°†äº‹ä»¶ç†è§£ä¸ºä¸€ä¸ªä¿¡å·ï¼Œåœ¨çº¿ç¨‹å†…éƒ¨è®¾ç½®ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨æš‚åœæ—¶è°ƒç”¨clear()ï¼Œè®¾ç½®å†…éƒ¨æ ‡è¯†ä¸ºFalseï¼Œæ¢å¤æ—¶è®¾ç½®å†…éƒ¨æ ‡è¯†ä¸ºTrueã€‚åœ¨run()å‡½æ•°ä¸­è°ƒç”¨wait()è®©äº‹ä»¶çš„é˜»å¡æ•ˆæœç”Ÿæ•ˆã€‚\nã€€çº¿ç¨‹é€€å‡ºï¼šåœ¨çº¿ç¨‹å†…éƒ¨è®¾ç½®å¦ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨run()ä¸­è®¾ç½®while \u0026lt;stop_event\u0026gt;.is_set():å¾ªç¯ï¼Œå°†ç›®æ ‡å‡½æ•°æ”¾åœ¨å¾ªç¯å†…ï¼Œåˆå§‹åŒ–æ—¶å°†è¯¥äº‹ä»¶set()ï¼Œé€€å‡ºæ—¶å°†è¯¥äº‹ä»¶clear()ï¼Œæ­¤æ—¶ç”±äºä¸æ»¡è¶³whileå¾ªç¯æ¡ä»¶ï¼Œrun()å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹ç»“æŸã€‚\nã€€ç¨‹åºç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  # thread_pause.py import threading import time class myThread(threading.Thread): def __init__(self, *args, **kwargs): super().__init__(*args, **kwargs) self.__flag = threading.Event() # ç”¨äºæš‚åœçº¿ç¨‹çš„æ ‡è¯† self.__flag.set() self.__running = threading.Event() # ç”¨äºç»“æŸçº¿ç¨‹çš„æ ‡è¯† self.__running.set() def run(self): while self.__running.isSet(): self.__flag.wait() # å¦‚æœ__flag=Falseåˆ™é˜»å¡ print(time.time()) time.sleep(1) def pause(self): self.__flag.clear() # è®¾ç½®ä¸ºFalse, è®©çº¿ç¨‹é˜»å¡ def resume(self): self.__flag.set() # è®¾ç½®ä¸ºTrue, å”¤é†’çº¿ç¨‹ def stop(self): self.__flag.set() # å¦‚æœçº¿ç¨‹æš‚åœåˆ™å…ˆæ¢å¤ self.__running.clear() # è®¾ç½®ä¸ºFalse a = myThread() a.start() time.sleep(3) a.pause() time.sleep(5) a.resume() time.sleep(3) a.pause() time.sleep(2) a.stop()   ã€€**ä¸ºä»€ä¹ˆé€‰ç”¨è¿™ç§æ–¹æ³•ï¼š**è¿™ç§æ–¹æ³•è™½ç„¶æ¯”è¾ƒæ…¢ä½†æ˜¯æ¯”è¾ƒå®‰å…¨ï¼Œè®©run()æ–¹æ³•çš„è‡ªç„¶æ‰§è¡Œå®Œæ¯•é€€å‡ºï¼Œå¼ºè¡Œæ€æ­»çº¿ç¨‹å¯èƒ½ä¼šé‡åˆ°æ•°æ®ä¸¢å¤±ç­‰ç¦»è°±çš„é”™è¯¯ã€‚\n3.å¤šçº¿ç¨‹ ã€€Pythonä¸­å¤šçº¿ç¨‹ç›´æ¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹å®ä¾‹ç„¶åç”¨.start()æ–¹æ³•å¯åŠ¨å°±è¡Œäº†ã€‚ç”±äºå®é™…åº”ç”¨ä¸­æ²¡ç”¨åˆ°è¿‡è¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥ä»…ä½œç®€å•ä»‹ç»ï¼Œä»¥åæœ‰æ·±åˆ»ç†è§£å†è¡¥å……ã€‚è€Œä¸”ç”±äºPythonæœ‰å…¨å±€é”ï¼Œå…¶ä¸­å¤šçº¿ç¨‹ä¼šå¼ºåˆ¶åœ¨å•æ ¸ä¸Šè¿è¡Œï¼Œæ‰€ä»¥Pythonçš„å¤šçº¿ç¨‹æ˜¯å¹¶å‘è€Œä¸æ˜¯å¹¶è¡Œï¼Œæˆ‘æ›´æ¨èä½¿ç”¨åç¨‹å’Œå¤šè¿›ç¨‹ã€‚\n3.1 çº¿ç¨‹è°ƒåº¦ã€€  æ¥æºï¼šhttps://my.oschina.net/u/240562/blog/137040\nçº¿ç¨‹åˆ‡æ¢ç”±Pythonå†³å®šï¼Œå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªæ•°å€¼ï¼Œè¿™ä¸ªæ•°å€¼æ˜¯pythonçš„å†…éƒ¨æ—¶é’Ÿï¼Œé»˜è®¤å€¼æ˜¯100ï¼Œä¹Ÿå°±æ˜¯è¯´pythonåœ¨æ‰§è¡Œå®Œ100æ¡è¯­å¥ä¹‹åï¼Œå¼€å§‹è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚ä¹Ÿä½¿ç”¨è¿™ä¸ªæ•°å€¼æ£€æŸ¥æ˜¯å¦æœ‰å¼‚æ­¥äº‹ä»¶å‘ç”Ÿã€‚éœ€è¦å¤„ç†ã€‚\npythonæ§åˆ¶ç€ä»€ä¹ˆæ—¶å€™è¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—è®¿é—®pythonè§£é‡Šå™¨çš„æ‰€å¿…éœ€çš„GILå¹¶è¿›å…¥è§£é‡Šå™¨åï¼Œå³å½“è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œäº†100æ¡è¯­å¥åï¼Œpythonè§£é‡Šå™¨å°†å¼ºåˆ¶æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œå¼€å§‹åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¤„äºç­‰å¾…çš„çº¿ç¨‹ã€‚\nç©¶ç«Ÿå“ªä¸ªçº¿ç¨‹ä¼šè¢«æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸Špythonæ˜¯ä¸ä¼šæ’æ‰‹çš„ï¼Œè€Œæ˜¯äº¤ç»™åº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥è§£å†³ï¼Œpythonå€Ÿç”¨åº•å±‚çš„æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å†³å®šä¸‹ä¸€ä¸ªè¿›å…¥pythonè§£é‡Šå™¨çš„çº¿ç¨‹ç©¶ç«Ÿæ˜¯è°ã€‚\næ‰€ä»¥pythonçš„çº¿ç¨‹å®é™…å°±æ˜¯æ“ä½œç³»ç»Ÿæ‰€æ”¯æŒçš„åŸç”Ÿçº¿ç¨‹ï¼Œpythonçš„å¤šçº¿ç¨‹æœºåˆ¶å»ºç«‹åœ¨æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹æœºåˆ¶ä¹‹ä¸Šï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„å®ç°ã€‚\nç„¶è€Œæœ€ç»ˆï¼Œåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šï¼Œpythonæä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„æŠ½è±¡æœºåˆ¶ï¼Œç»™pythonçš„ä½¿ç”¨è€…ä¸€ä¸ªå¤šçº¿ç¨‹çš„å·¥å…·ç®±ï¼Œå°±æ˜¯pythonçš„Threadå’ŒThreadingã€‚\n ã€€æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯Pythonå¤šçº¿ç¨‹çš„åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºåˆ†æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å æ®ä¸€å®šçš„æ—¶é—´ç‰‡ï¼Œæ—¶é—´ç‰‡è¿è¡Œå®Œçš„çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿåˆ‡æ¢æ‰ã€‚ã€€ã€€çº¿ç¨‹è°ƒåº¦ç”±Pythonæ§åˆ¶ï¼Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹åœ¨å•æ ¸ä¸Šæ‰§è¡Œã€‚Pythonå®ç°äº†è·¨å¹³å°çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼Œä½†æœ¬è´¨ä¸Šæ¿€æ´»ç­‰å¾…çº¿ç¨‹ä¸æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œä¸åŒæ“ä½œç³»ç»Ÿå¯èƒ½ç”±ä¸åŒçš„ç»“æœã€‚çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°äºè¿›ç¨‹åˆ‡æ¢ã€‚\n3.2 é”å¯¹è±¡ ã€€class threading.Lockæ˜¯å®ç°åŸå§‹é”å¯¹è±¡çš„ç±»ï¼Œç”¨äºåŒæ­¥ã€‚ä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹è·å¾—ä¸€ä¸ªé”ï¼Œä¼šé˜»å¡éšåå°è¯•è·å¾—é”çš„çº¿ç¨‹ï¼Œç›´åˆ°å®ƒè¢«é‡Šæ”¾ï¼›ä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥é‡Šæ”¾å®ƒã€‚\n   acquire(blocking=True, timeout=-1)\nå¯ä»¥é˜»å¡æˆ–éé˜»å¡åœ°è·å¾—é”ã€‚\nblockingï¼šå½“è°ƒç”¨æ—¶å‚æ•° blocking è®¾ç½®ä¸º True ï¼ˆç¼ºçœå€¼ï¼‰ï¼Œé˜»å¡ç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œç„¶åå°†é”é”å®šå¹¶è¿”å› True ã€‚åœ¨å‚æ•° blocking è¢«è®¾ç½®ä¸º False çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œå°†ä¸ä¼šå‘ç”Ÿé˜»å¡ã€‚å¦‚æœè°ƒç”¨æ—¶ blocking è®¾ä¸º True ä¼šé˜»å¡ï¼Œå¹¶ç«‹å³è¿”å› False ï¼›å¦åˆ™ï¼Œå°†é”é”å®šå¹¶è¿”å› Trueã€‚\ntimeoutï¼šå½“æµ®ç‚¹å‹ timeout å‚æ•°è¢«è®¾ç½®ä¸ºæ­£å€¼è°ƒç”¨æ—¶ï¼Œåªè¦æ— æ³•è·å¾—é”ï¼Œå°†æœ€å¤šé˜»å¡ timeout è®¾å®šçš„ç§’æ•°ã€‚timeout å‚æ•°è¢«è®¾ç½®ä¸º -1 æ—¶å°†æ— é™ç­‰å¾…ã€‚å½“ blocking ä¸º false æ—¶ï¼Œtimeout æŒ‡å®šçš„å€¼å°†è¢«å¿½ç•¥ã€‚å¦‚æœæˆåŠŸè·å¾—é”ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False (ä¾‹å¦‚å‘ç”Ÿ è¶…æ—¶ çš„æ—¶å€™)ã€‚\n  release()\né‡Šæ”¾ä¸€ä¸ªé”ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œä¸å•æŒ‡è·å¾—é”çš„çº¿ç¨‹ã€‚å½“é”è¢«é”å®šï¼Œå°†å®ƒé‡ç½®ä¸ºæœªé”å®šï¼Œå¹¶è¿”å›ã€‚å¦‚æœå…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¿™ä¸ªé”è§£é”è€Œè¢«é˜»å¡ï¼Œåªå…è®¸å…¶ä¸­ä¸€ä¸ªé‡ç½®ã€‚åœ¨æœªé”å®šçš„é”è°ƒç”¨æ—¶ï¼Œä¼šå¼•å‘ RuntimeError å¼‚å¸¸ã€‚æ²¡æœ‰è¿”å›å€¼ã€‚\n  locked()\nå¦‚æœè·å¾—äº†é”åˆ™è¿”å›çœŸå€¼ã€‚\n   åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡ï¼š\n1 2  import threading my_lock = threading.Lock()   è·å¾—é”å’Œé‡Šæ”¾é”ï¼š\n1 2 3 4  #è·å¾—é” my_lock.acquire() #é‡Šæ”¾é” my_lock.release()   ã€€å½“æ“ä½œå…±äº«çš„æ•°æ®æ—¶ï¼Œéœ€è¦ä¿è¯åŸå­æ“ä½œï¼Œå¦åˆ™å¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œé”ç”¨æ¥ä¿è¯åŸå­æ“ä½œã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†å½“æ²¡æœ‰é”ä¿è¯åŸå­æ€§æ“ä½œæ—¶å¯èƒ½å¾—åˆ°çš„é”™è¯¯ç»“æœã€‚\nã€€ä¸‹é¢çš„ä»£ç é¢„æœŸçš„ç»“æœæ˜¯0ï¼Œä½†ä¸åŠ é”çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´å‡ºç°æ„å¤–çš„è¾“å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  # -*- coding: utf-8 -*- #thread_lock.py #æ¥æºï¼šhttps://python-parallel-programmning-cookbook.readthedocs.io/zh_CN/latest/chapter2/06_Thread_synchronization_with_Lock_and_Rlock.html import threading shared_resource_with_lock = 0 shared_resource_with_no_lock = 0 COUNT = 100000 shared_resource_lock = threading.Lock() # æœ‰é”çš„æƒ…å†µ def increment_with_lock(): global shared_resource_with_lock for i in range(COUNT): shared_resource_lock.acquire() shared_resource_with_lock += 1 shared_resource_lock.release() def decrement_with_lock(): global shared_resource_with_lock for i in range(COUNT): shared_resource_lock.acquire() shared_resource_with_lock -= 1 shared_resource_lock.release() # æ²¡æœ‰é”çš„æƒ…å†µ def increment_without_lock(): global shared_resource_with_no_lock for i in range(COUNT): shared_resource_with_no_lock += 1 def decrement_without_lock(): global shared_resource_with_no_lock for i in range(COUNT): shared_resource_with_no_lock -= 1 if __name__ == \u0026#34;__main__\u0026#34;: t1 = threading.Thread(target=increment_with_lock) t2 = threading.Thread(target=decrement_with_lock) t3 = threading.Thread(target=increment_without_lock) t4 = threading.Thread(target=decrement_without_lock) t1.start() t2.start() t3.start() t4.start() t1.join() t2.join() t3.join() t4.join() print (\u0026#34;the value of shared variable with lock management is %s\u0026#34; % shared_resource_with_lock) print (\u0026#34;the value of shared variable with race condition is %s\u0026#34; % shared_resource_with_no_lock)   ä¸Šè¿°ä»£ç çš„å‡ æ¬¡è¾“å‡ºç»“æœï¼š\n1 2 3 4 5 6 7 8 9  #1 the value of shared variable with lock management is 0 the value of shared variable with race condition is 32622 #2 \u0026amp; 3 \u0026amp; 4 the value of shared variable with lock management is 0 the value of shared variable with race condition is 0 #5 the value of shared variable with lock management is 0 the value of shared variable with race condition is -8627   ã€€äº§ç”Ÿè¿™ç§è¾“å‡ºçš„åŸå› æ˜¯ï¼Œåœ¨æ²¡æœ‰é”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹çš„åˆ‡æ¢æ˜¯ç”±Pythonæ§åˆ¶çš„ï¼Œä¸ä¸€å®šæ‰§è¡Œåˆ°ä»€ä¹ˆæ—¶å€™å°±åˆ‡æ¢çº¿ç¨‹äº†ï¼Œå¯¼è‡´çº¿ç¨‹åˆ‡æ¢å‰åå…±äº«å˜é‡çš„å€¼ä¸ä¸€è‡´ã€‚\nã€€ä¸¾ä¾‹æ¥è¯´ï¼Œå¯èƒ½æ‰§è¡Œåˆ°æ—¶åˆ»Aæ—¶ï¼Œt4è¿è¡Œåˆ°shared_resource_with_no_lock -= 1æ—¶åˆ‡æ¢åˆ°äº†t3ï¼Œè¿è¡Œshared_resource_with_no_lock += 1ï¼Œæ‰§è¡Œäº†å¾ˆå¤šæ¬¡shared_resource_with_no_lock += 1ï¼Œè¿è¡Œåˆ°æ—¶åˆ»Båˆ‡æ¢å›t4,ä½†æ­¤æ—¶shared_resource_with_no_lock -= 1ä¸­çš„shared_resource_with_no_lockå·²ç»ä¸æ˜¯æ—¶åˆ»Açš„shared_resource_with_no_lockï¼Œå¯¼è‡´è¢«å‡æ•°å¢å¤§äº†ï¼Œç»“æœå°±ä¼šä¸é¢„æœŸä¸ç¬¦ï¼Œäº§ç”Ÿç¬¬ä¸€æ¬¡è¾“å‡ºçš„ç»“æœã€‚\nã€€ä½†t4åŠ ä¸Šé”ä¹‹åï¼Œå³ä½¿åˆ‡æ¢åˆ°t3ï¼Œç”±äºé”å·²ç»è¢«è·å¾—ï¼Œt3ä¼šè¢«é˜»å¡ï¼Œåˆä¼šåˆ‡å›åˆ°t4ï¼Œä»è€Œä¿è¯äº†åœ¨çº¿ç¨‹åˆ‡æ¢æ—¶shared_resource_with_lockçš„å€¼ä¸å˜ã€‚\n3.3 ä¿¡å·é‡å¯¹è±¡ ã€€ç”¨äºä¿æŠ¤æ•°é‡æœ‰é™çš„èµ„æºï¼Œåœ¨èµ„æºæ•°é‡å›ºå®šçš„ä»»ä½•æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥ä½¿ç”¨æœ‰ç•Œä¿¡å·é‡ã€‚åœ¨ç”Ÿæˆä»»ä½•å·¥ä½œçº¿ç¨‹å‰ï¼Œåº”è¯¥åœ¨ä¸»çº¿ç¨‹ä¸­åˆå§‹åŒ–ä¿¡å·é‡ã€‚è¿˜æ²¡ç”¨è¿‡ï¼Œæš‚æ—¶ä¸ä»‹ç»äº†ï¼Œç”¨æ³•å’Œé”ç›¸ä¼¼ï¼Œåªä¸è¿‡ä¿¡å·é‡è®¡æ•°ã€‚\n3.4 é˜Ÿåˆ— ã€€æ³¨æ„è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹éƒ½æœ‰é˜Ÿåˆ—ï¼Œä¸”å®šä¹‰åœ¨ä¸åŒçš„æ–‡ä»¶é‡Œï¼Œè¿™é‡ŒæŒ‡çº¿ç¨‹é˜Ÿåˆ—ã€‚\nã€€çº¿ç¨‹ç”¨çš„é˜Ÿåˆ—å°±æ˜¯queueæ¨¡å—çš„Queueå¯¹è±¡ã€‚\n æ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/library/queue.html\nqueue.Queueï¼ˆå…ˆå…¥å…ˆå‡ºï¼Œè¿˜æœ‰LifoQueueå’ŒPriorityQueueï¼‰\n qsize()ï¼šè¿”å›é˜Ÿåˆ—çš„å¤§è‡´å¤§å°ã€‚ empty()ï¼šé˜Ÿåˆ—ä¸ºç©ºè¿”å›Trueã€‚ full()ï¼šé˜Ÿåˆ—æ»¡è¿”å›Trueã€‚ put(item, block=True, timeout=None)ï¼šå°†itemæ”¾å…¥é˜Ÿåˆ—ã€‚  å¦‚æœå¯é€‰å‚æ•° block æ˜¯ true å¹¶ä¸” timeout æ˜¯ None (é»˜è®¤)ï¼Œåˆ™åœ¨å¿…è¦æ—¶é˜»å¡è‡³æœ‰ç©ºé—²æ’æ§½å¯ç”¨ã€‚å¦‚æœ timeout æ˜¯ä¸ªæ­£æ•°ï¼Œå°†æœ€å¤šé˜»å¡ timeout ç§’ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´æ²¡æœ‰å¯ç”¨çš„ç©ºé—²æ’æ§½ï¼Œå°†å¼•å‘ Full å¼‚å¸¸ã€‚ å¦‚æœå¯é€‰å‚æ•° block æ˜¯ falseï¼Œå¦‚æœç©ºé—²æ’æ§½ç«‹å³å¯ç”¨ï¼Œåˆ™æŠŠ item æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦åˆ™å¼•å‘ Full å¼‚å¸¸ ( åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œtimeout å°†è¢«å¿½ç•¥)ã€‚   put_nowait(item)ï¼šç›¸å½“äºput(item, False)ã€‚ get(block=True,timeout=None)ï¼šä»é˜Ÿåˆ—ä¸­ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªé¡¹ç›®ã€‚  å¦‚æœå¯é€‰å‚æ•° block æ˜¯ true å¹¶ä¸” timeout æ˜¯ None (é»˜è®¤å€¼)ï¼Œåˆ™åœ¨å¿…è¦æ—¶é˜»å¡è‡³é¡¹ç›®å¯è·å¾—ã€‚å¦‚æœ timeout æ˜¯ä¸ªæ­£æ•°ï¼Œå°†æœ€å¤šé˜»å¡ timeout ç§’ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…é¡¹ç›®ä¸èƒ½å¾—åˆ°ï¼Œå°†å¼•å‘ Empty å¼‚å¸¸ã€‚ å¦‚æœå¯é€‰å‚æ•° block æ˜¯ false , å¦‚æœä¸€ä¸ªé¡¹ç›®ç«‹å³å¯å¾—åˆ°ï¼Œåˆ™è¿”å›ä¸€ä¸ªé¡¹ç›®ï¼Œå¦åˆ™å¼•å‘ Empty å¼‚å¸¸ (è¿™ç§æƒ…å†µä¸‹ï¼Œtimeout å°†è¢«å¿½ç•¥)ã€‚   get_nowait()ï¼šç›¸å½“äºget(False)ã€‚ task_done()ï¼šè¡¨ç¤ºå‰é¢æ’é˜Ÿçš„ä»»åŠ¡å·²ç»è¢«å®Œæˆã€‚è¢«é˜Ÿåˆ—çš„æ¶ˆè´¹è€…çº¿ç¨‹ä½¿ç”¨ã€‚æ¯ä¸ª get() è¢«ç”¨äºè·å–ä¸€ä¸ªä»»åŠ¡ï¼Œ åç»­è°ƒç”¨ task_done() å‘Šè¯‰é˜Ÿåˆ—ï¼Œè¯¥ä»»åŠ¡çš„å¤„ç†å·²ç»å®Œæˆã€‚å¦‚æœ join() å½“å‰æ­£åœ¨é˜»å¡ï¼Œåœ¨æ‰€æœ‰æ¡ç›®éƒ½è¢«å¤„ç†åï¼Œå°†è§£é™¤é˜»å¡(æ„å‘³ç€æ¯ä¸ª put() è¿›é˜Ÿåˆ—çš„æ¡ç›®çš„ task_done() éƒ½è¢«æ”¶åˆ°)ã€‚å¦‚æœè¢«è°ƒç”¨çš„æ¬¡æ•°å¤šäºæ”¾å…¥é˜Ÿåˆ—ä¸­çš„é¡¹ç›®æ•°é‡ï¼Œå°†å¼•å‘ ValueError å¼‚å¸¸ ã€‚ join()ï¼šé˜»å¡è‡³é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½è¢«æ¥æ”¶å’Œå¤„ç†å®Œæ¯•ã€‚   åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š\n1 2  import queue q = queue.Queue()   çº¿ç¨‹é—´ä½¿ç”¨é˜Ÿåˆ—é€šä¿¡ï¼š\n æ¥æºï¼šhttps://www.cnblogs.com/Keep-Ambition/p/7597664.html\n ã€€ä¿®æ”¹äº†æ¥æºä¸­consumerä¸­count+1çš„ä½ç½®ï¼Œå› ä¸ºä¼šå‡ºç°é˜Ÿåˆ—ä¸ºç©ºçš„æƒ…å†µï¼Œä¼šå¯¼è‡´æ‰§è¡Œäº†elseè¯­å¥ï¼Œæ²¡æœ‰æ¶ˆè´¹åˆ°ä¸œè¥¿ï¼Œå´å¯¹count+1äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  # thread_queue.py import time,random import queue,threading q = queue.Queue() def producer(name): count = 0 while count \u0026lt; 20: time.sleep(random.randrange(3)) q.put(count) # ç”Ÿäº§itemåˆ°é˜Ÿåˆ— print(\u0026#39;Producer %shas produced %sitem..\u0026#39; % (name, count)) count += 1 def consumer(name): count = 0 while count \u0026lt; 20: time.sleep(random.randrange(4)) if not q.empty(): # å¦‚æœè¿˜æœ‰item data = q.get() # å°±ç»§ç»­è·å–item #\u0026#39;\\033[æ˜¾ç¤ºæ–¹å¼;å‰æ™¯è‰²;èƒŒæ™¯è‰²m\u0026lt;è¾“å‡ºå†…å®¹\u0026gt;\\033[0m\u0026#39;è¾“å‡ºæœ‰æ–‡å­—é¢œè‰²å’ŒèƒŒæ™¯è‰²çš„å†…å®¹ï¼Œå…¶ä¸­\u0026#39;\\033[0m\u0026#39;è¡¨ç¤ºè¯¥é¢œè‰²ç»“æŸ print(\u0026#39;\\033[32;1mConsumer %shas eat %sitem...\\033[0m\u0026#39; % (name, data)) count += 1 q.task_done() else: print(\u0026#34;waiting...\u0026#34;) p1 = threading.Thread(target=producer, args=(\u0026#39;A\u0026#39;,)) c1 = threading.Thread(target=consumer, args=(\u0026#39;B\u0026#39;,)) p1.start() c1.start() q.join()   ã€€è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  Producer A has produced 0 item.. Producer A has produced 1 item.. Producer A has produced 2 item.. Consumer B has eat 0 item... Producer A has produced 3 item.. Producer A has produced 4 item.. Consumer B has eat 1 item... Producer A has produced 5 item.. Consumer B has eat 2 item... Producer A has produced 6 item.. Producer A has produced 7 item.. Producer A has produced 8 item.. Producer A has produced 9 item.. Producer A has produced 10 item.. Producer A has produced 11 item.. Producer A has produced 12 item.. Consumer B has eat 3 item... Producer A has produced 13 item.. Consumer B has eat 4 item... Producer A has produced 14 item.. Producer A has produced 15 item.. Producer A has produced 16 item.. Consumer B has eat 5 item... Consumer B has eat 6 item... Producer A has produced 17 item.. Producer A has produced 18 item.. Producer A has produced 19 item.. Consumer B has eat 7 item... Consumer B has eat 8 item... Consumer B has eat 9 item... Consumer B has eat 10 item... Consumer B has eat 11 item... Consumer B has eat 12 item... Consumer B has eat 13 item... Consumer B has eat 14 item... Consumer B has eat 15 item... Consumer B has eat 16 item... Consumer B has eat 17 item... Consumer B has eat 18 item... Consumer B has eat 19 item...   4.å‚è€ƒä»£ç  ã€€åœ°å€ï¼šhttps://github.com/yyyIce/py_exercise/tree/main/threading\nã€€æœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\nå‚è€ƒèµ„æ–™ 1.ç®¡é“å’Œé˜Ÿåˆ—çš„é€‰æ‹©ï¼šhttps://qastack.cn/programming/8463008/multiprocessing-pipe-vs-queue\n2.å¯è°ƒç”¨å¯¹è±¡ï¼šhttps://zhuanlan.zhihu.com/p/101792911\n3.çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼šhttps://my.oschina.net/u/240562/blog/137040\n4.Pythonè¾“å‡ºæœ‰é¢œè‰²å’ŒèƒŒæ™¯è‰²çš„æ–‡å­—ï¼šhttps://o-u-u.com/?p=2940\n","description":"Pythonå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç†è§£ä¸åº”ç”¨","id":24,"section":"posts","tags":["python"],"title":"Pythonï¼šå¤šçº¿ç¨‹ç¼–ç¨‹","uri":"https://yyyIce.github.io/zh/posts/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"},{"content":"\r æœ¬æ–‡æ˜¯å¤šè¿›ç¨‹å’Œåç¨‹çš„ç»¼åˆä½¿ç”¨ç¤ºä¾‹ï¼Œè‡³å°‘2ä¸ªæ ¸æ‰èƒ½å……åˆ†è¾¾åˆ°é€Ÿåº¦è¦æ±‚ï¼Œå®é™…å·¥ç¨‹ä¸­è¿™ä¹ˆç”¨å¥½ä¸å¥½æš‚æ—¶ä¸æ¸…æ¥šã€‚ è¿™é‡Œä»…ç»™å‡ºç®€è¦ä»£ç ï¼Œå¯ä»¥è‡ªè¡Œæ·»åŠ æ—¥å¿—ã€é…ç½®æ–‡ä»¶ç­‰åŠŸèƒ½ã€‚  \r \ræ•´ä½“è®¾è®¡ è¿›ç¨‹1ï¼šä»kafkaçš„CONSUME_TOPICä¸­æ¶ˆè´¹æ¶ˆæ¯æ”¾å…¥è¿›ç¨‹é˜Ÿåˆ—msg_qï¼Œç„¶åä¿®æ”¹æ¶ˆæ¯å†…å®¹ç”Ÿäº§åˆ°PRODUCE_TOPICä¸­ã€‚é€šè¿‡ä¸€ä¸ªåç¨‹æ‰“å°æ¶ˆè´¹ç”Ÿäº§é€Ÿåº¦ã€‚\nè¿›ç¨‹2ï¼šä»è¿›ç¨‹é˜Ÿåˆ—msg_qä¸­å–å‡ºæ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯å†…å®¹å¼‚æ­¥å‘é€HTTPè¯·æ±‚ï¼Œå¯¹äºå¤±è´¥çš„è¯·æ±‚ï¼Œå°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚é€šè¿‡ä¸€ä¸ªåç¨‹æ‰“å°è·å–å“åº”çš„é€Ÿåº¦ã€‚\nã€å›¾ã€‘\nä»£ç ç¼–å†™ éœ€è¦æ³¨æ„çš„é—®é¢˜ é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿›ç¨‹å°†é˜»å¡ï¼Œéœ€è¦è¿›è¡Œæ£€æŸ¥å’Œå¤„ç†\nåŒæ­¥é—®é¢˜ï¼Œä¿®æ”¹åç§»é‡éœ€è¦åœ¨åŒä¸€æ¬¡æ§åˆ¶æƒä¸­ä¿®æ”¹\nå‚è€ƒä»£ç  ã€€åœ°å€ï¼š\n","description":"ç»¼åˆè¿›ç¨‹å’Œåç¨‹è¿›è¡Œä½¿ç”¨","id":25,"section":"posts","tags":["python"],"title":"Pythonï¼šå¤šè¿›ç¨‹+åç¨‹ç¼–ç¨‹ç¤ºä¾‹","uri":"https://yyyIce.github.io/zh/posts/python%E5%A4%9A%E8%BF%9B%E7%A8%8B+%E5%8D%8F%E7%A8%8B%E7%BC%96%E7%A8%8B%E7%A4%BA%E4%BE%8B/"},{"content":"\r Pythonæ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/library/multiprocessing.html å¯ä»¥å…ˆå‚çœ‹ä»–äººåšå®¢ï¼Œå¤§æ¦‚äº†è§£ä»¥åçœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œä½¿ç”¨ï¼Œä¸å»ºè®®ç›´æ¥çœ‹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚  \r \r1 multiprocessing  multiprocessingå¯ä»¥å¹¶å‘æ“ä½œï¼Œé€šè¿‡å­è¿›ç¨‹æœ‰æ•ˆåœ°ç»•è¿‡äº†å…¨å±€è§£é‡Šå™¨é”ï¼Œå…è®¸ç¨‹åºå‘˜å……åˆ†åˆ©ç”¨ç»™å®šæœºå™¨ä¸Šçš„å¤šä¸ªå¤„ç†å™¨ï¼Œåœ¨Unixå’ŒWindowsä¸Šå‡å¯è¿è¡Œã€‚\næºä»£ç ï¼šhttps://github.com/python/cpython/tree/3.9/Lib/multiprocessing/\nå…¶ä¸­Processç±»åœ¨process.pyæ–‡ä»¶ä¸­ã€‚\n ã€€Processå’Œthreading.Threadçš„APIç›¸åŒã€‚\n class multiprocessing.Process(group=None, target=None, name=None, args=(), kwargs={}, ***, daemon=None)\n  groupï¼šä¸ç”¨ç®¡ï¼Œä¿ç•™ targetï¼šrun()æ–¹æ³•è°ƒç”¨çš„å¯è°ƒç”¨å¯¹è±¡ nameï¼šçº¿ç¨‹åç§°ï¼Œé»˜è®¤æ ¼å¼ä¸ºThread-N argsï¼šè°ƒç”¨ç›®æ ‡å‡½æ•°çš„å‚æ•°å…ƒç»„ kwargsï¼šç”¨äºè°ƒç”¨ç›®æ ‡å‡½æ•°çš„å…³é”®å­—å‚æ•°å­—å…¸ daemonï¼šè®¾ç½®çº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤æ¨¡å¼ï¼Œä¸å»ºè®®ä½¿ç”¨setDaemon()  ã€€åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼š\n1 2 3  from multiprocessing import Process if __name__ == \u0026#39;__main__\u0026#39;: p = Process(target=\u0026lt;å¯è°ƒç”¨å¯¹è±¡\u0026gt;,args=(\u0026lt;å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°\u0026gt;),...)   ã€€å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼š\n1 2 3 4  from multiprocessing import Process if __name__ == \u0026#39;__main__\u0026#39;: p = Process(target=\u0026lt;å¯è°ƒç”¨å¯¹è±¡\u0026gt;,args=(\u0026lt;å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°\u0026gt;),...) p.start()   ã€€å¼€å§‹è¿›ç¨‹æ´»åŠ¨ï¼š\n\u0026lt;Process\u0026gt;.run()ï¼Œ.run()æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼Œå’Œçº¿ç¨‹ç›¸ä¼¼ï¼ŒæŠŠæ´»åŠ¨å†™æˆå‡½æ•°åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼ç»™targetå³å¯ã€‚\n1 2 3 4 5 6 7  #Lib/multiprocessing/process.py def run(self): \u0026#39;\u0026#39;\u0026#39; Method to be run in sub-process; can be overridden in sub-class \u0026#39;\u0026#39;\u0026#39; if self._target: self._target(*self._args, **self._kwargs)   ã€€å¯åŠ¨è¿›ç¨‹çš„æ–¹æ³•\n spawnï¼šåªç»§æ‰¿è¿è¡Œrun()æ–¹æ³•æ‰€å¿…è¦çš„èµ„æºï¼Œæ¯”forkå’Œforkserveræ…¢ã€‚Windowså’ŒUnixä¸Šéƒ½å¯ç”¨ã€‚ forkï¼šçˆ¶è¿›ç¨‹ä½¿ç”¨os.fork()ï¼Œåªèƒ½åœ¨Unixä¸Šç”¨ã€‚ forkserverï¼šéœ€è¦æ–°è¿›ç¨‹æ—¶ï¼Œçˆ¶è¿›ç¨‹è¿æ¥æœåŠ¡å™¨ï¼Œè¯·æ±‚å®ƒåˆ†å‡ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚å¯åœ¨Unixä¸Šä½¿ç”¨ã€‚  ã€€ä½¿ç”¨æ–¹æ³•ï¼šåœ¨if __name__ == '__main__':ä¸­è°ƒç”¨set_start_method()ï¼Œè¿™ä¸ªæ–¹æ³•ä¸åº”è¯¥è¢«å¤šæ¬¡è°ƒç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  import multiprocessing as mp def foo(q): q.put(\u0026#39;hello\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: mp.set_start_method(\u0026#39;fork\u0026#39;) q = mp.Queue() p = mp.Process(target=foo, args=(q,)) p.start() print(q.get()) p.join()   ã€€è¿›ç¨‹è°ƒåº¦\nã€€è¿›ç¨‹ä¼˜å…ˆåœ¨ä¸åŒçš„æ ¸ï¼ˆCPUï¼‰ä¸Šè¿è¡Œï¼Œæ¯”å¦‚æœ‰CPU1ï¼ŒCPU2ï¼ŒCPU3å’Œè¿›ç¨‹1-6ï¼Œåˆ™è¿›ç¨‹å¯èƒ½æ˜¯1ã€4åœ¨CPU1ä¸Šè¿è¡Œï¼Œ2ã€5åœ¨CPU2ä¸Šè¿è¡Œï¼Œ3ã€6åœ¨CPU3ä¸Šè¿è¡Œï¼ˆä¸ä¸€å®šæ˜¯æŒ‰è¿™ç§é¡ºåºåˆ†å¸ƒï¼Œä½†ä¼šåœ¨ä¸åŒçš„æ ¸ä¸Šï¼Œä¹Ÿå¯èƒ½1å’Œ6åœ¨åŒä¸€ä¸ªæ ¸ä¸Šï¼‰ã€‚multiprocessing.cpu_count()æŸ¥çœ‹å½“å‰æ ¸æ•°ã€‚\n1 2  import multiprocessing print(multiprocessing.cpu_count())   ã€€å¯ä»¥ä½¿ç”¨psutilæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œè¿™é‡Œåˆ©ç”¨pstutilçš„cpu_num()æ–¹æ³•æŸ¥çœ‹å½“å‰è¿›ç¨‹è¿è¡Œåœ¨å“ªä¸ªCPUä¸Šï¼Œç¼–å·ä»0å¼€å§‹ï¼Œä½¿ç”¨æ–¹æ³•å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  import psutil import os import multiprocessing from multiprocessing import Process def producer(name): //... pass if __name__ == \u0026#39;__main__\u0026#39;: p1 = Process(target=producer, args=(\u0026#39;A\u0026#39;,)) p1.start() parent = psutil.Process(os.getpid()) print(\u0026#34;main: %d\u0026#34; % parent.cpu_num())   2 è¿›ç¨‹é—´é€šä¿¡ ã€€multiprocessingæ”¯æŒè¿›ç¨‹é—´ä¸¤ç§é€šä¿¡é€šé“ï¼šé˜Ÿåˆ—ï¼ˆmultiprocessing.Queueå’Œmultiprocessing.Pipeï¼‰å’Œç®¡é“ã€‚\nã€€å¹¶å‘ç¼–ç¨‹å°½é‡é¿å…ä½¿ç”¨å…±äº«çŠ¶æ€ï¼Œä½¿ç”¨é˜Ÿåˆ—å’Œç®¡é“è¿›è¡Œé€šä¿¡ï¼Œæœ¬æ¬¡å­¦ä¹ è¿›ç¨‹çš„ç›®çš„æœ¬èº«å°±æ˜¯ä¸ºäº†å¹¶å‘ç¼–ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä»‹ç»å…±äº«çŠ¶æ€ã€‚\n2.1 é˜Ÿåˆ—å’Œç®¡é“çš„é€‰æ‹©   Pipeåªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼ŒQueueå¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…\n  å¦‚æœéœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„äº¤æµç‚¹ï¼Œä½¿ç”¨Queueï¼›éœ€è¦ç¼“å†²æ•°æ®æ—¶ï¼Œé˜Ÿåˆ—æ˜¯æ¯”ç®¡é“æ›´å¥½çš„é€‰æ‹©ã€‚\n  å¦‚æœæƒ³è¦ç»å¯¹çš„æ€§èƒ½ï¼Œé€‰ç”¨Pipe()ï¼Œå› ä¸ºQueue()å»ºç«‹åœ¨Pipe()ä¹‹ä¸Šã€‚\n  2.2 è¿›ç¨‹é˜Ÿåˆ— ã€€multiprocessing.Queueå’Œqueue.Queueè¿‘ä¼¼ï¼Œä½†è¿›ç¨‹Queueæ²¡æœ‰join()å’Œtask_done()æ–¹æ³•ï¼Œä½†å®ƒæœ‰join_thread()æ–¹æ³•ã€‚\n æ–‡æ¡£ï¼šhttps://docs.python.org/zh-cn/3/library/multiprocessing.html?highlight=queue#pipes-and-queues\nqueue.Queueï¼ˆå…ˆå…¥å…ˆå‡ºï¼Œè¿˜æœ‰LifoQueueå’ŒPriorityQueueï¼‰\n qsize()ï¼šè¿”å›é˜Ÿåˆ—çš„å¤§è‡´å¤§å°ã€‚ empty()ï¼šé˜Ÿåˆ—ä¸ºç©ºè¿”å›Trueã€‚ full()ï¼šé˜Ÿåˆ—æ»¡è¿”å›Trueã€‚ put(obj[, block[, timeout]])ï¼šå°†objæ”¾å…¥é˜Ÿåˆ—ã€‚  å¦‚æœå¯é€‰å‚æ•° block æ˜¯ true å¹¶ä¸” timeout æ˜¯ None (é»˜è®¤)ï¼Œåˆ™åœ¨å¿…è¦æ—¶é˜»å¡è‡³æœ‰ç©ºé—²æ’æ§½å¯ç”¨ã€‚å¦‚æœ timeout æ˜¯ä¸ªæ­£æ•°ï¼Œå°†æœ€å¤šé˜»å¡ timeout ç§’ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´æ²¡æœ‰å¯ç”¨çš„ç©ºé—²æ’æ§½ï¼Œå°†å¼•å‘ queue.Full å¼‚å¸¸ã€‚ å¦‚æœå¯é€‰å‚æ•° block æ˜¯ falseï¼Œå¦‚æœç©ºé—²æ’æ§½ç«‹å³å¯ç”¨ï¼Œåˆ™æŠŠ item æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦åˆ™å¼•å‘ Full å¼‚å¸¸ ( åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œtimeout å°†è¢«å¿½ç•¥)ã€‚   put_nowait(item)ï¼šç›¸å½“äºput(item, False)ã€‚ get([block[, timeout]])ï¼šä»é˜Ÿåˆ—ä¸­ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªé¡¹ç›®ã€‚  å¦‚æœå¯é€‰å‚æ•° block æ˜¯ true å¹¶ä¸” timeout æ˜¯ None (é»˜è®¤å€¼)ï¼Œåˆ™åœ¨å¿…è¦æ—¶é˜»å¡è‡³é¡¹ç›®å¯è·å¾—ã€‚å¦‚æœ timeout æ˜¯ä¸ªæ­£æ•°ï¼Œå°†æœ€å¤šé˜»å¡ timeout ç§’ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…é¡¹ç›®ä¸èƒ½å¾—åˆ°ï¼Œå°†å¼•å‘ Empty å¼‚å¸¸ã€‚ å¦‚æœå¯é€‰å‚æ•° block æ˜¯ false , å¦‚æœä¸€ä¸ªé¡¹ç›®ç«‹å³å¯å¾—åˆ°ï¼Œåˆ™è¿”å›ä¸€ä¸ªé¡¹ç›®ï¼Œå¦åˆ™å¼•å‘ Empty å¼‚å¸¸ (è¿™ç§æƒ…å†µä¸‹ï¼Œtimeout å°†è¢«å¿½ç•¥)ã€‚   get_nowait()ï¼šç›¸å½“äºget(False)ã€‚ close()ï¼šæŒ‡ç¤ºå½“å‰è¿›ç¨‹å°†ä¸ä¼šå†å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥å¯¹è±¡ã€‚ join_thread()ï¼šç­‰å¾…åå°çº¿ç¨‹ï¼Œä»…åœ¨è°ƒç”¨äº†close()æ–¹æ³•åå¯ç”¨ã€‚é˜»å¡å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°åå°çº¿ç¨‹é€€å‡ºï¼Œç¡®ä¿æ‰€æœ‰ç¼“å†²åŒºçš„æ•°æ®éƒ½è¢«å†™å…¥ç®¡é“ä¸­ã€‚ cancel_join_thread()ï¼šé˜²æ­¢join_thread()æ–¹æ³•é˜»å¡å½“å‰è¿›ç¨‹ã€‚å¦‚æœè¯¥è¿›ç¨‹ä¸æ˜¯é˜Ÿåˆ—çš„åˆ›å»ºè€…ï¼Œä¸éœ€è¦ç­‰å¾…é˜Ÿåˆ—çš„åå°çº¿ç¨‹é€€å‡ºï¼Œæ­¤æ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©join_thread()æ–¹æ³•ä»€ä¹ˆéƒ½ä¸åšç›´æ¥è·³è¿‡ã€‚   ã€€é˜Ÿåˆ—çš„ç®€å•ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  # multiprocess_queue.py from multiprocessing import Process, Queue def f(q): q.put([42, None, \u0026#39;hello\u0026#39;]) if __name__ == \u0026#39;__main__\u0026#39;: q = Queue() p = Process(target=f, args=(q,)) p.start() print(q.get()) # prints \u0026#34;[42, None, \u0026#39;hello\u0026#39;]\u0026#34; p.join()   ã€€ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  # multiprocess_queue_pc.py import time,random from multiprocessing import Process, Queue def producer(name): count = 0 while count \u0026lt; 20: time.sleep(random.randrange(3)) q.put(count) # ç”Ÿäº§itemåˆ°é˜Ÿåˆ— print(\u0026#39;Producer %shas produced %sitem..\u0026#39; % (name, count)) count += 1 def consumer(name): count = 0 while count \u0026lt; 20: time.sleep(random.randrange(4)) if not q.empty(): # å¦‚æœè¿˜æœ‰item data = q.get() # å°±ç»§ç»­è·å–item #\u0026#39;\\033[æ˜¾ç¤ºæ–¹å¼;å‰æ™¯è‰²;èƒŒæ™¯è‰²m\u0026lt;è¾“å‡ºå†…å®¹\u0026gt;\\033[0m\u0026#39;è¾“å‡ºæœ‰æ–‡å­—é¢œè‰²å’ŒèƒŒæ™¯è‰²çš„å†…å®¹ï¼Œå…¶ä¸­\u0026#39;\\033[0m\u0026#39;è¡¨ç¤ºè¯¥é¢œè‰²ç»“æŸ print(\u0026#39;\\033[32;1mConsumer %shas eat %sitem...\\033[0m\u0026#39; % (name, data)) count += 1 else: print(\u0026#34;waiting...\u0026#34;) q = Queue() p1 = Process(target=producer, args=(\u0026#39;A\u0026#39;,)) c1 = Process(target=consumer, args=(\u0026#39;B\u0026#39;,)) p1.start() c1.start()   JoinableQueue ã€€Queueé˜Ÿåˆ—æ²¡æœ‰join()å’Œtask_done()æ–¹æ³•ï¼Œåœ¨JoinableQueueä¸­æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼ŒJoinableQueueæ˜¯Queueçš„å­ç±»ã€‚\nã€€ç»ä½¿ç”¨å‘ç°ï¼ŒQueueé˜Ÿåˆ—ä¼šå‡ºç°é˜Ÿåˆ—ä¸­è¿˜æœ‰æœªå¤„ç†å…ƒç´ å´é€€å‡ºçš„æƒ…å†µï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨JoinableQueue()ã€‚\n  task_doneï¼šå¯¹äºæ¯æ¬¡è°ƒç”¨get()è·å–çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåè°ƒç”¨task_done()å‘Šè¯‰é˜Ÿåˆ—è¯¥ä»»åŠ¡å·²ç»å¤„ç†å®Œæˆã€‚\n  join()ï¼šé˜»å¡è‡³é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½è¢«æ¥æ”¶å’Œå¤„ç†å®Œæ¯•ã€‚\n  3 è¿›ç¨‹æ±  ã€€æš‚æ—¶ç”¨ä¸åˆ°ï¼Œä¸æ•´ç†äº†ï¼Œå‚è€ƒï¼šhttps://blog.csdn.net/SeeTheWorld518/article/details/49639651\n4 å‚è€ƒä»£ç  ã€€åœ°å€ï¼šhttps://github.com/yyyIce/py_exercise/tree/main/multiprocessing\nã€€æœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\nå‚è€ƒèµ„æ–™ ã€€ç®¡é“å’Œé˜Ÿåˆ—çš„é€‰æ‹©ï¼šhttps://qastack.cn/programming/8463008/multiprocessing-pipe-vs-queue\n","description":"å¯¹Pythonå¤šè¿›ç¨‹çš„ç†è§£ä¸åº”ç”¨","id":26,"section":"posts","tags":["python"],"title":"Pythonï¼šå¤šè¿›ç¨‹ç¼–ç¨‹","uri":"https://yyyIce.github.io/zh/posts/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%BC%96%E7%A8%8B/"},{"content":"\r åŸæ–‡ï¼šhttps://realpython.com/async-io-python/ è¿™ä¸ªçœ‹åŸè‹±æ–‡æŒºå®¹æ˜“çœ‹æ‡‚çš„ï¼Œåœ¨çœ‹çš„åŒæ—¶é¡ºä¾¿ç¿»è¯‘å‡ºæ¥ä¾›è‹±è¯­å±å®ä¸è¡Œçš„äººä½¿ç”¨ã€‚  \r \rã€€å¼‚æ­¥IOï¼ˆAsync IOï¼‰æ˜¯å¹¶å‘ç¼–ç¨‹è®¾è®¡ï¼Œå®ƒåœ¨Pythonä¸­çš„åˆ°æ”¯æŒï¼Œåœ¨Python3.4-3.7ä»¥åŠä»¥åçš„ç‰ˆæœ¬ä¸­å¿«é€Ÿå‘å±•ã€‚ä½ å¯èƒ½ä¼šå¯¹â€œå¹¶å‘ï¼Œå¹¶è¡Œï¼Œçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹â€æ„Ÿåˆ°è¿·æƒ‘ï¼Œéœ€è¦æŒæ¡å¤ªå¤šçŸ¥è¯†ï¼Œå¼‚æ­¥IOå±äºå“ªä¸ªï¼Ÿ\nã€€è¿™ä¸ªæ•™ç¨‹å¯ä»¥å¸®åŠ©ä½ è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å¸®åŠ©ä½ æŒæ¡Pythonä¸­å¼‚æ­¥IOçš„ç”¨æ³•ã€‚\nã€€ä½ å°†å­¦åˆ°ï¼š\n å¼‚æ­¥IOï¼šä¸è¯­è¨€æ— å…³çš„èŒƒå¼ï¼ˆæ¨¡å‹ï¼‰ï¼Œå…·æœ‰è·¨å¤šç§ç¼–ç¨‹è¯­è¨€çš„å®ç° async/awaitï¼šä¸¤ç§æ–°çš„Pythonå…³é”®å­—ï¼Œç”¨äºå®šä¹‰åç¨‹ï¼ˆcoroutinesï¼‰ asyncioï¼šæä¾›è¿è¡Œå’Œç®¡ç†åç¨‹çš„åŸºç¡€å’ŒAPIçš„PythonåŒ…  ã€€åç¨‹**ï¼ˆç‰¹æ®Šçš„ç”Ÿæˆå™¨å‡½æ•°**ï¼‰æ˜¯å¼‚æ­¥IOçš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ç¨åä¼šæ·±å…¥æ¢è®¨å®ƒä»¬ã€‚\nã€€æ³¨æ„ï¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä½¿ç”¨æœ¯è¯­async IOè¡¨ç¤ºå¼‚æ­¥IOçš„è¯­è¨€æ— å…³è®¾è®¡ï¼Œè€ŒasyncioæŒ‡çš„æ˜¯PythonåŒ…ã€‚\nã€€åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ åº”è¯¥ç¡®è®¤ä½ å·²ç»å®‰è£…äº†asyncioå’Œè¿™ç¯‡æ•™ç¨‹ä¸­çš„å…¶å®ƒåº“ã€‚\nå®‰è£…ç¯å¢ƒ ã€€ä½ éœ€è¦Python3.7æˆ–æ›´é«˜ç‰ˆæœ¬ã€aiohttpåŒ…å’ŒaiofilesåŒ…æ‰èƒ½å®Œæ•´åœ°å®Œæˆæ•™ç¨‹ã€‚\n1 2 3  $python3.7 -m venv ./py37async $source ./py37async/bin/activate # Windows: .\\py37async\\Scripts\\activate.bat $pip install --upgrade pip aiohttp aiofiles # Optional: aiodns   ã€€å®‰è£…Python3.7å’Œè™šæ‹Ÿç¯å¢ƒï¼Œè®¿é—®ï¼šhttps://realpython.com/installing-python/æˆ–https://realpython.com/python-virtual-environments-a-primer/\nã€€ä¸‹é¢å°±è®©æˆ‘ä»¬å¼€å§‹å§ã€‚\n10000è‹±å°ºçš„å¼‚æ­¥IOè§†å›¾ ã€€å¼‚æ­¥IOæ²¡æœ‰å®ƒçš„å…„å¼Ÿå¤šè¿›ç¨‹å’Œçº¿ç¨‹çŸ¥åã€‚æœ¬èŠ‚å°†ä¸ºæ‚¨æä¾›æ›´å…¨é¢çš„äº†è§£å¼‚æ­¥IOæ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¦‚ä½•é€‚åº”å‘¨å›´çš„ç¯å¢ƒã€‚\nå¼‚æ­¥IOé€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ ã€€å¹¶å‘å’Œå¹¶è¡Œæ˜¯ä¸å®¹æ˜“æ¶‰è¶³çš„æ‰©å±•ä¸»é¢˜ã€‚ä½†è¿™ç¯‡æ–‡ç« ä¸“æ³¨äºå¼‚æ­¥IOåŠå…¶åœ¨Pythonä¸­çš„å®ç°ï¼Œå€¼å¾—èŠ±ä¸€ç‚¹æ—¶é—´å°†å¼‚æ­¥IOä¸ç›¸ä¼¼çš„æ¦‚å¿µè¿›è¡Œæ¯”è¾ƒï¼Œä»¥äº†è§£å¼‚æ­¥IOå¦‚ä½•é€‚åº”æ›´å¤§ã€æœ‰æ—¶ä»¤äººå›°æƒ‘çš„éš¾é¢˜ã€‚\nã€€å¹¶è¡Œï¼ˆParallelismï¼‰ç”±åŒæ—¶æ‰§è¡Œçš„å¤šä¸ªæ“ä½œç»„æˆã€‚å¤šè¿›ç¨‹ï¼ˆMultiprocessingï¼‰æ˜¯ä¸€ç§å®ç°å¹¶è¡Œçš„æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒéœ€è¦æŠŠä»»åŠ¡åˆ†æ•£åˆ°CPUçš„ä¸­å¤®å¤„ç†å•å…ƒä¸Šï¼ˆCPUæˆ–æ ¸ï¼‰ã€‚å¤šè¿›ç¨‹é€‚åˆCPUå¯†é›†ä»»åŠ¡ï¼šç´§ç»‘å®šå¾ªç¯å’Œæ•°å­¦è®¡ç®—é€šå¸¸å±äºæ­¤ç±»ã€‚\nã€€å¹¶å‘ï¼ˆConcurrencyï¼‰æ˜¯æ¯”å¹¶è¡Œè¾¹ç•Œæ›´æ¾å¼›çš„æœ¯è¯­ã€‚å®ƒè¡¨æ˜å¤šä¸ªä»»åŠ¡å¯ä»¥ä»¥é‡å çš„æ–¹å¼è¿è¡Œã€‚ï¼ˆæœ‰ä¸€ç§è¯´æ³•æ˜¯å¹¶å‘ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼‰\nã€€çº¿ç¨‹ï¼ˆThreadingï¼‰æ˜¯å¹¶å‘æ‰§è¡Œçš„æ¨¡å‹ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµæ‰§è¡Œä»»åŠ¡ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚Pythonç”±äºå®ƒçš„å…¨å±€é”ï¼ˆGILï¼‰å…·æœ‰å¤æ‚çš„çº¿ç¨‹å…³ç³»ï¼Œä½†æ˜¯é‚£è¶…è¿‡äº†è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ã€‚\nã€€å…³äºçº¿ç¨‹éœ€è¦äº†è§£çš„æ˜¯å®ƒæ›´é€‚åˆIOå¯†é›†å‹ä»»åŠ¡ã€‚CPUå¯†é›†å‹ä»»åŠ¡çš„ç‰¹å¾æ˜¯è®¡ç®—æœºå†…æ ¸ä»å¤´åˆ°å°¾ä¸æ–­åœ°åŠªåŠ›å·¥ä½œï¼Œè€ŒIOå¯†é›†å‹å·¥ä½œä¸»è¦ç”±å¤§é‡ç­‰å¾…è¾“å…¥/è¾“å‡ºæ¥å®Œæˆã€‚\nã€€å›é¡¾ä¸Šé¢æè¿°çš„ï¼Œå¹¶å‘åŒ…å«å¤šè¿›ç¨‹ï¼ˆCPUå¯†é›†å‹ä»»åŠ¡ï¼‰å’Œå¤šçº¿ç¨‹ï¼ˆIOå¯†é›†å‹ä»»åŠ¡ï¼‰ã€‚å¤šè¿›ç¨‹æ˜¯å¹¶è¡Œçš„ä¸€ç§å½¢å¼ï¼Œå¹¶è¡Œæ˜¯å¹¶å‘çš„ç‰¹æ®Šç±»å‹ï¼ˆå­é›†ï¼‰ã€‚Pythonæ ‡å‡†åº“é€šè¿‡å®ƒçš„multiprocessingï¼Œthreadingå’Œconcurrent.futuresåŒ…ä¸ºä»–ä»¬æä¾›äº†é•¿ä¹…çš„æ”¯æŒã€‚\nã€€ç°åœ¨æ˜¯æ—¶å€™å¸¦æ¥ä¸€ä¸ªæ–°æˆå‘˜äº†ã€‚åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œå•ç‹¬çš„è®¾è®¡å·²æ›´å…¨é¢åœ°å†…ç½®åˆ°CPythonä¸­ï¼šå¼‚æ­¥IOï¼Œé€šè¿‡æ ‡å‡†åº“çš„asyncioåŒ…å’Œæ–°çš„asyncå’Œawaitè¯­è¨€å…³é”®å­—å¯åŠ¨ã€‚è¿›ä¸€æ­¥è¯´ï¼Œå¼‚æ­¥IOä¸æ˜¯æ–°æå‡ºçš„æ¦‚å¿µï¼Œå®ƒå·²ç»å­˜åœ¨å¹¶æ„å»ºåˆ°äº†å…¶å®ƒè¯­è¨€å’Œè¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚Goï¼ŒC#ï¼Œæˆ–Scalaã€‚\nã€€asyncioåŒ…è¢«Pythonæ–‡æ¡£è®°ä¸ºç”¨äºç¼–å†™å¹¶å‘ä»£ç çš„åº“ã€‚ç„¶è€Œï¼Œå¼‚æ­¥IOä¸æ˜¯å¤šçº¿ç¨‹ä¹Ÿä¸æ˜¯å¤šè¿›ç¨‹ã€‚å®ƒä¸å±äºä¸Šè¿°çš„ä»»ä½•ä¸€ä¸ªã€‚\nã€€äº‹å®ä¸Šï¼Œå¼‚æ­¥IOæ˜¯å•çº¿ç¨‹ï¼Œå•è¿›ç¨‹è®¾è®¡ï¼šå®ƒä½¿ç”¨å¤šä»»åŠ¡åä½œæ¨¡å¼ï¼Œä½ ä¼šåœ¨æ–‡ç« ç»“å°¾æ—¶å®Œå…¨äº†è§£è¿™ä¸ªæœ¯è¯­ã€‚æ¢å¥è¯æ¥è¯´å¼‚æ­¥IOå°½ç®¡ä½¿ç”¨å•è¿›ç¨‹ä¸­çš„å•çº¿ç¨‹ï¼Œä»ç„¶ç»™äººä¸€ç§å¹¶å‘çš„æ„Ÿè§‰ã€‚åç¨‹ï¼ˆCoroutinesï¼Œå¼‚æ­¥IOçš„æ ¸å¿ƒåŠŸèƒ½ï¼‰èƒ½å¤Ÿå¹¶å‘è°ƒåº¦ï¼Œä½†å®ƒä»¬å†…éƒ¨ä¸æ˜¯å¹¶å‘ã€‚\nã€€é‡ç”³ä¸€æ¬¡ï¼Œå¼‚æ­¥IOæ˜¯å¹¶å‘ç¼–ç¨‹çš„ä¸€ç§é£æ ¼ï¼Œä½†å®ƒä¸æ˜¯å¹¶è¡Œã€‚ä¸å¤šè¿›ç¨‹ç›¸æ¯”ï¼Œå®ƒä¸çº¿ç¨‹å¤„ç†çš„å…³ç³»æ›´ç´§å¯†ï¼Œä½†ä¸¤è€…æˆªç„¶ä¸åŒï¼Œå¹¶ä¸”æ˜¯å¹¶å‘æŠ€å·§ä¸­çš„ç‹¬ç«‹æˆå‘˜ã€‚\nè¿˜å‰©ä¸‹ä¸€ä¸ªæœ¯è¯­ã€‚å¼‚æ­¥æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼Œä½†åœ¨æˆ‘ä»¬çš„è¯­å¢ƒä¸­ï¼Œæˆ‘è®¤ä¸ºå®ƒæœ‰ä¸¤ç§å±æ€§ï¼š\n å¼‚æ­¥ä¾‹ç¨‹èƒ½å¤Ÿåœ¨ç­‰å¾…ä»–ä»¬æœ€ç»ˆç»“æœçš„æ—¶å€™â€œæš‚åœâ€ï¼Œå¹¶ä¸”åŒæ—¶è®©å…¶ä»–ä¾‹ç¨‹è¿è¡Œã€‚ é€šè¿‡ä»¥ä¸Šæœºåˆ¶ï¼Œå¼‚æ­¥ä»£ç æœ‰åŠ©äºå¹¶å‘æ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå¼‚æ­¥ä»£ç ç»™å‡ºäº†å¹¶å‘çš„è§†è§‰æ•ˆæœã€‚  ã€€ä¸‹é¢æ˜¯ä¸€å¼ æŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·çš„å›¾ã€‚ç™½è‰²çš„æœ¯è¯­ä»£è¡¨æ¦‚å¿µï¼Œç»¿è‰²çš„æœ¯è¯­ä»£è¡¨ä»–ä»¬çš„å®ç°æ–¹å¼ï¼š\nå›¾1 å¹¶è¡Œ\u0026amp;å¹¶å‘:\r\r ã€€æˆ‘å°†åœ¨è¿™é‡Œåœæ­¢å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹é—´çš„æ¯”è¾ƒï¼Œè¿™ç¯‡æ•™ç¨‹ä¸“æ³¨äºå®ƒçš„å­æˆåˆ†â€”â€”å¼‚æ­¥IOçš„å­ç»„ä»¶ï¼Œå¦‚ä½•ä½¿ç”¨å¼‚æ­¥IOï¼Œå’Œå›´ç»•å®ƒå…´èµ·çš„APIã€‚è¦å…¨é¢äº†è§£çº¿ç¨‹ï¼Œå¤šå¤„ç†å’Œå¼‚æ­¥IOï¼Œè¯·åœ¨æ­¤å¤„æš‚åœå¹¶æŸ¥çœ‹Jim Andersonçš„Pythonå¹¶å‘æ¦‚è¿°ã€‚Jimæ¯”æˆ‘æœ‰è¶£å¾—å¤šï¼Œä¹Ÿæ¯”æˆ‘å‚åŠ äº†æ›´å¤šçš„ä¼šè®®ã€‚\nå¼‚æ­¥IOè§£é‡Š ã€€å¼‚æ­¥IOä¼¼ä¹æ˜¯è¿åç›´è§‰ä¸”çŸ›ç›¾çš„ã€‚å¦‚ä½•ä½¿ç”¨å•çº¿ç¨‹å’Œå•æ ¸å®ç°å¹¶å‘ä»£ç ï¼Ÿæˆ‘ä»æ¥éƒ½ä¸æ“…é•¿ç¼–é€ ä¾‹å­ï¼Œæ‰€ä»¥æˆ‘ä»Miguel Grinberg 2017å¹´PyConçš„æ¼”è®²ä¸­å–ä¸€ä¸ªä¾‹å­ï¼Œä»–å°†æ‰€æœ‰çš„äº‹æƒ…éƒ½è§£é‡Šå¾—å¾ˆæ¼‚äº®ã€‚\n å›½é™…è±¡æ£‹å¤§å¸ˆæœ±è¿ªç‰¹Â·æ³¢å°”åŠ ï¼ˆJudit PolgÃ¡rï¼‰ä¸¾åŠå›½é™…è±¡æ£‹å±•è§ˆï¼Œå¥¹åœ¨å±•è§ˆä¸­ä¸å¤šä¸ªä¸šä½™ç©å®¶å¯¹æˆ˜ã€‚å¥¹æœ‰ä¸¤ç§è¿›è¡Œå±•è§ˆå¾—æ–¹å¼ï¼šåŒæ­¥å’Œå¼‚æ­¥ã€‚\nå‡è®¾æ¡ä»¶ï¼š\n 24ä½å¯¹æ‰‹ Juditæ¯æ¬¡åœ¨5ç§’å†…è½å­ å¯¹æ‰‹æ¯æ¬¡åœ¨55ç§’å†…è½å­ æ¯å±€æ¸¸æˆå¹³å±€30å¯¹è½å­ï¼ˆä¸€æ–¹ç§»åŠ¨æ£‹å­30æ¬¡ï¼‰  åŒæ­¥ç‰ˆæœ¬ï¼šJuditä¸€æ¬¡åªç©ä¸€å±€ï¼Œç»ä¸åŒæ—¶è¿›è¡Œä¸¤å±€ï¼Œç›´è‡³æ¸¸æˆå®Œæˆã€‚æ¯å±€æ¸¸æˆèŠ±è´¹(55 + 5) * 30 = 1800 ç§’ï¼Œå³30åˆ†é’Ÿã€‚æ•´ä¸ªå±•è§ˆéœ€è¦èŠ±è´¹24 * 30 = 720 åˆ†é’Ÿï¼Œå³12å°æ—¶ã€‚\nå¼‚æ­¥ç‰ˆæœ¬ï¼šæ¯å¼ æ¡Œå­ä»£è¡¨ä¸€å±€æ¸¸æˆï¼ŒJuditåœ¨æ¯å¼ æ¡Œå­ä¸Šè½å­ä¸€æ¬¡ï¼Œç„¶åä»ä¸€å¼ æ¡Œå­ç§»åŠ¨åˆ°å¦ä¸€å¼ ã€‚å¥¹ç¦»å¼€æ¡Œå­å¹¶è®©å¯¹æ‰‹åœ¨ç­‰å¾…çš„æ—¶é—´è¿›è¡Œä¸‹ä¸€æ¬¡è½å­ã€‚åœ¨å…¨éƒ¨24å±€æ¸¸æˆä¸­è½å­1æ¬¡èŠ±è´¹Judit 24 * 5 = 120 ç§’ï¼Œæˆ–2åˆ†é’Ÿã€‚æ€»å…±çš„å±•è§ˆæ—¶é—´ç°åœ¨è¢«ç¼©å‡åˆ°12 * 30 = 3600ç§’ï¼Œå³ä¸€å°æ—¶ã€‚\næ¥æºï¼šhttps://youtu.be/iG6fr81xHKA?t=4m29s\n ã€€ä¸Šè¿°ä¾‹å­ä¸­Juditåªæœ‰ä¸€ä½ï¼Œå¥¹åªæœ‰ä¸¤åªæ‰‹ï¼Œå¹¶ä¸”åŒä¸€æ—¶åˆ»åªèƒ½åœ¨ä¸€å±€æ¸¸æˆä¸Šè½å­ä¸€æ¬¡ã€‚ä½†æ˜¯å¼‚æ­¥å¯¹å±€å°†å±•è§ˆæ—¶é—´ä»12å°æ—¶ç¼©çŸ­è‡³äº†1å°æ—¶ã€‚æ‰€ä»¥ï¼Œåä½œå¼å¤šä»»åŠ¡æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼ï¼Œå³ç¨‹åºçš„äº‹ä»¶å¾ªç¯ï¼ˆç¨åå°†è¯¦ç»†æè¿°ï¼‰å’Œå¤šä»»åŠ¡è¿›è¡Œé€šä¿¡ï¼Œè®©æ¯ä¸ªä»»åŠ¡å¯ä»¥åœ¨æœ€ä¼˜æ—¶é—´è½®æµè¿è¡Œã€‚\nã€€å¼‚æ­¥IOéœ€è¦è¾ƒé•¿çš„ç­‰å¾…æ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´å†…å‡½æ•°å°†è¢«é˜»å¡ï¼Œå¹¶å…è®¸å…¶ä»–åŠŸèƒ½åœ¨åœæœºæœŸé—´è¿è¡Œã€‚ï¼ˆæœ‰æ•ˆé˜»å¡çš„å‡½æ•°ä»å¼€å§‹åˆ°è¿”å›ä¸ºæ­¢ä¸€ç›´ç¦æ­¢å…¶ä»–äººè¿è¡Œï¼‰\nå¼‚æ­¥IOå¹¶ä¸ç®€å• ã€€æˆ‘å¬è¯´ï¼Œâ€œå½“ä½ æœ‰é€‰æ‹©çš„æ—¶å€™ä½¿ç”¨å¼‚æ­¥IOï¼›å½“ä½ å¿…é¡»ä½¿ç”¨çš„æ—¶å€™é€‰æ‹©çº¿ç¨‹ã€‚â€äº‹å®å°±æ˜¯æ„å»ºè€ç”¨çš„å¤šçº¿ç¨‹ä»£ç æ˜¯å›°éš¾ä¸”æ˜“å‡ºé”™çš„ã€‚å¼‚æ­¥IOé¿å…äº†ä¸€äº›åœ¨çº¿ç¨‹è®¾è®¡ä¸­ä¼šé‡åˆ°çš„æ½œåœ¨çš„é€Ÿåº¦é¢ ç°¸ã€‚\nã€€ä½†è¿™å¹¶ä¸æ˜¯è¯´Pythonä¸­çš„å¼‚æ­¥IOå¾ˆç®€å•ã€‚è¯·æ³¨æ„ï¼šå½“ä½ è¯•å›¾è¿›å…¥æ¥å£å±‚ä»¥ä¸‹æ—¶ï¼Œå¼‚æ­¥ç¼–ç¨‹ä¹Ÿä¼šå¾ˆå›°éš¾ï¼Pythonçš„å¼‚æ­¥æ¨¡å‹æ„å»ºåœ¨å›è°ƒï¼ˆcallbacksï¼‰ï¼Œäº‹ä»¶ï¼ˆeventsï¼‰ï¼Œä¼ è¾“ï¼ˆtransportsï¼‰ï¼Œåè®®ï¼ˆprotocolsï¼‰å’ŒæœŸè´§ï¼ˆfuturesï¼‰çš„åŸºç¡€ä¸Šï¼ˆä»…ä»…æ˜¯æœ¯è¯­å°±ä»¤äººå›°æƒ‘ï¼‰ï¼Œå®é™…ä¸Šç”±äºå®ƒæŒç»­å˜åŒ–çš„APIè®©å®ƒæ›´ä¸ç®€å•ã€‚\nã€€å¹¸è¿çš„æ˜¯ï¼Œasyncioå·²ç»åˆ°äº†ä¸€ä¸ªæˆç†Ÿçš„åœ°æ­¥ï¼Œå®ƒçš„å¤§å¤šæ•°åŠŸèƒ½éƒ½ä¸å†æ˜¯ä¸´æ—¶çš„ï¼Œè€Œå®ƒçš„æ–‡æ¡£è¿›è¡Œäº†å¤§å¹…åº¦çš„ä¿®æ”¹ï¼Œä¸€äº›å…³äºå®ƒçš„ä¼˜è´¨èµ„æºä¹Ÿå¼€å§‹å‡ºç°ã€‚\nasyncioåŒ…å’Œasync/await ã€€ç°åœ¨ä½ å·²ç»å¯¹å¼‚æ­¥IOçš„èƒŒæ™¯æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œè®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹Pythonçš„å®ç°ã€‚Pythonçš„asyncioåŒ…ï¼ˆåœ¨Python 3.4ä¸­ä»‹ç»ï¼‰å¹¶ä¸”å®ƒæœ‰ä¸¤ä¸ªå…³é”®è¯ï¼Œasyncå’Œawaitï¼Œå…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬ä¸€èµ·å¸®ä½ å£°æ˜ã€æ„å»ºã€æ‰§è¡Œå¹¶ç®¡ç†å¼‚æ­¥ä»£ç ã€‚\nasync/awaitè¯­æ³•å’ŒåŸç”Ÿåç¨‹ ã€€å‘Šè¯«ï¼šè¯·æ‚¨æ³¨æ„åœ¨äº’è”ç½‘ä¸Šé˜…è¯»çš„å†…å®¹ã€‚Pythonçš„å¼‚æ­¥IO APIä»Python 3.4åˆ° Python3.7è¿…é€Ÿå˜åŒ–ã€‚ä¸€äº›è€çš„æ¨¡å¼ä¸å†ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æ–°çš„æ–‡æ¡£ä¸­æ—§çš„ä¸€äº›å°†è¢«ç¦æ­¢ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™ç¯‡æ•™ç¨‹å¾ˆå¿«ä¹Ÿæˆä¸ºè¿‡æ—¶å¤§å†›çš„ä¸€å‘˜ã€‚\nã€€å¼‚æ­¥IOçš„æ ¸å¿ƒæ˜¯åç¨‹ã€‚åç¨‹æ˜¯Pythonç”Ÿæˆå™¨å‡½æ•°çš„ç‰¹æ®Šç‰ˆæœ¬ã€‚è®©æˆ‘ä»¬ä»åŸºç¡€å®šä¹‰å¼€å§‹ï¼Œç„¶ååœ¨å®ƒçš„åŸºç¡€ä¸Šæ„å»ºä¸€ä¸ªç¨‹åºï¼šåç¨‹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿåœ¨åˆ°è¾¾returnä¹‹å‰æš‚åœå®ƒçš„æ‰§è¡Œï¼Œå¹¶ä¸”å®ƒå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…å°†æ§åˆ¶æƒé—´æ¥ä¼ é€’ç»™å…¶å®ƒåç¨‹ã€‚\nã€€ç¨åï¼Œä½ ä¼šæ›´æ·±å…¥åœ°äº†è§£åˆ°ä¼ ç»Ÿç”Ÿæˆå™¨æ˜¯æ€ä¹ˆé‡æ–°å®šä¹‰ä¸ºåç¨‹çš„ã€‚ä½†ç°åœ¨ï¼Œæœ€ç®€å•çš„äº†è§£åç¨‹å·¥ä½œæ–¹å¼çš„æ–¹æ³•å°±æ˜¯åˆ›å»ºä¸€äº›åç¨‹ã€‚\nã€€è®©æˆ‘ä»¬ç”¨æ²‰æµ¸å¼æ–¹æ³•å¹¶ç¼–å†™ä¸€äº›å¼‚æ­¥IOä»£ç ã€‚è¿™ä¸ªç¨‹åºç›¸å½“äºå¼‚æ­¥IOçš„Hello Worldï¼Œä½†è·ç¦»è¯´æ˜å®ƒçš„æ ¸å¿ƒåŠŸèƒ½è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #!/usr/bin/env python3 # countasync.py import asyncio async def count(): print(\u0026#34;One\u0026#34;) await asyncio.sleep(1) print(\u0026#34;Two\u0026#34;) async def main(): await asyncio.gather(count(), count(), count()) if __name__ == \u0026#34;__main__\u0026#34;: import time s = time.perf_counter() asyncio.run(main()) elapsed = time.perf_counter() - s print(f\u0026#34;{__file__} executed in {elapsed:0.2f} seconds.\u0026#34;)   ã€€å½“ä½ æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œæ³¨æ„å’Œä½ ç”¨defå’Œtime.sleep()å®šä¹‰çš„å‡½æ•°æœ‰å“ªäº›ä¸åŒï¼š\n1 2 3 4 5 6 7 8  $ python3.7 countasync.py One One One Two Two Two countasync.py executed in 1.01 seconds.   ã€€è¾“å‡ºçš„é¡ºåºå°±æ˜¯å¼‚æ­¥IOçš„æ ¸å¿ƒã€‚ä¸count()çš„æ¯ä¸ªè°ƒç”¨è¿›è¡Œäº¤æµçš„æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æˆ–åè°ƒå™¨ã€‚å½“æ¯ä¸ªä»»åŠ¡åˆ°è¾¾await asyncio.sleep(1)ï¼Œå‡½æ•°ä¼šå¤§å–Šé€šçŸ¥äº‹ä»¶å¾ªç¯å¹¶å½’è¿˜æ§åˆ¶æƒç»™å®ƒï¼Œå¹¶è¯´â€œæˆ‘å°†ç¡çœ 1ç§’ï¼Œè¯·è®©å…¶å®ƒæœ‰æ„ä¹‰çš„äº‹æƒ…åœ¨è¿™ä¸ªæ—¶é—´æ®µæ‰§è¡Œã€‚â€\nã€€å°†å®ƒå’ŒåŒæ­¥ç‰ˆæœ¬æ¯”è¾ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #!/usr/bin/env python3 # countsync.py import time def count(): print(\u0026#34;One\u0026#34;) time.sleep(1) print(\u0026#34;Two\u0026#34;) def main(): for _ in range(3): count() if __name__ == \u0026#34;__main__\u0026#34;: s = time.perf_counter() main() elapsed = time.perf_counter() - s print(f\u0026#34;{__file__} executed in {elapsed:0.2f} seconds.\u0026#34;)   ã€€å½“æ‰§è¡Œæ—¶ï¼Œåœ¨æ‰§è¡Œé¡ºåºå’Œæ—¶é—´ä¸Šæœ‰è½»å¾®ä½†å…³é”®çš„ä¸åŒï¼š\n1 2 3 4 5 6 7 8  $ python3.7 countsync.py One Two One Two One Two countsync.py executed in 3.01 seconds.ã€€  ã€€è™½ç„¶ä½¿ç”¨time.sleep()å’Œasyncio.sleep()çœ‹ä¼¼å¹³åº¸ï¼Œä½†å®ƒä»¬å¯ä»¥ç”¨ä½œæ¶‰åŠç­‰å¾…æ—¶é—´çš„æ‰€æœ‰è€—æ—¶çš„è¿‡ç¨‹çš„æ›¿èº«ã€‚ï¼ˆä½ å¯ä»¥è¿›è¡Œç­‰å¾…çš„æœ€å¹³å‡¡çš„äº‹æƒ…å°±æ˜¯è°ƒç”¨sleep()ï¼Œå› ä¸ºå®ƒä»€ä¹ˆéƒ½ä¸åšã€‚ï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œtime.sleep()å¯ä»¥ä»£è¡¨ä»»ä½•è€—æ—¶çš„é˜»å¡å‡½æ•°è°ƒç”¨ï¼Œè€Œasyncio.sleep()å¯ä»¥ç”¨æ¥ä»£è¡¨éé˜»å¡è°ƒç”¨ï¼ˆä½†æ˜¯ä»éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´å»å®Œæˆï¼‰ã€‚\nã€€ä½ åœ¨ä¸‹ä¸€èŠ‚å°†çœ‹åˆ°awaitingä¸€äº›äº‹æƒ…çš„å¥½å¤„ï¼ŒåŒ…æ‹¬asyncio.sleep()ï¼Œå³å‘¨å›´çš„å‡½æ•°å¯ä»¥æš‚æ—¶åœ°å°†æ§åˆ¶æƒäº¤ç»™å…¶ä»–å‡½æ•°ï¼ˆè¿™äº›å‡½æ•°å·²ç»å°±ç»ªï¼Œèƒ½ç«‹å³å¼€å§‹åšæŸäº›äº‹æƒ…ï¼‰ã€‚ç›¸å¯¹åœ°ï¼Œtime.sleep()æˆ–ä»»ä½•å…¶å®ƒé˜»å¡è°ƒç”¨åœ¨Pythonä¸­æ˜¯å’Œå¼‚æ­¥ä»£ç ä¸å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä¼šåœ¨ç¡çœ æœŸé—´åœæ­¢æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»ä½•äº‹æƒ…ã€‚\nå¼‚æ­¥IOçš„è§„åˆ™ ã€€åœ¨è¿™ä¸€æ®µä¸­ï¼Œä¼šä¾æ¬¡ä»‹ç»asyncï¼Œawaitï¼Œå’Œåç¨‹å‡½æ•°çš„æ­£å¼å®šä¹‰ã€‚è¿™ä¸€èŠ‚æœ‰ä¸€ç‚¹æ¯ç‡¥ï¼Œä½†å¯¹äºæŒæ¡async/awaitæ˜¯æœ‰å¸®åŠ©çš„ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯è¯·å›é¡¾è¿™ä¸€èŠ‚ï¼š\n async defçš„è¯­æ³•ä»‹ç»äº†åŸç”Ÿåç¨‹ï¼ˆnative coroutineï¼‰æˆ–è€…å«å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasynchronous generatorï¼‰ã€‚è¡¨è¾¾å¼async withå’Œasync forä¹Ÿæ˜¯åˆæ³•çš„ï¼Œç¨åä½ å°†çœ‹åˆ°å®ƒä»¬ã€‚ å…³é”®å­—awaitå°†å‡½æ•°æ§åˆ¶æƒäº¤è¿˜ç»™äº‹ä»¶å¾ªç¯ï¼ˆå®ƒæš‚åœå½“å‰åç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼‰ã€‚å¦‚æœPythonåœ¨g()èŒƒå›´å†…é‡åˆ°äº†ä¸€ä¸ªawait f()è¡¨è¾¾å¼ï¼Œawaitå°±ä¼šè¿™æ ·å‘Šè¯‰äº‹ä»¶å¾ªç¯ï¼Œâ€œåœæ­¢g()çš„æ‰§è¡Œï¼Œç›´åˆ°æˆ‘ç­‰åˆ°äº†f()çš„æ‰§è¡Œç»“æœï¼Œå³f()è¿”å›ã€‚åœ¨ç­‰å¾…æœŸé—´ï¼Œè¯·è®©å…¶ä»–çš„äº‹æƒ…è¿è¡Œã€‚â€  ã€€ç¬¬äºŒç‚¹ç”¨ä»£ç å¤§æ¦‚åƒä¸‹é¢è¿™æ ·è¡¨ç¤ºï¼š\n1 2 3 4  async def g(): # Pause here and come back to g() when f() is ready r = await f() return r   ã€€å…³äºä½•æ—¶ã€å¦‚ä½•ã€ä»¥åŠä¸èƒ½ä½¿ç”¨async/awaitæœ‰ä¸€å¥—ä¸¥æ ¼çš„è§„åˆ™ï¼Œæ— è®ºä½ åœ¨å­¦ä¹ è¯­æ³•æˆ–å·²ç»æœ‰ä½¿ç”¨async/awaitçš„ç»éªŒï¼Œè¿™äº›éƒ½éå¸¸æœ‰ç”¨ã€‚\n ä½ ç”¨async defå®šä¹‰çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªåç¨‹ã€‚å®ƒå¯èƒ½ä¼šä½¿ç”¨awaitï¼Œreturnï¼Œæˆ–æ˜¯yieldï¼Œè¿™äº›éƒ½æ˜¯å¯é€‰çš„ã€‚å£°æ˜async def noop():passä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼š  ä½¿ç”¨awaitå’Œ/æˆ–returnåˆ›å»ºä¸€ä¸ªåç¨‹å‡½æ•°ã€‚ä¸ºè°ƒç”¨åç¨‹å‡½æ•°ï¼Œä½ å¿…é¡»ä½¿ç”¨awaitæ¥è·å¾—éœ€è¦ç­‰å¾…çš„ç»“æœã€‚ æ¯”è¾ƒå°‘è§çš„æ˜¯åœ¨async defå‡½æ•°ä½“ä¸­ä½¿ç”¨yieldï¼ˆåªæœ‰æœ€è¿‘æ‰åœ¨Pythonä¸­åˆæ³•ï¼‰ã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ï¼Œä½ ä¼šä½¿ç”¨async forè¿­ä»£å®ƒã€‚æš‚æ—¶å¿˜è®°å¼‚æ­¥ç”Ÿæˆå™¨ï¼Œå¹¶ä¸“æ³¨äºè·å–åç¨‹å‡½æ•°çš„è¯­æ³•ï¼Œä½¿ç”¨awaitå’Œ/æˆ–returnã€‚   å°±åƒåœ¨defå‡½æ•°å¤–ä½¿ç”¨yieldæ˜¯ä¸€ä¸ªSyntaxErrorä¸€æ ·ï¼Œåœ¨async defåç¨‹å¤–ä½¿ç”¨awaitä¹Ÿæ˜¯ä¸€ä¸ªSyntaxErrorã€‚ä½ åªèƒ½åœ¨åç¨‹å†…éƒ¨ä½¿ç”¨awaitã€‚  ã€€ä¸‹é¢æ˜¯ä¸€äº›æ€»ç»“ä¸Šé¢å‡ æ¡è§„åˆ™çš„ç®€æ´ç¤ºä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13  async def f(x): y = await z(x) # OK - `await` and `return` allowed in coroutines return y async def g(x): yield x # OK - this is an async generator async def m(x): yield from gen(x) # No - SyntaxError def m(x): y = await z(x) # Still no - SyntaxError (no `async def` here) return y   ã€€æœ€åï¼Œå½“ä½ ä½¿ç”¨await f()æ—¶ï¼Œå®ƒéœ€è¦f()æ˜¯ä¸€ä¸ªå¯ç­‰å¾…çš„å¯¹è±¡ã€‚å¬èµ·æ¥å¥½åƒå¹¶ä¸æ˜¯ååˆ†æœ‰ç”¨ã€‚ä½ ä»…éœ€è¦çŸ¥é“ä¸€ä¸ªå¯ç­‰å¾…å¯¹è±¡æ˜¯ï¼ˆ1ï¼‰å¦ä¸€ä¸ªåç¨‹ï¼Œæˆ–ï¼ˆ2ï¼‰ä¸€ä¸ªå®šä¹‰äº†.__await__()æ–¹æ³•çš„å¯¹è±¡ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¦‚æœä½ ç¼–å†™äº†ä¸€ä¸ªç¨‹åºï¼Œå¯¹äºå¤§å¤šæ•°ç›®çš„æ¥è¯´ï¼Œä½ åº”è¯¥åªéœ€è¦è€ƒè™‘case#1ã€‚\nã€€è¿™å¸¦ç»™æˆ‘ä»¬å¦ä¸€ä¸ªä½ éœ€è¦ç†è§£çš„æŠ€æœ¯ä¸Šçš„åŒºåˆ«ï¼šä»¥å‰æ ‡è¯†ä¸€ä¸ªåç¨‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨è£…é¥°å™¨ï¼Œå³åœ¨æ ‡å‡†defå‡½æ•°å®šä¹‰å‰ç”¨@asyncio.coroutineè£…é¥°ã€‚è¿™ä¸ªå®šä¹‰ç»“æœæ˜¯åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼ˆgenerator-based coroutineï¼‰ã€‚åœ¨Python3.5ä¸­æå‡ºasync/awaitä»¥åï¼Œè¿™ç§ç”¨æ³•å·²ç»è¿‡æ—¶äº†ã€‚\nã€€è¿™ä¸¤ç§åç¨‹åŸºæœ¬ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼ˆéƒ½æ˜¯å¯ç­‰å¾…çš„ï¼‰ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ˜¯åŸºäºç”Ÿæˆå™¨çš„ï¼Œç¬¬äºŒä¸ªæ˜¯åŸç”Ÿåç¨‹ï¼ˆnative coroutineï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10  import asyncio @asyncio.coroutine def py34_coro(): \u0026#34;\u0026#34;\u0026#34;Generator-based coroutine, older syntax\u0026#34;\u0026#34;\u0026#34; yield from stuff() async def py35_coro(): \u0026#34;\u0026#34;\u0026#34;Native coroutine, modern syntax\u0026#34;\u0026#34;\u0026#34; await stuff()   ã€€å¦‚æœä½ è‡ªå·±æ­£åœ¨å†™ä»»ä½•ä»£ç ï¼Œæœ€å¥½ä½¿ç”¨åŸç”Ÿåç¨‹ï¼Œå› ä¸ºæ˜¾å¼æ¯”éšå¼æ›´å¥½ã€‚åŸºäºç”Ÿæˆå™¨çš„åç¨‹å°†åœ¨Python3.10ä¸­è¢«ç§»é™¤ã€‚\nã€€åœ¨æœ¬ç¯‡æ•™ç¨‹çš„ååŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼Œä»…ä»…æ˜¯ç”¨äºè§£é‡Šã€‚å¼•å…¥async/awaitçš„åŸå› æ˜¯ä¸ºäº†ä½¿åç¨‹ç§°ä¸ºPythonçš„ç‹¬ç«‹åŠŸèƒ½ï¼Œä»è€Œå¾ˆå®¹æ˜“åœ°å°†å®ƒå’Œæ™®é€šçš„ç”Ÿæˆå™¨å‡½æ•°åŒºåˆ†å¼€ï¼Œä»è€Œå‡å°‘äº†æ­§ä¹‰ã€‚\nã€€ä¸è¦åœ¨åŸºäºç”Ÿæˆå™¨çš„åç¨‹ä¸Šè¶Šé™·è¶Šæ·±ï¼Œä»–å·²ç»è¢«async/awaitæ·˜æ±°äº†ã€‚å®ƒä»¬æœ‰å®ƒä»¬è‡ªå·±çš„ä¸€ç»„å°è§„åˆ™ï¼ˆä¾‹å¦‚ï¼Œawaitä¸èƒ½è¢«ä½¿ç”¨åœ¨åŸºäºåç¨‹çš„ç”Ÿæˆå™¨ä¸­ï¼‰ï¼Œå¦‚æœæ‚¨åšæŒä½¿ç”¨async/awaitè¯­æ³•ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å’Œå®ƒä»¬æ— å…³çš„ã€‚\nã€€äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬ä¸¾æ›´å¤šçš„ä¾‹å­ã€‚\nã€€è¿™æœ‰ä¸€ä¸ªå¼‚æ­¥IOæ˜¯æ€æ ·ç¼©å‡ç­‰å¾…æ—¶é—´çš„ä¾‹å­ï¼šç»™å®šä¸€ä¸ªåç¨‹makerandom()ï¼Œå®ƒæŒç»­ç”Ÿäº§èŒƒå›´ä¸ºï¼ˆ0ï¼Œ10ï¼‰çš„éšæœºæ•°ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼ä¸ºæ­¢ï¼Œä½ è¦è®©æ­¤åç¨‹çš„å¤šä¸ªè°ƒç”¨ä¸éœ€è¦å½¼æ­¤ç­‰å¾…ä¾æ¬¡å®Œæˆã€‚ä½ å¯ä»¥å¤§éƒ¨åˆ†éµå¾ªä¸Šè¿°ä¸¤ç§è„šæœ¬æ¨¡å¼ï¼Œå¹¶è¿›è¡Œä¸€äº›æ›´æ”¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  #!/usr/bin/env python3 # rand.py import asyncio import random # ANSI colors c = ( \u0026#34;\\033[0m\u0026#34;, # End of color \u0026#34;\\033[36m\u0026#34;, # Cyan \u0026#34;\\033[91m\u0026#34;, # Red \u0026#34;\\033[35m\u0026#34;, # Magenta ) async def makerandom(idx: int, threshold: int = 6) -\u0026gt; int: print(c[idx + 1] + f\u0026#34;Initiated makerandom({idx}).\u0026#34;) i = random.randint(0, 10) while i \u0026lt;= threshold: print(c[idx + 1] + f\u0026#34;makerandom({idx}) == {i} too low; retrying.\u0026#34;) await asyncio.sleep(idx + 1) i = random.randint(0, 10) print(c[idx + 1] + f\u0026#34;---\u0026gt; Finished: makerandom({idx}) == {i}\u0026#34; + c[0]) return i async def main(): #*args,å°†å‚æ•°æ‰“åŒ…ä¸ºä¸€ä¸ªå…ƒç»„ res = await asyncio.gather(*(makerandom(i, 10 - i - 1) for i in range(3))) return res if __name__ == \u0026#34;__main__\u0026#34;: random.seed(444) r1, r2, r3 = asyncio.run(main()) print() print(f\u0026#34;r1: {r1}, r2: {r2}, r3: {r3}\u0026#34;)   ã€€å½©è‰²è¾“å‡ºçš„å†…å®¹æ¯”æˆ‘è¯´çš„è¦å¤šå¾—å¤šï¼Œä½¿ä½ å¯¹å¦‚ä½•æ‰§è¡Œæ­¤è„šæœ¬æœ‰ä¸€å®šçš„äº†è§£ã€‚\nå›¾2 rand.pyè¿è¡Œç»“æœ:\r\r ã€€ç¨‹åºä½¿ç”¨ä¸€ä¸ªä¸»åç¨‹ï¼Œmakerandom()ï¼Œå¹¶ä»¥ä¸‰ç§ä¸åŒçš„è¾“å…¥åŒæ—¶è¿è¡Œå®ƒã€‚å¤§å¤šæ•°ç¨‹åºä¼šåŒ…å«å°å‹æ¨¡å—åŒ–åç¨‹å’Œä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œè¯¥åŒ…è£…å‡½æ•°èƒ½å¤ŸæŠŠæ¯ä¸ªå°åç¨‹é“¾åœ¨ä¸€èµ·ã€‚main()é€šè¿‡æŠŠä¸­å¿ƒåç¨‹æ˜ å°„åˆ°ä¸€äº›è¿­ä»£å™¨æˆ–æ± ä¸­æ¥æ”¶é›†ä»»åŠ¡ï¼ˆfuturesï¼‰ã€‚\nã€€åœ¨è¿™ä¸ªå¾®å‹ç¤ºä¾‹ä¸­ï¼Œæ± æ˜¯range(3)ã€‚ç¨åæˆ‘ä»¬ä¼šå±•ç¤ºä¸€ä¸ªæ›´å®Œæ•´çš„ç¤ºä¾‹ï¼Œå®ƒéœ€è¦å¹¶å‘å¤„ç†è¯·æ±‚ã€è§£æä¸€ç»„URLï¼Œå¹¶ä¸”main()ä¸ºæ¯ä¸ªURLå°è£…äº†æ•´ä¸ªä¾‹ç¨‹ã€‚\nã€€å°½ç®¡â€œç”Ÿäº§éšæœºæ•°ï¼ˆä¸»è¦å—é™äºCPUï¼‰â€ä½¿ç”¨asyncioä¸æ˜¯ä¸€ä¸ªæœ€ä½³é€‰æ‹©ï¼Œè¯¥ç¤ºä¾‹ä¸­å­˜åœ¨asyncio.sleep()çš„ç›®çš„æ˜¯æ¨¡ä»¿ä¸€ä¸ªIOå—é™è¿›ç¨‹ï¼Œå…¶ä¸­æ¶‰åŠä¸ç¡®å®šçš„ç­‰å¾…æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œasyncio.sleep()è°ƒç”¨å¯èƒ½ä»£è¡¨æ¶ˆæ¯åº”ç”¨ä¸­å‘é€å’Œæ¥æ”¶ä¸¤ä¸ªå®¢æˆ·ç«¯ä¹‹é—´çš„ééšæœºæ•´æ•°ã€‚\nå¼‚æ­¥IOè®¾è®¡æ¨¡å¼ ã€€å¼‚æ­¥IOæœ‰å®ƒè‡ªå·±çš„ä¸€ç»„è„šæœ¬è®¾è®¡ï¼Œå°†åœ¨è¿™ä¸€èŠ‚ä¸ºä½ ä»‹ç»ã€‚\né“¾å¼åç¨‹ ã€€åç¨‹çš„å…³é”®åŠŸèƒ½æ˜¯å®ƒä»¬èƒ½å¤Ÿè¢«é“¾æ¥åœ¨ä¸€èµ·ã€‚ï¼ˆè®°ä½ï¼Œåç¨‹å¯¹è±¡æ˜¯å¯ç­‰å¾…çš„ï¼Œæ‰€ä»¥å¦ä¸€ä¸ªåç¨‹å¯ä»¥awaitå®ƒã€‚ï¼‰è¿™è®©ä½ èƒ½å¤Ÿå°†ç¨‹åºåˆ†å‰²æˆæ›´å°çš„ã€å¯ç®¡ç†çš„ã€æ˜“äºå›æ”¶çš„åç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44  #!/usr/bin/env python3 # chained.py import asyncio import random import time \u0026#39;\u0026#39;\u0026#39; n:intï¼Œnæ˜¯ä¼ å…¥å‚æ•°ï¼Œintæ˜¯æ³¨é‡Šï¼Œæ³¨é‡Šå‚æ•°nåº”è¯¥æ˜¯ä¸€ä¸ªæ•´å‹ï¼Œä½†ä¼ å…¥çš„nä¸æ˜¯æ•´å‹ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œ -\u0026gt;strï¼Œæ˜¯è¿”å›å€¼çš„æ³¨é‡Šï¼Œè¡¨ç¤ºè¿”å›å€¼æ˜¯å­—ç¬¦ä¸² \u0026#39;\u0026#39;\u0026#39; async def part1(n: int) -\u0026gt; str: i = random.randint(0, 10) #ä»¥få¼€å¤´è¡¨ç¤ºåœ¨å­—ç¬¦ä¸²å†…æ”¯æŒå¤§æ‹¬å·å†…çš„pythonè¡¨è¾¾å¼ print(f\u0026#34;part1({n}) sleeping for {i} seconds.\u0026#34;) await asyncio.sleep(i) result = f\u0026#34;result{n}-1\u0026#34; print(f\u0026#34;Returning part1({n}) == {result}.\u0026#34;) return result async def part2(n: int, arg: str) -\u0026gt; str: i = random.randint(0, 10) print(f\u0026#34;part2{n, arg} sleeping for {i} seconds.\u0026#34;) await asyncio.sleep(i) result = f\u0026#34;result{n}-2 derived from {arg}\u0026#34; print(f\u0026#34;Returning part2{n, arg} == {result}.\u0026#34;) return result async def chain(n: int) -\u0026gt; None: start = time.perf_counter() p1 = await part1(n) p2 = await part2(n, p1) end = time.perf_counter() - start print(f\u0026#34;--\u0026gt;Chained result{n} =\u0026gt; {p2} (took {end:0.2f} seconds).\u0026#34;) async def main(*args): await asyncio.gather(*(chain(n) for n in args)) if __name__ == \u0026#34;__main__\u0026#34;: import sys random.seed(444) args = [1, 2, 3] if len(sys.argv) == 1 else map(int, sys.argv[1:]) start = time.perf_counter() asyncio.run(main(*args)) end = time.perf_counter() - start print(f\u0026#34;Program finished in {end:0.2f} seconds.\u0026#34;)   ã€€æ³¨æ„è¾“å‡ºï¼Œpart1()ç¡çœ å¯å˜æ—¶é—´ï¼Œå¹¶ä¸”part2()å¼€å§‹å¤„ç†å¯ç”¨çš„ç»“æœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  $ python3.7 chained.py 9 6 3 part1(9) sleeping for 4 seconds. part1(6) sleeping for 4 seconds. part1(3) sleeping for 0 seconds. Returning part1(3) == result3-1. part2(3, \u0026#39;result3-1\u0026#39;) sleeping for 4 seconds. Returning part1(9) == result9-1. part2(9, \u0026#39;result9-1\u0026#39;) sleeping for 7 seconds. Returning part1(6) == result6-1. part2(6, \u0026#39;result6-1\u0026#39;) sleeping for 4 seconds. Returning part2(3, \u0026#39;result3-1\u0026#39;) == result3-2 derived from result3-1. --\u0026gt;Chained result3 =\u0026gt; result3-2 derived from result3-1 (took 4.00 seconds). Returning part2(6, \u0026#39;result6-1\u0026#39;) == result6-2 derived from result6-1. --\u0026gt;Chained result6 =\u0026gt; result6-2 derived from result6-1 (took 8.01 seconds). Returning part2(9, \u0026#39;result9-1\u0026#39;) == result9-2 derived from result9-1. --\u0026gt;Chained result9 =\u0026gt; result9-2 derived from result9-1 (took 11.01 seconds). Program finished in 11.01 seconds.   ã€€åœ¨è¿™ä¸ªè®¾ç½®ä¸­ï¼Œmain()çš„è¿è¡Œæ—¶é—´å’Œå®ƒæ”¶é›†åœ¨ä¸€èµ·å¹¶è°ƒåº¦çš„è¿è¡Œæ—¶é—´æœ€é•¿çš„ä»»åŠ¡ç›¸åŒã€‚\nä½¿ç”¨é˜Ÿåˆ— ã€€asyncioåŒ…æä¾›é˜Ÿåˆ—ç±»ï¼Œè¯¥ç±»çš„æ¶‰åŠå’Œqueueæ¨¡å—ä¸­çš„ç±»å¾ˆç›¸ä¼¼ã€‚åœ¨æˆ‘ä»¬ç›®å‰çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦é˜Ÿåˆ—ç»“æ„ã€‚åœ¨chained.pyä¸­ï¼Œæ¯ä¸ªä»»åŠ¡ï¼ˆfutureï¼‰éƒ½æœ‰ä¸€ç»„åç¨‹ç»„æˆï¼Œæ¯ä¸ªåç¨‹éƒ½åœ¨å½¼æ­¤ç­‰å¾…ï¼Œå¹¶ä¸”æ¯æ¡é“¾ä¼ é€’ä¸€ä¸ªå•ç‹¬çš„è¾“å…¥ã€‚\nã€€æœ‰ä¸€ä¸ªèƒ½å¤Ÿå’Œå¼‚æ­¥IOå…±åŒå·¥ä½œçš„å¯é€‰ç»“æ„ï¼šæœ‰ä¸€å®šæ•°é‡çš„ç”Ÿäº§è€…ï¼ˆå®ƒä»¬å½¼æ­¤ä¹‹é—´æ²¡æœ‰è”ç³»ï¼‰ï¼Œå‘ä¸€ä¸ªé˜Ÿåˆ—é‡Œæ·»åŠ äº‹é¡¹ã€‚æ¯ä¸ªç”Ÿäº§è€…åœ¨äº¤é”™ã€éšæœºã€æœªé€šçŸ¥çš„æ—¶é—´é‡Œå¯èƒ½å‘é˜Ÿåˆ—é‡Œæ·»åŠ å¤šä¸ªäº‹é¡¹ã€‚ä¸€ç»„æ¶ˆè´¹è€…åœ¨å®ƒä»¬å‡ºç°æ—¶è´ªå©ªåœ°ä»é˜Ÿåˆ—ä¸­æ‹‰å–äº‹é¡¹ï¼Œæ— éœ€ç­‰å¾…ä»»ä½•ä¿¡å·ã€‚\nã€€åœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å•ä¸ªæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ä¹‹é—´çš„é“¾ã€‚æ¶ˆè´¹è€…ä¸çŸ¥é“ç”Ÿäº§è€…çš„æ•°é‡ï¼Œç”šè‡³ä¹Ÿä¸ä¼šæå‰çŸ¥é“æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„äº‹é¡¹çš„ç´¯ç§¯æ•°é‡ã€‚\nã€€æ¯ä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…èŠ±è´¹å¯å˜çš„æ—¶é—´åˆ†åˆ«ä»é˜Ÿåˆ—ä¸­æ”¾å…¥å’Œæå–äº‹é¡¹ã€‚é˜Ÿåˆ—ä½œä¸ºååé‡ï¼Œå¯ä»¥è®©ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´é€šä¿¡è€Œæ— éœ€ä»–ä»¬å½¼æ­¤ä¹‹é—´ç›´æ¥äº¤æµã€‚\n\r\rå°½ç®¡ç”±äºqueue.Queue()çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œé˜Ÿåˆ—é€šå¸¸åœ¨çº¿ç¨‹ç¨‹åºä¸­ä½¿ç”¨ï¼Œä½†å½“æ¶‰åŠå¼‚æ­¥IOæ—¶ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨ã€‚ï¼ˆé™¤äº†ä½ è¯•å›¾ç»“åˆè¿™ä¸¤è€…æ—¶ï¼Œä½†åœ¨æ­¤ç¯‡æ•™ç¨‹ä¸­å¹¶æœªå®ç°ã€‚ï¼‰\n\r \rã€€ä¸€ç§é˜Ÿåˆ—çš„ä½¿ç”¨æƒ…å½¢ï¼ˆå¦‚æ­¤å¤„çš„æƒ…å†µï¼‰æ˜¯é˜Ÿåˆ—ä½œä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„ä¼ è¾“è€…ï¼ˆtransmitterï¼‰ï¼Œè€Œä¸æ˜¯å°†ä»–ä»¬å½¼æ­¤ç›¸è”ç³»æˆ–ç›´æ¥é“¾æ¥èµ·æ¥ã€‚\nã€€è¿™ä¸ªç¨‹åºçš„åŒæ­¥ç‰ˆæœ¬çœ‹èµ·æ¥ç›¸å½“æƒ¨æ·¡ï¼šä¸€ç»„é˜»å¡ç”Ÿäº§è€…ä¸²è¡Œå°†äº‹é¡¹æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œä¸€æ¬¡è¿è¡Œä¸€ä¸ªç”Ÿäº§è€…ã€‚åªæœ‰æ‰€æœ‰çš„ç”Ÿäº§è€…éƒ½å®Œæˆç”Ÿäº§ï¼Œä¸€æ¬¡æ‰èƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…é€é¡¹å¤„ç†é˜Ÿåˆ—ã€‚è¿™ä¸ªè®¾è®¡ä¸­æœ‰è¿‡å¤šçš„å»¶è¿Ÿã€‚äº‹é¡¹å¯èƒ½é—²ç½®åœ°æ”¾ç½®åœ¨é˜Ÿåˆ—ä¸­ï¼Œè€³ä¸æ˜¯ç«‹å³æ‹¿èµ·å¹¶å¤„ç†ã€‚\nã€€ä¸€ä¸ªå¼‚æ­¥ç‰ˆæœ¬ï¼Œasyncq.pyï¼Œå†™åœ¨ä¸‹é¢ã€‚è¿™é¡¹å·¥ä½œçš„æŒ‘æˆ˜éƒ¨åˆ†æ˜¯éœ€è¦ç»™æ¶ˆè´¹è€…ä¸€ä¸ªç”Ÿäº§è€…å·²ç»å®Œæˆç”Ÿäº§çš„ä¿¡å·ã€‚å¦åˆ™await q.get()ä¼šæ— é™æœŸçš„æŒ‚èµ·ï¼Œå› ä¸ºé˜Ÿåˆ—å·²ç»è¢«å……åˆ†å¤„ç†ï¼Œä½†æ˜¯æ¶ˆè´¹è€…å®Œå…¨ä¸çŸ¥é“ç”Ÿäº§å·²ç»å®Œæˆã€‚\nã€€ï¼ˆç‰¹åˆ«æ„Ÿè°¢æ¥è‡ªStackOverflowç”¨æˆ·åœ¨ç†æ¸…main()ä¸Šçš„å¸®åŠ©ï¼šå…³é”®æ˜¯await q.join()ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰äº‹é¡¹éƒ½è¢«æ¥æ”¶å’Œå¤„ç†ä¹‹å‰éƒ½ä¼šé˜»å¡ï¼Œç„¶åå–æ¶ˆæ¶ˆè´¹è€…ä»»åŠ¡ï¼Œå¦åˆ™å®ƒä¼šæŒ‚èµ·å¹¶æ— é™ç­‰å¾…é¢å¤–çš„é˜Ÿåˆ—äº‹é¡¹å‡ºç°ã€‚ï¼‰\nã€€ä¸‹é¢æ˜¯å®Œæ•´çš„è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56  #!/usr/bin/env python3 # asyncq.py import asyncio import itertools as it import os import random import time async def makeitem(size: int = 5) -\u0026gt; str: return os.urandom(size).hex() async def randsleep(a: int = 1, b: int = 5, caller=None) -\u0026gt; None: i = random.randint(0, 10) if caller: print(f\u0026#34;{caller} sleeping for {i} seconds.\u0026#34;) await asyncio.sleep(i) async def produce(name: int, q: asyncio.Queue) -\u0026gt; None: n = random.randint(0, 10) for _ in it.repeat(None, n): # Synchronous loop for each single producer await randsleep(caller=f\u0026#34;Producer {name}\u0026#34;) i = await makeitem() t = time.perf_counter() await q.put((i, t)) print(f\u0026#34;Producer {name} added \u0026lt;{i}\u0026gt; to queue.\u0026#34;) async def consume(name: int, q: asyncio.Queue) -\u0026gt; None: while True: await randsleep(caller=f\u0026#34;Consumer {name}\u0026#34;) i, t = await q.get() now = time.perf_counter() print(f\u0026#34;Consumer {name} got element \u0026lt;{i}\u0026gt;\u0026#34; f\u0026#34; in {now-t:0.5f} seconds.\u0026#34;) q.task_done() async def main(nprod: int, ncon: int): q = asyncio.Queue() producers = [asyncio.create_task(produce(n, q)) for n in range(nprod)] consumers = [asyncio.create_task(consume(n, q)) for n in range(ncon)] await asyncio.gather(*producers) await q.join() # Implicitly awaits consumers, too for c in consumers: c.cancel() if __name__ == \u0026#34;__main__\u0026#34;: import argparse random.seed(444) parser = argparse.ArgumentParser() parser.add_argument(\u0026#34;-p\u0026#34;, \u0026#34;--nprod\u0026#34;, type=int, default=5) parser.add_argument(\u0026#34;-c\u0026#34;, \u0026#34;--ncon\u0026#34;, type=int, default=10) ns = parser.parse_args() start = time.perf_counter() asyncio.run(main(**ns.__dict__)) elapsed = time.perf_counter() - start print(f\u0026#34;Program completed in {elapsed:0.5f} seconds.\u0026#34;)   ã€€å‰å‡ ä¸ªåç¨‹æ˜¯è¾…åŠ©å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåˆ†ç§’æ€§èƒ½è®¡æ•°å™¨å’Œä¸€ä¸ªéšæœºæ•´æ•°ã€‚ç”Ÿäº§è€…å‘é˜Ÿåˆ—ä¸­ä»1æ”¾åˆ°5ä¸ªäº‹é¡¹ã€‚æ¯ä¸ªäº‹é¡¹æ˜¯(i,t)å…ƒç»„ï¼Œiæ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œtæ˜¯ç”Ÿäº§è€…è¯•å›¾å°†å…ƒç»„æ”¾å…¥é˜Ÿåˆ—çš„æ—¶é—´ã€‚\nã€€å½“æ¶ˆè´¹è€…æ‹‰å–ä¸€ä¸ªäº‹é¡¹æ—¶ï¼Œå®ƒä»…ä½¿ç”¨äº‹é¡¹æ”¾å…¥é˜Ÿåˆ—æ—¶çš„æ—¶é—´æˆ³è®¡ç®—äº‹é¡¹æ”¾å…¥é˜Ÿåˆ—ä¸­å­˜åœ¨çš„æ—¶é—´ã€‚\nã€€è®°ä½asyncio.sleep()ç”¨æ¥æ¨¡ä»¿å…¶å®ƒæ›´å¤æ‚çš„åç¨‹ï¼Œå¦‚æœè¿™æ˜¯å¸¸è§„çš„é˜»å¡å‡½æ•°ï¼Œä¼šæ¶ˆè€—æ—¶é—´å¹¶é˜»å¡å…¶ä»–æ‰€æœ‰çš„æ‰§è¡Œã€‚\nã€€è¿™æ˜¯ç”¨ä¸¤ä¸ªç”Ÿäº§è€…å’Œäº”ä¸ªæ¶ˆè´¹è€…çš„æµ‹è¯•ç»“æœï¼šï¼ˆæˆ‘å®é™…è¿è¡Œçš„æ—¶å€™å‘ç°æ²¡æœ‰Producer 1ï¼Œå¤ªå¥‡æ€ªäº†ï¼Œæœ‰ç”Ÿäº§è€…1ï¼Œç”Ÿäº§è€…2ï¼Œç”Ÿäº§è€…3ï¼Œå°±æ˜¯æ²¡æœ‰1ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  $ python3.7 asyncq.py -p 2 -c 5 Producer 0 sleeping for 3 seconds. Producer 1 sleeping for 3 seconds. Consumer 0 sleeping for 4 seconds. Consumer 1 sleeping for 3 seconds. Consumer 2 sleeping for 3 seconds. Consumer 3 sleeping for 5 seconds. Consumer 4 sleeping for 4 seconds. Producer 0 added \u0026lt;377b1e8f82\u0026gt; to queue. Producer 0 sleeping for 5 seconds. Producer 1 added \u0026lt;413b8802f8\u0026gt; to queue. Consumer 1 got element \u0026lt;377b1e8f82\u0026gt; in 0.00013 seconds. Consumer 1 sleeping for 3 seconds. Consumer 2 got element \u0026lt;413b8802f8\u0026gt; in 0.00009 seconds. Consumer 2 sleeping for 4 seconds. Producer 0 added \u0026lt;06c055b3ab\u0026gt; to queue. Producer 0 sleeping for 1 seconds. Consumer 0 got element \u0026lt;06c055b3ab\u0026gt; in 0.00021 seconds. Consumer 0 sleeping for 4 seconds. Producer 0 added \u0026lt;17a8613276\u0026gt; to queue. Consumer 4 got element \u0026lt;17a8613276\u0026gt; in 0.00022 seconds. Consumer 4 sleeping for 5 seconds. Program completed in 9.00954 seconds.   ã€€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹é¡¹åœ¨å‡ ç§’é’Ÿå°±è¢«å¤„ç†å®Œæ¯•ã€‚å»¶è¿Ÿå¯èƒ½æœ‰ä¸¤ç‚¹åŸå› ï¼š\n æ ‡å‡†çš„ã€å¾ˆå¤§ç¨‹åº¦ä¸Šä¸å¯é¿å…çš„å¼€é”€ å½“é˜Ÿåˆ—ä¸­å‡ºç°ä¸€é¡¹æ—¶ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½åœ¨ç¡çœ çš„æƒ…å†µ  ã€€å…³äºç¬¬äºŒä¸ªç†ç”±ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæ‰©å±•åˆ°æˆç™¾ä¸Šåƒä¸ªæ¶ˆè´¹è€…æ˜¯å®Œå…¨æ­£å¸¸çš„ã€‚åœ¨æ‰§è¡Œpython3.7 asyncq.py -p 5 -c 100æ—¶åº”è¯¥ä¸ä¼šå‡ºç°é—®é¢˜ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç†è®ºä¸Šï¼Œä½ åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šä¼šæœ‰ä¸åŒçš„ç”¨æˆ·æ§åˆ¶æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„ç®¡ç†ï¼Œé˜Ÿåˆ—ä½œä¸ºä¸­å¤®ååé‡ã€‚\nã€€åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»é™·å…¥å›°å¢ƒï¼Œå¹¶çœ‹åˆ°äº†ä¸‰ä¸ªç›¸å…³çš„asyncioè°ƒç”¨asyncå’Œawaitåç¨‹çš„ç¤ºä¾‹ã€‚å¦‚æœä½ æ²¡æœ‰å®Œå…¨è·Ÿä¸Šæˆ–è€…ä»…ä»…æƒ³åŠ æ·±ä¸€ä¸‹Pythonä¸­ç°ä»£åç¨‹æœºåˆ¶çš„äº†è§£ï¼Œä½ å¯ä»¥ä»ä¸‹ä¸€ç« é‡æ–°å¼€å§‹ã€‚\nå¼‚æ­¥IOåœ¨ç”Ÿæˆå™¨ä¸­çš„æ ¹ ã€€å…ˆå‰ä½ å·²ç»çœ‹åˆ°äº†æ—§é£æ ¼çš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼Œå·²ç»è¢«æ›´æ˜¾å¼çš„åŸç”Ÿåç¨‹æ·˜æ±°ã€‚è¯¥ç¤ºä¾‹å€¼å¾—ç¨ä½œè°ƒæ•´é‡æ–°å±•ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  import asyncio @asyncio.coroutine def py34_coro(): \u0026#34;\u0026#34;\u0026#34;Generator-based coroutine\u0026#34;\u0026#34;\u0026#34; # No need to build these yourself, but be aware of what they are s = yield from stuff() return s async def py35_coro(): \u0026#34;\u0026#34;\u0026#34;Native coroutine, modern syntax\u0026#34;\u0026#34;\u0026#34; s = await stuff() return s async def stuff(): return 0x10, 0x20, 0x30   ã€€ä½œä¸ºå®éªŒï¼Œæ²¡æœ‰awaitï¼Œæˆ–æ²¡æœ‰ä»»ä½•å¯¹asyncio.run()çš„è°ƒç”¨ï¼Œæˆ–å…¶ä»–asyncioæœ‰å…³çš„å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå•ç‹¬è°ƒç”¨py34_coro()æˆ–py35_coro()ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç‹¬ç«‹è°ƒç”¨ä¸€ä¸ªåç¨‹ä¼šè¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼š\n1 2  \u0026gt;\u0026gt;\u0026gt; py35_coro() \u0026lt;coroutine object py35_coro at 0x10126dcc8\u0026gt;   ã€€è¡¨é¢ä¸Šè¿™ä¸æ˜¯ååˆ†æœ‰è¶£ï¼Œè°ƒç”¨ä¸€ä¸ªåç¨‹çš„ç»“æœæ˜¯ä¸€ä¸ªå¯ç­‰å¾…çš„åç¨‹å¯¹è±¡ï¼ˆcoroutine objectï¼‰ã€‚\nã€€æé—®æ—¶é—´ï¼šPythonçš„å…¶ä»–åŠŸèƒ½æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿï¼ˆå•ç‹¬è°ƒç”¨Pythonçš„å“ªä¸ªåŠŸèƒ½å®é™…ä¸Šå¹¶æ²¡æœ‰åšä»€ä¹ˆï¼Ÿï¼‰\nã€€è¿™ä¸ªé—®é¢˜çš„å…¶ä¸­ä¸€ä¸ªç­”æ¡ˆæ˜¯ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ï¼Œå› ä¸ºåç¨‹æ˜¯å¼•æ“å¼ºåŒ–ç‰ˆçš„ç”Ÿæˆå™¨ã€‚åœ¨è¿™æ–¹é¢å®ƒçš„è¡Œä¸ºæ˜¯ç›¸ä¼¼çš„ï¼š\n1 2 3 4 5 6 7 8  \u0026gt;\u0026gt;\u0026gt; def gen(): ... yield 0x10, 0x20, 0x30 ... \u0026gt;\u0026gt;\u0026gt; g = gen() \u0026gt;\u0026gt;\u0026gt; g # Nothing much happens - need to iterate with `.__next__()` \u0026lt;generator object gen at 0x1012705e8\u0026gt; \u0026gt;\u0026gt;\u0026gt; next(g) (16, 32, 48)   ã€€ç”Ÿæˆå™¨å‡½æ•°ï¼Œæ­£å¦‚å®ƒå‘ç”Ÿçš„é‚£æ ·ï¼Œæ˜¯å¼‚æ­¥IOçš„åŸºç¡€ï¼ˆä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨async defå£°æ˜åç¨‹è¿˜æ˜¯ä½¿ç”¨æ—§ç‰ˆæœ¬çš„@asyncio.coroutineè£…é¥°å™¨ï¼‰ã€‚æŠ€æœ¯ä¸Šï¼Œawaitå’Œyield fromæ¯”yieldæ›´ç›¸ä¼¼ã€‚ï¼ˆä½†æ˜¯è¯·è®°ä½ï¼Œyield from x()ä»…æ˜¯åœ¨æ›¿ä»£for i in x():yield i çš„è¯­æ³•ç³–ã€‚ï¼‰\nã€€å’Œå¼‚æ­¥IOæœ‰å…³çš„ç”Ÿæˆå™¨çš„ä¸€ä¸ªå…³é”®ç‰¹ç‚¹æ˜¯å®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°æŒ‰æ„æ„¿åœæ­¢å’Œé‡å¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥breakæ­£åœ¨è¿­ä»£çš„ç”Ÿæˆå™¨å¯¹è±¡ï¼Œç„¶åç¨åæ¢å¤å¯¹å‰©ä½™å€¼å¾—è¿­ä»£ã€‚å½“ç”Ÿæˆå™¨å‡½æ•°åˆ°è¾¾yieldï¼Œå®ƒä¼šç”Ÿæˆè¯¥å€¼ï¼Œéšåå¤„äºç©ºé—²çŠ¶æ€ï¼Œç›´è‡³è¢«å‘ŠçŸ¥è¦ç”Ÿæˆåç»­å€¼ã€‚\nã€€å¯ä»¥é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å…·ä½“è¯´æ˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  \u0026gt;\u0026gt;\u0026gt; from itertools import cycle \u0026gt;\u0026gt;\u0026gt; def endless(): ... \u0026#34;\u0026#34;\u0026#34;Yields 9, 8, 7, 6, 9, 8, 7, 6, ... forever\u0026#34;\u0026#34;\u0026#34; ... yield from cycle((9, 8, 7, 6)) \u0026gt;\u0026gt;\u0026gt; e = endless() \u0026gt;\u0026gt;\u0026gt; total = 0 \u0026gt;\u0026gt;\u0026gt; for i in e: ... if total \u0026lt; 30: ... print(i, end=\u0026#34; \u0026#34;) ... total += i ... else: ... print() ... # Pause execution. We can resume later. ... break 9 8 7 6 9 8 7 6 9 8 7 6 9 8 \u0026gt;\u0026gt;\u0026gt; # Resume \u0026gt;\u0026gt;\u0026gt; next(e), next(e), next(e) (6, 9, 8)   ã€€awaitå…³é”®å­—è¡¨ç°ç›¸ä¼¼ï¼Œæ ‡è®°ä¸€ä¸ªæ–­ç‚¹ï¼Œåç¨‹ä¼šæš‚åœç„¶åè®©å…¶å®ƒåç¨‹å·¥ä½œã€‚â€œæš‚åœâ€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯è¯´åç¨‹æš‚æ—¶äº¤å‡ºäº†æ§åˆ¶æƒï¼Œä½†æ²¡æœ‰å®Œå…¨é€€å‡ºæˆ–å®Œæˆã€‚è¯·è®°ä½yieldï¼Œå’Œå®ƒçš„æ‰©å±•yield fromå’Œawaitï¼Œç›¸å½“äºåœ¨ç”Ÿæˆå™¨æ‰§è¡Œæ—¶æ ‡è®°æ–­ç‚¹ã€‚\nã€€è¿™æ˜¯å‡½æ•°å’Œç”Ÿæˆå™¨ä¹‹é—´çš„åŸºæœ¬ä¸åŒã€‚å‡½æ•°æ˜¯å…¨åšæˆ–ä¸åšã€‚ä¸€æ—¦å®ƒå¯åŠ¨ï¼Œå®ƒåœ¨é‡åˆ°returnä¹‹å‰ä¸ä¼šåœæ­¢ï¼Œç„¶åå°†å€¼è¿”å›ç»™è°ƒç”¨è€…ï¼ˆè°ƒç”¨å®ƒçš„å‡½æ•°ï¼‰ã€‚ç”Ÿæˆå™¨ï¼Œåœ¨æ¯æ¬¡é‡åˆ°yieldçš„æ—¶å€™æš‚åœï¼Œä¸å†ç»§ç»­è¿è¡Œã€‚å®ƒä¸ä»…å¯ä»¥å°†å€¼å‹å…¥è°ƒç”¨æ ˆï¼Œè¿˜èƒ½é€šè¿‡è°ƒç”¨next()æ¢å¤å®ƒæ—¶ä¿ç•™å®ƒçš„å±€éƒ¨å˜é‡ã€‚\nã€€è¿˜æœ‰ç¬¬äºŒä¸ªé²œä¸ºäººçŸ¥ä½†åŒæ ·é‡è¦çš„ç”Ÿæˆå™¨ç‰¹ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡.send()æ–¹æ³•å‘é€ä¸€ä¸ªå€¼åˆ°ç”Ÿæˆå™¨ã€‚è¿™å…è®¸ç”Ÿæˆå™¨ï¼ˆå’Œåç¨‹ï¼‰è°ƒç”¨ï¼ˆawaitï¼‰å½¼æ­¤è€Œæ— éœ€é˜»å¡ã€‚æˆ‘ä¸ä¼šæ›´æ·±çš„ä»‹ç»è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒä¸»è¦å’Œåç¨‹æœ¬èº«çš„å®ç°æœ‰å…³ï¼Œä½†æ˜¯ä½ è‡ªå·±ä¸éœ€è¦ç›´æ¥ä½¿ç”¨å®ƒã€‚\nã€€å¦‚æœä½ æƒ³è¦äº†è§£æ›´å¤šï¼Œå¯ä»¥ä»PEP 342å¼€å§‹ï¼Œæ˜¯åç¨‹çš„æ­£å¼ä»‹ç»ã€‚Brett Cannonçš„How the Heck Does Async-Await in Pythonå’ŒPYMOTW writeup on asyncioä¹Ÿæ˜¯ä¸é”™çš„è¯»ç‰©ã€‚æœ€åï¼Œè¿˜æœ‰David Beazleyçš„Curious Course on Coroutines and Concurrencyï¼Œæ·±å…¥ä»‹ç»äº†åç¨‹è¿è¡Œã€‚\nã€€è®©æˆ‘ä»¬è¯•ç€æŠŠä¸Šè¿°æ–‡ç« æ€»ç»“ä¸ºå‡ å¥è¯ï¼šè¿™äº›åç¨‹å®é™…ä¸Šæ˜¯é€šè¿‡ä¸€ç§ç‰¹åˆ«éå¸¸è§„çš„æœºåˆ¶è¿è¡Œçš„ã€‚ä»–ä»¬çš„ç»“æœæ˜¯å¼‚å¸¸å¯¹è±¡çš„å±æ€§ï¼Œè¯¥å¼‚å¸¸å¯¹è±¡åœ¨è°ƒç”¨å…¶.send()æ–¹æ³•æ—¶è¢«æŠ›å‡ºã€‚æ‰€æœ‰è¿™äº›è¿˜æœ‰æ›´å¤šç»†èŠ‚ï¼Œä½†æ˜¯å®ƒå¯èƒ½å¯¹ä½ å®é™…ä½¿ç”¨è¯­è¨€æ²¡æœ‰å¸®åŠ©ï¼Œè®©æˆ‘ä»¬ç»§ç»­å§ã€‚\nã€€å°†æ‰€æœ‰äº‹æƒ…æ€»ç»“ä¸€ä¸‹ï¼Œä»¥ä¸‹æ˜¯åç¨‹ä½œä¸ºç”Ÿæˆå™¨çš„ä¸€äº›å…³é”®ç‚¹ï¼š\n åç¨‹æ˜¯æ”¹è£…çš„ç”Ÿæˆå™¨ï¼ˆrepurposed generatorsï¼‰ï¼Œå…·æœ‰ç”Ÿæˆå™¨æ–¹æ³•çš„ä¼˜ç‚¹ã€‚ æ—§çš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹ä½¿ç”¨yield fromç­‰å¾…åç¨‹ç»“æœã€‚ç°ä»£Pythonè¯­æ³•çš„åŸç”Ÿåç¨‹ç”¨awaitæ›¿æ¢æ‰yield fromæ¥ç­‰å¾…åç¨‹ç»“æœã€‚awaitå’Œyield fromç›¸ä¼¼ï¼Œé€šå¸¸å¯ä»¥çœ‹ä½œç­‰ä»·ã€‚ awaitçš„ä½¿ç”¨æ˜¯æ ‡è®°æ–­ç‚¹çš„ä¿¡å·ã€‚å®ƒè®©åç¨‹æš‚æ—¶åœæ­¢æ‰§è¡Œï¼Œå¹¶ä¸”å…è®¸ç¨‹åºç¨åå›æ¥ç»§ç»­æ‰§è¡Œã€‚  å…¶ä»–åŠŸèƒ½ï¼šasync forå’Œå¼‚æ­¥ç”Ÿæˆå™¨ã€æ¨å¯¼å¼ï¼ˆComprehensionï¼‰ ã€€é™¤äº†æ™®é€šçš„async/awaitï¼ŒPythonè¿˜å…è®¸ä½¿ç”¨async forå¯¹**å¼‚æ­¥è¿­ä»£å™¨ï¼ˆasynchronous iteratorï¼‰**è¿›è¡Œè¿­ä»£ã€‚å¼‚æ­¥è¿­ä»£å™¨çš„ç›®çš„æ˜¯èƒ½å¤Ÿåœ¨è¿­ä»£æ—¶åœ¨æ¯ä¸ªé˜¶æ®µè°ƒç”¨å¼‚æ­¥ä»£ç ã€‚\nã€€è¿™ä¸ªæ¦‚å¿µçš„è‡ªç„¶æ‰©å±•æ˜¯å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasynchronous generatorï¼‰ã€‚å›é¡¾åœ¨åŸç”Ÿåç¨‹ä¸­ä½ å¯ä»¥ä½¿ç”¨awaitï¼Œreturnæˆ–yieldã€‚ä»Python3.6ï¼ˆPEP 525ï¼‰èµ·ï¼Œå¯ä»¥åœ¨åç¨‹å†…ä½¿ç”¨yieldï¼Œä»–å¼•å…¥äº†å¼‚æ­¥ç”Ÿæˆå™¨ï¼Œç›®çš„æ˜¯å…è®¸åœ¨åŒä¸€ä¸ªåç¨‹å‡½æ•°ä½“ä¸­ä½¿ç”¨awaitå’Œyieldã€‚\n1 2 3 4 5 6 7  \u0026gt;\u0026gt;\u0026gt; async def mygen(u: int = 10): ... \u0026#34;\u0026#34;\u0026#34;Yield powers of 2.\u0026#34;\u0026#34;\u0026#34; ... i = 0 ... while i \u0026lt; u: ... yield 2 ** i ... i += 1 ... await asyncio.sleep(0.1)   ã€€æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼ŒPythonç”¨async forå¯ç”¨å¼‚æ­¥æ¨å¯¼å¼ï¼ˆasynchronous comprehensionï¼‰ã€‚åƒå®ƒçš„åŒæ­¥å…„å¼Ÿï¼Œè¿™ä¸»è¦æ˜¯è¯­æ³•ç³–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  \u0026gt;\u0026gt;\u0026gt; async def main(): ... # This does *not* introduce concurrent execution ... # It is meant to show syntax only ... g = [i async for i in mygen()] ... f = [j async for j in mygen() if not (j // 3 % 5)] ... return g, f ... \u0026gt;\u0026gt;\u0026gt; g, f = asyncio.run(main()) \u0026gt;\u0026gt;\u0026gt; g [1, 2, 4, 8, 16, 32, 64, 128, 256, 512] \u0026gt;\u0026gt;\u0026gt; f [1, 2, 16, 32, 256, 512]   ã€€è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ï¼šå¼‚æ­¥ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç†è§£éƒ½ä¸ä¼šä½¿è¿­ä»£å¹¶å‘ã€‚å®ƒä»¬åªæä¾›å’Œå®ƒä»¬åŒæ­¥å†™æ³•ç›¸å¯¹åº”çš„æ„Ÿè§‰ï¼Œä½†æ˜¯å…·æœ‰ä½¿ç›¸å…³å¾ªç¯æ”¾å¼ƒå¯¹äº‹ä»¶å¾ªç¯çš„æ§åˆ¶æƒä»¥ä¾¿ä½¿å…¶ä»–åç¨‹è¿è¡Œçš„èƒ½åŠ›ã€‚\nã€€æ¢å¥è¯è¯´ï¼Œå¼‚æ­¥è¿­ä»£å™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨å¹¶éæ—¨åœ¨åºåˆ—æˆ–è¿­ä»£å™¨ä¸Šå¹¶å‘æ˜ å°„æŸäº›å‡½æ•°ã€‚å®ƒä»¬ä»…ä»…æ˜¯è®©å°é—­çš„åç¨‹å…è®¸å…¶ä»–ä»»åŠ¡è½®æµè¿è¡Œã€‚ä»…åœ¨ä½¿ç”¨æ™®é€šçš„forå’Œwithä¼šâ€œç ´åâ€å†™æˆä¸­çš„awaitæ€§è´¨çš„æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦async forå’Œasync withã€‚å¼‚æ­¥å’Œå¹¶å‘çš„åŒºåˆ«æ˜¯è¦æŠŠæ¡çš„å…³é”®ã€‚\n\r Comprehensionï¼šè¿™é‡Œå–Pythonæ–‡æ¡£ä¸­ç®€ä½“ä¸­æ–‡ç‰ˆçš„ç¿»è¯‘ï¼Œå³ç¿»è¯‘ä¸ºâ€æ¨å¯¼å¼â€œï¼Œå…¶å®ƒåœ°æ–¹ä¹Ÿè¯‘ä¸ºåˆ—è¡¨ç”Ÿæˆå¼ç­‰ã€‚  \r \räº‹ä»¶å¾ªç¯ï¼ˆEvent loopï¼‰å’Œasyncio.run() ã€€ä½ å¯ä»¥è®¤ä¸ºäº‹ä»¶å¾ªç¯å°±åƒwhile Trueå¾ªç¯ä¸€æ ·ï¼Œå®ƒç›‘è§†åç¨‹ï¼Œåé¦ˆç©ºé—²çŠ¶æ€ä¿¡æ¯ï¼Œå¯»æ‰¾åœ¨æ­¤æ—¶å¯ä»¥æ‰§è¡Œçš„åœ°åäº”ã€‚å½“åç¨‹æ­£åœ¨ç­‰å¾…çš„ä¸œè¥¿å¯ç”¨æ—¶ï¼Œå®ƒèƒ½å¤Ÿå”¤é†’è¯¥ç©ºé—²åç¨‹ã€‚\nã€€å› æ­¤ï¼Œäº‹ä»¶å¾ªç¯çš„æ•´ä¸ªç®¡ç†å·²ç»éšå¼åœ°é€šè¿‡ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¤„ç†ï¼š\n1  asyncio.run(main()) # Python 3.7+   ã€€asyncio.run()ï¼Œåœ¨Python3.7å¼•å…¥ï¼Œè´Ÿè´£è·å–äº‹ä»¶å¾ªç¯ï¼Œåœ¨æ ‡è®°å®Œæˆå‰ä¸€ç›´è¿è¡Œä»»åŠ¡ï¼Œç„¶åå…³é—­äº‹ä»¶å¾ªç¯ã€‚\nã€€ä½¿ç”¨get_event_loop()å¯ä»¥æ›´å¹¿æ³›åœ°ç®¡ç†asyncioäº‹ä»¶å¾ªç¯ï¼Œå…¸å‹çš„æ¨¡å¼çœ‹èµ·æ¥åƒè¿™æ ·ï¼š\n1 2 3 4 5  loop = asyncio.get_event_loop() try: loop.run_until_complete(main()) finally: loop.close()   ã€€ä½ å¯èƒ½åœ¨ä¸€äº›æ—§çš„ç¤ºä¾‹ä¸­çœ‹åˆ°loop.get_event_loop()ï¼Œä½†æ˜¯é™¤éä½ ç‰¹åˆ«éœ€è¦å¾®è°ƒå¯¹äº‹ä»¶å¾ªç¯ç®¡ç†çš„æ§åˆ¶ï¼Œå¦åˆ™asyncio.run()å¯¹å¤§å¤šæ•°ç¨‹åºæ¥è¯´åº”è¯¥è¶³å¤Ÿäº†ã€‚\nã€€å¦‚æœä½ éœ€è¦åœ¨Pythonç¨‹åºå†…éƒ¨å’Œäº‹ä»¶å¾ªç¯äº¤äº’ï¼Œloopæ˜¯ä¸€ä¸ªè€å¼çš„Pythonå¯¹è±¡ï¼Œå®ƒé€šè¿‡loop.is_running()å’Œloop.is_closed()æ”¯æŒè‡ªçœã€‚\nã€€å¦‚æœä½ éœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œæ¯”å¦‚æŠŠå¾ªç¯ä½œä¸ºå‚æ•°è¿›è¡Œè°ƒåº¦å›è°ƒï¼Œä½ å¯ä»¥æ“çºµå®ƒä»¬ã€‚\nã€€æ›´å…³é”®çš„æ˜¯è¦å¯¹äº‹ä»¶å¾ªç¯çš„æœºåˆ¶æœ‰ä¸€å®šäº†è§£ã€‚å…³äºäº‹ä»¶å¾ªç¯è¿™é‡Œæœ‰å‡ ç‚¹å€¼å¾—å¼ºè°ƒã€‚\nã€€**#1ï¼š**ååŒç¨‹åºåªæœ‰åœ¨ä¸äº‹ä»¶å¾ªç¯ç›¸å…³è”çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è‡ªè¡Œå®Œæˆå¾ˆå¤šå·¥ä½œã€‚\nã€€è¿™ç‚¹ä½ åœ¨ä¹‹å‰å¯¹ç”Ÿæˆå™¨çš„è§£é‡Šä¸­çœ‹åˆ°è¿‡ï¼Œä½†å€¼å¾—é‡è¿°ä¸€éã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªawaitå…¶å®ƒåç¨‹çš„ä¸»åç¨‹ï¼Œä»…ä»…ç‹¬ç«‹åœ°è°ƒç”¨å®ƒæ˜¯æ— æ•ˆçš„ï¼š\n1 2 3 4 5 6 7 8 9 10  \u0026gt;\u0026gt;\u0026gt; import asyncio \u0026gt;\u0026gt;\u0026gt; async def main(): ... print(\u0026#34;Hello ...\u0026#34;) ... await asyncio.sleep(1) ... print(\u0026#34;World!\u0026#34;) \u0026gt;\u0026gt;\u0026gt; routine = main() \u0026gt;\u0026gt;\u0026gt; routine \u0026lt;coroutine object main at 0x1027a6150\u0026gt;   ã€€è®°ä½ä½¿ç”¨asyncio.run()é€šè¿‡è°ƒåº¦main()åç¨‹åœ¨äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œæ¥å¼ºåˆ¶æ‰§è¡Œã€‚\n1 2 3  \u0026gt;\u0026gt;\u0026gt; asyncio.run(routine) Hello ... World!   ã€€ï¼ˆå…¶å®ƒåç¨‹å¯ä»¥é€šè¿‡awaitæ¥æ‰§è¡Œã€‚é€šå¸¸åªå°†main()åŒ…è£…åœ¨asyncio.run()ä¸­ï¼Œç„¶åä»é‚£é‡Œè°ƒç”¨å¸¦æœ‰awaitçš„é“¾å¼åç¨‹ã€‚\nã€€**#2ï¼š**å¼‚æ­¥IOå¾ªç¯é»˜è®¤è¿è¡Œåœ¨å•æ ¸å•ä¸ªçº¿ç¨‹ä¸Šã€‚é€šå¸¸ï¼Œåœ¨ä¸€ä¸ªCPUæ ¸ä¸Šè¿è¡Œä¸€ä¸ªå•çº¿ç¨‹äº‹ä»¶å¾ªç¯ç»°ç»°æœ‰ä½™ã€‚å®ƒå¯èƒ½é€šè¿‡å¤šä¸ªæ ¸è¿è¡Œäº‹ä»¶å¾ªç¯ã€‚å¯ä»¥å‚è€ƒtalk by John Reeseäº†è§£æ›´å¤šï¼Œä½†ä½ çš„ç¬”è®°æœ¬ç”µè„‘å¯èƒ½ä¼šè‡ªç‡ƒã€‚\nã€€**#3ï¼š**äº‹ä»¶å¾ªç¯æ˜¯å¯æ’å…¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ çœŸçš„æƒ³çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°ä½ è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œå¹¶è®©å®ƒä»¥ç›¸åŒæ–¹å¼è¿è¡Œä»»åŠ¡ã€‚è¿™åœ¨uvloopåŒ…ä¸­è¢«å……åˆ†åœ°ä»‹ç»ï¼Œæ˜¯CPythonä¸­çš„äº‹ä»¶å¾ªç¯å®ç°ã€‚\nã€€â€œå¯æ’å…¥çš„äº‹ä»¶å¾ªç¯â€çš„æ„æ€æ˜¯ï¼šä½ å¯ä»¥ä½¿ç”¨ä»»ä½•äº‹ä»¶å¾ªç¯çš„å·¥ä½œå®ç°ï¼Œæ ¸åç¨‹ä»–ä»¬æœ¬èº«çš„ç»“æ„æ— å…³ã€‚asyncioåŒ…æœ¬èº«æ¶‰åŠä¸¤ç§ä¸åŒçš„äº‹ä»¶å¾ªç¯å®ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹åŸºäºselectorsæ¨¡å—ã€‚ï¼ˆç¬¬äºŒç§å®ç°ä»…ä¸ºWindowsæ„å»ºï¼‰\nå®Œæ•´çš„ç¨‹åºï¼šå¼‚æ­¥è¯·æ±‚ ã€€åˆ°ç›®å‰ä¸ºæ­¢ä½ å·²ç»çœ‹äº†å¤§éƒ¨åˆ†äº†ï¼Œæ˜¯æ—¶å€™è¿›è¡Œæœ‰è¶£è€Œæ— ç—›çš„å·¥ä½œäº†ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ ä¼šæ„å»ºä¸€ä¸ªç½‘é¡µæŠ“å–ç½‘å€æ”¶é›†å™¨ï¼Œareq.pyï¼Œä½¿ç”¨aiohttpï¼Œå¿«é€Ÿçš„å¼‚æ­¥HTTPå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¡†æ¶ã€‚ï¼ˆæˆ‘ä»¬ä»…éœ€è¦å®¢æˆ·ç«¯éƒ¨åˆ†ï¼‰è¿™è¿™æ ·çš„å·¥å…·å¯ç”¨äºæ˜ å°„ç«™ç‚¹é›†ç¾¤ä¹‹é—´çš„è¿æ¥ï¼Œé“¾æ¥å½¢æˆæœ‰å‘å›¾ã€‚\n\r\rä½ å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆPythonçš„requestsåŒ…å’Œå¼‚æ­¥IOä¸å…¼å®¹ã€‚requestsåœ¨urllib3çš„ä¸Šå±‚æ„å»ºï¼Œå®é™…ä¸Šä½¿ç”¨çš„æ˜¯Pythonçš„httpåŒ…å’Œsocketæ¨¡å—ã€‚\n\r \rã€€é»˜è®¤æƒ…å†µä¸‹ï¼Œå¥—æ¥å­—æ“ä½œæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€Pythonä¸ä¼šawait requests.get(url)ï¼Œå› ä¸º.get()ä¸æ˜¯å¯ç­‰å¾…çš„ã€‚ç›¸å¯¹åœ°ï¼Œå‡ ä¹æ‰€æœ‰çš„äº‹æƒ…åœ¨aiohttpä¸­éƒ½æ˜¯å¯ç­‰å¾…çš„åç¨‹ï¼Œå¦‚session.request()å’Œresponse.text()ã€‚å®ƒè™½ç„¶æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„åŒ…ï¼Œä½†æ˜¯åœ¨å¼‚æ­¥ä»£ç ä¸­ä½¿ç”¨requestsä¼šå¯¹è‡ªå·±é€ æˆæŸå®³ã€‚\nã€€é«˜çº§ç¨‹åºç»“æ„åƒè¿™æ ·ï¼š\n ä»æœ¬åœ°æ–‡ä»¶urls.txtè¯»å–URLåºåˆ—ã€‚ å‘é€å¯¹URLçš„GETè¯·æ±‚å¹¶è§£æç»“æœå†…å®¹ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™åœ¨æ­¤å¤„åœæ­¢è¾“å…¥URLã€‚ åœ¨URLå“åº”çš„HTMLä¸­å¯»æ‰¾hrefæ ‡ç­¾ã€‚ å°†ç»“æœå†™å…¥foundurls.txtã€‚ å°½å¯èƒ½å¼‚æ­¥å’ŒåŒæ—¶æ‰§è¡Œä¸Šè¿°æ‰€æœ‰æ“ä½œã€‚ï¼ˆä½¿ç”¨aiohttpå‘é€è¯·æ±‚ï¼Œå’Œaiofilesè¿½åŠ æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ˜¯éå¸¸é€‚åˆå¼‚æ­¥IOæ¨¡å‹çš„IOä¸»è¦ç¤ºä¾‹ï¼‰ã€‚  ã€€è¿™æ˜¯urls.txtçš„å†…å®¹ï¼Œå®ƒå¹¶ä¸å¤§ï¼Œä½†åŒ…å«äº†å¤§éƒ¨åˆ†æµé‡å¤§çš„ç½‘ç«™\n1 2 3 4 5 6 7 8 9  $ cat urls.txt https://regex101.com/ https://docs.python.org/3/this-url-will-404.html https://www.nytimes.com/guides/ https://www.mediamatters.org/ https://1.1.1.1/ https://www.politico.com/tipsheets/morning-money https://www.bloomberg.com/markets/economics https://www.ietf.org/rfc/rfc2616.txt   ã€€åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªURLä¼šè¿”å›ä¸€ä¸ª404å“åº”ï¼Œä½ éœ€è¦ä¼˜é›…åœ°å¤„ç†ã€‚å¦‚æœä½ è¿è¡Œè¿™ä¸ªç¨‹åºçš„æ‰©å±•ç‰ˆæœ¬ï¼Œä½ éœ€è¦å¤„ç†æ›´æ£˜æ‰‹çš„é—®é¢˜ï¼Œæ¯”å¦‚è¿ä¸ä¸ŠæœåŠ¡å™¨å’Œæ— ä¼‘æ­¢çš„é‡å®šå‘ã€‚\nã€€è¯·æ±‚æœ¬èº«åº”è¯¥ä½¿ç”¨å•ä¸ªçš„ä¼šè¯å‘å‡ºï¼Œä»¥å……åˆ†åˆ©ç”¨ä¼šè¯å†…éƒ¨çš„è¿æ¥æ± ã€‚\nã€€è®©æˆ‘ä»¬çœ‹ä¸€çœ¼æ•´ä¸ªç¨‹åºã€‚æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°æµè§ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108  #!/usr/bin/env python3 # areq.py \u0026#34;\u0026#34;\u0026#34;Asynchronously get links embedded in multiple pages\u0026#39; HMTL.\u0026#34;\u0026#34;\u0026#34; import asyncio import logging import re import sys from typing import IO import urllib.error import urllib.parse import aiofiles import aiohttp from aiohttp import ClientSession logging.basicConfig( format=\u0026#34;%(asctime)s%(levelname)s:%(name)s: %(message)s\u0026#34;, level=logging.DEBUG, datefmt=\u0026#34;%H:%M:%S\u0026#34;, stream=sys.stderr, ) logger = logging.getLogger(\u0026#34;areq\u0026#34;) logging.getLogger(\u0026#34;chardet.charsetprober\u0026#34;).disabled = True HREF_RE = re.compile(r\u0026#39;href=\u0026#34;(.*?)\u0026#34;\u0026#39;) async def fetch_html(url: str, session: ClientSession, **kwargs) -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;GET request wrapper to fetch page HTML. kwargs are passed to `session.request()`. \u0026#34;\u0026#34;\u0026#34; resp = await session.request(method=\u0026#34;GET\u0026#34;, url=url, **kwargs) resp.raise_for_status() logger.info(\u0026#34;Got response [%s] for URL: %s\u0026#34;, resp.status, url) html = await resp.text() return html async def parse(url: str, session: ClientSession, **kwargs) -\u0026gt; set: \u0026#34;\u0026#34;\u0026#34;Find HREFs in the HTML of `url`.\u0026#34;\u0026#34;\u0026#34; found = set() try: html = await fetch_html(url=url, session=session, **kwargs) except ( aiohttp.ClientError, aiohttp.http_exceptions.HttpProcessingError, ) as e: logger.error( \u0026#34;aiohttp exception for %s[%s]: %s\u0026#34;, url, getattr(e, \u0026#34;status\u0026#34;, None), getattr(e, \u0026#34;message\u0026#34;, None), ) return found except Exception as e: logger.exception( \u0026#34;Non-aiohttp exception occured: %s\u0026#34;, getattr(e, \u0026#34;__dict__\u0026#34;, {}) ) return found else: for link in HREF_RE.findall(html): try: abslink = urllib.parse.urljoin(url, link) except (urllib.error.URLError, ValueError): logger.exception(\u0026#34;Error parsing URL: %s\u0026#34;, link) pass else: found.add(abslink) logger.info(\u0026#34;Found %dlinks for %s\u0026#34;, len(found), url) return found async def write_one(file: IO, url: str, **kwargs) -\u0026gt; None: \u0026#34;\u0026#34;\u0026#34;Write the found HREFs from `url` to `file`.\u0026#34;\u0026#34;\u0026#34; res = await parse(url=url, **kwargs) if not res: return None async with aiofiles.open(file, \u0026#34;a\u0026#34;) as f: for p in res: await f.write(f\u0026#34;{url}\\t{p}\\n\u0026#34;) logger.info(\u0026#34;Wrote results for source URL: %s\u0026#34;, url) async def bulk_crawl_and_write(file: IO, urls: set, **kwargs) -\u0026gt; None: \u0026#34;\u0026#34;\u0026#34;Crawl \u0026amp; write concurrently to `file` for multiple `urls`.\u0026#34;\u0026#34;\u0026#34; async with ClientSession() as session: tasks = [] for url in urls: tasks.append( write_one(file=file, url=url, session=session, **kwargs) ) await asyncio.gather(*tasks) if __name__ == \u0026#34;__main__\u0026#34;: import pathlib import sys assert sys.version_info \u0026gt;= (3, 7), \u0026#34;Script requires Python 3.7+.\u0026#34; here = pathlib.Path(__file__).parent with open(here.joinpath(\u0026#34;urls.txt\u0026#34;)) as infile: urls = set(map(str.strip, infile)) outpath = here.joinpath(\u0026#34;foundurls.txt\u0026#34;) with open(outpath, \u0026#34;w\u0026#34;) as outfile: outfile.write(\u0026#34;source_url\\tparsed_url\\n\u0026#34;) asyncio.run(bulk_crawl_and_write(file=outpath, urls=urls))   ã€€è¿™ä¸ªè„šæœ¬æ¯”æˆ‘ä»¬çš„ç¨‹åºé•¿å¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†è§£å®ƒã€‚\nã€€å¸¸é‡HREF_REæ˜¯ä¸€ä¸ªå¸¸è§„è¡¨è¾¾å¼ï¼Œç”¨æ¥æå–æˆ‘ä»¬æœ€ç»ˆæŸ¥æ‰¾çš„HTMLä¸­çš„hrefæ ‡ç­¾ï¼š\n1 2  \u0026gt;\u0026gt;\u0026gt; HREF_RE.search(\u0026#39;Go to \u0026lt;a href=\u0026#34;https://realpython.com/\u0026#34;\u0026gt;Real Python\u0026lt;/a\u0026gt;\u0026#39;) \u0026lt;re.Match object; span=(15, 45), match=\u0026#39;href=\u0026#34;https://realpython.com/\u0026#34;\u0026#39;\u0026gt;   ã€€åç¨‹fetch_html()æ˜¯ä¸€ä¸ªGETè¯·æ±‚çš„è£…é¥°å™¨ï¼Œç”¨æ¥åˆ›å»ºè¯·æ±‚å¹¶å¯¹HTMLé¡µé¢è§£ç ã€‚å®ƒåˆ›å»ºè¯·æ±‚ï¼Œawaitå“åº”ï¼Œå¹¶ç”¨æ­£ç¡®çš„æ–¹å¼å¤„ç†é200çš„çŠ¶æ€ç ã€‚\n1 2  resp = await session.request(method=\u0026#34;GET\u0026#34;, url=url, **kwargs) resp.raise_for_status()   ã€€å¦‚æœçŠ¶æ€æ˜¯OKï¼Œfetch_html()è¿”å›HTMLé¡µé¢ï¼ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°ä¸­æ²¡æœ‰å¼‚å¸¸å¤„ç†ã€‚é€»è¾‘æ˜¯å°†è¯¥å¼‚å¸¸ä¼ æ’­ç»™è°ƒç”¨æ–¹ï¼Œå¹¶åœ¨é‚£é‡Œè¿›è¡Œå¤„ç†ã€‚\n1  html = await resp.text()   ã€€æˆ‘ä»¬await session.request()å’Œresp.text()æ˜¯å› ä¸ºä»–ä»¬æ˜¯å¯ç­‰å¾…çš„åç¨‹ã€‚è¯·æ±‚/å“åº”å¾ªç¯æ˜¯åº”ç”¨å»¶è¿Ÿé«˜ä¸”è€—æ—¶çš„éƒ¨åˆ†ï¼Œä½†æ˜¯ä½¿ç”¨å¼‚æ­¥IOï¼Œfetch_html()è®©äº‹ä»¶å¾ªç¯å·¥ä½œåœ¨å…¶å®ƒå°±ç»ªå¯ç”¨çš„å·¥ä½œä¸Šï¼Œæ¯”å¦‚è§£æå’Œå†™å…¥å·²ç»è·å–çš„URLã€‚\nã€€åç¨‹é“¾çš„ä¸‹ä¸€æ­¥æ˜¯parse()ï¼Œåœ¨fetch_html()ä¸­ç­‰å¾…ç»™å®šçš„URLï¼Œç„¶åæå–é‚£ä¸ªHTMLé¡µé¢çš„æ‰€æœ‰hrefæ ‡ç­¾ï¼Œä¿è¯æ¯ä¸ªéƒ½æœ‰æ•ˆå¹¶ä¸”å°†å®ƒæ ¼å¼åŒ–ä¸ºç»å¯¹è·¯å¾„ã€‚\nã€€è¯šç„¶ï¼Œparse()çš„ç¬¬äºŒéƒ¨åˆ†æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯å®ƒç”±å¿«é€Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç»„æˆï¼Œå¹¶ç¡®ä¿å‘ç°çš„è¿æ¥è®¾ç½®ä¸ºç»å¯¹è·¯å¾„ã€‚\nã€€åœ¨è¿™ç§å…·ä½“æƒ…å½¢ä¸‹ï¼ŒåŒæ­¥ä»£ç éœ€è¦æ˜¯å¿«é€Ÿä¸”ä¸æ˜¾çœ¼çš„ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œç»™å®šåç¨‹ä¸­çš„ä»»ä½•è¡Œéƒ½ä¼šé˜»å¡å…¶å®ƒåç¨‹ï¼Œé™¤éè¯¥è¡Œä½¿ç”¨yieldï¼Œawaitæˆ–returnã€‚å¦‚æœè§£æï¼Œä½ å¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨loop.run_in_executor()åœ¨å®ƒè‡ªå·±çš„ç¨‹åºä¸­è¿è¡Œè¿™éƒ¨åˆ†ã€‚\nã€€æ¥ä¸‹æ¥ï¼Œåç¨‹write()æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡å’Œä¸€ä¸ªURLï¼Œç­‰å¾…parse()è¿”å›ä¸€ç»„è§£æçš„URLï¼Œé€šè¿‡aiofilesï¼ˆå¼‚æ­¥æ–‡ä»¶IOåŒ…ï¼‰æ ¹æ®æºURLæŠŠæ¯ä¸€ä¸ªå¼‚æ­¥åœ°å†™å…¥æ–‡ä»¶ã€‚\nã€€æœ€åï¼Œbulk_crawl_and_write()ä½œä¸ºè¿›å…¥è„šæœ¬åç¨‹é“¾çš„ä¸»è¦å…¥å£ç‚¹ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªä¼šè¯ï¼Œå¹¶ä¸ºæ¯ä¸ªä»url.txtä¸­è¯»å–çš„URLåˆ›å»ºä¸€ä¸ªä»»åŠ¡ã€‚\nã€€è¿™é‡Œæœ‰é¢å¤–çš„å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\n é»˜è®¤çš„ClientSessionæœ€å¤§å…·æœ‰100ä¸ªå¼€æ”¾è¿æ¥çš„é€‚é…å™¨ã€‚éœ€è¦æ›´æ”¹æ­¤è®¾ç½®ï¼Œè¯·ä¼ é€’ä¸€ä¸ªasyncio.connector.TCPConnectorå®ä¾‹ç»™ClientSessionã€‚ä½ ä¹Ÿå¯ä»¥åŸºäºæ¯ä¸ªä¸»æœºæŒ‡å®šé™åˆ¶ã€‚ ä½ å¯ä»¥ä¸ºæ•´ä¸ªä¼šè¯å’Œå•ä¸ªè¯·æ±‚æŒ‡å®šæœ€å¤§è¶…æ—¶ã€‚ è¿™ä¸ªè„šæœ¬ä¹Ÿä½¿ç”¨äº†await withï¼Œç”¨ä½œå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆasynchronous context managerï¼‰ã€‚æˆ‘æ²¡æœ‰ä¸ºæ­¤å¼€è®¾ä¸€èŠ‚è®²è¿°è¿™ä¸ªæ¦‚å¿µï¼Œå› ä¸ºä»åŒæ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åˆ°å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„è½¬å˜æ¯”è¾ƒç›´æ¥ã€‚åè€…å®šä¹‰äº†.__aenter__()å’Œ.__aexit__()è€Œä¸æ˜¯.__exit__()å’Œ.__enter__()ã€‚å’Œä½ æƒ³çš„ä¸€æ ·ï¼Œasync withä¹Ÿåªèƒ½ç”¨åœ¨å£°æ˜ä¸ºasync defçš„åç¨‹å‡½æ•°å†…éƒ¨ã€‚  ã€€å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼ŒGithubä¸Šæœ¬æ•™ç¨‹çš„é…å¥—æ–‡ä»¶ä¹Ÿé™„å¸¦äº†æ³¨é‡Šå’Œæ–‡æ¡£ã€‚\nã€€è¿™æ˜¯å…¨éƒ¨æ‰§è¡Œè¿‡ç¨‹ï¼Œareq.pyåœ¨1ç§’é’Ÿè·å–ã€è§£æå¹¶ä¿å­˜äº†9ä¸ªURLçš„ç»“æœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  $ python3.7 areq.py 21:33:22 DEBUG:asyncio: Using selector: KqueueSelector 21:33:22 INFO:areq: Got response [200] for URL: https://www.mediamatters.org/ 21:33:22 INFO:areq: Found 115 links for https://www.mediamatters.org/ 21:33:22 INFO:areq: Got response [200] for URL: https://www.nytimes.com/guides/ 21:33:22 INFO:areq: Got response [200] for URL: https://www.politico.com/tipsheets/morning-money 21:33:22 INFO:areq: Got response [200] for URL: https://www.ietf.org/rfc/rfc2616.txt 21:33:22 ERROR:areq: aiohttp exception for https://docs.python.org/3/this-url-will-404.html [404]: Not Found 21:33:22 INFO:areq: Found 120 links for https://www.nytimes.com/guides/ 21:33:22 INFO:areq: Found 143 links for https://www.politico.com/tipsheets/morning-money 21:33:22 INFO:areq: Wrote results for source URL: https://www.mediamatters.org/ 21:33:22 INFO:areq: Found 0 links for https://www.ietf.org/rfc/rfc2616.txt 21:33:22 INFO:areq: Got response [200] for URL: https://1.1.1.1/ 21:33:22 INFO:areq: Wrote results for source URL: https://www.nytimes.com/guides/ 21:33:22 INFO:areq: Wrote results for source URL: https://www.politico.com/tipsheets/morning-money 21:33:22 INFO:areq: Got response [200] for URL: https://www.bloomberg.com/markets/economics 21:33:22 INFO:areq: Found 3 links for https://www.bloomberg.com/markets/economics 21:33:22 INFO:areq: Wrote results for source URL: https://www.bloomberg.com/markets/economics 21:33:23 INFO:areq: Found 36 links for https://1.1.1.1/ 21:33:23 INFO:areq: Got response [200] for URL: https://regex101.com/ 21:33:23 INFO:areq: Found 23 links for https://regex101.com/ 21:33:23 INFO:areq: Wrote results for source URL: https://regex101.com/ 21:33:23 INFO:areq: Wrote results for source URL: https://1.1.1.1/   ã€€è¿™æ ·ä¸ä¸¥è°¨ï¼Œå¯¹äºå¥å…¨çš„æ£€æŸ¥ï¼Œä½ å¯ä»¥æ£€æŸ¥è¾“å‡ºè¡Œæ•°ï¼Œæˆ‘æ˜¯626ï¼Œä½†è¿™å¯èƒ½ä¼šæœ‰æ‰€æ³¢åŠ¨ï¼š\n1 2 3 4 5 6 7  $ wc -l foundurls.txt 626 foundurls.txt $ head -n 3 foundurls.txt source_url parsed_url https://www.bloomberg.com/markets/economics https://www.bloomberg.com/feedback https://www.bloomberg.com/markets/economics https://www.bloomberg.com/notices/tos   ã€€ä¸‹ä¸€æ­¥ï¼šå¦‚æœä½ æƒ³è¦æé«˜åº•æ³¨ï¼Œè¯·ä½¿ç”¨è¿™ä¸ªç½‘ç»œçˆ¬è™«é€’å½’ã€‚ä½ å¯ä»¥ä½¿ç”¨aio-redisè¿½è¸ªå“ªä¸ªURLå·²ç»è¢«æŠ“å–äº†ï¼Œä»è€Œé¿å…è¯·æ±‚ä»–ä»¬ä¸¤æ¬¡ï¼Œå¹¶ç”¨Pythonçš„networkxåº“å’Œé“¾æ¥ç›¸è¿ã€‚\nã€€è®°ä½è¦å‹å¥½ã€‚å‘é€1000ä¸ªå¹¶å‘è¯·æ±‚ç»™ä¸€ä¸ªå°å‹ã€æ¯«æ— é˜²å¾¡çš„ç½‘ç«™æ˜¯éå¸¸ç³Ÿç³•çš„ã€‚æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥é™åˆ¶ä½ ä¸€æ¬¡å‘å‡ºçš„å¹¶å‘è¯·æ±‚ï¼Œä¾‹å¦‚ä½¿ç”¨asyncioçš„sempahoreå¯¹è±¡æˆ–ä½¿ç”¨å’Œå®ƒç›¸ä¼¼çš„æ¨¡æ¿ã€‚å¦‚æœä½ ä¸æ³¨æ„æ­¤è­¦å‘Šï¼Œå¯èƒ½ä¼šå—åˆ°å¤§é‡çš„TimeoutErrorå¼‚å¸¸ï¼Œæœ€ç»ˆåªä¼šæŸå®³æ‚¨è‡ªå·±çš„ç¨‹åºã€‚\nå¼‚æ­¥IOçš„ä½¿ç”¨åœºæ™¯ ã€€ç°åœ¨ä½ å·²ç»äº†è§£äº†å¥åº·çš„ä»£ç ï¼Œè®©æˆ‘ä»¬é€€ä¸€æ­¥æ€è€ƒä¸€ä¸‹å¼‚æ­¥IOä»€ä¹ˆæ—¶å€™æ˜¯ä¸€ä¸ªç†æƒ³çš„é€‰æ‹©ï¼Œä»¥åŠä½ æ€æ ·åšå‡ºæ¯”è¾ƒå¾—å‡ºç»“è®ºæˆ–æ˜¯å¦é€‰æ‹©å…¶ä»–çš„å¹¶å‘æ¨¡å‹ã€‚\nå¼‚æ­¥IOä»€ä¹ˆæ—¶å€™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„é€‰æ‹©ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ã€€æœ¬æ•™ç¨‹å¹¶æ²¡æœ‰å¯¹å¼‚æ­¥IOã€çº¿ç¨‹ã€å¤šè¿›ç¨‹è¿›è¡Œæ‰©å±•è®ºè¿°ã€‚ä½†æ˜¯ï¼Œäº†è§£å¼‚æ­¥IOä½•æ—¶æ˜¯ä¸‰è€…é—´çš„æœ€ä½³é€‰æ‹©å¾ˆæœ‰ç”¨ã€‚\nã€€å¼‚æ­¥å’Œå¤šè¿›ç¨‹ä¹‹é—´çš„æ–—äº‰æ ¹æœ¬ä¸å­˜åœ¨ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬å¯ä»¥è¢«æ­£ç¡®åœ°ä½¿ç”¨ã€‚å¦‚æœä½ æœ‰å¤šä¸ªå…¬å¹³ç»Ÿä¸€çš„CPUå—é™ä»»åŠ¡ï¼Œï¼ˆä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯åº“å†…ç½‘æ ¼æŸ¥æ‰¾ï¼ˆgrid searchï¼‰ï¼Œæ¯”å¦‚scikit-learnæˆ–kerasï¼‰å¤šè¿›ç¨‹æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nã€€å¦‚æœæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯é˜»å¡è°ƒç”¨ï¼Œè€Œä»…ä»…æ˜¯å°†asyncæ”¾åˆ°æ¯ä¸ªå‡½æ•°å‰é¢æ˜¯ç³Ÿç³•çš„æƒ³æ³•ã€‚ï¼ˆå®é™…ä¸Šè¿˜å¯èƒ½ä¼šå‡é€Ÿä½ çš„ä»£ç ï¼‰ä½†æ˜¯åƒå…ˆå‰æåˆ°çš„é‚£æ ·ï¼Œå¼‚æ­¥IOå’Œå¤šè¿›ç¨‹åœ¨å¾ˆå¤šåœ°æ–¹å¯ä»¥å’Œè°å…±å­˜ã€‚\nã€€å¼‚æ­¥IOå’Œçº¿ç¨‹ä¹‹é—´çš„ç«äº‰æ›´ç›´æ¥ï¼Œæˆ‘åœ¨å¼•è¨€ä¸­æåˆ°äº†â€œçº¿ç¨‹æ˜¯å›°éš¾çš„â€ã€‚å®Œæ•´çš„è¯´æ³•æ˜¯ï¼Œå³ä½¿æŸäº›æƒ…å½¢ä¸‹çº¿ç¨‹çœ‹èµ·æ¥å¾ˆå®¹æ˜“å®ç°ï¼Œç”±äºç«äº‰æ¡ä»¶å’Œå†…å­˜ä½¿ç”¨ç­‰åŸå› ï¼Œå®ƒä»ç„¶å¯èƒ½å¯¼è‡´é‚£äº›è‡­åæ˜­è‘—ã€æ— æ³•è·Ÿè¸ªçš„é”™è¯¯ã€‚\nã€€å’Œå¼‚æ­¥IOç›¸æ¯”ï¼Œçº¿ç¨‹æ‰©å±•çš„è¶‹åŠ¿ä¹Ÿä¸å¤ªå¥½ã€‚å› ä¸ºçº¿ç¨‹æ˜¯å…·æœ‰æœ‰é™å¯ç”¨æ€§çš„ç³»ç»Ÿèµ„æºã€‚åˆ›å»ºå‡ åƒä¸ªçº¿ç¨‹åœ¨å¤§å¤šæ•°æœºå™¨ä¸Šéƒ½ä¼šå¤±è´¥ï¼Œå› æ­¤æˆ‘ä¸å»ºè®®ä½ é¦–å…ˆè¿›è¡Œå°è¯•ã€‚åˆ›å»ºæ•°åƒå¼‚æ­¥IOä»»åŠ¡å®Œå…¨å¯è¡Œã€‚\nã€€åœ¨ä½ æœ‰å¤šä¸ªIOå—é™ä»»åŠ¡æ—¶å¼‚æ­¥IOé—ªé—ªå‘å…‰ï¼Œå¦åˆ™è¿™äº›ä»»åŠ¡çš„æ—¶å¸¸ä¼šè¢«é˜»å¡çš„IOç­‰å¾…æ—¶é—´å æ®ï¼Œä¾‹å¦‚ï¼š\n ç½‘ç»œIOï¼Œæ— è®ºä½ çš„ç¨‹åºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ã€‚ æ— æœåŠ¡å™¨è®¾è®¡ï¼Œä¾‹å¦‚åƒèŠå¤©å®¤å¤šç”¨æˆ·ç½‘ç»œæˆ–P2Pç½‘ç»œã€‚ æ¨¡ä»¿â€œå³å†™å³å¿˜â€é£æ ¼çš„è¯»/å†™æ“ä½œï¼Œè€Œä¸æ‹…å¿ƒè¯»å†™æ—¶é”å®šçš„ä¸œè¥¿æ—¶ã€‚  ã€€ä¸ä½¿ç”¨å¼‚æ­¥IOçš„æœ€å¤§åŸå› æ˜¯awaitä»…æ”¯æŒä¸€ç»„ç”±ç‰¹å®šæ–¹æ³•å®šä¹‰çš„ç‰¹å®šå¯¹è±¡ã€‚å¦‚æœä½ æƒ³è¦å¯¹DBMSè¿›è¡Œå¼‚æ­¥è¯»æ“ä½œï¼Œä½ éœ€è¦æ‰¾åˆ°çš„ä¸ä»…æ˜¯DBMSçš„Pythonè£…é¥°å™¨ï¼Œè¿˜éœ€è¦æ”¯æŒasync/awaitçš„è¯­æ³•ã€‚åŒ…å«åŒæ­¥è°ƒç”¨çš„åç¨‹ä¼šé˜»æ­¢å…¶å®ƒåç¨‹å’Œä»»åŠ¡çš„è¿è¡Œã€‚\nã€€æ”¯æŒasync/awaitçš„æ¸…å•ï¼Œå¯ä»¥åœ¨æ•™ç¨‹çš„å°¾éƒ¨æŸ¥çœ‹ã€‚\nåº”è¯¥é€‰æ‹©å¼‚æ­¥IOçš„å“ªä¸ªåŒ…ï¼Ÿ ã€€è¿™ç¯‡æ•™ç¨‹ä¸“æ³¨äºå¼‚æ­¥IOï¼Œasync/awaitè¯­æ³•ï¼Œä½¿ç”¨asyncioè¿›è¡Œäº‹ä»¶å¾ªç¯ç®¡ç†å’ŒæŒ‡å®šä»»åŠ¡ã€‚asyncioå¹¶ä¸æ˜¯å”¯ä¸€çš„å¼‚æ­¥IOåº“ã€‚Nathaniel J. Smithå‘ç°äº†å¾ˆå¤šï¼š\n åœ¨æœªæ¥çš„å‡ å¹´ï¼Œasyncioå¯èƒ½ä¼šæ²¦è½ä¸ºç²¾æ˜çš„å¼€å‘äººå‘˜é¿å…ä½¿ç”¨çš„æ ‡å‡†åº“ä¹‹ä¸€ï¼Œå¦‚urllib2ã€‚\n\u0026hellip;\nå®é™…ä¸Šï¼Œæˆ‘è¦è¯´çš„æ˜¯asyncioæ˜¯å…¶è‡ªèº«æˆåŠŸçš„å—å®³è€…ï¼šè®¾è®¡æ—¶ï¼Œå®ƒä½¿ç”¨äº†å¯èƒ½çš„æœ€ä½³æ–¹æ³•ï¼›ä½†æ˜¯ä»é‚£æ—¶èµ·ï¼Œå¼‚æ­¥çš„å¯å‘ä¸‹çš„å·¥ä½œï¼ˆä¾‹å¦‚æ·»åŠ å¼‚æ­¥/ç­‰å¾…ï¼‰å·²ç»æ”¹å˜äº†ç°çŠ¶ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼Œç°åœ¨å¼‚æ­¥å·²è¢«å…¶æ—©æœŸçš„æ‰¿è¯ºæ‰€æŸç¼šã€‚ï¼ˆSourceï¼‰\n ã€€å°½ç®¡å¦‚æ­¤ï¼Œå¯ä»¥æ›¿ä»£asyncioçš„è‘—åæ›¿ä»£å“æ˜¯curioå’Œtrioï¼Œå®ƒä»¬ä½¿ç”¨ä¸åŒçš„APIå’Œæ–¹æ³•ã€‚ä»ä¸ªäººæ¥è®²ï¼Œæˆ‘è®¤ä¸ºå¦‚æœä½ è¦æ„å»ºå¤§å°é€‚ä¸­ï¼Œç®€å•æ˜äº†çš„ç¨‹åºï¼Œä»…ä½¿ç”¨asyncioå°±è¶³å¤Ÿä¸”èƒ½å¤Ÿç†è§£äº†ï¼Œå¹¶ä¸”è®©ä½ é¿å…æ·»åŠ Pythonæ ‡å‡†åº“ä»¥å¤–çš„å¤§å‹ä¾èµ–ã€‚\nã€€ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œæ£€æŸ¥curioå’Œtrioï¼Œä½ ä¼šå‘ç°å®ƒä»¬ä»¥ç›¸åŒçš„æ–¹å¼å®Œæˆäº†å¯¹ç”¨æˆ·è€Œè¨€æ›´ç›´è§‚çš„æ“ä½œã€‚è¿™é‡Œä»‹ç»çš„ä¸åŒ…æ— å…³çš„æ¦‚å¿µä¹Ÿåº”è¯¥æ¸—é€åˆ°å…¶å®ƒå¼‚æ­¥IOåŒ…ä¸­ã€‚\nå…¶ä»–é›¶ç¢çš„å†…å®¹ ã€€åœ¨æ¥ä¸‹æ¥çš„å‡ èŠ‚ï¼Œä½ ä¼šäº†è§£åˆ°asyncioå’Œasync/awaitçš„å…¶å®ƒå„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†ç›®å‰ä¸å¤ªåŒ¹é…æœ¬æ•™ç¨‹ï¼Œä½†å¯¹äºæ„å»ºå’Œç†è§£å®Œæ•´çš„ç¨‹åºå¾ˆé‡è¦ã€‚\nå…¶å®ƒé¡¶çº§asyncioå‡½æ•° ã€€é™¤äº†asyncio.run()ä»¥å¤–ï¼Œä½ ä¼šçœ‹åˆ°å‡ ä¸ªå…¶å®ƒåŒ…çº§åˆ«çš„å‡½æ•°ï¼Œæ¯”å¦‚asyncio.create_task()å’Œasyncio.gather()ã€‚\nã€€ä½ å¯ä»¥ä½¿ç”¨create_task()è°ƒåº¦åç¨‹å¯¹è±¡çš„æ‰§è¡Œï¼Œç„¶åä½¿ç”¨asyncio.run()ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  \u0026gt;\u0026gt;\u0026gt; import asyncio \u0026gt;\u0026gt;\u0026gt; async def coro(seq) -\u0026gt; list: ... \u0026#34;\u0026#34;\u0026#34;\u0026#39;IO\u0026#39; wait time is proportional to the max element.\u0026#34;\u0026#34;\u0026#34; ... await asyncio.sleep(max(seq)) ... return list(reversed(seq)) ... \u0026gt;\u0026gt;\u0026gt; async def main(): ... # This is a bit redundant in the case of one task ... # We could use `await coro([3, 2, 1])` on its own ... t = asyncio.create_task(coro([3, 2, 1])) # Python 3.7+ ... await t ... print(f\u0026#39;t: type {type(t)}\u0026#39;) ... print(f\u0026#39;t done: {t.done()}\u0026#39;) ... \u0026gt;\u0026gt;\u0026gt; t = asyncio.run(main()) t: type \u0026lt;class \u0026#39;_asyncio.Task\u0026#39;\u0026gt; t done: True   ã€€è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚ï¼šå¦‚æœä½ ä¸åœ¨main()ä¸­ä½¿ç”¨await()ï¼Œå®ƒä¼šåœ¨main()å‘é€å®Œæˆä¿¡å·ä¹‹å‰å®Œæˆã€‚å› ä¸ºasyncio.run(main())è°ƒç”¨loop.run_until_complete(main())ï¼Œäº‹ä»¶å¾ªç¯ä»…å…³å¿ƒï¼ˆæ²¡æœ‰await tï¼‰main()æ˜¯å¦å®Œæˆï¼Œå¹¶ä¸å…³å¿ƒåœ¨main()å†…éƒ¨åˆ›å»ºçš„ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚æ²¡æœ‰await tï¼Œå¾ªç¯å…¶ä»–çš„ä»»åŠ¡å¯èƒ½åœ¨å®ƒä»¬å®Œæˆä¹‹å‰å–æ¶ˆã€‚å¦‚æœä½ éœ€è¦è·å–å½“å‰å¾…å¤„ç†çš„ä»»åŠ¡åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨asyncio.Task.all_tasks()ã€‚\n\r\rasyncio.create_task()æ˜¯åœ¨Python3.7ä¸­æå‡ºçš„ã€‚åœ¨Python3.6æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œä½¿ç”¨asyncio.ensure_future()æ›¿æ¢create_task()ã€‚\n\r \rã€€å¦å¤–ï¼Œè¿˜æœ‰asyncio.gather()ã€‚å°½ç®¡ä»–æ²¡åšä»€ä¹ˆç‰¹åˆ«çš„äº‹ï¼Œgather()æ„æ€æ˜¯æŠŠåç¨‹ï¼ˆfutureï¼‰çš„é›†åˆæ•´é½åœ°æ”¾å…¥ä¸€ä¸ªå•ä¸ªçš„futureä¸­ã€‚å®ƒè¿”å›ä¸€ä¸ªfutureå¯¹è±¡ä½œä¸ºç»“æœï¼Œå¦‚æœä½ await asyncio.gather()å¹¶æŒ‡å®šå¤šä¸ªä»»åŠ¡æˆ–åç¨‹ï¼Œä½ éœ€è¦ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆã€‚ï¼ˆè¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼äºå…ˆå‰ä¾‹å­ä¸­queue.join()çš„å¹¶è¡Œç‰ˆï¼‰gather()çš„ç»“æœæ˜¯è¾“å…¥çš„ç»“æœåˆ—è¡¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  \u0026gt;\u0026gt;\u0026gt; import time \u0026gt;\u0026gt;\u0026gt; async def main(): ... t = asyncio.create_task(coro([3, 2, 1])) ... t2 = asyncio.create_task(coro([10, 5, 0])) # Python 3.7+ ... print(\u0026#39;Start:\u0026#39;, time.strftime(\u0026#39;%X\u0026#39;)) ... a = await asyncio.gather(t, t2) ... print(\u0026#39;End:\u0026#39;, time.strftime(\u0026#39;%X\u0026#39;)) # Should be 10 seconds ... print(f\u0026#39;Both tasks done: {all((t.done(), t2.done()))}\u0026#39;) ... return a ... \u0026gt;\u0026gt;\u0026gt; a = asyncio.run(main()) Start: 16:20:11 End: 16:20:21 Both tasks done: True \u0026gt;\u0026gt;\u0026gt; a [[1, 2, 3], [0, 5, 10]]   ã€€ä½ å¯èƒ½æ³¨æ„åˆ°äº†gather()ç­‰å¾…Futureæˆ–ä½ ä¼ é€’çš„åç¨‹çš„å…¨éƒ¨ç»“æœã€‚æˆ–è€…ï¼Œä½ å¯ä»¥éå†asyncio.as_completed()æ¥æŒ‰é¡ºåºè·å–å®Œæˆçš„ä»»åŠ¡ã€‚å‡½æ•°è¿”å›ä¸€ä¸ªåœ¨å®Œæˆä»»åŠ¡æ—¶äº§ç”Ÿä»»åŠ¡çš„è¿­ä»£å™¨ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåœ¨coro([10,5,0])å®Œæˆä¹‹å‰å¯ä»¥ä½¿ç”¨coro([3,2,1])çš„ç»“æœï¼Œåœ¨gather()ä¸­åˆ™ä¸è¡Œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  \u0026gt;\u0026gt;\u0026gt; async def main(): ... t = asyncio.create_task(coro([3, 2, 1])) ... t2 = asyncio.create_task(coro([10, 5, 0])) ... print(\u0026#39;Start:\u0026#39;, time.strftime(\u0026#39;%X\u0026#39;)) ... for res in asyncio.as_completed((t, t2)): ... compl = await res ... print(f\u0026#39;res: {compl} completed at {time.strftime(\u0026#34;%X\u0026#34;)}\u0026#39;) ... print(\u0026#39;End:\u0026#39;, time.strftime(\u0026#39;%X\u0026#39;)) ... print(f\u0026#39;Both tasks done: {all((t.done(), t2.done()))}\u0026#39;) ... \u0026gt;\u0026gt;\u0026gt; a = asyncio.run(main()) Start: 09:49:07 res: [1, 2, 3] completed at 09:49:10 res: [0, 5, 10] completed at 09:49:17 End: 09:49:17 Both tasks done: True   ã€€æœ€åï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°asyncio.ensure_future()ã€‚ä½ åº”è¯¥å¾ˆå°‘éœ€è¦å®ƒï¼Œå› ä¸ºå®ƒæ˜¯è¾ƒä½çº§çš„ç®¡é“APIï¼Œå¹¶ä¸”å¤§å¤šæ•°æƒ…å†µéƒ½èƒ½è¢«create_task()æ›¿ä»£ï¼Œç¨åä¼šä»‹ç»å®ƒã€‚\nawaitä¼˜å…ˆ ã€€å°½ç®¡å®ƒä»¬æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†awaitå…³é”®å­—æ¯”yieldæœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚è¿™æ„å‘³ç€ï¼Œç”±äºç•Œé™ç´§å¯†ï¼Œå› æ­¤åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä½ éœ€è¦åœ¨yield fromè¯­å¥ä¸­ä½¿ç”¨æ‹¬å·ï¼Œè€Œåœ¨ç±»ä¼¼çš„awaitè¯­å¥ä¸­åˆ™ä¸éœ€è¦ã€‚è¯¦æƒ…å‚è€ƒPEP 492å…³äºawaitè¡¨è¾¾å¼çš„ç¤ºä¾‹ã€‚\nç»“è®º ã€€ç°åœ¨ä½ å·²ç»å¯ä»¥ä½¿ç”¨async/awaitå’Œç”±æ­¤æ„å»ºçš„åº“äº†ã€‚è¿™æ˜¯æœ¬ç¯‡æ•™ç¨‹å†…å®¹çš„å›é¡¾ï¼š\n å¼‚æ­¥IOæ˜¯ä¸€ç§è¯­è¨€æ— å…³æ¨¡å‹å’Œä¸€ç§é€šè¿‡è®©åç¨‹ä¹‹é—´é—´æ¥äº¤æµå®ç°æœ‰æ•ˆå¹¶å‘çš„æ–¹å¼ã€‚ Pythonçš„æ–°å…³é”®å­—asyncå’Œawaitï¼Œç”¨æ¥æ ‡è®°å’Œå®šä¹‰åç¨‹ã€‚ asyncioï¼ŒPythonæä¾›è¿è¡Œå’Œç®¡ç†åç¨‹çš„åŒ…ã€‚  èµ„æº Pythonç‰ˆæœ¬ç»†èŠ‚ ã€€Pythonä¸­çš„å¼‚æ­¥IOå‘å±•è¿…é€Ÿï¼Œå¾ˆéš¾è¿½è¸ªä½•æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚ä»¥ä¸‹æ˜¯ä¸asyncioç›¸å…³çš„Pythonç‰ˆæœ¬å˜æ›´åˆ—è¡¨ï¼š\n 3.3ï¼šç”Ÿæˆå™¨ä¸­å…è®¸ä½¿ç”¨yield from 3.4ï¼šåœ¨Pythonæ ‡å‡†åº“ä¸­ä»¥ä¸´æ—¶APIçŠ¶æ€å¼•å…¥asyncio 3.5ï¼šasyncå’Œawaitç§°ä¸ºPythonè¯­æ³•çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æ ‡è¯†å’Œç­‰å¾…åç¨‹ã€‚å®ƒä»¬ä»ä¸æ˜¯ä¿ç•™å­—ã€‚ï¼ˆä½ ä»ç„¶å¯ä»¥å®šä¹‰åä¸ºawaitå’Œasyncçš„å‡½æ•°æˆ–å˜é‡ï¼‰ 3.6ï¼šå¼•å…¥å¼‚æ­¥ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç†è§£ï¼ˆç”Ÿäº§åˆ—è¡¨çš„å·¥å…·ï¼‰ã€‚asyncioçš„APIè¢«å£°æ˜ä¸ºç¨³å®šçš„ï¼Œè€Œä¸æ˜¯ä¸´æ—¶çš„ã€‚ 3.7ï¼šasyncå’Œawaitç§°ä¸ºä¿ç•™å­—ã€‚ï¼ˆä»–ä»¬ä¸èƒ½è¢«ç”¨ä½œæ ‡è¯†ç¬¦ï¼‰å®ƒä»¬æ›¿ä»£äº†asyncio.coroutine()è£…é¥°å™¨ã€‚``asyncioåŒ…å¼•å…¥äº†asyncio.run()`ï¼Œå…¶ä¸­åŒ…æ‹¬è®¸å¤šå…¶å®ƒåŠŸèƒ½ã€‚  ã€€å¦‚æœä½ æƒ³è¦ç¨³ä¸€ç‚¹ï¼ˆå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨asyncio.run()ï¼‰ï¼Œè¯·ä½¿ç”¨Pyhton3.7æˆ–æ›´é«˜ç‰ˆæœ¬è·å–å®Œæ•´çš„åŠŸèƒ½ã€‚\næ–‡ç«  ã€€è¿™æ˜¯é¢å¤–çš„èµ„æºæ¸…å•ï¼š\n Real Python: Speed up your Python Program with Concurrency Real Python: What is the Python Global Interpreter Lock? CPython: The asyncio package source Python docs: Data model \u0026gt; Coroutines TalkPython: Async Techniques and Examples in Python Brett Cannon: How the Heck Does Async-Await Work in Python 3.5? PYMOTW: asyncio A. Jesse Jiryu Davis and Guido van Rossum: A Web Crawler With asyncio Coroutines Andy Pearce: The State of Python Coroutines: yield from Nathaniel J. Smith: Some Thoughts on Asynchronous API Design in a Post-async/await World Armin Ronacher: I donâ€™t understand Pythonâ€™s Asyncio Andy Balaam: series on asyncio (4 posts) Stack Overflow: Python asyncio.semaphore in async-await function Yeray Diaz:  AsyncIO for the Working Python Developer Asyncio Coroutine Patterns: Beyond await    A few Python Whatâ€™s New sections explain the motivation behind language changes in more detail:\n Whatâ€™s New in Python 3.3 (yield from and PEP 380) Whatâ€™s New in Python 3.6 (PEP 525 \u0026amp; 530)  From David Beazley:\n Generator: Tricks for Systems Programmers A Curious Course on Coroutines and Concurrency Generators: The Final Frontier  YouTube talks:\n John Reese - Thinking Outside the GIL with AsyncIO and Multiprocessing - PyCon 2018 Keynote David Beazley - Topics of Interest (Python Asyncio) David Beazley - Python Concurrency From the Ground Up: LIVE! - PyCon 2015 Raymond Hettinger, Keynote on Concurrency, PyBay 2017 Thinking about Concurrency, Raymond Hettinger, Python core developer Miguel Grinberg Asynchronous Python for the Complete Beginner PyCon 2017 Yury Selivanov asyncawait and asyncio in Python 3 6 and beyond PyCon 2017 Fear and Awaiting in Async: A Savage Journey to the Heart of the Coroutine Dream What Is Async, How Does It Work, and When Should I Use It? (PyCon APAC 2014)  ç›¸å…³çš„PEP    PEP Date Created     PEP 342 â€“ Coroutines via Enhanced Generators 2005-05   PEP 380 â€“ Syntax for Delegating to a Subgenerator 2009-02   PEP 3153 â€“ Asynchronous IO support 2011-05   PEP 3156 â€“ Asynchronous IO Support Rebooted: the â€œasyncioâ€ Module 2012-12   PEP 492 â€“ Coroutines with async and await syntax 2015-04   PEP 525 â€“ Asynchronous Generators 2016-07   PEP 530 â€“ Asynchronous Comprehensions 2016-09    æ”¯æŒasync/awaitçš„åº“ ã€€From aio-libs:\n aiohttp: Asynchronous HTTP client/server framework aioredis: Async IO Redis support aiopg: Async IO PostgreSQL support aiomcache: Async IO memcached client aiokafka: Async IO Kafka client aiozmq: Async IO ZeroMQ support aiojobs: Jobs scheduler for managing background tasks async_lru: Simple LRU cache for async IO  From magicstack:\n uvloop: Ultra fast async IO event loop asyncpg: (Also very fast) async IO PostgreSQL support  From other hosts:\n trio: Friendlier asyncio intended to showcase a radically simpler design aiofiles: Async file IO asks: Async requests-like http library asyncio-redis: Async IO Redis support aioprocessing: Integrates multiprocessing module with asyncio umongo: Async IO MongoDB client unsync: Unsynchronize asyncio aiostream: Like itertools, but async  ","description":"ä¸€ç¯‡è®²è§£Pythonå¼‚æ­¥IOåšå®¢çš„è¯‘æ–‡ï¼Œå†…å®¹å¾ˆæ¸…æ™°","id":27,"section":"posts","tags":["python"],"title":"Pythonï¼šå®Œæ•´åœ°äº†è§£å¼‚æ­¥IOï¼ˆè¯‘ï¼‰","uri":"https://yyyIce.github.io/zh/posts/pythonasync-io-in-python-a-complete-walkthrough%E8%AF%91/"},{"content":"ã€€ä¸»è¦æ˜¯ä¸ºäº†å›è°ƒå‡½æ•°çš„ç¼–å†™å’Œé˜…è¯»ï¼Œé¡ºå¸¦äº†ä¸€ç‚¹æŒ‡é’ˆçš„åŸºç¡€å†…å®¹ã€‚\n0.ç†è§£å‰æ ã€€æŒ‡é’ˆçš„å®šä¹‰å’Œè¿ç®—ä¸å†èµ˜è¿°ï¼Œéœ€è¦ç†è§£æŒ‡é’ˆå’Œåœ°å€çš„å…³ç³»ã€‚\nã€€åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œè®¤ä¸ºå˜é‡åè¡¨ç¤ºçš„æ˜¯æ•°æ®æœ¬èº«ï¼Œå‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åè¡¨ç¤ºä»£ç å—æˆ–æ•°æ®å—çš„é¦–åœ°å€ã€‚\nã€€å˜é‡éƒ½å¯¹åº”ä¸€å—å†…å­˜ç©ºé—´ï¼Œæ•´å‹å˜é‡5ï¼Œå¯¹åº”çš„å†…å­˜ç©ºé—´ä¸­å­˜å‚¨çš„å†…å®¹å°±æ˜¯5ï¼Œèµ‹å€¼æ—¶åº”èµ‹ç»™è¿™å—å†…å®¹ä¸€ä¸ªæ•´å‹å€¼ï¼›æŒ‡é’ˆå¯¹åº”çš„è¿™å—å†…å­˜ç©ºé—´å­˜å‚¨çš„å†…å®¹æ˜¯å®ƒæŒ‡å‘çš„æ•°æ®çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨èµ‹å€¼æ—¶åº”å°†ä¸€ä¸ªåœ°å€èµ‹å€¼ç»™æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„æŒ‡é’ˆå°±æ˜¯åœ°å€ã€‚\n printfå‡½æ•°æ—ä¸­å¯¹äº%pä¸€èˆ¬ä»¥åå…­è¿›åˆ¶æ•´æ•°æ–¹å¼è¾“å‡ºæŒ‡é’ˆçš„å€¼ï¼‰\n ã€€ä¾‹å¦‚ï¼šæŒ‡é’ˆpå­˜å‚¨çš„å†…å®¹æ˜¯æ•´å‹å˜é‡cçš„åœ°å€ï¼Œå¯¹på­˜å‚¨çš„å†…å®¹è¿›è¡Œå–å€¼è¿ç®—ï¼ˆ*ï¼‰ï¼Œå³å¯¹åœ°å€å–å€¼ï¼Œpå­˜å‚¨cçš„åœ°å€ï¼Œcä¸­å­˜å‚¨çš„æ˜¯5ï¼Œæ‰€ä»¥*p=5ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  int main() { int c = 5; int * p = \u0026amp;c; printf(\u0026#34;c:%d\t\u0026amp;c:%p\\n\u0026#34;, c, \u0026amp;c); printf(\u0026#34;\u0026amp;p:%p\tp:%p *p:%d\\n\u0026#34;, \u0026amp;p, p, *p); return 0; } é¢„è®¡è¾“å‡ºï¼š c:5 \u0026amp;c:000000000062FE1C \u0026amp;p:000000000062FE10 p:000000000062FE1C *p:5   \rã€€ä¸‹å›¾å·¦ä¾§ä¸€åˆ—ä¸ºåœ°å€ï¼Œå³ä¾§ä¸€åˆ—ä¸ºåœ°å€å•å…ƒä¸­å­˜å‚¨çš„å€¼ã€‚\nå›¾1 \u0026amp;pï¼Œpï¼Œ*pï¼Œcï¼Œ\u0026amp;cçš„å­˜å‚¨ä½ç½®:\r\r 1.void * ã€€void *ï¼Œvoid *è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šæŒ‡é’ˆçš„ç±»å‹ï¼ˆæ•´å‹ã€å­—ç¬¦å‹ç­‰ç­‰ï¼‰ï¼Œå³è¯¥æŒ‡é’ˆå¯ä»¥è¢«æŒ‡å‘ä»»æ„ç±»å‹çš„å˜é‡ã€‚\nã€€(void *) \u0026amp;aï¼Œ æŠŠå˜é‡açš„åœ°å€è½¬æ¢ä¸ºä»»æ„ç±»å‹çš„æŒ‡é’ˆå˜é‡ã€‚\nã€€void *ç±»å‹çš„å˜é‡ç»™åˆ«çš„å˜é‡èµ‹å€¼åº”å¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¾‹ï¼š\n1 2  void * p1 = NULL; int * p2 = (int *)p1;   2.äºŒç»´æ•°ç»„å’ŒæŒ‡é’ˆ ã€€å…ˆæ˜ç¡®æŒ‡é’ˆçš„åŠ ï¼ˆå‡ï¼‰è¿ç®—ï¼Œæ˜¯åŠ ä¸Šï¼ˆå‡å»ï¼‰è¯¥æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ç±»å‹å¤§å°çš„æ•´æ•°å€ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒæŒ‡é’ˆpæ˜¯intç±»å‹ï¼Œå°†ä»–æŒ‡å‘aï¼Œåˆ™p + 1æ˜¯å°†pï¼Œå³a[0]çš„åœ°å€å€¼åŠ ä¸Šä¸€ä¸ªæ•´å‹æ•°æ®çš„å¤§å°ï¼Œå³æŒ‡å‘äº†a[0]çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œa[2]ã€‚\n1 2 3 4 5 6  int a[4] = {1,2,3,4}; int * p = a; for(int i = 0; i \u0026lt; 4; i++) { printf(\u0026#34;%d \u0026#34;,*(p+i)); }   ã€€äºŒç»´æ•°ç»„åœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒæ˜¯çº¿æ€§çš„ï¼ˆa[è¡Œ][åˆ—]ï¼‰ï¼Œæ•´ä¸ªæ•°ç»„å ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ï¼š\nint a[3][4] = {{0,1,2,3}, {4,5,6,7}, {8,9,10,11}};\r\rå›¾2 a[3][4]å†…å­˜åˆ†å¸ƒå›¾:\r\r ã€€å³åªæ˜¯ä¸ºäº†äººç±»ç†è§£ã€ç¼–ç¨‹æ–¹ä¾¿ï¼Œæ‰å°†æ•°ç»„åœ¨é€»è¾‘ä¸Šåˆ†æˆäºŒç»´æ•°ç»„ï¼Œåœ¨å†…å­˜ä¸­ä»æ˜¯ä¸€ç»´æ•°ç»„ã€‚\nã€€æ‰€ä»¥å¤„ç†äºŒç»´æ•°ç»„æ—¶å¯ä»¥æŠŠäºŒç»´æ•°ç»„åˆ†è§£æˆå¤šä¸ªä¸€ç»´æ•°ç»„æ¥å¤„ç†ã€‚a[3][4]å¯ä»¥åˆ†ä¸ºa[0]ï¼Œa[1]ï¼Œa[2]ï¼Œæ¯ä¸ªä¸€ç»´æ•°ç»„ä¸­æœ‰4ä¸ªå…ƒç´ ã€‚\nã€€ä¸‹é¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆå˜é‡pï¼Œå¹¶å°†å®ƒæŒ‡å‘äº†äºŒç»´æ•°ç»„aï¼Œæ­¤æ—¶pç­‰ä»·äºa[0]çš„é¦–åœ°å€ï¼Œp+1åˆ™æ˜¯a[1]çš„é¦–åœ°å€ï¼Œå› ä¸ºæ­¤æ—¶pçš„æŒ‡å‘ç±»å‹æ˜¯int [4]ï¼Œæ‰€ä»¥+1æŒ‡é’ˆä¼šå‘åç§»åŠ¨4ä¸ªintå¤§å°ï¼Œå³æŒ‡é’ˆå€¼åŠ ä¸Š4ä¸ªintå¤§å°ï¼Œå…¶å€¼å°±æ˜¯a[1]çš„åœ°å€ã€‚å¯ä»¥ä»è¾“å‡ºçœ‹å‡ºï¼Œp+1çš„åœ°å€å€¼æ¯”på¤šäº†0x10ï¼Œå³16ï¼Œä¸º4ä¸ªintçš„å¤§å°ã€‚\n1 2 3 4 5 6 7 8  int b[3][4] = {{0,1,2,3}, {4,5,6,7}, {8,9,10,11}}; int (*p)[4] = b; printf(\u0026#34;sizeof(int): %d\\n\u0026#34;,sizeof(int)); printf(\u0026#34;p:%p , p+1:\u0026#34;,p , p+1); //è¾“å‡º \u0026gt;\u0026gt;\u0026gt;sizeof(int): 4 \u0026gt;\u0026gt;\u0026gt;p:000000000062FDC0 , p+1:000000000062FDD0   ã€€ç”¨äºŒç»´æ•°ç»„æŒ‡é’ˆè®¿é—®äºŒç»´æ•°ç»„å…ƒç´ ï¼š\nã€€æ ¹æ®ä¸Šé¢æ‰€è¯´ï¼Œp+1æ˜¯a[1]çš„é¦–åœ°å€ï¼Œæ‰€ä»¥p+1å¯¹åº”çš„å†…å­˜å•å…ƒä¸­å­˜å‚¨çš„æ˜¯\u0026amp;a[1][0]ï¼Œå³a[1]çš„é¦–åœ°å€ï¼Œå³*(p+1)ï¼Œè¦è®¿é—®a[1][1]ï¼Œéœ€è¦æŠŠa[1][0]çš„åœ°å€åŠ ä¸Šä¸€ä¸ªintå¤§å°ï¼Œç„¶åå¯¹è¿™ä¸ªåœ°å€åšå–å€¼è¿ç®—ï¼ˆ*è¿ç®—ï¼‰ï¼Œ\u0026amp;a[1][1]å³*(p+1) + 1ï¼ˆä¹Ÿå¯ä»¥å†™æˆa[1]+1ï¼Œå› ä¸ºa[1]ä»£è¡¨é¦–åœ°å€ï¼‰ï¼Œæ˜¯a[1][1]çš„åœ°å€ï¼Œå¯¹å®ƒåšå–å€¼è¿ç®—ï¼Œa[1][1] = *(*(p+1) + 1)=*(a[1]+1)ï¼Œè®¿é—®å…¶ä»–è¡Œåˆ—çš„å…ƒç´ åŒç†ã€‚\n1 2 3 4 5 6 7 8  int b[3][4] = {{0,1,2,3}, {4,5,6,7}, {8,9,10,11}}; int (*p)[4] = b; printf(\u0026#34;\u0026amp;b[1][0]:%p\\tb[1]:%p\\t*(p+1):%p\\n\u0026#34;,\u0026amp;b[1][0],b[1],*(p+1)); printf(\u0026#34;b[1][0]:%d\\t*(b[1]+1):%d\\t*(*(p+1)+1):%d\\n\u0026#34;,b[1][0],*(b[1]+1),*(*(p+1)+1) ); //è¾“å‡º \u0026gt;\u0026gt;\u0026gt;\u0026amp;b[1][0]:000000000062FDD0 b[1]:000000000062FDD0 *(p+1):000000000062FDD0 \u0026gt;\u0026gt;\u0026gt;b[1][0]:4 *(b[1]+1):5 *(*(p+1)+1):5   ã€€æŒ‡é’ˆæ•°ç»„å’Œæ•°ç»„æŒ‡é’ˆå£°æ˜æ—¶çš„åŒºåˆ«ï¼šæ‹¬å·ä½ç½®\n1 2  int (*p1)[4]; //æ‹¬å·ä¸€å®šåœ¨*p1å¤–ï¼Œ(*p) int *(p2[5]); //è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œè¯¥æ•°ç»„æœ‰5ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯intç±»å‹çš„æŒ‡é’ˆ   3.å‡½æ•°æŒ‡é’ˆ ã€€å‡½æ•°æŒ‡é’ˆå³æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¿™ç§æŒ‡é’ˆå®šä¹‰å¯ä»¥ç”¨ä¸€ä¸ªæ ‡è¯†ç¬¦è¡¨ç¤ºå‚æ•°å’Œè¿”å›å€¼ç±»å‹ç›¸åŒçš„ä»»æ„å‡½æ•°ï¼Œæ–¹ä¾¿ä¿®æ”¹å‡½æ•°å†…å®¹è€Œå¼•ç”¨å‡½æ•°çš„éƒ¨åˆ†æ— éœ€å˜åŠ¨ã€‚\nã€€å‡½æ•°æŒ‡é’ˆçš„å®šä¹‰å½¢å¼ï¼š\n1  returnType (*pointerName)(param list); //æ‹¬å·ä¸èƒ½çœç•¥ï¼Œçœç•¥æ‹¬å·ä¼šå˜æˆè¿”å›å€¼æ˜¯æŒ‡é’ˆçš„å‡½æ•°   ã€€ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11  void haaa(int a, char c) { printf(\u0026#34;a:%d, c:%c\\n\u0026#34;,a,c); } int main() { int (*fun_pointer)(int, char) = NULL; //å¦‚æœæœªæŒ‡å®šåˆå€¼è®°å¾—æŒ‡å‘NULLï¼Œå…»æˆè‰¯å¥½ä¹ æƒ¯  fun_pointer = haaa; //å‡½æ•°åçš„å€¼æ˜¯å‡½æ•°çš„é¦–åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŠŠhaaaèµ‹å€¼ç»™fun_pointer  fun_pointer(1,\u0026#39;x\u0026#39;); return 0; }   ã€€å…¶ä¸­å¯¹äºå‡½æ•°æŒ‡é’ˆçš„èµ‹å€¼ï¼Œç”±äº\u0026amp;haaaå’Œhaaaç­‰ä»·ï¼Œæ‰€ä»¥(* fun_pointer)å°±æ˜¯fun_pointerï¼Œæ‰€ä»¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆçš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œå³è°ƒç”¨æ—¶åŠ ä¸åŠ *éƒ½ä¸€æ ·ã€‚\n1 2 3 4 5  printf(\u0026#34;\u0026amp;haaa:%p, haaa:%p\\n\u0026#34;, \u0026amp;haaa, haaa); \u0026gt;\u0026gt;\u0026gt;\u0026amp;haaa:0000000000401530, haaa:0000000000401530 printf(\u0026#34;fun_pointer:%p, *fun_pointer:%p\\n\u0026#34;, fun_pointer, *fun_pointer); \u0026gt;\u0026gt;\u0026gt;fun_pointer:0000000000401530, *fun_pointer:0000000000401530   1 2 3 4 5 6 7 8 9  //ç»™æŒ‡é’ˆå‡½æ•°èµ‹å€¼ fun_pointer = haaa; //æˆ– fun_pointer = \u0026amp;haaa; //è°ƒç”¨æŒ‡é’ˆå‡½æ•° fun_pointer(1,\u0026#39;x\u0026#39;); //æˆ– (* fun_pointer)(1,\u0026#39;x\u0026#39;);   4.å›è°ƒå‡½æ•° ã€€å›è°ƒå‡½æ•°å°±æ˜¯æŸå‡½æ•°çš„å‚æ•°å«æœ‰è¯¥å‡½æ•°çš„æŒ‡é’ˆï¼Œåˆ™è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°è¢«ç§°ä¸ºå›è°ƒå‡½æ•°ã€‚\nã€€å›è°ƒï¼šæ²¡æœ‰ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä½œä¸ºå‚æ•°è¢«åˆ«çš„å‡½æ•°è°ƒç”¨ã€‚\nã€€åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œtesté€šè¿‡å‚æ•°ä¼ é€’çš„æ–¹å¼è°ƒç”¨äº†ä¼ å…¥çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°çµæ´»åœ°è°ƒç”¨ä¸åŒçš„å‡½æ•°ï¼Œå½“å‡½æ•°æŒ‡é’ˆæŒ‡å‘maxæ—¶ï¼ŒæŠŠè¯¥æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥testï¼Œä¼šåœ¨testå†…æ‰§è¡Œmaxï¼›æŒ‡å‘minæ—¶åŒç†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  #include \u0026lt;stdio.h\u0026gt;int test(int a, int b, int (* callback)(int,int)) { return callback(a,b); } int max(int a, int b) { return a \u0026gt; b ? a : b; } int min(int a, int b) { return a \u0026gt; b ? b : a; } int main() { int ret = 0; ret = test(4, 8, max); printf(\u0026#34;result:%d\\n\u0026#34;, ret); ret = test(4, 8, min); printf(\u0026#34;result:%d\\n\u0026#34;, ret); return 0; } \u0026gt;\u0026gt;\u0026gt;result:8 \u0026gt;\u0026gt;\u0026gt;result:4   ã€€æ³¨ï¼š\nã€€åœ¨Cä¸­è¿˜å¯ä»¥å‘ä¸‹é¢è¿™æ ·å†™ï¼Œå³ä¸å†™æŒ‡é’ˆçš„å‚æ•°ä¸ªæ•°å’Œç±»å‹ï¼Œæ­¤æ—¶æ–‡ä»¶åç¼€å¿…é¡»ä¸º.cï¼Œ.cppä¼šæŠ¥é”™ã€‚å¯èƒ½æ˜¯ä¸è§„èŒƒä½†èƒ½æ‰§è¡Œçš„å†™æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œä½†åº”è¯¥äº†è§£ä»¥ä¾¿äºç¨‹åºçš„é˜…è¯»ã€‚\n1 2 3 4  int test(int a, int b, int (* callback)()) { return callback(a,b); }   ã€€å›è°ƒå‡½æ•°çš„ä½œç”¨ï¼šå¯ä»¥ä½œä¸ºæ¥å£ï¼Œç”±åº”ç”¨å®ç°testå‡½æ•°ï¼Œç¬¬ä¸‰æ–¹å¼€å‘è€…å®ç°callbackå‡½æ•°ï¼Œåº”ç”¨å°±å¯ä»¥å¸®åŠ©ç¬¬ä¸‰æ–¹å¼€å‘è€…æ‰§è¡Œcallbackå‡½æ•°ï¼Œä»è€Œè¾¾åˆ°å¼€æ”¾æ€§å’Œå¯æ‰©å±•æ€§ã€‚è¿™æ ·åº”ç”¨åªéœ€è¦å‘ç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›å¤´æ–‡ä»¶å’ŒåŠ¨æ€é“¾æ¥åº“è€Œæ— éœ€æä¾›æºä»£ç ã€‚ç¬¬ä¸‰æ–¹å¼€å‘è€…é€šè¿‡å¤´æ–‡ä»¶ä¸­çš„å›è°ƒå‡½æ•°æ¥å£ï¼Œç¼–å†™éœ€è¦åº”ç”¨æ‰§è¡Œçš„å‡½æ•°å³å¯ã€‚\n5.åˆ†æç»ƒä¹  ã€€è¯•åˆ†æä¸‹åˆ—ä»£ç ç‰‡æ®µçš„é€»è¾‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  #include \u0026lt;stdio.h\u0026gt;#include \u0026lt;stdlib.h\u0026gt; typedef unsigned long (*bf_hash_handler_type)(void *element); struct bloom_filter { bf_hash_handler_type *handlers; unsigned char *bitmap; unsigned long k, m; }; typedef struct bloom_filter *bf_core_type; bf_core_type bf_create(bf_hash_handler_type handlers[], unsigned long k, unsigned long m) { bf_core_type bf; bf=(bf_core_type)malloc(sizeof(struct bloom_filter)); bf-\u0026gt;k=k; bf-\u0026gt;m=m; bf-\u0026gt;handlers=handlers; bf-\u0026gt;bitmap=(unsigned char *)malloc((m+7)\u0026gt;\u0026gt;3); return bf; } static inline unsigned char bitget(unsigned char *bitmap, unsigned long index) { return 1\u0026amp;(bitmap[index\u0026gt;\u0026gt;3]\u0026gt;\u0026gt;(index\u0026amp;7)); } int bf_has(bf_core_type bf, void *element) { int i; for(i=0; i\u0026lt;bf-\u0026gt;k; i++) { if(!bitget(bf-\u0026gt;bitmap, bf-\u0026gt;handlers[i](element)%bf-\u0026gt;m)) { return 0; } } return 1; } unsigned long simple_hash(void *element) { return *(unsigned long*)element; } //...  int main() { bf_core_type bf; bf_hash_handler_type handlers[]= {simple_hash}; unsigned long handlers_len=sizeof(handlers)/sizeof(bf_hash_handler_type); bf=bf_create(handlers, handlers_len, 100); //....  return 0; }   ã€€ã€€è§£æï¼š\nã€€ç›´æ¥çœ‹mainå‡½æ•°ï¼Œä¸€å…±å››è¡Œã€‚\n ç¬¬ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ªbf_core_typeç±»å‹çš„å˜é‡ï¼Œbf_core_typeæ˜¯struct bloom_filterç±»å‹çš„æŒ‡é’ˆçš„åˆ«åã€‚ ç¬¬äºŒè¡Œåˆå§‹åŒ–äº†ä¸€ä¸ªbf_hash_handler_typeç±»å‹çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„æœ‰ä¸€ä¸ªå…ƒç´ simple_hashï¼Œbf_hash_handler_typeæ˜¯ä¸€ä¸ªå‚æ•°ä¸ºvoid *ç±»å‹ã€è¿”å›å€¼ä¸ºunsigned longç±»å‹çš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶ä¸”è¯¥æŒ‡é’ˆçš„åˆ«åä¸ºbf_hash_handler_typeï¼Œå®šä¹‰å‡½æ•°æŒ‡é’ˆæ—¶å¯ç›´æ¥ï¼š  \r1 2 3  bf_hash_handler_type fun_name; //ç­‰ä»·äº  unsigned long fun_name(void *);    ç¬¬ä¸‰è¡Œè®¡ç®—çš„æ˜¯handlersä¸­æœ‰å‡ ä¸ªå…ƒç´ ï¼Œæ­¤è¡Œçš„è®¡ç®—ç»“æœåº”è¯¥ä¸º1ï¼Œhandlersçš„ç±»å‹æ˜¯æŒ‡é’ˆæ•°ç»„ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯unsigned longï¼Œæ‰€ä»¥handlersçš„å¤§å°åº”è¯¥å’Œbf_hash_handler_typeçš„å¤§å°ç›¸åŒï¼Œä¹Ÿå’Œunsigned long *çš„å¤§å°ç›¸åŒã€‚  \r1 2 3 4 5 6 7 8 9  printf(\u0026#34;sizeof unsigned long:%d\\n\u0026#34;,sizeof(unsigned long)); printf(\u0026#34;sizeof unsigned long *:%d\\n\u0026#34;,sizeof(unsigned long *)); printf(\u0026#34;sizeof handlers:%d\\n\u0026#34;,sizeof(handlers)); printf(\u0026#34;sizeof bf_hash_handler_type:%d\\n\u0026#34;,sizeof(bf_hash_handler_type)); //è¾“å‡º  \u0026gt;\u0026gt;\u0026gt;sizeof unsigned long:4 \u0026gt;\u0026gt;\u0026gt;sizeof unsigned long *:8 \u0026gt;\u0026gt;\u0026gt;sizeof handlers:8 \u0026gt;\u0026gt;\u0026gt;sizeof bf_hash_handler_type:8   \r ç¬¬å››è¡Œè°ƒç”¨äº†bf_createå‡½æ•°ï¼Œä¼ å…¥äº†å‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼Œå’Œä¸¤ä¸ªå€¼ã€‚ åœ¨bf_createå‡½æ•°ä¸­ï¼Œä¸ºmainä¸­çš„bfç”³è¯·äº†å†…å­˜ç©ºé—´ï¼Œå¹¶å¯¹bfè¿›è¡Œåˆå§‹åŒ–ï¼Œæ²¡æœ‰è°ƒç”¨simple_hashã€‚ åœ¨bf_hashå‡½æ•°ä¸­ï¼Œä¼ å…¥äº†å«æœ‰å›è°ƒå‡½æ•°çš„ç»“æ„ä½“bfï¼Œåœ¨bf-\u0026gt;handlers[i](element)%bf-\u0026gt;mè¿™å¥æ‰€åœ¨çš„forå¾ªç¯ä¸­è°ƒç”¨äº†handlersä¸­çš„æ‰€æœ‰æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ã€‚  6.å‚è€ƒä»£ç  ã€€åœ°å€ï¼šhttps://github.com/yyyIce/c_exercise/tree/main/pointer_test\nã€€æœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\nå‚è€ƒèµ„æ–™ ã€€1.äºŒç»´æ•°ç»„æŒ‡é’ˆï¼šhttp://c.biancheng.net/view/2022.html\nã€€2.å›è°ƒå‡½æ•°ï¼šhttps://cloud.tencent.com/developer/article/1457059\n","description":"Cè¯­è¨€æŒ‡é’ˆçš„ç”¨æ³•å’Œç¤ºä¾‹","id":28,"section":"posts","tags":["c"],"title":"Cè¯­è¨€ï¼šæŒ‡é’ˆ","uri":"https://yyyIce.github.io/zh/posts/c%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88/"},{"content":"ã€€æ³¨æ„é¢˜ç›®ï¼šCè¯­è¨€ï¼Œä¸æ˜¯C+ã€‚\nã€€æœ¬æ–‡é€‚åˆå¯¹Cè¯­è¨€æœ‰ä¸€å®šç†è§£ï¼Œåªå­˜åœ¨éƒ¨åˆ†æ¦‚å¿µæ¨¡ç³Šçš„äººç¾¤é˜…è¯»ï¼Œä¸é€‚åˆåˆå­¦è€…ï¼Œå‚è€ƒèµ„æ–™åˆ—åœ¨æ–‡ç« æœ€åã€‚\nã€€æœ¬æ–‡çš„ç›®æ ‡æ˜¯å½»åº•ç†è§£ç»“æ„ä½“ï¼Œåœ¨éœ€è¦ä½¿ç”¨ç»“æ„ä½“æ—¶ï¼Œå…‰é€Ÿä¸”æ­£ç¡®åœ°å†™å®Œç›¸å…³ä»£ç ï¼Œåšæ˜æ˜ç™½ç™½çš„å·¥å…·äººã€‚\n0.å˜é‡çš„å®šä¹‰ã€å£°æ˜ã€åˆå§‹åŒ– ã€€å˜é‡çš„å£°æ˜ï¼Œæ˜¯å‘ç¨‹åºè¡¨æ˜å˜é‡çš„ç±»å‹å’Œåå­—ã€‚å¦‚ç»“æ„ä½“ç±»å‹å£°æ˜ã€å‡½æ•°å£°æ˜ç­‰ï¼Œåœ¨ä»…å£°æ˜æ—¶ï¼Œä¸åˆ†é…å†…å­˜ç©ºé—´ã€‚\nã€€å®šä¹‰ä¹Ÿæ˜¯å£°æ˜ï¼Œä½†åœ¨å®šä¹‰æ—¶ï¼Œä¸ºå˜é‡åˆ†é…å†…å­˜ç©ºé—´ã€‚\n1 2  int a; //æ˜¯å®šä¹‰ï¼Œä¹Ÿæ˜¯å£°æ˜ï¼Œæœªåˆå§‹åŒ– extern int a; //æ˜¯å£°æ˜ï¼Œä¸æ˜¯å®šä¹‰ï¼Œæœªåˆå§‹åŒ–   ã€€å£°æ˜ä¸»è¦æ˜¯ä¸ºäº†(æå‰)ä½¿ç”¨å£°æ˜çš„å†…å®¹ï¼Œå£°æ˜çš„ä½œç”¨ä¸¾ä¾‹ï¼š\n ä¸å£°æ˜ç»“æ„ä½“ç±»å‹ï¼Œåˆ™æ— æ³•åœ¨åæ¥éœ€è¦æ—¶æ‰å®šä¹‰ç»“æ„ä½“ç±»å‹çš„å˜é‡ã€‚ å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°fun_1ï¼Œåœ¨æ–‡ä»¶çš„ä»£ç é¡ºåºä¸­å®ƒå®šä¹‰åœ¨è°ƒç”¨å®ƒçš„å‡½æ•°fun_2åé¢ï¼Œæ­¤æ—¶å¦‚æœä¸æ›´æ”¹å®šä¹‰é¡ºåºï¼Œåˆ™å¿…é¡»åœ¨æ–‡ä»¶å¼€å§‹å¤„å£°æ˜fun_1ã€‚  ã€€å˜é‡åˆå§‹åŒ–å°±æ˜¯èµ‹äºˆå˜é‡ä¸€ä¸ªåˆå§‹å€¼ï¼š\n1 2 3 4  int a; //å®šä¹‰å˜é‡ a = 5; //åˆå§‹åŒ– //æˆ– int b = 10; //åœ¨å˜é‡å®šä¹‰çš„åŒæ—¶åˆå§‹åŒ–   1.ç»“æ„ä½“ç±»å‹çš„å®šä¹‰å’Œå£°æ˜ (1)struct \u0026lt;ç»“æ„ä½“å\u0026gt;{\nâ€‹ ç±»å‹ \u0026lt;æˆå‘˜å\u0026gt; ;\nâ€‹ ç±»å‹ \u0026lt;æˆå‘˜å\u0026gt; ;\nâ€‹ \u0026hellip;\n}ï¼›\n1 2 3 4 5 6 7  //ä¾‹å¦‚ï¼š struct student_t { char name[128]; int sex; int age; };   (2)å¯åœ¨å£°æ˜ç»“æ„ä½“çš„åŒæ—¶å®šä¹‰å˜é‡ï¼Œå¦‚ä¸‹æ–‡ä»£ç ï¼Œåœ¨å£°æ˜ç±»å‹struct student_tçš„åŒæ—¶ï¼Œè¿˜å®šä¹‰äº†2ä¸ªå˜é‡ï¼Œ student1 å’Œ student2 ï¼Œå®ƒä»¬çš„ç±»å‹æ˜¯struct student_tã€‚\n1 2 3 4 5 6  struct student_t { char name[128]; int sex; int age; }student1,student2;   (3)ä¹Ÿå¯ä»¥ä¸å†™ç»“æ„ä½“åï¼Œç›´æ¥å®šä¹‰ç»“æ„ä½“å˜é‡ï¼š\n1 2 3 4 5 6  struct { char name[128]; int sex; int age; }student;   2.ç»“æ„ä½“çš„åˆå§‹åŒ–å’Œå†…å­˜ç©ºé—´åˆ†é… (1)å®šä¹‰æ—¶èµ‹å€¼ 1  struct student_t s1 = { \u0026#34;Sarah\u0026#34;, 0, 18};   (2)å®šä¹‰åé€ä¸ªèµ‹å€¼ ç†è®ºä¸Šåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4  struct student_t s2; s2.name = \u0026#34;Sam\u0026#34;; //æ­¤å¥æŠ¥é”™ s2.sex = 1; s2.age = 19;   è§£é‡Šï¼šä¸èƒ½åœ¨å®šä¹‰ä»¥å¤–çš„åœ°æ–¹æŠŠå­—ç¬¦ä¸²èµ‹å€¼ç»™ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚\n1 2 3  char a[10] = \u0026#34;hello\u0026#34;; //è¿™æ ·å¯ä»¥ï¼Œè¿™ç§æƒ…å†µæ˜¯cè¯­è¨€åˆå§‹åŒ–æ‰€æ”¯æŒçš„ï¼Œæ­¤æ—¶\u0026#34;hello\u0026#34;æ²¡æœ‰å­˜å‚¨åœ¨å¸¸é‡åŒº char b[10]; b = \u0026#34;hello\u0026#34;; //è¿™æ ·ä¸è¡Œï¼Œä¸èƒ½æŠŠå­—ç¬¦ä¸²èµ‹å€¼ç»™ä¸€ä¸ªæ•°ç»„ï¼Œæ­¤æ—¶\u0026#34;hello\u0026#34;å­˜å‚¨åœ¨å¸¸é‡åŒº   ã€€åŒå¼•å·\u0026quot;\u0026quot;åœ¨å¸¸é‡åŒºç”³è¯·å†…å­˜ç©ºé—´å¹¶å­˜æ”¾å­—ç¬¦ä¸²helloï¼Œå¹¶åœ¨å­—ç¬¦ä¸²å°¾åŠ å…¥\\0ï¼Œæœ€åè¿”å›ç”³è¯·çš„å†…å­˜ç©ºé—´çš„åœ°å€ï¼Œbæ˜¯æ•°ç»„çš„é¦–åœ°å€ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œç¼–è¯‘å™¨ä¸å…è®¸æ›´æ”¹å­˜å‚¨åœ¨å¸¸é‡åŒºçš„å†…å®¹ï¼Œå³å®ƒä¸æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚å·¦å€¼å°±æ˜¯æŒ‡åœ¨ç¨‹åºä¸­å ç”¨å†…å­˜ç©ºé—´ã€å¯ä»¥è¢«ä¿®æ”¹çš„é‡,æ¯”å¦‚å„ç§å˜é‡ã€‚\nã€€æ›´æ”¹ï¼šå°†nameçš„ç±»å‹æ”¹ä¸ºå­—ç¬¦æŒ‡é’ˆchar *ï¼Œæ­¤æ—¶å†è¿›è¡Œèµ‹å€¼åˆ™ä¸ä¼šå‡ºç°é—®é¢˜ã€‚s2.nameæ˜¯ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼ŒæŒ‡é’ˆçš„æœ¬è´¨å°±æ˜¯åœ°å€ï¼Œå³æŒ‡é’ˆè¿™å—å†…å­˜ç©ºé—´å­˜å‚¨ç€å…¶æŒ‡å‘å†…å®¹çš„å†…å­˜åœ°å€ï¼Œå‡è®¾Samè¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ä¸ºaddrï¼Œåˆ™s2.nameç”³è¯·çš„ç©ºé—´ä¸­å­˜å‚¨ç€addrï¼Œåœ¨å¯»å€æ—¶å–å‡ºaddrï¼Œå³å¯æ‰¾åˆ°å­˜å‚¨çš„å†…å®¹Samã€‚\n1 2 3 4 5 6 7 8 9 10  struct student_t { char * name; int sex; int age; }; struct student_t s2; s2.name = \u0026#34;Sam\u0026#34;; //ä¸æŠ¥é”™ s2.sex = 1; s2.age = 19;   ã€€è¿™æ—¶å€™å¯èƒ½æœ‰äººè¦æé—®äº†ï¼Œæ—¢ç„¶s2.nameä¸­å­˜å‚¨çš„æ˜¯addrï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘è¾“å‡ºs2.nameï¼Œä¼šè¾“å‡ºSamè€Œä¸æ˜¯addrå‘¢ï¼Ÿè¿™æ˜¯printfçš„å®ç°æœºåˆ¶å†³å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬é€‰ç”¨%pæ ¼å¼ï¼Œåˆ™ä¼šè¾“å‡ºå­˜å‚¨æ•°å€¼çš„åœ°å€ï¼Œå¦‚æœç”¨%dï¼Œ%cï¼Œåˆ™ä¼šè¾“å‡ºåœ°å€ä¸­å­˜å‚¨çš„æ•°å€¼ï¼Œå¦‚æœä½¿ç”¨%sï¼Œåˆ™ä¼šè¾“å‡ºé¦–åœ°å€åŠå…¶ä½™åœ°å€å­˜å‚¨çš„å­—ç¬¦ä¸²å†…å®¹ã€‚æµ‹è¯•ä»£ç åŠç»“æœå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  struct student_t s4; char a[10] = \u0026#34;Sally\u0026#34;; s4.name = a; //aæ˜¯æ•°ç»„é¦–åœ°å€ s4.sex = 1; s4.age = 19; printf(\u0026#34;%p\\n\u0026#34;, a); //%på¯ä»¥è¾“å‡ºå˜é‡å­˜å‚¨çš„åœ°å€ï¼Œ000000000062FD50 printf(\u0026#34;%s\\n\u0026#34;, a); //%så¯»å€ï¼Œè¾“å‡ºåœ°å€å†…å­˜å‚¨çš„å†…å®¹ï¼ŒSally printf(\u0026#34;%p\\n\u0026#34;, s4.name); //è¾“å‡ºs4.nameå­˜å‚¨(æŒ‡å‘)çš„åœ°å€ï¼Œ000000000062FD50ï¼Œå¯ä»¥å‘ç°ä¸açš„åœ°å€ç›¸åŒ printf(\u0026#34;%p\\n\u0026#34;, \u0026amp;s4.name); //è¾“å‡ºs4.nameæœ¬èº«çš„åœ°å€ï¼Œ000000000062FD60 printf(\u0026#34;%c\\n\u0026#34;, *s4.name); //æ³¨æ„ä½¿ç”¨%cï¼Œ\u0026#39;*\u0026#39;ä¸ºå–åœ°å€ä¸­å­˜å‚¨çš„æ•°å€¼ï¼Œs4.nameä¸­å­˜å‚¨çš„å†…å®¹æ˜¯ç¬¬ä¸€ä¸ªå­—æ¯\u0026#39;S\u0026#39; printf(\u0026#34;%s\\n\u0026#34;, s4.name); //%sï¼Œè¾“å‡ºs4.nameè¿™ä¸€ä¸²åœ°å€å­˜å‚¨çš„å†…å®¹ï¼ŒSally printf(\u0026#34;%p\\n\u0026#34;, \u0026amp;*s4.name); //è¾“å‡ºs4.nameå­˜å‚¨å†…å®¹\u0026#39;S\u0026#39;çš„åœ°å€ï¼Œ 000000000062FD50   ã€€æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®è´¨ä¸Šaå’Œs4.nameçš„åœ°å€æ˜¯ç›¸åŒçš„ã€‚åœ¨å®é™…ç¨‹åºè°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨gdbç­‰è°ƒè¯•å·¥å…·æŸ¥çœ‹å†…å­˜åœ°å€ï¼Œä¸å»ºè®®ä½¿ç”¨è¾“å‡ºçš„æ–¹å¼ã€‚\n(3)å®šä¹‰æ—¶ä¹±åºèµ‹å€¼\n1 2 3 4 5 6  struct student_t s5 = { .name = \u0026#34;Tom\u0026#34;, .sex = 1, .age = 10 }; printf(\u0026#34;%s, %d, %d\\n\u0026#34;, s5.name, s5.sex, s5.age);   (4)å†…å­˜ç©ºé—´å ç”¨\nã€€Cè¯­è¨€ä¸æ˜¯å†…å­˜å®‰å…¨çš„ï¼Œéœ€è¦ç¼–ç¨‹äººå‘˜è‡ªå·±ç®¡ç†å†…å­˜ï¼Œæ‰€ä»¥åº”å¯¹å†…å­˜ç©ºé—´çš„åˆ†é…æœ‰æ¸…æ™°çš„è®¤è¯†ã€‚ç°åœ¨æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨ï¼Œç­‰ç”¨åˆ°å°±æ‡µäº†ã€‚åŸºæœ¬ç±»å‹çš„å†…å­˜ç©ºé—´å ç”¨ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7  printf(\u0026#34;void:%d\\n\u0026#34;,sizeof(void)); //1 printf(\u0026#34;char:%d\\n\u0026#34;,sizeof(char)); //1 printf(\u0026#34;short:%d\\n\u0026#34;,sizeof(short)); //2 printf(\u0026#34;int:%d\\n\u0026#34;,sizeof(int)); //4 printf(\u0026#34;long:%d\\n\u0026#34;,sizeof(long)); //4(win64),8(ubuntu18) printf(\u0026#34;float:%d\\n\u0026#34;,sizeof(float)); //4 printf(\u0026#34;double:%d\\n\u0026#34;,sizeof(double)); //8   ã€€æŒ‡é’ˆç±»å‹çš„ç©ºé—´å ç”¨ï¼Œå’ŒæŒ‡é’ˆçš„åŸºæœ¬ç±»å‹æ— å…³ï¼Œå’Œè®¡ç®—æœºä¸€æ¬¡èƒ½å¤Ÿå¤„ç†çš„æ“ä½œæ•°å¤§å°æœ‰å…³ï¼Œä¿—ç§°å­—é•¿ï¼ˆå…³äºå­—å’Œå­—é•¿å¯å‚è€ƒã€Šæ±‡ç¼–è¯­è¨€ã€‹-ç‹çˆ½ï¼‰ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œèƒ½å¤Ÿå¤„ç†çš„æ“ä½œæ•°å¤§å°ä¸º64bitï¼Œæ‰€ä»¥æŒ‡é’ˆç±»å‹çš„å¤§å°ä¸º8å­—èŠ‚ï¼Œå¦‚char *ï¼Œint *ï¼Œ struct example1_t *ï¼Œå…¶å¤§å°éƒ½æ˜¯8å­—èŠ‚ã€‚32ä½æ“ä½œç³»ç»ŸæŒ‡é’ˆçš„å¤§å°å°±ä¸º4å­—èŠ‚ã€‚\n1 2 3 4 5 6  char * c; int * d; struct example1_t * e; printf(\u0026#34;char * c:%d\\n\u0026#34;,sizeof(c)); printf(\u0026#34;int * d:%d\\n\u0026#34;,sizeof(d)); printf(\u0026#34;example1 * e:%d\\n\u0026#34;,sizeof(e));   ã€€ç»“æ„ä½“çš„å†…å­˜ç©ºé—´å ç”¨ä¸èƒ½å•çº¯çš„å°†ç»“æ„ä½“ä¸­çš„æ‰€æœ‰ç±»å‹å¤§å°ç›¸åŠ ï¼Œä»¥ä¸‹é¢ä¸¤ä¸ªç»“æ„ä½“ä¸ºä¾‹ï¼Œè¿™ä¸¤ä¸ªç»“æ„ä½“å†…çš„å˜é‡å’Œå˜é‡ç±»å‹å®Œå…¨ç›¸åŒï¼Œ ä½†å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°ä¸åŒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  struct example1_t { char a; int b; short c; }; struct example2_t { char a; short c; int b; }; printf(\u0026#34;example1: %d\\n\u0026#34;,sizeof(struct example1_t)); //12B printf(\u0026#34;example2: %d\\n\u0026#34;,sizeof(struct example2_t)); //8B   ã€€è¿™æ˜¯å› ä¸ºç»“æ„ä½“åœ¨å­˜å‚¨æ—¶ï¼Œä»¥ç»“æ„ä½“ä¸­å ç”¨ç©ºé—´æœ€å¤§çš„åŸºæœ¬å˜é‡ç±»å‹ä¸ºä¸€ä¸ªå•å…ƒï¼ŒæŒ‰ç»“æ„ä½“ä¸­çš„å˜é‡å®šä¹‰é¡ºåºå¼€è¾Ÿä¸€ä¸ªåˆä¸€ä¸ªå•å…ƒçš„ç©ºé—´ã€‚\nã€€åœ¨example1_tä¸­ï¼Œå ç”¨ç©ºé—´æœ€å¤§çš„å˜é‡ç±»å‹ä¸ºintï¼Œæ‰€ä»¥ä»¥4å­—èŠ‚ä¸ºä¸€ä¸ªå•å…ƒå¼€è¾Ÿç©ºé—´ã€‚ç¬¬ä¸€ä¸ªå•å…ƒå­˜æ”¾charç±»å‹çš„aåï¼Œè¿˜å‰©3ä¸ªå­—èŠ‚ï¼Œä¸å¤Ÿç»§ç»­å­˜æ”¾bï¼Œæ‰€ä»¥å¼€è¾Ÿç¬¬äºŒä¸ªå¤§å°ä¸º4å­—èŠ‚çš„å•å…ƒï¼Œå­˜æ”¾bï¼Œbçš„ç±»å‹ä¸ºintï¼Œç¬¬äºŒä¸ªå•å…ƒè¢«æ”¾æ»¡ï¼Œæ‰€ä»¥å¼€è¾Ÿç¬¬ä¸‰ä¸ªå¤§å°ä¸º4å­—èŠ‚çš„å•å…ƒï¼Œå­˜æ”¾cã€‚ä¸€å…±å¼€è¾Ÿäº†ä¸‰ä¸ª4å­—èŠ‚çš„å•å…ƒï¼Œæ‰€ä»¥example1_tçš„å ç”¨çš„ç©ºé—´å¤§å°ä¸º3 * 4 = 12 å­—èŠ‚ã€‚\nã€€åœ¨example2_tä¸­ï¼Œä»æ˜¯ä»¥intçš„å¤§å°ä½œä¸ºå•å…ƒå¤§å°ï¼Œä¸example1_tä¸åŒçš„æ˜¯ï¼Œç¬¬äºŒä¸ªå®šä¹‰çš„æ˜¯cï¼Œcæ˜¯2å­—èŠ‚çš„shortç±»å‹ï¼Œå¯ä»¥å’Œaæ”¾åœ¨åŒä¸€å†…å­˜å•å…ƒä¸­ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå•å…ƒå‰©1å­—èŠ‚ï¼Œä¸å¤Ÿå­˜æ”¾bï¼Œäºæ˜¯å¼€è¾Ÿç¬¬äºŒä¸ª4å­—èŠ‚å†…å­˜å•å…ƒã€‚ä¸€å…±å¼€è¾Ÿäº†2ä¸ª4å­—èŠ‚çš„å•å…ƒï¼Œæ‰€ä»¥example2_tå ç”¨çš„ç©ºé—´å¤§å°ä¸º2 * 4 = 8 å­—èŠ‚ã€‚\nã€€åœ¨ç»“æ„ä½“ä¸­æœ‰æ•°ç»„æ—¶ï¼Œæ•°ç»„å°±ç›¸å½“äºè‹¥å¹²ä¸ªè¯¥ç±»å‹çš„å…ƒç´ ï¼Œå¦‚ä¸‹é¢çš„example3_tï¼Œå…¶ä¸­çš„char b[4]å°±ç›¸å½“äº4ä¸ªchar bï¼Œåˆ™ç¬¬ä¸€ä¸ª4å­—èŠ‚å†…å­˜å•å…ƒå­˜æ”¾aï¼Œb[0]ï¼Œb[1]ï¼Œb[2]ï¼›ç¬¬äºŒä¸ªå•å…ƒå­˜æ”¾b[3]å’Œcï¼›æœ€åä¸€ä¸ªå•å…ƒå­˜æ”¾dï¼Œæ‰€ä»¥example3_tçš„å¤§å°ä¸º3 * 4 = 12 å­—èŠ‚ã€‚\n1 2 3 4 5 6  struct example3_t { char a; char b[4]; short c; int d; };   ã€€example1_tã€example2_tã€example3_tçš„ç©ºé—´å ç”¨å›¾ç¤ºï¼š\nå›¾1 example1_tã€example2_tã€example3_tçš„ç©ºé—´å ç”¨:\r\r ã€€æ‰€ä»¥ç»“æ„ä½“å ç”¨çš„ç©ºé—´å¤§å°åº”æ˜¯ç»“æ„ä½“ä¸­å ç”¨ç©ºé—´æœ€å¤§çš„åŸºæœ¬å˜é‡ç±»å‹çš„æ•´æ•°å€ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å‡†ç¡®åœ°è®¡ç®—å‡ºæ¥ã€‚åŸºæœ¬å˜é‡ç±»å‹åŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦å‹ã€æŒ‡é’ˆã€æ— å€¼å‹(void)ã€‚\nã€€é‚£å¦‚æœç»“æ„ä½“ä¸­å«æœ‰ç»“æ„ä½“æ—¶ï¼Œå ç”¨ç©ºé—´æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå½“ç»“æ„ä½“ä¸­å«æœ‰ç»“æ„ä½“æ—¶ï¼Œä»¥å…¶ä¸­çš„æ‰€æœ‰åŸºæœ¬å˜é‡ç±»å‹ä¸­å ç”¨ç©ºé—´æœ€å¤§çš„ä¸ºå•å…ƒå¤§å°ã€‚ä»¥ä¸‹åˆ—ä¸¤ä¸ªç»“æ„ä½“ä¸ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9  struct example4_t { char a; int b; double c; }; struct example5_t { char a; struct example4_t c; };   ã€€ç»“æ„ä½“example_4çš„å¤§å°ä¸º16å­—èŠ‚ï¼Œç»“æ„ä½“example5_tçš„å¤§å°ä¸º24å­—èŠ‚ã€‚\n3.typedefä¸ç»“æ„ä½“ç»“åˆä½¿ç”¨ ã€€æˆ‘ä»¬ç»å¸¸åœ¨å£°æ˜ç»“æ„ä½“çš„æ—¶å€™çœ‹åˆ°ä¸typedefè¿ç”¨ï¼Œäºæ˜¯å°±åˆæ‡µäº†ï¼Œé‚£ä¹ˆè¿™é‡Œçš„typedefåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\nã€€typedefæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå¸¸ç”¨ä½œç»™ç±»å‹èµ·ä¸€ä¸ªåˆ«åï¼Œä½¿ç”¨å½¢å¼ä¸º\n1  typedef \u0026lt;æ—§å˜é‡å\u0026gt; \u0026lt;æ–°å˜é‡å\u0026gt;;   ã€€ä¸‹åˆ—ä»£ç ç»™intç±»å‹èµ·äº†åˆ«åios_intï¼Œåœ¨å®šä¹‰å˜é‡bæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ios_intæ¥å®šä¹‰bï¼Œå…¶å«ä¹‰ä¸int bç›¸åŒã€‚\n1 2 3  typedef int ios_int; int a; ios_int b;   ã€€å¦‚ä½•ä½¿ç”¨typedefç»™ç»“æ„ä½“ç±»å‹èµ·åˆ«åå‘¢ï¼Ÿ\n1 2 3 4 5 6  typedef struct student_t { char name[128]; int sex; int age; }student;   ã€€æ­¤æ—¶ç›¸å½“äºtypedef struct student_t{} studentï¼Œå³studentæ˜¯struct stutent_tçš„åˆ«åï¼Œæ­¤æ—¶studentä¸å†æ˜¯å®šä¹‰çš„ä¸€ä¸ªå˜é‡ï¼Œè€Œæ˜¯åˆ«åï¼Œè¦æ³¨æ„ä¸å‰è¾¹struct student_t {...} student;è¿›è¡ŒåŒºåˆ†ã€‚åœ¨å˜é‡å®šä¹‰æ—¶ï¼š\n1 2 3  student a; //ç­‰ä»·äº struct student_t a;   4.ç»“æ„ä½“æŒ‡é’ˆ ã€€ç»“æ„ä½“æŒ‡é’ˆéœ€è¦ç”³è¯·å†…å­˜ç©ºé—´åæ‰å¯ä»¥å¯¹å…ƒç´ èµ‹å€¼ï¼ˆä¸ç„¶æŒ‡é’ˆåªæœ‰8å­—èŠ‚ï¼Œå­˜å‚¨åœ°å€ï¼Œèµ‹äºˆçš„è¿™äº›å€¼æ²¡æœ‰ä½ç½®å­˜æ”¾ï¼‰ï¼Œæˆ–è€…ç›´æ¥å°†ç»“æ„ä½“æŒ‡é’ˆç›´æ¥æŒ‡å‘å·²æœ‰ç»“æ„ä½“ã€‚\n1 2 3 4 5 6 7 8 9  struct student_t { char name[128]; int sex; int age; }student; student b = {\u0026#34;Lee\u0026#34;, 1, 19}; student * a; a = \u0026amp;b;   ã€€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·å†…å­˜ç©ºé—´ï¼Œè¯¥å‡½æ•°åŒ…å«åœ¨å¤´æ–‡ä»¶\u0026lt;stdlib.h\u0026gt;ä¸­ã€‚æ³¨æ„ç”³è¯·çš„ç©ºé—´å¤§å°ä¸å¯ä»¥å¸¦æ˜Ÿå·ï¼Œ'*\u0026lsquo;è¡¨ç¤ºæŒ‡é’ˆï¼ŒæŒ‡é’ˆå¤§å°ä¸ç­‰äºç»“æ„ä½“å¤§å°ï¼Œæˆ‘ä»¬ç”³è¯·ç©ºé—´æ˜¯ç”¨æ¥æ¥å­˜æ”¾ç»“æ„ä½“ä¸­çš„æ•°æ®çš„ã€‚\n1 2 3 4  void* malloc (size_t size); //(ç”³è¯·ç©ºé—´çš„å˜é‡ç±»å‹)malloc(ç”³è¯·çš„ç©ºé—´å¤§å°) //ä¾‹ï¼š student * a = (student *)malloc(sizeof(student)); a-\u0026gt;age = 19;   5.åˆ†æç»ƒä¹  ã€€å¦‚æœå¯¹ä»¥ä¸Š5ç‚¹éƒ½ç†Ÿæ‚‰äº†ä»¥åå¯ä»¥æ¥çœ‹è¿™æ ·ä¸€ä¸ªç»“æ„ä½“(ä»£ç æ¥è‡ªäºä¸çŸ¥é“å“ªä½)è¿›è¡Œç»ƒä¹ ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  typedef struct _p_data_analysis { char p_type[8]; //åŒ…ç±»å‹  int time[6]; //æ—¶é—´æˆ³  int len; //é•¿åº¦  struct _ethernet_h *eth_hdr; //ä»¥å¤ªç½‘å¸§å¤´  struct _arp_h *arp_hdr; //arpåŒ…å¤´  struct _ip_h *ip_hdr; //ipåŒ…å¤´  struct _icmp_h *icmp_hdr; //icmpåŒ…å¤´  struct _udp_h *udp_hdr; //udpåŒ…å¤´  struct _tcp_h *tcp_hdr; //tcpåŒ…å¤´  }p_data_analysis;   ã€€è¯·å®Œæˆä»¥ä¸‹ç»ƒä¹ ï¼š\nã€€ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªè¯¥ç±»å‹çš„å˜é‡\nï¼ˆ2ï¼‰è®¡ç®—è¯¥ç±»å‹å ç”¨çš„ç©ºé—´å¤§å°(win64ç³»ç»Ÿ)\nï¼ˆ3ï¼‰å®šä¹‰ä¸€ä¸ªè¯¥ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œå…¶ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå¹¶ç”¨memsetæ¸…0\nï¼ˆ4ï¼‰æ ¹æ®ï¼ˆ3ï¼‰ä¸­å®šä¹‰çš„æŒ‡é’ˆå˜é‡ï¼Œä¸º.eth_hdrç”³è¯·å†…å­˜ç©ºé—´\nå‚è€ƒç­”æ¡ˆï¼š\nã€€ï¼ˆ1ï¼‰typedefç»™struct _p_data_analysiså®šä¹‰åˆ«åp_data_analysisï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼å®šä¹‰ï¼š\n1 2 3  struct _p_data_analysis a; //æˆ– p_data_analysis a;   ã€€ï¼ˆ2ï¼‰win64ç³»ç»Ÿçš„æŒ‡é’ˆå¤§å°ä¸º8å­—èŠ‚ï¼Œè¯¥ç»“æ„ä½“ä»¥8å­—èŠ‚ä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œå­˜å‚¨ï¼Œp_typeå ç”¨1ä¸ªå•å…ƒï¼Œtimeå ç”¨3ä¸ªå•å…ƒï¼Œlenå ç”¨1ä¸ªå•å…ƒï¼Œ6ä¸ªæŒ‡é’ˆå ç”¨6ä¸ªå•å…ƒï¼Œä¸€å…±éœ€è¦1 + 3 + 1 + 6 = 11ä¸ªå•å…ƒï¼Œæ¯ä¸ªå•å…ƒ8å­—èŠ‚ï¼Œæœ€ç»ˆå ç”¨çš„ç©ºé—´å¤§å°ä¸º11 * 8 = 88 å­—èŠ‚ã€‚\nã€€ï¼ˆ3ï¼‰\n1 2 3 4 5 6 7 8  p_data_analysis * data = (p_data_analysis *)malloc(sizeof(p_data_analysis)); //æˆ– struct _p_data_analysis * data = (struct _p_data_analysis *)malloc(sizeof(struct _p_data_analysis)); memset(data, 0, sizeof(p_data_analysis)); //æˆ– memset(data, 0, sizeof(struct _p_data_analysis));   ã€€ï¼ˆ4ï¼‰\n1  data-\u0026gt;eth_hdr = (struct _ethernet_h *)malloc(sizeof(struct _ethernet_h));   å‚è€ƒä»£ç  ã€€åœ°å€ï¼šhttps://github.com/yyyIce/c_exercise/tree/main/struct_test\nã€€æœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\nå‚è€ƒèµ„æ–™ ã€€ç»“æ„ä½“å†…å­˜ç©ºé—´çš„å ç”¨ï¼šhttps://blog.csdn.net/fb2058/article/details/15502071\n","description":"Cè¯­è¨€ç»“æ„ä½“çš„ç”¨æ³•å’Œç¤ºä¾‹","id":29,"section":"posts","tags":["c"],"title":"Cè¯­è¨€ï¼šç»“æ„ä½“çš„ä½¿ç”¨","uri":"https://yyyIce.github.io/zh/posts/c%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93/"},{"content":"1.å¿«é€Ÿäº†è§£ typedefç”¨æ¥ä¸ºæ•°æ®ç±»å‹èµ·åˆ«åï¼Œè¿™æ ·åœ¨é˜…è¯»æ—¶èƒ½å¤Ÿæ›´æ¸…æ™°åœ°ç†è§£ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®©å˜é‡åå˜çŸ­ã€‚\nä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œstruct studentå¾ˆé•¿(ä½†æ˜¯å¯ä»¥è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹çš„å˜é‡)ã€‚\n1 2 3 4 5  struct student{ char * name; int sex; } struct student a;   æˆ‘ä»¬å¯ä»¥ç”¨typedefæ¥å°†struct studentç¼©çŸ­\n1  typedef struct student stu;   è€Œæˆ‘ä»¬æ›´å¸¸è§çš„å½¢å¼æ˜¯ä¸‹é¢è¿™æ ·ï¼Œåœ¨å£°æ˜çš„åŒæ—¶å®šä¹‰åˆ«åï¼š\n1 2 3 4 5 6 7  typedef struct student{ char * name; int sex; }stu; struct student a; //ç­‰ä»·äº stu a;   2.typedefç”¨æ³• å…³é”®å­—typedefå¯ä»¥ä¸ºç±»å‹èµ·ä¸€ä¸ªæ–°çš„åˆ«åï¼Œç”¨æ³•ä¸€èˆ¬ä¸ºï¼š\n1  typedef \u0026lt;old_type_name\u0026gt; \u0026lt;new_type_name\u0026gt;;   1.æ˜“è¯»åˆ«åï¼šç»™åŸºç¡€ç±»å‹èµ·åˆ«å\n1 2 3 4  typedef int ICE_INT; int a; //ç­‰ä»·äº ICE_INT a;   2.ä¸å¤ªæ˜“è¯»çš„åˆ«åï¼šç»™æ•°ç»„èµ·åˆ«åï¼Œä¸ºç»“æ„ä½“èµ·åˆ«å(å¯è§å¼•è¨€)\n1 2 3 4  typedef char ICE_ARRAY15[15]; //ICE_ARRAY15æ˜¯char [15]çš„åˆ«å char a[15]; //ç­‰ä»·äº ICE_ARRAY15 a;   3.çœ‹ä¸å¤ªæ‡‚çš„åˆ«å\n(1)ä¸ºæŒ‡é’ˆèµ·åˆ«å(æ³¨æ„ï¼Œ*å¿…é¡»å’Œnew_type_nameç”¨æ‹¬å·æ‹¬èµ·æ¥)\n1 2 3 4  typedef char (* ICE_PTR_ARR)[10]; //ICE_PTR_ARRæ˜¯char * [10]çš„åˆ«å char (* p)[10]; //ç­‰ä»·äº ICE_PTR_ARR p; //å¼•ç”¨æ—¶ä¹Ÿæ˜¯p[0],p[1],...   (2)ä¸ºå‡½æ•°æŒ‡é’ˆå®šä¹‰åˆ«å\n1 2 3 4  typedef int (* ICE_FUNC)(int, int); //åˆ«åæ˜¯ICE_FUNCï¼Œç±»å‹æ˜¯å‚æ•°ä¸º(int,int)è¿”å›å€¼ä½intçš„å‡½æ•°æŒ‡é’ˆ int (* p_func)(int, int); //ç­‰ä»·äº ICE_FUNC p_func;   ï¼ˆ3ï¼‰ä¸ºç»“æ„ä½“æŒ‡é’ˆèµ·åˆ«å\n1 2 3 4 5  //å…¶ä¸­ice_tæ˜¯struct ice_struct *ç±»å‹ï¼Œå³ä¸€ä¸ªstruct ice_structç±»å‹çš„æŒ‡é’ˆ typedef struct ice_struct * ice_t; //å†™æˆä¸‹é¢è¿™ç§å½¢å¼å®¹æ˜“çœ‹ä¸æ‡‚ï¼Œå®¹æ˜“å°†ice_tå’Œ*è¯»åˆ°ä¸€èµ·ï¼Œå’Œstruct ice_structåˆ†å¼€ typedef struct ice_struct *ice_t;   3.å‚è€ƒä»£ç  é“¾æ¥ï¼šhttps://github.com/yyyIce/c_exercise/blob/main/typedef_test.c\næœ‰å¸®åŠ©çš„è¯å¯ä»¥ç‚¹ä¸ªStarâ­å“¦~\nå‚è€ƒèµ„æ–™ [1]http://c.biancheng.net/view/2040.html\n","description":"Cè¯­è¨€Typedefçš„ä½¿ç”¨æ–¹æ³•","id":30,"section":"posts","tags":["c"],"title":"Cè¯­è¨€ï¼šTypedef","uri":"https://yyyIce.github.io/zh/posts/c%E8%AF%AD%E8%A8%80typedef/"},{"content":"ã€€Wiresharkæ˜¯ä¸€æ¬¾å¼ºå¤§çš„æ•°æ®åŒ…åˆ†æè½¯ä»¶ã€‚\nã€€å®˜ç½‘åœ°å€ï¼šhttps://www.wireshark.org/\n1.å®‰è£… ã€€ï¼ˆ1ï¼‰è¿›å…¥å®˜ç½‘\nå›¾1 å®˜æ–¹ç•Œé¢:\r\r ã€€ï¼ˆ2ï¼‰ç‚¹å‡»â€œDownloadâ€è¿›å…¥ä¸‹è½½ç•Œé¢ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œä¸€è·¯ä¸‹ä¸€æ­¥å³å¯ã€‚\nã€€Downloadåœ°å€ï¼šhttps://www.wireshark.org/#download\nå›¾2 é€‰æ‹©åˆé€‚çš„wiresharkç‰ˆæœ¬:\r\r 2.ç®€å•ä½¿ç”¨ ã€€è¯¦ç»†çš„ä½¿ç”¨å¯ä»¥ä»å›¾1çš„â€œLearnâ€ç‚¹è¿›å»ï¼ŒåŒ…æ‹¬ä½¿ç”¨æ–‡æ¡£å’Œå¼€å‘æ–‡æ¡£\nã€€Learnåœ°å€ï¼šhttps://www.wireshark.org/#learnWS\n2.1 æŠ“åŒ… ã€€ï¼ˆ1ï¼‰æ‰“å¼€wiresharkï¼ŒåŒå‡»é€‰æ‹©ç½‘å¡ï¼Œåé¢çš„çº¿æœ‰æ³¢åŠ¨å³ä¸ºè¯¥ç½‘å¡æœ‰æ•°æ®åŒ…\nå›¾3 é€‰æ‹©ç½‘ç»œé€‚é…å™¨ï¼ˆç½‘å¡ï¼‰:\r\r ã€€ï¼ˆ2ï¼‰å¼€å§‹æ•åŒ…çš„ç•Œé¢å¦‚ä¸‹ï¼Œç‚¹å‡»â€œæ–‡ä»¶â€ä¸‹é¢çš„çº¢è‰²æ–¹å—å³å¯åœæ­¢ã€‚\nå›¾4 å¼€å§‹æ•åŒ…ï¼ˆç½‘å¡ï¼‰:\r\r 2.2 è¿‡æ»¤ ã€€åœ¨åº”ç”¨æ˜¾ç¤ºè¿‡æ»¤å™¨ä¸­è¾“å…¥è¿‡æ»¤è§„åˆ™å¯ä»¥è¿‡æ»¤å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®åŒ…ï¼Œä¸€èˆ¬ç”¨äºç­›é€‰ç‰¹å®šåè®®ã€ç«¯å£çš„æ•°æ®åŒ…ï¼Œæå–å®ƒä»¬çš„ç‰¹å¾ã€‚è¿‡æ»¤è§„åˆ™è¾“å…¥åè®®ç®€ç§°åä¼šæœ‰æç¤ºè¡¥å…¨ã€‚\nã€€å¸¸ç”¨è¿‡æ»¤è§„åˆ™ï¼š\n1 2 3  ip.addr=192.168.1.1 tcp.port==80 udp.port==80   ã€€è¿‡æ»¤è§„åˆ™ï¼š\nå›¾5 è¿‡æ»¤è§„åˆ™ä¸ºhttp:\r\r ã€€å¸¸ç”¨è¿½è¸ªTCPæµåˆ†æä¼šè¯ï¼Œè°ƒè¯•çº é”™ï¼Œå¯ä»¥çœ‹åˆ°å®Œæ•´çš„TCPæ¡æ‰‹åˆ†æ‰‹è¿‡ç¨‹\nå›¾6 é€‰ä¸­æŸæ•°æ®åŒ…å³é”®è¿½è¸ªTCPæµ:\r\r å›¾7 è¿½è¸ªTCPæµçš„ç»“æœ:\r\r ã€€å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å…ˆå‘é€SYNï¼Œseq=0ï¼Œç„¶åæœåŠ¡ç«¯å‘é€SYNï¼ŒACKï¼Œseq=0ï¼Œack=1ï¼Œå®¢æˆ·ç«¯å‘é€ACKï¼Œseq=1ï¼Œack=1ï¼Œæ¡æ‰‹ç»“æŸï¼Œå»ºç«‹è¿æ¥ã€‚\nå›¾8 è¿½è¸ªTCPæµçš„æ•°æ®åŒ…ç»“æœ:\r\r 2.3 å¯¼å‡ºåˆ†ç»„ ã€€ï¼ˆ1ï¼‰æ–‡ä»¶-\u0026gt;å¯¼å‡ºç‰¹å®šåˆ†ç»„\nå›¾9 å¯¼å‡ºç‰¹å®šåˆ†ç»„:\r\r ã€€ï¼ˆ2ï¼‰æ ¹æ®â€œPacketRangeå†…çš„é€‰é¡¹å¯¼å‡ºæ•°æ®åŒ…ï¼Œæ¯”å¦‚å¯ä»¥å…ˆå°†æƒ³è¦è¿‡æ»¤çš„æ•°æ®åŒ…åœ¨åº”ç”¨æ˜¾ç¤ºè¿‡æ»¤å™¨ä¸­è¿‡æ»¤å‡ºæ¥ï¼Œç„¶åé€‰æ‹©\u0026quot;displayed\u0026quot;ï¼Œå¯¼å‡ºè¿‡æ»¤åçš„åˆ†ç»„\nå›¾10 åœ¨å¯¼å‡ºç•Œé¢è¿›è¡Œé€‰æ‹©:\r\r ã€€ï¼ˆ3ï¼‰å¯¼å‡ºcsvæ–‡ä»¶\nå›¾11 å¯¼å‡ºcsvæ–‡ä»¶:\r\r 2.4 IO Graph  Wiresharkä¹‹åˆ©ç”¨IO Graphåˆ†ææ•°æ®å¹¶å°†æ•°æ®å¤åˆ¶åˆ°excelä¸­ç”Ÿæˆå›¾ï¼šhttps://blog.csdn.net/Mary19920410/article/details/72828033\n ã€€Wireshark IO Graphå¯ä»¥å±•ç¤ºç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ•°æ®åŒ…æ—¶é—´å’Œæ•°é‡çš„å…³ç³»æ›²çº¿å›¾ã€‚æ›²çº¿å›¾çš„Xè½´ä¸ºtick intervalï¼ˆæ»´ç­”æ—¶é—´é—´éš”ï¼‰ï¼ŒYè½´ä¸ºæ¯tickçš„æŠ¥æ–‡æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒXè½´çš„tickä¸º1sï¼Œå¯ä»¥è‡ªå·±è°ƒèŠ‚tickçš„å¤§å°ã€‚è°ƒèŠ‚tickå¯¹äºæŸ¥çœ‹æµé‡ä¸­çš„æ³¢å³°ï¼æ³¢è°·å¾ˆæœ‰å¸®åŠ©ã€‚è¦è¿›ä¸€æ­¥æŸ¥çœ‹æ•°æ®åŒ…ä¿¡æ¯ï¼Œå¯ä»¥ç‚¹å‡»å›¾å½¢ä¸­çš„ä»»ä¸€ç‚¹ï¼Œå³å¯åœ¨wiresharkçš„æ•°æ®åŒ…ç•Œé¢è‡ªåŠ¨é€‰ä¸­è¯¥æ•°æ®åŒ…ã€‚\nã€€æŸ¥çœ‹IOå›¾\nã€€ï¼ˆ1ï¼‰èœå•æ -\u0026gt;ç»Ÿè®¡-\u0026gt;IOå›¾è¡¨\nå›¾12 æŸ¥çœ‹IOå›¾:\r\r ã€€ï¼ˆ2ï¼‰æˆ‘ä»¬æ‰“å¼€IOå›¾åï¼Œç‚¹å‡»å›¾ä¸­ä¸€ä¸ªå³°å€¼ï¼Œå¯ä»¥å‘ç°åœ¨åé¢çš„wiresharkæ•°æ®åŒ…ç•Œé¢ï¼Œå·²ç»è‡ªåŠ¨é€‰ä¸­äº†åºå·ä¸º1281çš„æ•°æ®åŒ…ã€‚è¿‡æ»¤å™¨ã€æ—¶é—´é—´éš”ç­‰ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨å›¾ä¸­æŸ¥çœ‹åˆ°ã€‚ç‚¹å‡»å›¾13æœ€ä¸‹æ–¹çš„save asï¼Œå¯ä»¥å¯¼å‡ºIOå›¾ã€‚\nå›¾13 IOå›¾:\r\r ã€€å¯¼å‡ºIOå›¾ä¿¡æ¯åˆ°Excel\nã€€é»˜è®¤å¯¼å‡ºçš„IOå›¾è¿‡äºç²—ç³™ï¼Œæˆ‘ä»¬å¯ä»¥ä»…å¯¼å‡ºå®ƒçš„å›¾æ•°æ®ï¼Œç„¶ååœ¨Excelä¸­é‡æ–°ç»˜åˆ¶ã€‚\nï¼ˆ1ï¼‰ç‚¹å‡»å›¾13ä¸­çš„å¤åˆ¶\nï¼ˆ2ï¼‰æ‰“å¼€Excelï¼Œç²˜è´´-\u0026gt;ä½¿ç”¨æ–‡æœ¬å¯¼å…¥å‘å¯¼\nå›¾14-1 ç²˜è´´åˆ°Excel:\r\r ï¼ˆ3ï¼‰ç¬¬1æ­¥ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥\nå›¾14-2 ç²˜è´´åˆ°Excel:\r\r ï¼ˆ4ï¼‰ç¬¬2æ­¥ï¼Œåˆ†éš”ç¬¦å·é€‰æ‹©é€—å·ï¼Œå¯ä»¥åœ¨â€œæ•°æ®é¢„è§ˆâ€ä¸­çœ‹åˆ°æ•°æ®å·²ç»åˆ†æˆä¸¤åˆ—ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥\nå›¾14-2 ç²˜è´´åˆ°Excel:\r\r ï¼ˆ5ï¼‰é€‰æ‹©æ¯åˆ—çš„æ•°æ®æ ¼å¼ï¼Œå¦‚ä¸éœ€è¦æ›´æ”¹ç›´æ¥ç‚¹å‡»å®Œæˆå³å¯ã€‚\nï¼ˆ6ï¼‰ä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸¤åˆ—æ•°æ®ç»˜åˆ¶éœ€è¦çš„æ›²çº¿å›¾ã€‚\n","description":"wiresharkçš„æŠ“åŒ…ã€è¿‡æ»¤ã€å¯¼å‡ºåˆ†ç»„å’Œå¯è§†åŒ–çš„åŸºæœ¬æ“ä½œæ–¹æ³•","id":31,"section":"posts","tags":["basic"],"title":"å·¥å…·ä½¿ç”¨ï¼šwireshark","uri":"https://yyyIce.github.io/zh/posts/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8wireshark/"},{"content":"ã€€è®ºæ–‡åç§°ï¼šSilkRoad: Making Stateful Layer-4 Load Balancing Fast and Cheap Using Switching ASICs\nã€€ä¼šè®®ä¿¡æ¯ï¼šSIGCOMM â€™17, August 21â€“25, 2017, Los Angeles, CA, USA\nã€€æˆæœï¼šåœ¨switch.p4çš„åŸºç¡€ä¸Šç¼–å†™400è¡ŒP4ä»£ç ï¼Œåœ¨ä¸€å°å¯ç¼–ç¨‹ASICäº¤æ¢æœºä¸Šå®ç°ç™¾ä¸‡è¿æ¥çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»£æ›¿å¤šè¾¾æ•°ç™¾ä¸ªè½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ã€‚\nã€€è´¡çŒ®ï¼šå°†ConnTableä»è´Ÿè½½å‡è¡¡è½¯ä»¶ä¸Šè½¬ç§»åˆ°äº¤æ¢æœºä¸­ï¼›æ›´å¥½åœ°ä¿è¯æ¯ä¸ªè¿æ¥ä¸€è‡´æ€§(PCC)\nå››å±‚è´Ÿè½½å‡è¡¡é¢ä¸´çš„æŒ‘æˆ˜ï¼šä½å»¶è¿Ÿçš„å®Œæ•´åŒå‘é€šä¿¡ ï¼›é¢‘ç¹çš„DIPæ± å˜åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¡®ä¿æ¯ä¸ªè¿æ¥çš„ä¸€è‡´æ€§\nã€€å‰äººå·¥ä½œä¸è¶³ï¼šè½¯ä»¶è´Ÿè½½å‡è¡¡å™¨(ConnTableå’ŒVIPTableéƒ½åœ¨è½¯ä»¶ä¸Šï¼Œèƒ½ä¿è¯PCCï¼Œå»¶è¿Ÿé«˜ï¼Œæ€§èƒ½éš”ç¦»å·®)ã€Duet(VIPTableåœ¨äº¤æ¢æœºä¸Šï¼Œä¸å­˜å‚¨è¿æ¥çŠ¶æ€ï¼Œèƒ½ä½å»¶è¿Ÿä½†æ˜¯ä¸èƒ½å®Œå…¨ä¿è¯PCCï¼‰\nã€€æœ¬æ–‡å·¥ä½œï¼šConnTableå’ŒVIPTableéƒ½åœ¨äº¤æ¢æœºä¸Šï¼Œå­˜å‚¨è¿æ¥çŠ¶æ€ï¼Œä½å»¶è¿Ÿï¼Œä¸”æ¯”Duetä¿æŒPCCçš„æ•ˆæœå¥½\næ³¨ï¼šæ¶‰åŠåˆ°çš„åŸºç¡€æ¦‚å¿µå¯åœ¨æ–‡æœ«æŸ¥è¯¢ã€‚\nä¸€ã€èƒŒæ™¯ 1.å››å±‚è´Ÿè½½å‡è¡¡ ã€€å››å±‚è´Ÿè½½å‡è¡¡ç»´æŠ¤ä¸¤å¼ è¡¨ï¼ŒConnTableå’ŒVIPTable\nå›¾1 ConnTableå’ŒVIPTable:\r\r ã€€ConnTableï¼šè®°å½•æ¯ä¸ªè¿æ¥æ˜ å°„åˆ°çš„DIPï¼Œå³è¿æ¥çŠ¶æ€\nã€€VIPTableï¼šè®°å½•VIPæ˜ å°„åˆ°çš„DIPæ± \nã€€å½“ä¸€ä¸ªæ–°è¿æ¥(TCP SYNæ•°æ®åŒ…)åˆ°è¾¾æ—¶ï¼Œè´Ÿè½½å‡è¡¡è½¯ä»¶æ ¹æ®VIPï¼Œä»è¯¥VIPå¯¹åº”çš„DIPæ± ä¸­è¿è¡Œhashè¿ç®—é€‰æ‹©ä¸€ä¸ªDIPï¼Œç„¶åå°†è¯¥æ•°æ®åŒ…è½¬å‘åˆ°æ‰€é€‰DIPå¯¹åº”çš„æœåŠ¡å™¨ä¸Šå»ã€‚å½“è¯¥è¿æ¥çš„åç»­æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œè´Ÿè½½å‡è¡¡è½¯ä»¶ç›´æ¥å°†è¿™äº›æ•°æ®åŒ…è½¬å‘åˆ°ä¹‹å‰æ‰€é€‰DIPå¯¹åº”çš„æœåŠ¡å™¨ã€‚æ‰€ä»¥éœ€è¦ä¸¤ä¸ªå­˜å‚¨ç»“æ„ï¼Œåˆ†åˆ«ç”¨æ¥è®°å½•è¿æ¥å’ŒDIPçš„å…³ç³»ã€VIPå’ŒDIPæ± çš„å…³ç³»ã€‚ä¸€èˆ¬ç”¨ConnTableè®°å½•è¿æ¥å’ŒDIPçš„æ˜ å°„å…³ç³»ï¼Œç”¨VIPTableè®°å½•VIPå’ŒDIPæ± çš„æ˜ å°„å…³ç³»ã€‚å½“æ–°è¿æ¥åˆ°è¾¾æ—¶ï¼Œå°†ä¸ä¼šå‘½ä¸­ConnTableï¼Œæ­¤æ—¶ç”±äº¤æ¢æœºåœ¨VIPTableä¸­æ ¹æ®æ–°è¿æ¥çš„VIPé€‰æ‹©ä¸€ä¸ªDIPï¼Œé€‰æ‹©DIPä¹‹åï¼Œç”±äº¤æ¢æœºçš„CPUå°†è¿™ä¸ªè¿æ¥å’Œä¸ºå®ƒé€‰æ‹©çš„DIPè®°å½•åœ¨ConnTableä¸­ï¼Œè¿™æ ·è¯¥è¿æ¥çš„åç»­æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œç›´æ¥æ ¹æ®ConnTableè¿›è¡Œè½¬å‘å³å¯ã€‚\nã€€æ¯ä¸ªè¿æ¥çš„ä¸€è‡´æ€§(PCC)ï¼šåŒä¸€è¿æ¥çš„æ¯ä¸ªæ•°æ®åŒ…éƒ½æ˜ å°„åˆ°ç›¸åŒçš„DIPã€‚\nã€€ç ´åæ¯ä¸ªè¿æ¥çš„ä¸€è‡´æ€§ï¼šå½“DIPæ± ç”±äºæ·»åŠ æˆ–åˆ é™¤æœåŠ¡å™¨è€Œå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŒä¸€è¿æ¥çš„æ•°æ®åŒ…å¯èƒ½ä¼šå“ˆå¸Œåˆ°ä¸åŒçš„DIPï¼Œä»è€Œç ´åæ¯ä¸ªè¿æ¥çš„ä¸€è‡´æ€§ï¼ˆper-connection consistency, PCCï¼‰ã€‚\nã€€ç ´åPCCçš„æƒ…å†µåˆ†æï¼š\nã€€1ï¼‰å¦‚æœåœ¨ConnTableä¸­è®°å½•è¿æ¥çŠ¶æ€ï¼Œåˆ™å‘DIPæ± ä¸­æ·»åŠ DIPä¸ä¼šå½±å“å·²ç»å†™å…¥ConnTableçš„è¿æ¥çš„PCCï¼Œå› ä¸ºå·²ç»å†™å…¥ConnTableçš„è¿æ¥çš„æ•°æ®åŒ…ä¸ç»è¿‡VIPTableï¼Œç›´æ¥è½¬å‘åˆ°è®°å½•çš„DIPå»ï¼›è€ŒDIPæ± ä¸­åˆ é™¤DIPä¸€å®šä¼šå°†è¿™ä¸ªDIPçš„è¿æ¥å…¨éƒ¨æ–­å¼€åå†åˆ é™¤ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å†™å…¥ConnTableçš„è¿æ¥çš„PCCã€‚æ‰€ä»¥åœ¨è®°å½•è¿æ¥çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨æ–°è¿æ¥åˆ°è¾¾ï¼Œä¸”è¿˜æ²¡æœ‰å°†æ–°è¿æ¥çŠ¶æ€å†™å…¥ConnTableæ—¶ï¼ŒVIPTableæ›´æ–°ï¼Œæ‰æœ‰å¯èƒ½ç ´åPCCã€‚\nã€€ä¸¾ä¾‹è¯´æ˜ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ–°è¿æ¥Aï¼ŒAçš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾ï¼Œæœªå‘½ä¸­ConnTableï¼Œç»è¿‡hashè®¡ç®—ï¼Œé€‰æ‹©äº†VIPå¯¹åº”çš„DIPæ± ä¸­ç´¢å¼•ä¸º20çš„DIPï¼Œè®°ä½œa_dipï¼Œæ­¤æ—¶å‘VIPTableçš„æ­¤DIPæ± ä¸­å¢åŠ 3ä¸ªDIPï¼Œè¿™3ä¸ªDIPä½äºa_dipå‰ï¼Œåˆ™a_dipçš„ç´¢å¼•å˜ä¸º23ï¼Œåœ¨Açš„ç¬¬äºŒä¸ªæ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œè¿æ¥A-a_dipè¿˜æ²¡æ¥å¾—åŠå†™å…¥ConnTableï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…ä¹Ÿå»åŒ¹é…VIPTableï¼Œä½†ç”±äºå‘VIPTableä¸­æ’å…¥äº†3ä¸ªDIPï¼Œè¿™æ¬¡ç»è¿‡hashè®¡ç®—åç´¢å¼•ä»ä¸º20ï¼Œä½†ç´¢å¼•20å­˜å‚¨çš„DIPå·²ç»ä¸æ˜¯a_dipäº†ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å’Œç¬¬äºŒä¸ªæ•°æ®åŒ…æ˜ å°„åˆ°äº†ä¸åŒçš„DIPï¼ŒPCCè¢«ç ´åã€‚\nã€€æ‰€ä»¥åœ¨è®°å½•è¿æ¥çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œåªæœ‰â€œæ–°è¿æ¥åˆ°è¾¾æ—¶â€åˆ°â€œå®Œæˆå‘ConnTableå†™å…¥æ–°è¿æ¥çŠ¶æ€â€çš„è¿™ä¸€æ—¶é—´æ®µå†…æ›´æ–°VIPTableä¼šå½±å“PCCï¼Œå…¶ä»–æ—¶é—´æ›´æ–°VIPTableä¸ä¼šå½±å“PCCã€‚æ¢å¥è¯è¯´ï¼Œæ›´æ–°VIPTableæ—¶ï¼Œè¦è€ƒè™‘æ˜¯å¦æœ‰æ–°è¿æ¥åˆ°è¾¾ï¼Œè¦å¯¹æ–°è¿æ¥è¿›è¡Œå¤„ç†ä»¥ä¿æŠ¤PCCã€‚\nã€€2ï¼‰å¦‚æœåœ¨ConnTableä¸­ä¸è®°å½•è¿æ¥çŠ¶æ€ï¼Œåˆ™æ¯æ¬¡éƒ½è¿è¡Œhashè¿ç®—æ¥é€‰æ‹©åŒä¸€DIPï¼Œåˆ™åªè¦VIPTableå‘ç”Ÿå˜åŒ–ï¼Œå°±å¯èƒ½ç ´åPCCã€‚\nã€€VIPTableå¿…é¡»æ˜¯åŸå­æ›´æ–°ï¼Œä¸”è¦ä¸å‘ConnTableä¸­æ’å…¥\u0026quot;è¿æ¥-DIP\u0026quot;çš„åŠ¨ä½œåŒæ­¥ã€‚\n2.å‰äººçš„è§£å†³æ–¹æ¡ˆ 2.1 è´Ÿè½½å‡è¡¡è½¯ä»¶(Software Load Balancer, SLB) ã€€åœ¨è½¯ä»¶ä¸­å®ç°ConnTableå’ŒVIPTableï¼Œéœ€è¦å¤§é‡æœåŠ¡å™¨ï¼Œé«˜æˆæœ¬ã€é«˜å»¶è¿Ÿã€é«˜æŠ–åŠ¨ï¼Œæ€§èƒ½éš”ç¦»å·®ï¼Œä½†ä¿è¯äº†PCCã€‚åœ¨è½¯ä»¶å®ç°ä¸­ï¼Œè´Ÿè½½å‡è¡¡å™¨é”å®šVIPTableï¼Œå¹¶å°†æ–°çš„ä¼ å…¥è¿æ¥ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œé˜²æ­¢å®ƒä»¬åŒ¹é…VIPTableã€‚ç„¶åï¼ŒSLBå°†æ–°çš„DIPæ± æ˜ å°„æ›´æ–°åˆ°VIPTableï¼Œç„¶åé‡Šæ”¾ç¼“å†²åŒºä¸­çš„è¿æ¥ã€‚è¿™æ ·ï¼ŒSLBå¯ä»¥ç¡®ä¿åœ¨VIPTableæ›´æ–°ä¹‹å‰å’Œä¹‹åçš„PCCï¼Œä½†æ˜¯ä»£ä»·æ˜¯CPUæ…¢è·¯å¾„åŒ…å¤„ç†å’Œç¼“å†²å»¶è¿Ÿã€‚\n2.2 Duet ã€€åœ¨äº¤æ¢æœºä¸Šå®ç°VIPTableï¼Œä½†ä»…ç”¨äº¤æ¢æœºå¤„ç†å…·æœ‰è¾ƒé«˜æµé‡çš„VIPï¼Œä½¿ç”¨SLB(åŒ…å«VIPTableå’ŒConnTable)å¤„ç†å…¶ä»–VIPï¼Œä½†æ— æ³•ä¿è¯é¢‘ç¹çš„DIPæ± æ›´æ–°æƒ…å†µä¸‹çš„PCCã€‚\nã€€ç”±äºDuetä¸è®°å½•è¿æ¥çŠ¶æ€(å³ConnTableä¸­ä¸å­˜å‚¨DIP)ï¼Œæ¯æ¬¡éƒ½ä¾é Hashç®—æ³•æ¥é€‰æ‹©å¯¹åº”çš„DIPï¼Œå¯¼è‡´DIPæ± ä¸­çš„DIPé¢‘ç¹æ·»åŠ æˆ–åˆ é™¤æ—¶ï¼ŒåŒä¸€è¿æ¥çš„ä¸åŒæ•°æ®åŒ…å¯èƒ½ä¼šæ˜ å°„åˆ°ä¸åŒçš„DIPä¸Šã€‚ä¸ºåº”å¯¹æ­¤ç§æƒ…å†µï¼ŒDuetå®šæœŸå°†VIPè¿ç§»åˆ°äº¤æ¢æœºï¼Œæˆ–ç­‰æ‰€æœ‰æ—§è¿æ¥éƒ½å®Œæˆå†æ›´æ–°VIPTableã€‚\näºŒã€æœ¬æ–‡çš„å·¥ä½œ ã€€åœ¨ASICäº¤æ¢æœºä¸Šå®ç°ConnTableå’ŒVIPTableï¼Œå§‹ç»ˆåœ¨äº¤æ¢æœºä¸Šå¤„ç†æ‰€æœ‰è¿æ¥ã€‚\nã€€å­˜åœ¨çš„é—®é¢˜ï¼ŒConnTableå¤ªå¤§ï¼Œæ— æ³•å­˜å‚¨åœ¨SRAMä¸­ï¼›VIPTableæ›´æ–°é€ æˆçš„ç ´åPCCçš„é—®é¢˜ã€‚\n1.æ§åˆ¶ConnTableçš„è§„æ¨¡ ã€€ASICäº¤æ¢æœºçš„SRAMå¤§å°ä¸º50-100MBï¼Œè€Œæ­£å¸¸çš„ConnTableæœ‰å‡ ç™¾MBï¼Œæ‰€ä»¥å¯¹ConnTableçš„å­˜å‚¨å†…å®¹è¿›è¡Œå‹ç¼©ã€‚\nã€€P4ä¸­çš„Match-Actionè¡¨çš„æ•°æ®åŒ…æ‹¬åŒ¹é…å­—æ®µ(match fieldï¼Œå°±æ˜¯key)ã€åŠ¨ä½œæ•°æ®(action data)ï¼ŒConnTableçš„åŒ¹é…å­—æ®µå³èƒ½å¤Ÿæ ‡è¯†ä¸€ä¸ªè¿æ¥çš„äº”å…ƒç»„ï¼ŒåŠ¨ä½œæ•°æ®å³ä¸ºè¯¥è¿æ¥çš„VIPæ‰€é€‰æ‹©çš„DIPã€‚æ‰€ä»¥å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘ç¼©å‡ConnTableçš„è§„æ¨¡ã€‚ä¸€æ˜¯å­˜å‚¨çš„åŒ¹é…å­—æ®µçš„å¤§å°ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ç¼©çŸ­åŠ¨ä½œæ•°æ®ã€‚\nã€€åœ¨Silkroadä¸­ï¼ŒConnTableçš„åŒ¹é…å­—æ®µä¸å­˜å‚¨è¿æ¥çš„äº”å…ƒç»„ï¼Œè€Œå­˜å‚¨äº”å…ƒç»„çš„16ä½çš„hashæ‘˜è¦ï¼Œä»è€Œå‡å°‘åŒ¹é…å­—æ®µçš„å¤§å°ï¼›åŠ¨ä½œæ•°æ®ä¸å­˜å‚¨DIPï¼Œè€Œå­˜å‚¨å¤§å°ä¸º6ä½çš„DIPæ± ç‰ˆæœ¬å·ã€‚\n1.1 ConnTableç”¨ hashæ‘˜è¦æ ‡è¯†è¿æ¥è€Œå¼•å…¥çš„é—®é¢˜ ã€€é—®é¢˜æè¿°ï¼šå¦‚æœä¸¤ä¸ªè¿æ¥çš„hashè®¡ç®—ç»“æœç›¸åŒï¼Œå³hashæ‘˜è¦ç›¸åŒï¼Œå‘ç”Ÿå†²çªï¼Œè¿™æ—¶ä½¿ç”¨hashæ‘˜è¦å»åŒ¹é…ConnTableä¼šå¯¼è‡´è¯¯æŠ¥ã€‚ä¾‹å¦‚ï¼Œå‡è®¾è¿æ¥Açš„hashæ‘˜è¦ä¸ºdigestï¼Œè¿æ¥Bè®¡ç®—åçš„hashæ‘˜è¦ä¹Ÿæ˜¯digestï¼Œè¿æ¥Aå·²ç»å­˜åœ¨äºConnTableä¸­ï¼Œæ­¤æ—¶è¿æ¥Bä½œä¸ºæ–°è¿æ¥åˆ°è¾¾ï¼Œåˆ™è¿æ¥Bå°†è¢«é”™è¯¯åœ°å½“ä½œè¿æ¥Aï¼Œæ•°æ®åŒ…å°†ä¸ç»è¿‡VIPTableï¼Œç›´æ¥è½¬å‘åˆ°è¿æ¥Açš„DIPå¯¹åº”çš„æœåŠ¡å™¨ä¸Šï¼Œè€Œè¿æ¥Açš„DIPï¼Œå’Œè¿æ¥Bçš„VIPï¼Œä¸ä¸€å®šå…·æœ‰æ˜ å°„å…³ç³»ï¼Œå¯¼è‡´è¯¯æŠ¥ã€‚\nã€€é—®é¢˜è§£å†³ï¼šæ¯å½“è¿æ¥ä¸ConnTableä¸­çš„æ¡ç›®åŒ¹é…ï¼Œå°±å°†è¿æ¥çš„TCP SYNæ•°æ®åŒ…é‡å®šå‘åˆ°äº¤æ¢æœºçš„CPUï¼Œäº¤æ¢æœºè½¯ä»¶å¯¹ConnTableä¸­çš„æ¯ä¸ªæ¡ç›®å…·æœ‰å®Œæ•´çš„5å…ƒç»„ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥è¯†åˆ«æ–°è¿æ¥çš„é”™è¯¯å‘½ä¸­ã€‚\nã€€ConnTableè¿™æ ·çš„å¤§å‹è¡¨ï¼Œåœ¨ASICäº¤æ¢æœºä¸Šä¼šä»¥å¤šä¸ªç‰©ç†çº§è¡¨çš„å½¢å¼å®ä¾‹åŒ–ï¼Œå³ç‰©ç†ä¸Šå°†ConnTableæ‹†åˆ†æˆäº†å‡ ä¸ªå­è¡¨ï¼Œå‡è®¾ä¸ºConnTable0,ConnTable1,ConnTable2ã€‚åˆ©ç”¨Match-Actionçš„å¤šé˜¶æ®µä½“ç³»ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒé˜¶æ®µä½¿ç”¨ä¸åŒçš„Hashå‡½æ•°è¿›è¡Œæ˜ å°„ï¼Œå³åœ¨ConnTable0ä¸Šä½¿ç”¨Hash0ï¼Œåœ¨ConnTable1ä¸Šä½¿ç”¨Hash1\u0026hellip;ã€‚å½“æ–°è¿æ¥Bçš„Hashæ‘˜è¦ä¸ConnTable0ä¸­çš„è¿æ¥Açš„Hashæ‘˜è¦ç›¸åŒæ—¶ï¼ŒCPUæ£€æµ‹åˆ°å†²çªï¼Œåˆ™å°†è¿æ¥Aè¿ç§»åˆ°å¦ä¸€ä¸ªé˜¶æ®µï¼Œå³è®¡ç®—å…¶åœ¨ConnTable2ä¸­çš„Hashæ‘˜è¦å¹¶å®ƒè¿ç§»åˆ°ConnTable2ä¸­ï¼Œè¿™æ—¶è¿æ¥Bå­˜å‚¨åœ¨ConnTable0ä¸­ï¼Œè¿æ¥Aå­˜å‚¨åœ¨ConnTable2ä¸­ï¼Œç”±äºConnTable0å’ŒConnTable2çš„Hashè®¡ç®—æ–¹å¼ä¸åŒï¼Œè¿æ¥Açš„Hashæ‘˜è¦å’Œè¿æ¥Bçš„Hashæ‘˜è¦ä¸åŒï¼Œå†²çªè§£å†³ã€‚è¿™å®é™…ä¸Šåˆ©ç”¨äº†Cuckoo Hashçš„æ€æƒ³ï¼Œå³å°†å†²çªçš„æ¡ç›®æ”¾åˆ°åˆ«çš„æ§½é‡Œã€‚\n1.2 ConnTableä¸­ç”¨DIPæ± çš„ç‰ˆæœ¬æ¥ä»£æ›¿DIPå¼•å…¥äº†æ–°è¡¨ ã€€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±äºåœ¨ConnTableä¸­ä½¿ç”¨äº†â€œConn-Versionâ€çš„æ˜ å°„ï¼Œå¿…é¡»å¢åŠ ä¸€å¼ è¡¨ç»´æŠ¤Versionå’ŒDIPæ± çš„æ˜ å°„å…³ç³»ï¼Œæ‰èƒ½è®©è¿æ¥ä¸­çš„æ•°æ®åŒ…è½¬å‘åˆ°å¯¹åº”çš„DIPä¸Šå»ã€‚ç”±äºä¸åŒVIPå¯¹åº”DIPæ± çš„ç‰ˆæœ¬å·å¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥Versionä¸æ˜¯å”¯ä¸€æ ‡è¯†DIPæ± çš„å­—æ®µï¼ŒVIP+Versionæ‰æ˜¯å”¯ä¸€æ ‡è¯†DIPæ± çš„å­—æ®µã€‚æ‰€ä»¥å¼•å…¥ä¸€å¼ æ–°è¡¨DIPPoolTableï¼Œè®°å½•VIP Versionå’ŒDIPæ± çš„æ˜ å°„å…³ç³»ã€‚\nå›¾2 DIPPoolTable:\r\r ã€€DIPæ± æ›´æ–°æ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªåŸDIPæ± çš„å‰¯æœ¬ï¼Œç„¶ååœ¨è¿™ä¸ªå‰¯æœ¬ä¸Šè¿›è¡Œæ›´æ”¹ï¼Œè¿™ä¸ªæ›´æ”¹åçš„å‰¯æœ¬å°±æˆä¸ºäº†æ–°DIPæ± ï¼Œå†å°†æ–°ç‰ˆæœ¬å·åˆ†é…ç»™æ–°DIPæ± ï¼Œå†å¯¹VIPTableè¿›è¡Œç¼–ç¨‹ï¼Œå°†è¿æ¥æ˜ å°„åˆ°æœ€æ–°çš„DIPæ± ç‰ˆæœ¬ã€‚å½“ä½¿ç”¨DIPæ± çš„è¿æ¥è¶…æ—¶å¹¶ä»ConnTableä¸­åˆ é™¤æ—¶ï¼ŒDIPæ± å°†é”€æ¯ï¼Œé”€æ¯æ—¶æ± çš„ç‰ˆæœ¬å·ä¼šé‡Šæ”¾å›ç¯å½¢ç¼“å†²åŒºã€‚äº¤æ¢æœºè½¯ä»¶è·Ÿè¸ªè¿æ¥åˆ°æ± çš„æ˜ å°„ï¼Œå¹¶ç®¡ç†DIPæ± çš„åˆ›å»ºã€åˆ é™¤ã€å­˜å‚¨ç‰ˆæœ¬å·çš„ç¯å½¢ç¼“å†²åŒºã€‚\nã€€å¯ä»¥é€šè¿‡ç‰ˆæœ¬é‡ç”¨å‡å°‘æ´»åŠ¨ç‰ˆæœ¬çš„æ•°é‡ï¼Œä»è€Œå‡å°‘ç‰ˆæœ¬ä½çš„å¤§å°ã€‚åœ¨æ·»åŠ çš„æ–°DIPå’Œåˆ é™¤çš„DIPæ•°é‡ç›¸åŒæ—¶ï¼Œå¯ä»¥ä¿®æ”¹ç°æœ‰æ± ï¼Œå°†ç°æœ‰æ± é‡æ–°ç”¨ä½œæœ€æ–°æ± ï¼Œè€Œä¸æ˜¯é‡æ–°åˆ›å»ºDIPæ± å¹¶è·å¾—æ–°ç‰ˆæœ¬å·ã€‚æ¯”å¦‚å›¾2ï¼Œä¹‹å‰20.0.0.1ï¼š80çš„V1ä¸­æœ‰ä¸¤ä¸ªDIPï¼Œç°åœ¨è¿›è¡Œæ›´æ–°ï¼Œåˆ å»çº¢è‰²åˆ’çº¿çš„DIPï¼Œå¢åŠ ç»¿è‰²çš„DIPï¼Œæ›´æ–°åDIPçš„æ•°é‡ä¸å˜ã€‚å¦‚æœé‡æ–°å»ºç«‹DIPæ± ï¼Œåˆ™è·å¾—ç‰ˆæœ¬å·V3ï¼Œå¦‚æœé‡ç”¨åŸæœ‰DIPæ± ï¼Œåˆ™ç‰ˆæœ¬å·ä¸ºV1ã€‚æ™ºèƒ½åœ°é‡ç”¨ç‰ˆæœ¬å·é™ä½äº†ç‰ˆæœ¬å·å¢åŠ çš„é€Ÿåº¦ã€‚\nã€€æ ¹æ®å¤§å‹WebæœåŠ¡æä¾›å•†çš„æ•°æ®ï¼Œ6bitçš„ç‰ˆæœ¬å·è¶³å¤Ÿå¤„ç†DIPæ± æ›´æ–°çš„å„ç§æƒ…å†µã€‚å½“æ˜ å°„åˆ°æ¯ä¸ªDIPæ± ç‰ˆæœ¬çš„è¿æ¥æ•°é‡å¾ˆå¤§ä¸”å¯¿å‘½å¾ˆçŸ­æ—¶ï¼Œé‡‡ç”¨Versionçš„ConnTableæ¯”è®°å½•DIPçš„ConnTableèŠ‚çœäº†å¾ˆå¤šå¼€é”€ã€‚å½“æ´»è·ƒè¿æ¥çš„æ•°é‡å¾ˆå°‘ä¸”å¯¿å‘½å¾ˆé•¿æ—¶ï¼Œå°†é€€å›åˆ°â€œConn-DIPâ€çš„æ˜ å°„ï¼Œè€Œä¸ä½¿ç”¨Versionã€‚\n2.ä¿è¯æ¯ä¸ªè¿æ¥çš„ä¸€è‡´æ€§ ã€€SilkRoadåœ¨ConnTableä¸­å­˜å‚¨äº†è¿æ¥çŠ¶æ€ã€‚åœ¨æœ¬æ–‡ç¬¬ä¸€ç« çš„ç¬¬ä¸€å°èŠ‚â€œå››å±‚è´Ÿè½½å‡è¡¡â€ä¸­æˆ‘ä»¬æåˆ°è¿‡ç ´åPCCçš„æ¡ä»¶ï¼Œåœ¨ConnTableå­˜å‚¨è¿æ¥çŠ¶æ€çš„æƒ…å†µä¸‹ï¼ŒVIPTableæ›´æ–°æ—¶ä»…éœ€è¦è€ƒè™‘å¤„ç†åˆ°è¾¾äº¤æ¢æœºä½†æœªå†™å…¥ConnTableä¸­çš„æ–°è¿æ¥ã€‚\nã€€åœ¨è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨(SLB)ä¸­ï¼Œåœ¨VIPTableæ›´æ–°æ—¶ï¼Œä¼šé”å®šVIPTableï¼Œå¹¶è®¾ç«‹ä¸€ä¸ªç¼“å†²åŒºå­˜å‚¨æ–°è¿æ¥ï¼Œå½“VIPTableæ›´æ–°å®Œæ¯•ï¼Œé‡Šæ”¾ç¼“å†²åŒºä¸­çš„æ–°è¿æ¥ã€‚SilkRoadé‡‡ç”¨çš„æ–¹æ³•ä¸SLBä¸­çš„æ–¹æ³•ä¸€è‡´ï¼Œä¹Ÿæ˜¯å°†æ–°è¿æ¥å­˜å‚¨èµ·æ¥ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªæ–°çš„è¡¨TransitTableä¸­ï¼Œä½†åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚\nã€€å¤©çœŸçš„è®¾è®¡ï¼šå°†æ¯ä¸ªæ–°è¿æ¥éƒ½å­˜å‚¨åœ¨TransitTableä¸­ï¼Œå¹¶è®°å½•å…¶é€‰æ‹©çš„DIPæ± ç‰ˆæœ¬ã€‚\nã€€ç¼ºç‚¹ï¼šTransitTableç‰¹åˆ«å¤§ã€‚\nã€€å‰è¾¹åœ¨ç¬¬ä¸€ç« ä¹Ÿåˆ†æè¿‡äº†ï¼ŒConnTableå­˜å‚¨é“¾æ¥çŠ¶æ€æ—¶ï¼Œä¸éœ€è¦å­˜å‚¨æ‰€æœ‰æ–°è¿æ¥ï¼Œä»…è€ƒè™‘åœ¨DIPæ± æ›´æ–°æ—¶åˆ°è¾¾ä½†æœªå†™å…¥ConnTableçš„è¿æ¥ï¼Œå³åœ¨TransitTableä¸­å­˜å‚¨æ˜ å°„åˆ°æ—§DIPæ± çš„æŒ‚èµ·è¿æ¥(æŒ‚èµ·è¿æ¥ï¼šåœ¨æ—¶åˆ»tåˆ°è¾¾ï¼Œä½†å°šæœªæ’å…¥ConnTableä¸­çš„è¿æ¥)ã€‚æ–‡ç« æŠŠå¤„ç†æŒ‚èµ·è¿æ¥åˆ†ä¸º3æ­¥ã€‚\nã€€ç¬¬ä¸€æ­¥ï¼šå½“æ”¶åˆ°VIPTableçš„æ›´æ–°è¯·æ±‚æ—¶ï¼Œä¼šæœ‰ä¸€äº›è¿æ¥Aã€Bã€Cè¿˜æ²¡æœ‰è¢«CPUæ’å…¥åˆ°ConnTableï¼Œè¿™æ—¶å¼€å§‹è®°å½•æ–°è¿æ¥Dã€Eã€Fåˆ°TransitTableï¼Œå› ä¸ºVIPTableè¿™æ—¶è¿˜æ²¡æœ‰å¼€å§‹æ›´æ–°ï¼Œæ‰€ä»¥æ–°è¿æ¥Dã€Eã€Fæ˜ å°„åˆ°äº†æ—§ç‰ˆæœ¬çš„DIPæ± ï¼Œå³TransitTableå­˜å‚¨äº†VIPTableæ›´æ–°æ—¶ï¼Œæ˜ å°„åˆ°æ—§DIPæ± ä½†æ²¡æœ‰æ’å…¥åˆ°ConnTableçš„æ–°è¿æ¥ï¼ˆç¬¬äºŒæ­¥ä¸­å¯çŸ¥ï¼Œè¿æ¥Aã€Bã€Cåœ¨VIPTableæ›´æ–°æ—¶å·²ç»æ’å…¥åˆ°äº†ConnTableä¸­ï¼‰ã€‚\nã€€ç¬¬äºŒæ­¥ï¼šå½“æ”¶åˆ°VIPTableæ›´æ–°è¯·æ±‚ä¹‹å‰çš„è¿æ¥Aã€Bã€Céƒ½æ’å…¥åˆ°ConnTableæ—¶ï¼Œåœæ­¢è®°å½•æ–°è¿æ¥åˆ°TransitTableã€‚ç„¶åæ›´æ–°VIPTableã€‚æ›´æ–°å®Œæ¯•åï¼Œæ‰€æœ‰æœªå‘½ä¸­ConnTableçš„æ•°æ®åŒ…éƒ½ä¼šå…ˆç»è¿‡TransitTableï¼Œå¦‚æœå‘½ä¸­TransitTableï¼Œè¯´æ˜è¯¥è¿æ¥åº”è¯¥æ˜ å°„åˆ°æ—§ç‰ˆæœ¬çš„DIPæ± ï¼Œå¦‚æœæœªå‘½ä¸­TransitTableï¼Œåˆ™å°†åŒ¹é…VIPTableï¼Œå°†æ˜ å°„åˆ°æ–°ç‰ˆæœ¬çš„DIPæ± ã€‚\nã€€ç¬¬ä¸‰æ­¥ï¼šå½“TransitTableä¸­çš„æ‰€æœ‰è¿æ¥éƒ½æ’å…¥ConnTableåï¼Œæ¸…é™¤TransitTableï¼Œå®Œæˆè¯¥è¿‡ç¨‹ã€‚\nã€€æ‰€ä»¥ç”±ä»¥ä¸Šä¸‰æ­¥ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•æŒ‚èµ·è¿æ¥å’Œæ—§ç‰ˆæœ¬åˆ°TransitTableä¸­ã€‚è¿›ä¸€æ­¥æ€è€ƒï¼ŒæŒ‚èµ·è¿æ¥è¦ä¹ˆæ˜ å°„åˆ°æ—§ç‰ˆæœ¬ï¼Œè¦ä¹ˆæ˜ å°„åˆ°æ–°ç‰ˆæœ¬ï¼Œè€Œæ ¹æ®DIPPoolTableçš„æ–°ç‰ˆæœ¬åˆ›å»ºè§„åˆ™ï¼Œåˆ›å»ºæ–°ç‰ˆæœ¬æ—¶å…ˆåˆ›å»ºæ—§ç‰ˆæœ¬çš„å‰¯æœ¬ï¼Œç„¶åä¿®æ”¹å‰¯æœ¬ä¸ºæ–°ç‰ˆæœ¬ã€‚æ‰€ä»¥DIPPoolTableä¸­å­˜å‚¨äº†æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œç”¨æ–°ç‰ˆæœ¬å·-1å³å¯æ‰¾åˆ°æ—§ç‰ˆæœ¬ï¼Œæ‰€ä»¥TransitTableä¸­å¯ä»¥åªå­˜å‚¨æŒ‚èµ·è¿æ¥è€Œä¸å¿…å­˜å‚¨æ—§ç‰ˆæœ¬å·ã€‚\nã€€TransitTableä¸­åªå­˜å‚¨è¿æ¥ï¼Œåˆ™å¯ä»¥è½¬åŒ–ä¸ºè¿æ¥æ˜¯å¦å­˜å‚¨åœ¨TransitTableä¸­çš„é—®é¢˜ï¼Œå³å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­çš„é—®é¢˜ã€‚æ‰€ä»¥TransitTableå¯ä»¥ç”¨Bloom Filteræ¥å®ç°ï¼ŒBloom Filterå¯ä»¥èŠ‚çœå¤§é‡å†…å­˜ï¼Œä½†Bloom Filterå¯èƒ½å­˜åœ¨è¯¯æŠ¥ï¼Œå¯¼è‡´è¿æ¥æ˜ å°„åˆ°æ—§ç‰ˆæœ¬ã€‚Bloom Filterå¯ä»¥ç”¨äº‹åŠ¡å¯„å­˜å™¨æ¥å®ç°ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œåœ¨SilkRoadä¸­ï¼ŒTransitTableä¸æ˜¯Match-Actionè¡¨ï¼Œè€Œæ˜¯ç”¨äº‹åŠ¡å¯„å­˜å™¨å®ç°çš„Bloom Filterã€‚Bloom Filterçš„å¤§å°è®¾ç½®å½±å“è¯¯æŠ¥ç‡ï¼ŒSilkroadå°†å…¶å¤§å°è®¾ç½®ä¸º256å­—èŠ‚ã€‚\n3.ä¸¤ä¸ªVIPTableæ›´æ–°çš„ä¾‹å­ ã€€1ï¼‰å¯¹äºæ›´æ–°æ—¶å·²ç»å­˜åœ¨äºConnTableä¸­çš„è¿æ¥ï¼Œå½“DIPæ± æ›´æ–°å‰åï¼Œä¸ä¼šå½±å“PCCã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè™½ç„¶æ›´æ–°äº†v1æ‰€å¯¹åº”çš„DIPæ± ï¼Œä½†ç”±äºDIPPoolTableçš„æ›´æ–°æœºåˆ¶ï¼Œconn_aä»ç„¶èƒ½æ˜ å°„åˆ°åŸæ¥v1çš„DIPæ± ä¸­å»ã€‚\nå›¾3 æ›´æ–°æ—¶å·²å­˜åœ¨äºConnTableçš„è¿æ¥çš„PCC:\r\r ã€€2ï¼‰å¯¹äºæ›´æ–°æ—¶åˆ°è¾¾çš„æ–°è¿æ¥ï¼ŒVIPTableåœ¨æ›´æ–°æ—¶ï¼Œå¤åˆ¶åŸæ¥çš„VIPTableå¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶ååœ¨å‰¯æœ¬ä¸Šä¿®æ”¹ä¸ºæ–°çš„VIPTableï¼ˆLock Free RCUçš„æ€æƒ³ï¼‰ï¼Œä¿®æ”¹å®Œæ¯•åï¼Œå†æ¸…ç©ºæ—§çš„VIPTableå’ŒBloomFilterã€‚æ‰€ä»¥BloomFilteråªéœ€è¦å­˜å‚¨æ–°è¿æ¥æ‘˜è¦ï¼Œè€Œä¸éœ€è¦å­˜å‚¨æ—§çš„ç‰ˆæœ¬å·ã€‚\nå›¾4 æ›´æ–°æ—¶åˆ°è¾¾çš„æ–°è¿æ¥çš„PCC:\r\r 4.ä¸ºä»€ä¹ˆä½¿ç”¨Bloomfilterå­˜å‚¨æ–°è¿æ¥ï¼Ÿ  Silkroadä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å®ç°ç¼“å­˜æ–°è¿æ¥è€Œæ²¡æœ‰ä½¿ç”¨æ•°ç»„ï¼Œå¯èƒ½ä¸æ˜¯å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨çš„é«˜æ€§èƒ½ï¼Œå¯èƒ½å°±æ˜¯æ°å¥½æƒ³åˆ°äº†å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå®éªŒä»¥åå‘ç°èƒ½ç”¨ï¼Œå°±ç”¨äº†ã€‚ å¦‚æœTransitåŸºæœ¬ä¿æŒåœ¨8ä¸ªè¿æ¥ï¼Œè¿æ¥æ‘˜è¦16ä½ï¼Œç”¨è¡¨å­˜å‚¨æ‘˜è¦ï¼Œä¸€å…±å ç”¨16 * 8 =16å­—èŠ‚ï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨å ç”¨256å­—èŠ‚ï¼Œä¸ºä»€ä¹ˆä¸ç”¨Tableï¼Ÿå¯èƒ½æ˜¯CPUå°†è¡¨é¡¹æ’å…¥åˆ°è¡¨ä¸­é€Ÿåº¦è¾ƒæ…¢ï¼Œè€Œå¯„å­˜å™¨è¯»å†™ä¸éœ€è¦ç»è¿‡CPUã€‚ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œå¦‚é¡ºåºæŸ¥æ‰¾ï¼Ÿä¸€ä¸ªå‘¨æœŸå†…å¯¹ä¸€ä¸ªå¯„å­˜å™¨åªèƒ½æ“ä½œä¸€æ¬¡ã€‚  5.æ•´ä½“æ¶æ„ å›¾5 SilkRoadæ€»ä½“æ¶æ„:\r\r ã€€ç³»ç»Ÿæ•´ä½“æ¶æ„å¦‚ä¸Šå›¾æ‰€ç¤º,é™¤äº†å‰æ–‡ä¸­æåˆ°çš„ConnTableï¼ŒVIPTableï¼ŒTransitTableï¼ŒDIPPoolTableä»¥å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªLearnTableï¼Œç”¨æ¥è§¦å‘CPUå­¦ä¹ æ–°è¿æ¥ã€‚\nä¸‰ã€å®ç° ã€€åŸºçº¿switch.p4ä¹‹ä¸Šæ„å»ºäº†SilkRoadçš„P4åŸå‹ï¼Œå¹¶åœ¨å¯ç¼–ç¨‹äº¤æ¢æœºASIC [1]ä¸Šè¿›è¡Œäº†ç¼–è¯‘ã€‚åŸºçº¿switch.p4ä»¥å¤§çº¦5000è¡ŒP4ä»£ç å®ç°äº†å…¸å‹äº‘æ•°æ®ä¸­å¿ƒï¼ˆL2 / L3 / ACL / QoS / \u0026hellip;ï¼‰æ‰€éœ€çš„å„ç§è”ç½‘åŠŸèƒ½ã€‚åŸºçº¿switch.p4çš„ç®€åŒ–ç‰ˆæœ¬åœ¨[16]ä¸­å¼€æºã€‚æˆ‘ä»¬æ·»åŠ äº†çº¦400è¡ŒP4ä»£ç ï¼Œè¿™äº›ä»£ç å®ç°äº†SilkRoadæ‰€éœ€çš„æ‰€æœ‰è¡¨å’Œå…ƒæ•°æ®ï¼ˆå›¾10ï¼‰ã€‚ [32]ä¸­å±•ç¤ºäº†æˆ‘ä»¬åŸå‹çš„æ›´å¤šç»†èŠ‚ã€‚\nã€€æˆ‘ä»¬å°†æ‰€æœ‰è¡¨å®ç°ä¸ºexact-matchè¡¨ï¼Œä½†TransitTableä½œä¸ºäº‹åŠ¡å†…å­˜ä¸Šçš„Bloomè¿‡æ»¤å™¨é™¤å¤–ã€‚ ASICé€šå¸¸æ”¯æŒå­—æ‰“åŒ…ï¼Œè¿™å…è®¸ä¸€æ¬¡æœ‰æ•ˆåœ°ä¸SRAMå—ä¸­çš„å¤šä¸ªå­—åŒ¹é…[19]ã€‚æˆ‘ä»¬ç²¾å¿ƒè®¾è®¡å•è¯æ‰“åŒ…ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜å­˜å‚¨æ•ˆç‡ï¼ŒåŒæ—¶æœ€å¤§ç¨‹åº¦å‡å°‘è¯¯æŠ¥[27]ã€‚\nã€€æˆ‘ä»¬è¿˜åœ¨äº¤æ¢è½¯ä»¶ä¸­å®ç°äº†ä¸€ä¸ªæ§åˆ¶å¹³é¢ï¼Œè¯¥å¹³é¢å¤„ç†æ¥è‡ªå­¦ä¹ è¿‡æ»¤å™¨çš„æ–°è¿æ¥äº‹ä»¶ä»¥åŠæ¥è‡ªConnTableçš„è¿æ¥åˆ°æœŸäº‹ä»¶ã€‚è¯¥è½¯ä»¶è¿è¡Œæœé¹ƒå“ˆå¸Œç®—æ³•ä»¥æ’å…¥æˆ–åˆ é™¤ConnTableä¸­çš„è¿æ¥æ¡ç›®ã€‚æ­¤å¤–ï¼Œæ§åˆ¶å¹³é¢å¯¹DIPæ± æ›´æ–°æ‰§è¡Œ3æ­¥PCCæ›´æ–°ã€‚äº‹ä»¶å’Œæ›´æ–°å¤„ç†ç¨‹åºç”¨å¤§çº¦1000è¡ŒCä»£ç ç¼–å†™ï¼Œè€Œæ¡ç›®æ’å…¥/åˆ é™¤æ˜¯å¼€å…³é©±åŠ¨ç¨‹åºè½¯ä»¶çš„ä¸€éƒ¨åˆ†ã€‚\nå››ã€æ¶‰åŠåˆ°çš„åŸºç¡€çŸ¥è¯† 1.è´Ÿè½½å‡è¡¡(Load Balance) ã€€ç°ä»£è´Ÿè½½å‡è¡¡æŠ€æœ¯é€šå¸¸æ“ä½œäºç½‘ç»œçš„ç¬¬å››å±‚æˆ–ç¬¬ä¸ƒå±‚ã€‚æœ¬æ–‡æåˆ°çš„æ˜¯4å±‚(L4)è´Ÿè½½å‡è¡¡æŠ€æœ¯(å…·ä½“æ˜¯ä»€ä¹ˆGoogleä¸€ä¸‹å§)ã€‚\nã€€å››å±‚çš„è´Ÿè½½å‡è¡¡å°±æ˜¯åŸºäºIP+ç«¯å£çš„è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸‰å±‚è´Ÿè½½å‡è¡¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å‘å¸ƒä¸‰å±‚çš„IPåœ°å€ï¼ˆVIPï¼‰ï¼Œç„¶ååŠ å››å±‚çš„ç«¯å£å·ï¼Œæ¥å†³å®šå“ªäº›æµé‡éœ€è¦åšè´Ÿè½½å‡è¡¡ï¼Œå¯¹éœ€è¦å¤„ç†çš„æµé‡è¿›è¡ŒNATå¤„ç†ï¼Œè½¬å‘è‡³åå°æœåŠ¡å™¨ï¼Œå¹¶è®°å½•ä¸‹è¿™ä¸ªTCPæˆ–è€…UDPçš„æµé‡æ˜¯ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„ï¼Œåç»­è¿™ä¸ªè¿æ¥çš„æ‰€æœ‰æµé‡éƒ½åŒæ ·è½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨å¤„ç†ã€‚\n2.VIP(Virtual IP) ã€€è™šæ‹ŸIP: å°±æ˜¯ä¸€ä¸ªæœªåˆ†é…ç»™çœŸå®ä¸»æœºçš„IPï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹å¤–æä¾›æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºé™¤äº†æœ‰ä¸€ä¸ªçœŸå®IPå¤–è¿˜æœ‰ä¸€ä¸ªè™šIPï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªIPä¸­çš„ ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥è¿æ¥åˆ°è¿™å°ä¸»æœºï¼Œæ‰€æœ‰é¡¹ç›®ä¸­æ•°æ®åº“é“¾æ¥ä¸€é¡¹é…ç½®çš„éƒ½æ˜¯è¿™ä¸ªè™šIPï¼Œå½“æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ— æ³•å¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼ŒåŠ¨æ€å°†è¿™ä¸ªè™šIPåˆ‡æ¢åˆ°å¤‡ç”¨ä¸»æœºã€‚\nã€€ä¾‹ï¼šä¸»æœºAï¼ŒæŸ¥è¯¢ä¸»æœºA IPå¾—åˆ°10.1.2.3ï¼Œä¸»æœºAè¿˜æœ‰ä¸€ä¸ªè™šæ‹ŸIPï¼Œ10.1.2.4ï¼Œå½“ç”¨æˆ·è®¿é—®10.1.2.4æ—¶ï¼Œä¼šè®¿é—®åˆ°ä¸»æœºAï¼Œå½“ç”¨æˆ·è®¿é—®åˆ°10.1.2.3æ—¶ï¼Œä¹Ÿä¼šè®¿é—®åˆ°ä¸»æœºAï¼Œä½†å½“ä¸»æœºAå®•æœºæ—¶ï¼Œå¯ä»¥ä½¿å¾—10.1.2.4æ˜ å°„åˆ°å¤‡ç”¨ä¸»æœºBï¼Œä½¿å¾—è®¿é—®10.1.2.4æ—¶è®¿é—®åˆ°ä¸»æœºBï¼Œä»è€Œè¾¾åˆ°é«˜å¯ç”¨çš„æ•ˆæœã€‚\n3.DIP(Direct IP) ã€€ç›´æ¥IPï¼Œå³çœŸå®çš„IPåœ°å€ã€‚\n4.è¿æ¥æ±  ã€€è¿æ¥æ± çš„ä½œç”¨å°±æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†å·²ç»åˆ›å»ºå¥½çš„è¿æ¥ä¿å­˜åœ¨æ± ä¸­ï¼Œå½“æœ‰è¯·æ±‚æ¥æ—¶ï¼Œç›´æ¥ä½¿ç”¨å·²ç»åˆ›å»ºå¥½çš„è¿æ¥å¯¹Serverç«¯è¿›è¡Œè®¿é—®ã€‚è¿™æ ·çœç•¥äº†åˆ›å»ºè¿æ¥å’Œé”€æ¯è¿æ¥çš„è¿‡ç¨‹ï¼ˆTCPè¿æ¥å»ºç«‹æ—¶çš„ä¸‰æ¬¡æ¡æ‰‹å’Œé”€æ¯æ—¶çš„å››æ¬¡æ¡æ‰‹ï¼‰ï¼Œä»è€Œåœ¨æ€§èƒ½ä¸Šå¾—åˆ°äº†æé«˜ã€‚\n5.æ€§èƒ½éš”ç¦»(Performance Isolation) ã€€ä¸€å°æœåŠ¡å™¨å®ä¾‹ä¸ºå¤šä¸ªVIPæä¾›æœåŠ¡æ—¶å„ä¸ªVIPè·å¾—çš„æœåŠ¡äº’ä¸å½±å“ï¼Œåˆ™ç§°ä¸ºæ€§èƒ½éš”ç¦»ã€‚\n6.DIPæ± æ›´æ–° ã€€å‘DIPæ± ä¸­æ·»åŠ æˆ–åˆ é™¤DIPã€‚å¤§éƒ¨åˆ†DIPæ± æ›´æ–°æ¥è‡ªäºæœåŠ¡å‡çº§ï¼Œå³æœåŠ¡å‡çº§ä¼šå¯¼è‡´DIPæ± ä¸­DIPçš„æ·»åŠ æˆ–åˆ é™¤ã€‚\n7.å¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter) ã€€ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ã€‚åˆ¤å®šä¸å­˜åœ¨çš„å…ƒç´ ä¸€å®šä¸å­˜åœ¨ï¼Œåˆ¤å®šå­˜åœ¨çš„å…ƒç´ å¯èƒ½ä¸å­˜åœ¨ã€‚\n","description":"åœ¨switch.p4çš„åŸºç¡€ä¸Šç¼–å†™400è¡ŒP4ä»£ç ï¼Œåœ¨ä¸€å°å¯ç¼–ç¨‹ASICäº¤æ¢æœºä¸Šå®ç°ç™¾ä¸‡è¿æ¥çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»£æ›¿å¤šè¾¾æ•°ç™¾ä¸ªè½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸»è¦è§£å†³æ¯ä¸ªè¿æ¥ä¸€è‡´æ€§é—®é¢˜","id":32,"section":"posts","tags":["P4"],"title":"SilkRoad ï¼šä½¿ç”¨ASICäº¤æ¢æœºä½œä¸ºé«˜é€Ÿä½æˆæœ¬çš„æœ‰çŠ¶æ€å››å±‚è´Ÿè½½å‡è¡¡å™¨","uri":"https://yyyIce.github.io/zh/posts/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBsilkroad/"},{"content":"Sample images from Pixabay\n","description":"éšä¾¿ç»ƒç‚¹ä»€ä¹ˆ","id":33,"section":"gallery","tags":null,"title":"ç»ƒä¹ ","uri":"https://yyyIce.github.io/zh/gallery/%E7%BB%83%E4%B9%A0/"},{"content":"å’¸é±¼çš„åšå®¢ã€‚\nè¿™ä¸€é¡µæ²¡æ„æ€å¥½æ€ä¹ˆå†™ã€‚\nä»¥åå†è¯´å§ğŸ‘\n","description":"About myself","id":34,"section":"","tags":null,"title":"å…³äºæˆ‘","uri":"https://yyyIce.github.io/zh/about/"}]